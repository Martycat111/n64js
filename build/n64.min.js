var fj=Object.defineProperty;var pj=(J,q)=>{for(var Q in q)fj(J,Q,{get:q[Q],enumerable:!0,configurable:!0,set:(Z)=>q[Q]=()=>Z})};var g6=31,BJ=0,Eq=1,Tq=2,_q=3,bq=4,Sq=5,IX=6,wX=7,vq=8,i8=9,P8=10,AJ=11,S0=12,d0=13,t6=14,n9=15,xq=16,a9=17;var BX=20,AX=21,CX=22,RX=23,yX=24,EX=25,uK=26,gK=27,fK=28,pK=29,uq=30,TX=31,_X=2,mK=0,cK=1,bX=2,SX=3,oK=4,dK=5;var lK=8,nK=9,aK=10,rK=11,sK=12,iK=13;var tK=15;function q5(J){switch(J){case 67:case 68:case 70:case 72:case 73:case 76:case 80:case 83:case 85:case 87:case 88:case 89:case 96:return 0;case 66:return 2;case 55:case 65:case 69:case 71:case 74:case 75:case 78:return 1}return 1}function Q5(J){const q=String.fromCharCode(J),Q=mj.get(q);if(Q)return Q;return`unknown code ${q}`}var CJ=0,fq=1,eK=2;var J5=69;var mj=new Map([["N","Game Pak"],["D","64DD Disk"],["C","Expandable Game: Game Pak Part"],["E","Expandable Game: 64DD Disk Part"],["Z","Aleck64 Game Pak"]]);function Z5(J,q,Q){const Z=q.sp_mem.subRegion(4096,4096);J.setControlU64(S0,0x00000000_34000000n),J.setControlU64(xq,0x00000000_7006e463n),J.setControlU64(i8,0x00000000_00005000n),J.setControlU64(d0,0x00000000_0000005cn),J.setControlU64(n9,0x00000000_00000b22n),J.setControlU64(bq,0x00000000_007ffff0n),J.setControlU64(t6,0xffffffff_ffffffffn),J.setControlU64(vq,0xffffffff_ffffffffn),J.setControlU64(uq,0xffffffff_ffffffffn),J.cop1ControlChanged();const X=0x00000000_00000000n;if(J.setRegU64(0,X),J.setRegU64(1,X),J.setRegU64(2,0xffffffff_d1731be9n),J.setRegU64(3,0xffffffff_d1731be9n),J.setRegU64(4,0x00000000_00001be9n),J.setRegU64(5,0xffffffff_f45231e5n),J.setRegU64(6,0xffffffff_a4001f0cn),J.setRegU64(7,0xffffffff_a4001f08n),J.setRegU64(8,0x00000000_000000c0n),J.setRegU64(9,X),J.setRegU64(10,0x00000000_00000040n),J.setRegU64(11,0xffffffff_a4000040n),J.setRegU64(16,X),J.setRegU64(17,X),J.setRegU64(18,X),J.setRegU64(19,X),J.setRegU64(20,BigInt(Q.tvType)),J.setRegU64(21,X),J.setRegU64(23,0x00000000_00000006n),J.setRegU64(24,X),J.setRegU64(25,0xffffffff_d73f2993n),J.setRegU64(26,X),J.setRegU64(27,X),J.setRegU64(28,X),J.setRegU64(29,0xffffffff_a4001ff0n),J.setRegU64(30,X),J.setRegU64(31,0xffffffff_a4001554n),Q.tvType==CJ){switch(Q.cic){case"6102":J.setRegU64(5,0xffffffff_c0f1d859n),J.setRegU64(14,0x00000000_2de108ean),J.setRegU64(24,X);break;case"6103":J.setRegU64(5,0xffffffff_d4646273n),J.setRegU64(14,0x00000000_1af99984n),J.setRegU64(24,X);break;case"6105":J.setRegU64(5,0xffffffff_decaaad1n),J.setRegU64(14,0x00000000_0cf85c13n),J.setRegU64(24,0x00000000_00000002n);break;case"6106":J.setRegU64(5,0xffffffff_b04dc903n),J.setRegU64(14,0x00000000_1af99984n),J.setRegU64(24,0x00000000_00000002n);break;default:break}J.setRegU64(20,X),J.setRegU64(23,0x00000000_00000006n),J.setRegU64(31,0xffffffff_a4001554n)}else{switch(Q.cic){case"6102":J.setRegU64(5,0xffffffff_c95973d5n),J.setRegU64(14,0x00000000_2449a366n);break;case"6103":J.setRegU64(5,0xffffffff_95315a28n),J.setRegU64(14,0x00000000_5baca1dfn);break;case"6105":J.setRegU64(5,0x00000000_5493fb9an),J.setRegU64(14,0xffffffff_c2c20384n);break;case"6106":J.setRegU64(5,0xffffffff_e067221fn),J.setRegU64(14,0x00000000_5cd2b70fn);break;default:break}J.setRegU64(20,0x00000000_00000001n),J.setRegU64(23,X),J.setRegU64(24,0x00000000_00000003n),J.setRegU64(31,0xffffffff_a4001550n)}switch(Q.cic){case"6101":J.setRegU64(22,0x00000000_0000003fn);break;case"6102":J.setRegU64(1,0x00000000_00000001n),J.setRegU64(2,0x00000000_0ebda536n),J.setRegU64(3,0x00000000_0ebda536n),J.setRegU64(4,0x00000000_0000a536n),J.setRegU64(12,0xffffffff_ed10d0b3n),J.setRegU64(13,0x00000000_1402a4ccn),J.setRegU64(15,0x00000000_3103e121n),J.setRegU64(22,0x00000000_0000003fn),J.setRegU64(25,0xffffffff_9debb54fn);break;case"6103":J.setRegU64(1,0x00000000_00000001n),J.setRegU64(2,0x00000000_49a5ee96n),J.setRegU64(3,0x00000000_49a5ee96n),J.setRegU64(4,0x00000000_0000ee96n),J.setRegU64(12,0xffffffff_ce9dfbf7n),J.setRegU64(13,0xffffffff_ce9dfbf7n),J.setRegU64(15,0x00000000_18b63d28n),J.setRegU64(22,0x00000000_00000078n),J.setRegU64(25,0xffffffff_825b21c9n);break;case"6105":Z.set32(0,1007534016),Z.set32(4,Q.tvType==CJ?3181905916:2376599548),Z.set32(8,632096704),Z.set32(12,822608000),Z.set32(16,1426128892),Z.set32(20,1007534016),Z.set32(24,2376597540),Z.set32(28,1007398912),J.setRegU64(1,X),J.setRegU64(2,0xffffffff_f58b0fbfn),J.setRegU64(3,0xffffffff_f58b0fbfn),J.setRegU64(4,0x00000000_00000fbfn),J.setRegU64(12,0xffffffff_9651f81en),J.setRegU64(13,0x00000000_2d42aac5n),J.setRegU64(15,0x00000000_56584d60n),J.setRegU64(22,0x00000000_00000091n),J.setRegU64(25,0xffffffff_cdce565fn);break;case"6106":J.setRegU64(1,X),J.setRegU64(2,0xffffffff_a95930a4n),J.setRegU64(3,0xffffffff_a95930a4n),J.setRegU64(4,0x00000000_000030a4n),J.setRegU64(12,0xffffffff_bcb59510n),J.setRegU64(13,0xffffffff_bcb59510n),J.setRegU64(15,0x00000000_7a3c07f4n),J.setRegU64(22,0x00000000_00000085n),J.setRegU64(25,0x00000000_465e3f72n);break;default:break}J.pc=2751463488}var vX=function(J){return(J>>26&63)===28};class xX{constructor(J){this.hardware=J,this.breakpoints=new Map}reset(){this.breakpoints.clear()}toggle(J){const q=this.hardware.memMap.readMemoryInternal32(J);let Q;if(vX(q))Q=this.breakpoints[J]||0,delete this.breakpoints[J];else Q=28<<26,this.breakpoints[J]=q;this.hardware.memMap.writeMemoryInternal32(J,Q)}isBreakpoint(J){const q=this.hardware.memMap.readMemoryInternal32(J);return vX(q)}getInstruction(J){const q=this.hardware.memMap.readMemoryInternal32(J);if(vX(q))return this.breakpoints[J]||0;return q}}function X5(J,q){let Q=J.toString();while(Q.length<q)Q="0"+Q;return Q}function v(J,q){let Q;if(typeof J=="bigint"){const X=q?(1n<<BigInt(q))-1n:0xffff_ffff_ffff_ffffn;Q=J&X}else{const X=q&&q<32?(1<<q)-1:4294967295;Q=(Number(J)&X)>>>0}let Z=Q.toString(16);if(q){const X=q>>2;while(Z.length<X)Z="0"+Z}return Z}function v0(J){return"0x"+v(J,8)}function Q0(J){return"0x"+v(J,16)}function N(J){return"0x"+v(J,32)}function M8(J){return"0x"+v(J,64)}function e(J){return J.nameOf=(q)=>{for(let Q in J)if(Object.prototype.hasOwnProperty.call(J,Q)&&J[Q]===q)return Q;return N(q)},Object.freeze(J)}var W5=32768,F5=16384,uX=8192,$5=4096,H5=2048,G5=1024,j5=512,N5=256,L5=32,V5=16,U5=8,P5=4,M5=2,h5=1,B0=e({RightBottom:0,RightRight:1,RightLeft:2,RightTop:3,TopLeft:4,TopRight:5,BottomLeft:6,BottomRight:7,CenterLeft:8,CenterRight:9,LeftStick:10,RightStick:11,LeftTop:12,LeftBottom:13,LeftLeft:14,LeftRight:15,CenterCenter:16}),Y5=17,z5=e({AxisLeftX:0,AxisLeftY:1,AxisRightX:2,AxisRightY:3}),K5=4;class pq{constructor(){this.buttons=0,this.stick_x=0,this.stick_y=0}}class gX{constructor(){this.inputs=[new pq,new pq,new pq,new pq];const J=document.querySelector("body");J.addEventListener("keyup",(q)=>{this.handleKey(0,q.key,!1)}),J.addEventListener("keydown",(q)=>{this.handleKey(0,q.key,!0)}),this.gamepads={},this.activeGamepadidx=-1,window.addEventListener("gamepadconnected",(q)=>{this.connectGamepad(q)},!1),window.addEventListener("gamepaddisconnected",(q)=>{this.disconnectGamepad(q)},!1),this.controllerMapping=new k5}handleKey(J,q,Q){switch(q){case"a":this.setButton(J,$5,Q);break;case"s":this.setButton(J,W5,Q);break;case"x":this.setButton(J,F5,Q);break;case"z":this.setButton(J,uX,Q);break;case"y":this.setButton(J,uX,Q);break;case"c":this.setButton(J,L5,Q);break;case"v":this.setButton(J,V5,Q);break;case"t":this.setButton(J,H5,Q);break;case"g":this.setButton(J,G5,Q);break;case"f":this.setButton(J,j5,Q);break;case"h":this.setButton(J,N5,Q);break;case"i":this.setButton(J,U5,Q);break;case"k":this.setButton(J,P5,Q);break;case"j":this.setButton(J,M5,Q);break;case"l":this.setButton(J,h5,Q);break;case"ArrowLeft":this.setStickX(J,Q?-80:0);break;case"ArrowRight":this.setStickX(J,Q?80:0);break;case"ArrowDown":this.setStickY(J,Q?-80:0);break;case"ArrowUp":this.setStickY(J,Q?80:0);break}}setStickX(J,q){this.inputs[J].stick_x=q}setStickY(J,q){this.inputs[J].stick_y=q}setButton(J,q,Q){let Z=this.inputs[J].buttons;if(Q)Z|=q;else Z&=~q;this.inputs[J].buttons=Z}connectGamepad(J){const q=J.gamepad;if(console.log(`Gamepad connected at index ${q.index}: ${q.id}. ${q.buttons.length} buttons, ${q.axes.length} axes.`),this.gamepads[q.index]=q,this.activeGamepadidx<0)if(this.isStandardGamepad(q))this.activeGamepadidx=q.index;else console.log("Gamepad mapping is non-standard, ignoring")}disconnectGamepad(J){const q=J.gamepad;if(delete this.gamepads[q.index],q.index==this.activeGamepadidx)this.activeGamepadidx=-1}isStandardGamepad(J){if(J.mapping!=="standard")return console.log(`gamepad mapping is unhandled: (${J.mapping})`),!1;if(J.axes.length<K5)return console.log(`gamepad has too few axes: ${J.axes.length} < ${K5}`),!1;if(J.buttons.length<Y5)return console.log(`gamepad has too few buttons: ${J.buttons.length} < ${Y5}`),!1;if(typeof J.buttons[0]!=="object")return console.log("gamepad buttons element is not object"),!1;return!0}updateInput(){if(this.activeGamepadidx<0)return;const J=navigator.getGamepads()[this.activeGamepadidx];if(!J.connected){console.log("gamepad not connected");return}const q=J.buttons;this.controllerMapping.mappings.forEach((Q,Z)=>{if(Q.gpModifier===void 0?!0:q[Q.gpModifier].pressed==Q.gpModifierDown)this.setButton(0,Z,q[Q.gpButton].pressed)}),this.setStickX(0,J.axes[z5.AxisLeftX]*80),this.setStickY(0,J.axes[z5.AxisLeftY]*-80)}}class k5{constructor(){const J=new Map;this.mappings=J,J.set(U5,new r0(B0.RightTop,B0.BottomLeft,!0)),J.set(P5,new r0(B0.RightBottom,B0.BottomLeft,!0)),J.set(M5,new r0(B0.RightLeft,B0.BottomLeft,!0)),J.set(h5,new r0(B0.RightRight,B0.BottomLeft,!0)),J.set(W5,new r0(B0.RightBottom,B0.BottomLeft,!1)),J.set(F5,new r0(B0.RightRight,B0.BottomLeft,!1)),J.set(L5,new r0(B0.TopLeft)),J.set(V5,new r0(B0.TopRight)),J.set($5,new r0(B0.CenterRight)),J.set(uX,new r0(B0.BottomRight)),J.set(H5,new r0(B0.LeftTop)),J.set(G5,new r0(B0.LeftBottom)),J.set(j5,new r0(B0.LeftLeft)),J.set(N5,new r0(B0.LeftRight))}}class r0{constructor(J,q,Q){this.gpButton=J,this.gpModifier=q,this.gpModifierDown=Q}}function D5(J,q){$6=J,mq=q}function O5(){if($6)$6.html("")}function h(J){if(mq)J=`${mq()}: ${J}`;if(console.log(J),$6)$6.append(`${J}<br>`),$6.scrollTop($6[0].scrollHeight)}function I5(J){if(mq)J=`${mq()}: ${J}`;if(console.warn(J),$6)$6.append(`<font color="yellow">${J}</font><br>`),$6.scrollTop($6[0].scrollHeight)}function w5(J){if($6)$6.append(J)}var $6,mq;function B5(){t8=void 0,e6=void 0}function A5(){return t8||e6?!0:!1}function C5(J){let Q=J;for(let Z of[t8,e6]){if(!Z)continue;if(!Z.tick())Q=0;let X=Math.floor(Z.getAvailableBytes()/8);X=Math.max(0,X-100),Q=Math.min(Q,X)}return Q}var t8=null,e6=null;function E5(J,q,Q){let Z=11,X=R5;for(let Y=0;Y<Q;Y++){q[Y]=Z+5*J[Y]&15,Z=X[q[Y]];const z=q[Y]>>3&1;let W=((z==1?~q[Y]:q[Y])&7)%3==1?z:1-z;if(X==y5){if(q[Y]==1||q[Y]==9)W=1;if(q[Y]==11||q[Y]==14)W=0}X=W==1?y5:R5}}var R5=[4,7,10,7,14,5,14,1,12,15,8,15,6,3,6,9],y5=[4,1,10,7,14,5,14,1,12,9,8,5,6,3,12,9];var u5=function(J,q,Q){let Z=0;for(let X=0;X<Q;X++){const Y=J[q+X];for(let z=0;z<8;z++)Z=(Z<<1|Y>>>7-z&1)^(Z&128?133:0)}for(let X=8;X!==0;X--)Z=Z<<1^(Z&128?133:0);return Z&255},g5=function(J){let q=0;for(let Q=0;Q<16;Q++)q=(q<<1|J>>>15-Q&1)^(q&16?21:0);return q&31},oj=5,cq=64,T5=63,f5=0,dj=1,lj=2,nj=3,aj=4,rj=5,sj=6,ij=7,tj=8,p5=255,ej=0,J3=253,_5=254,q3=255,b5=0,fX=1,S5=2,v5=16,Q3=128,Z3=192,x5=1280;var X3=64,Y3=128;class pX{constructor(J,q){this.hardware=J,this.pifRam=this.hardware.pif_mem.subRegion(1984,64);const Q=new oq(q[0]);Q.present=!0,Q.attachControllerPack(J.mempacks[0]),this.channels=[Q,new oq(q[1]),new oq(q[2]),new oq(q[3]),new m5(J)]}get controlByte(){return this.pifRam.getU8(T5)}set controlByte(J){this.pifRam.set8(T5,J)}cpuRead(J){}cpuWrite(J){}dmaWrite(J,q){if(this.pifRam.copy(0,J,q,cq),this.controlByte&1)this.controlByte&=~1,this.configure()}dmaRead(J,q){if(this.controlByte&2)this.processCICChallenge();else this.execute();J.copy(q,this.pifRam,0,cq)}processCICChallenge(){const J=new Uint8Array(30),q=new Uint8Array(30);for(let Q=0;Q<15;++Q)J[Q*2+0]=this.pifRam.u8[48+Q]>>>4&15,J[Q*2+1]=this.pifRam.u8[48+Q]>>>0&15;E5(J,q,30);for(let Q=0;Q<15;++Q)this.pifRam.u8[48+Q]=(q[Q*2]<<4)+q[Q*2+1];this.pifRam.u8[46]=0,this.pifRam.u8[47]=0}configure(){for(let Q of this.channels)Q.init();let J=0,q=0;while(J<cq&&q<oj){const Q=this.pifRam.u8.subarray(J),Z=Q[0];if(J++,Z==_5)break;if(Z==q3)continue;if(Z==ej){q++;continue}if(Z==J3){this.channels[q].reset=!0,q++;continue}if(J>=cq)break;const X=Q[1];if(J++,X==_5)break;const Y=Z&63,z=J;J+=Y;const K=X&63,W=J;if(J+=K,J>=cq)break;const G=this.pifRam.u8.subarray(z,z+Y),H=this.pifRam.u8.subarray(W,W+K);this.channels[q].joybusConfigure(Q,Y,K,G,H),q++}}execute(){for(let J of this.channels){if(J.reset)continue;if(J.skip)continue;const q=J.frame[0],Q=J.frame[1];if(q&128)continue;if(q&64)continue;const Z=q&63,X=Q&63,Y=J.joybusCommand(Z,X,J.txBuf,J.rxBuf);if(Y<X)J.frame[1]|=Y3;if(Y>X)J.frame[1]|=X3}}}class mX{constructor(){this.init()}expectTx(J,q,Q){if(q!=Q)h(`${J}: got tx ${q} but expect ${Q}`)}init(){this.frame=0,this.tx=0,this.rx=0,this.txBuf=null,this.rxBuf=null,this.skip=!0,this.reset=!1}joybusConfigure(J,q,Q,Z,X){this.frame=J,this.tx=q,this.rx=Q,this.txBuf=Z,this.rxBuf=X,this.skip=!1}}class oq extends mX{constructor(J){super();this.inputs=J,this.present=!1,this.attachment=b5,this.memory=null,this.rumbleActive=!1}attachControllerPack(J){this.attachment=fX,this.memory=J}joybusCommand(J,q,Q,Z){if(!this.present)return 0;const X=Q[0];switch(X){case p5:return this.getStatus(J,q,Q,Z);case f5:return this.getStatus(J,q,Q,Z);case dj:return this.readController(J,q,Q,Z);case lj:return this.readAccessory(J,q,Q,Z);case nj:return this.writeAccessory(J,q,Q,Z)}return n64js.halt("Unknown controller command "+X),0}getStatus(J,q,Q,Z){return this.expectTx("kCmdGetStatus",J,1),Z[0]=x5>>>8,Z[1]=x5&255,Z[2]=this.attachment==b5?2:1,3}readController(J,q,Q,Z){this.expectTx("kCmdControllerRead",J,1);let X=this.inputs.buttons,Y=this.inputs.stick_x,z=this.inputs.stick_y;if(e6)e6.sync32(3203395597,"input"),X=e6.reflect32(X),Y=e6.reflect32(Y),z=e6.reflect32(z);return Z[0]=X>>>8,Z[1]=X&255,Z[2]=Y,Z[3]=z,4}readAccessory(J,q,Q,Z){this.expectTx("kCmdControllerAccessoryRead",J,3);const X=Q[1]<<8|Q[2]&224;if((Q[2]&31)!=g5(X))return 0;switch(this.attachment){case fX:const z=this.memory.data;for(let K=0,W=X;K<q-1;K++,W++)Z[K]=W<z.length?z[W]:0;break;case S5:for(let K=0,W=X;K<q-1;K++,W++){let G;if(W<32768)G=0;else if(W<36864)G=128;else G=this.rumbleActive?255:0;Z[K]=G}break;default:return 0}return Z[q-1]=u5(Z,0,q-1),q}writeAccessory(J,q,Q,Z){this.expectTx("kCmdControllerAccessoryWrite",J,35);const X=Q[1]<<8|Q[2]&224;if((Q[2]&31)!=g5(X))return 0;switch(this.attachment){case fX:const z=this.memory.data;this.memory.dirty=!0;for(let K=0,W=X;K<J-3;K++,W++)if(W<z.length)z[W]=Q[3+K];break;case S5:if(X>=49152)this.rumbleActive=Q[3]&1;break;default:return 0}return Z[q-1]=u5(Q,3,J-3),q}}class m5 extends mX{constructor(J){super();this.hardware=J}joybusCommand(J,q,Q,Z){const X=Q[0];switch(X){case p5:return this.getStatus(J,q,Q,Z);case f5:return this.getStatus(J,q,Q,Z);case aj:return this.readEeprom(J,q,Q,Z);case rj:return this.writeEeprom(J,q,Q,Z);case sj:return this.rtcStatus(J,q,Q,Z);case ij:return this.rtcRead(J,q,Q,Z);case tj:return this.rtcWrite(J,q,Q,Z)}return n64js.halt(`Unknown cartridge command: ${X}`),0}getEepromID(){switch(this.hardware.saveType){case"Eeprom4k":return Q3;case"Eeprom16k":return Z3}return 0}getEeprom(){switch(this.hardware.saveType){case"Eeprom4k":case"Eeprom16k":return this.hardware.saveMem}return null}getStatus(J,q,Q,Z){this.expectTx("kCmdGetStatus",J,1);const X=this.getEepromID();if(!X)return 0;return Z[0]=X>>>8,Z[1]=X&255,Z[2]=0,3}readEeprom(J,q,Q,Z){this.expectTx("kCmdEepromRead",J,2);const X=this.getEeprom();if(!X)return 0;const Y=Q[1]*8;for(let z=0;z<q;++z)Z[z]=X.u8[Y+z];return q}writeEeprom(J,q,Q,Z){this.expectTx("kCmdEepromWrite",J,10);const X=this.getEeprom();if(!X)return 0;const Y=Q[1]*8;for(let z=0;z<J-2;++z)X.u8[Y+z]=Q[2+z];return this.hardware.saveDirty=!0,Z[0]=0,1}rtcStatus(J,q,Q,Z){return Z[0]=v5>>>8,Z[1]=v5&255,Z[2]=0,3}rtcRead(J,q,Q,Z){return n64js.warn("rtc read unhandled"),0}rtcWrite(J,q,Q,Z){return n64js.warn("rtc write unhandled"),0}}function q0(J,q){if(!J)throw new c5(q)}class c5{constructor(J){this.message=J}toString(){return"AssertException: "+this.message}}function RJ(J){return J>>>26&63}function yJ(J){return J>>>16&31}function EJ(J){return J&63}function H6(J){return J>>>21&31}function o5(J){return J>>>16&3}function G6(J){return J&63}function J8(J){return J>>>6&31}function W0(J){return J>>>11&31}function f6(J){return J>>>16&31}function G0(J){return(J&65535)<<16>>16}function J6(J){return J>>>6&31}function u(J){return J>>>11&31}function I(J){return J>>>16&31}function y(J){return J>>>21&31}function TJ(J){return J&63}function z3(J){return J&67108863}function q8(J){return J&65535}function g(J){return(J&65535)<<16>>16}function d(J){return J>>>21&31}function l0(J,q){return J+4+G0(q)*4>>>0}function h8(J,q){return(J&4026531840|z3(q)*4)>>>0}var K3=function(J){return G0(J)&65535},d5=function(J){return G0(J)<<16>>16},D=function(){return"?"},F3=function(J){return n5[EJ(J.opcode)](J)},$3=function(J){return a5[H6(J.opcode)](J)},H3=function(J){switch(q0((J.opcode>>>18&7)===0,"cc bit is not 0"),o5(J.opcode)){case 0:return`BC1F      !c ? --> ${J.branchAddress}`;case 1:return`BC1T      c ? --> ${J.branchAddress}`;case 2:return`BC1FL     !c ? --> ${J.branchAddress}`;case 3:return`BC1TL     c ? --> ${J.branchAddress}`}return"???"},r9=function(J,q){const Q=q.toUpperCase();switch(G6(J.opcode)){case 0:return`ADD.${Q}     ${J.fd(q)} = ${J.fs(q)} + ${J.ft(q)}`;case 1:return`SUB.${Q}     ${J.fd(q)} = ${J.fs(q)} - ${J.ft(q)}`;case 2:return`MUL.${Q}     ${J.fd(q)} = ${J.fs(q)} * ${J.ft(q)}`;case 3:return`DIV.${Q}     ${J.fd(q)} = ${J.fs(q)} / ${J.ft(q)}`;case 4:return`SQRT.${Q}    ${J.fd(q)} = sqrt(${J.fs(q)})`;case 5:return`ABS.${Q}     ${J.fd(q)} = abs(${J.fs(q)})`;case 6:return`MOV.${Q}     ${J.fd(q)} = ${J.fs(q)}`;case 7:return`NEG.${Q}     ${J.fd(q)} = -${J.fs(q)}`;case 8:return`ROUND.L.${Q} ${J.fd("l")} = round.l(${J.fs(q)})`;case 9:return`TRUNC.L.${Q} ${J.fd("l")} = trunc.l(${J.fs(q)})`;case 10:return`CEIL.L.${Q}  ${J.fd("l")} = ceil.l(${J.fs(q)})`;case 11:return`FLOOR.L.${Q} ${J.fd("l")} = floor.l(${J.fs(q)})`;case 12:return`ROUND.W.${Q} ${J.fd("w")} = round.w(${J.fs(q)})`;case 13:return`TRUNC.W.${Q} ${J.fd("w")} = trunc.w(${J.fs(q)})`;case 14:return`CEIL.W.${Q}  ${J.fd("w")} = ceil.w(${J.fs(q)})`;case 15:return`FLOOR.W.${Q} ${J.fd("w")} = floor.w(${J.fs(q)})`;case 32:return`CVT.S.${Q}   ${J.fd("s")} = (s)${J.fs(q)}`;case 33:return`CVT.D.${Q}   ${J.fd("d")} = (d)${J.fs(q)}`;case 36:return`CVT.W.${Q}   ${J.fd("w")} = (w)${J.fs(q)}`;case 37:return`CVT.L.${Q}   ${J.fd("l")} = (l)${J.fs(q)}`;case 48:return`C.F.${Q}     c = ${J.fs(q)} cmp ${J.ft(q)}`;case 49:return`C.UN.${Q}    c = ${J.fs(q)} cmp ${J.ft(q)}`;case 50:return`C.EQ.${Q}    c = ${J.fs(q)} cmp ${J.ft(q)}`;case 51:return`C.UEQ.${Q}   c = ${J.fs(q)} cmp ${J.ft(q)}`;case 52:return`C.OLT.${Q}   c = ${J.fs(q)} cmp ${J.ft(q)}`;case 53:return`C.ULT.${Q}   c = ${J.fs(q)} cmp ${J.ft(q)}`;case 54:return`C.OLE.${Q}   c = ${J.fs(q)} cmp ${J.ft(q)}`;case 55:return`C.ULE.${Q}   c = ${J.fs(q)} cmp ${J.ft(q)}`;case 56:return`C.SF.${Q}    c = ${J.fs(q)} cmp ${J.ft(q)}`;case 57:return`C.NGLE.${Q}  c = ${J.fs(q)} cmp ${J.ft(q)}`;case 58:return`C.SEQ.${Q}   c = ${J.fs(q)} cmp ${J.ft(q)}`;case 59:return`C.NGL.${Q}   c = ${J.fs(q)} cmp ${J.ft(q)}`;case 60:return`C.LT.${Q}    c = ${J.fs(q)} cmp ${J.ft(q)}`;case 61:return`C.NGE.${Q}   c = ${J.fs(q)} cmp ${J.ft(q)}`;case 62:return`C.LE.${Q}    c = ${J.fs(q)} cmp ${J.ft(q)}`;case 63:return`C.NGT.${Q}   c = ${J.fs(q)} cmp ${J.ft(q)}`}return`Cop1.${q}${v(G6(J.opcode),8)}?`},G3=function(J){return r9(J,"s")},j3=function(J){return r9(J,"d")},N3=function(J){return r9(J,"w")},L3=function(J){return r9(J,"l")},V3=function(J){return r5[H6(J.opcode)](J)},U3=function(J){return f,s5[H6(J.opcode)](J)},P3=function(J){return i5[H6(J.opcode)](J)},M3=function(J){switch(TJ(J.opcode)){case 1:return"TLBR";case 2:return"TLBWI";case 6:return"TLBWR";case 8:return"TLBP";case 24:return"ERET"}return"Unk"},h3=function(J){return t5[yJ(J.opcode)](J)};function dX(J,q,Q){const Z=new l5(J,q,Q),X=e5[RJ(q)](Z);return{instruction:Z,disassembly:X,isJumpTarget:!1}}function JW(J,q,Q){const Z=n64js.breakpoints(),X=[],Y=new Set;for(let z=J;z<q;z+=4){const K=Z.getInstruction(z),W=dX(z,K,Q);if(W.instruction.target)Y.add(W.instruction.target);X.push(W)}for(let z of X)if(Y.has(z.instruction.address))z.isJumpTarget=!0;return X}window.n64js=window.n64js||{};var cX=["r0","at","v0","v1","a0","a1","a2","a3","t0","t1","t2","t3","t4","t5","t6","t7","s0","s1","s2","s3","s4","s5","s6","s7","t8","t9","k0","k1","gp","sp","s8","ra"],_J=["Index","Rand","EntryLo0","EntryLo1","Context","PageMask","Wired","?7","BadVAddr","Count","EntryHi","Compare","SR","Cause","EPC","PrID","Config","LLAddr","WatchLo","WatchHi","XContext","?21","?22","?23","?24","?25","ECC","CacheErr","TagLo","TagHi","ErrorEPC","?31"],oX=["f00","f01","f02","f03","f04","f05","f06","f07","f08","f09","f10","f11","f12","f13","f14","f15","f16","f17","f18","f19","f20","f21","f22","f23","f24","f25","f26","f27","f28","f29","f30","f31"],W3=["GR00","GR01","GR02","GR03","GR04","GR05","GR06","GR07","GR08","GR09","GR10","GR11","GR12","GR13","GR14","GR15","GR16","GR17","GR18","GR19","GR20","GR21","GR22","GR23","GR24","GR25","GR26","GR27","GR28","GR29","GR30","GR31"];class l5{constructor(J,q,Q){this.address=J,this.opcode=q,this.srcRegs={},this.dstRegs={},this.target="",this.memory=null,this.outputHTML=Q}get rt_d(){const J=this.cop0RegName(I);return this.dstRegs[J]=1,this.makeRegSpan(J)}get rd(){const J=this.cop0RegName(u);return this.dstRegs[J]=1,this.makeRegSpan(J)}get rt(){const J=this.cop0RegName(I);return this.srcRegs[J]=1,this.makeRegSpan(J)}get rs(){const J=this.cop0RegName(y);return this.srcRegs[J]=1,this.makeRegSpan(J)}get sa(){return J6(this.opcode)}cop0RegName(J){return cX[J(this.opcode)]}writesRA(){return this.dstRegs[g6]=1,""}ft_d(J){const q=this.cop1RegName(f6,J);return this.dstRegs[q]=1,this.makeFPRegSpan(q)}fs_d(J){const q=this.cop1RegName(W0,J);return this.dstRegs[q]=1,this.makeFPRegSpan(q)}fd(J){const q=this.cop1RegName(J8,J);return this.dstRegs[q]=1,this.makeFPRegSpan(q)}ft(J){const q=this.cop1RegName(f6,J);return this.srcRegs[q]=1,this.makeFPRegSpan(q)}fs(J){const q=this.cop1RegName(W0,J);return this.srcRegs[q]=1,this.makeFPRegSpan(q)}cop1RegName(J,q){const Q=J(this.opcode),Z=q?`-${q}`:"";return oX[Q]+Z}get gt_d(){const J=this.cop2RegName(I);return this.dstRegs[J]=1,this.makeRegSpan(J)}get gd(){const J=this.cop2RegName(u);return this.dstRegs[J]=1,this.makeRegSpan(J)}get gt(){const J=this.cop2RegName(I);return this.srcRegs[J]=1,this.makeRegSpan(J)}get gs(){const J=this.cop2RegName(y);return this.srcRegs[J]=1,this.makeRegSpan(J)}cop2RegName(J){return W3[J(this.opcode)]}get imm(){return`0x${v(q8(this.opcode),16)}`}get branchAddress(){return this.target=l0(this.address,this.opcode),this.makeLabelText(this.target)}get jumpAddress(){return this.target=h8(this.address,this.opcode),this.makeLabelText(this.target)}get base(){const J=this.cop0RegName(d);return this.srcRegs[J]=1,this.makeRegSpan(J)}get offsetU16(){return`0x${v(K3(this.opcode),16)}`}get offsetS16(){return`0x${v(d5(this.opcode),16)}`}memaccess(J){return this.memory={reg:d(this.opcode),offset:d5(this.opcode),mode:J},`[${this.base}+${this.offsetU16}]`}memload(){return this.memaccess("load")}memstore(){return this.memaccess("store")}makeLabelText(J){if(this.outputHTML)return`<span class="dis-address-jump">${v(J,32)}</span>`;return v(J,32)}makeRegSpan(J){if(this.outputHTML)return`<span class="dis-reg-${J}">${J}</span>`;return J}makeFPRegSpan(J){const q=J.replace("-",".");if(this.outputHTML)return`<span class="dis-reg-${J}">${q}</span>`;return q}}var n5=[(J)=>{if(J.opcode===0)return"NOP";return`SLL       ${J.rd} = ${J.rt} << ${J.sa}`},D,(J)=>`SRL       ${J.rd} = ${J.rt} >>> ${J.sa}`,(J)=>`SRA       ${J.rd} = ${J.rt} >> ${J.sa}`,(J)=>`SLLV      ${J.rd} = ${J.rt} << ${J.rs}`,D,(J)=>`SRLV      ${J.rd} = ${J.rt} >>> ${J.rs}`,(J)=>`SRAV      ${J.rd} = ${J.rt} >> ${J.rs}`,(J)=>`JR        ${J.rs}`,(J)=>`JALR      ${J.rd}, ${J.rs}`,D,D,(J)=>`SYSCALL   ${v(J.opcode>>6&1048575,20)}`,(J)=>`BREAK     ${v(J.opcode>>6&1048575,20)}`,D,(J)=>"SYNC",(J)=>`MFHI      ${J.rd} = MultHi`,(J)=>`MTHI      MultHi = ${J.rs}`,(J)=>`MFLO      ${J.rd} = MultLo`,(J)=>`MTLO      MultLo = ${J.rs}`,(J)=>`DSLLV     ${J.rd} = ${J.rt} << ${J.rs}`,D,(J)=>`DSRLV     ${J.rd} = ${J.rt} >>> ${J.rs}`,(J)=>`DSRAV     ${J.rd} = ${J.rt} >> ${J.rs}`,(J)=>`MULT      ${J.rs} * ${J.rt}`,(J)=>`MULTU     ${J.rs} * ${J.rt}`,(J)=>`DIV       ${J.rs} / ${J.rt}`,(J)=>`DIVU      ${J.rs} / ${J.rt}`,(J)=>`DMULT     ${J.rs} * ${J.rt}`,(J)=>`DMULTU    ${J.rs} * ${J.rt}`,(J)=>`DDIV      ${J.rs} / ${J.rt}`,(J)=>`DDIVU     ${J.rs} / ${J.rt}`,(J)=>`ADD       ${J.rd} = ${J.rs} + ${J.rt}`,(J)=>`ADDU      ${J.rd} = ${J.rs} + ${J.rt}`,(J)=>`SUB       ${J.rd} = ${J.rs} - ${J.rt}`,(J)=>`SUBU      ${J.rd} = ${J.rs} - ${J.rt}`,(J)=>`AND       ${J.rd} = ${J.rs} & ${J.rt}`,(J)=>{if(I(J.opcode)===0)if(y(J.opcode)===0)return`CLEAR     ${J.rd} = 0`;else return`MOV       ${J.rd} = ${J.rs}`;return`OR        ${J.rd} = ${J.rs} | ${J.rt}`},(J)=>`XOR       ${J.rd} = ${J.rs} ^ ${J.rt}`,(J)=>`NOR       ${J.rd} = ~( ${J.rs} | ${J.rt} )`,D,D,(J)=>`SLT       ${J.rd} = ${J.rs} < ${J.rt}`,(J)=>`SLTU      ${J.rd} = ${J.rs} < ${J.rt}`,(J)=>`DADD      ${J.rd} = ${J.rs} + ${J.rt}`,(J)=>`DADDU     ${J.rd} = ${J.rs} + ${J.rt}`,(J)=>`DSUB      ${J.rd} = ${J.rs} - ${J.rt}`,(J)=>`DSUBU     ${J.rd} = ${J.rs} - ${J.rt}`,(J)=>`TGE       trap( ${J.rs} >= ${J.rt} )`,(J)=>`TGEU      trap( ${J.rs} >= ${J.rt} )`,(J)=>`TLT       trap( ${J.rs} < ${J.rt} )`,(J)=>`TLTU      trap( ${J.rs} < ${J.rt} )`,(J)=>`TEQ       trap( ${J.rs} == ${J.rt} )`,D,(J)=>`TNE       trap( ${J.rs} != ${J.rt} )`,D,(J)=>`DSLL      ${J.rd} = ${J.rt} << ${J.sa}`,D,(J)=>`DSRL      ${J.rd} = ${J.rt} >>> ${J.sa}`,(J)=>`DSRA      ${J.rd} = ${J.rt} >> ${J.sa}`,(J)=>`DSLL32    ${J.rd} = ${J.rt} << (32+${J.sa})`,D,(J)=>`DSRL32    ${J.rd} = ${J.rt} >>> (32+${J.sa})`,(J)=>`DSRA32    ${J.rd} = ${J.rt} >> (32+${J.sa})`];if(n5.length!=64)throw"Oops, didn't build the special table correctly";var a5=[(J)=>`MFC0      ${J.rt} <- ${_J[W0(J.opcode)]}`,(J)=>`DMFC0     ${J.rt} <- ${_J[W0(J.opcode)]}`,D,D,(J)=>`MTC0      ${J.rt} -> ${_J[W0(J.opcode)]}`,(J)=>`DMTC0     ${J.rt} -> ${_J[W0(J.opcode)]}`,D,D,D,D,D,D,D,D,D,D,M3,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D];if(a5.length!=32)throw"Oops, didn't build the cop0 table correctly";var r5=[(J)=>`MFC1      ${J.rt_d} = ${J.fs()}`,(J)=>`DMFC1     ${J.rt_d} = ${J.fs()}`,(J)=>`CFC1      ${J.rt_d} = CCR${u(J.opcode)}`,(J)=>`DCFC1     ${J.rt_d} = CCR${u(J.opcode)}`,(J)=>`MTC1      ${J.fs_d()} = ${J.rt}`,(J)=>`DMTC1     ${J.fs_d()} = ${J.rt}`,(J)=>`CTC1      CCR${u(J.opcode)} = ${J.rt}`,(J)=>`DCTC1     CCR${u(J.opcode)} = ${J.rt}`,H3,D,D,D,D,D,D,D,G3,j3,D,D,N3,L3,D,D,D,D,D,D,D,D,D,D];if(r5.length!=32)throw"Oops, didn't build the cop1 table correctly";var s5=[(J)=>`MFC2      ${J.rt_d} = ${J.fs()}`,(J)=>`DMFC2     ${J.rt_d} = ${J.fs()}`,(J)=>`CFC2      ${J.rt_d} = CCR${u(J.opcode)}`,(J)=>`DCFC2     ${J.rt_d} = CCR${u(J.opcode)}`,(J)=>`MTC2      ${J.fs_d()} = ${J.rt}`,(J)=>`DMTC2     ${J.fs_d()} = ${J.rt}`,(J)=>`CTC2      CCR${u(J.opcode)} = ${J.rt}`,(J)=>`DCTC2     CCR${u(J.opcode)} = ${J.rt}`,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D];if(s5.length!=32)throw"Oops, didn't build the cop2 table correctly";var i5=[(J)=>`MFC3      ${J.rt_d} = ${J.fs()}`,(J)=>`DMFC3     ${J.rt_d} = ${J.fs()}`,(J)=>`CFC3      ${J.rt_d} = CCR${u(J.opcode)}`,(J)=>`DCFC3     ${J.rt_d} = CCR${u(J.opcode)}`,(J)=>`MTC3      ${J.fs_d()} = ${J.rt}`,(J)=>`DMTC3     ${J.fs_d()} = ${J.rt}`,(J)=>`CTC3      CCR${u(J.opcode)} = ${J.rt}`,(J)=>`DCTC3     CCR${u(J.opcode)} = ${J.rt}`,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D];if(i5.length!=32)throw"Oops, didn't build the cop3 table correctly";var t5=[(J)=>`BLTZ      ${J.rs} < 0 --> ${J.branchAddress}`,(J)=>`BGEZ      ${J.rs} >= 0 --> ${J.branchAddress}`,(J)=>`BLTZL     ${J.rs} < 0 --> ${J.branchAddress}`,(J)=>`BGEZL     ${J.rs} >= 0 --> ${J.branchAddress}`,D,D,D,D,(J)=>`TGEI      ${J.rs} >= ${J.rt} --> trap `,(J)=>`TGEIU     ${J.rs} >= ${J.rt} --> trap `,(J)=>`TLTI      ${J.rs} < ${J.rt} --> trap `,(J)=>`TLTIU     ${J.rs} < ${J.rt} --> trap `,(J)=>`TEQI      ${J.rs} == ${J.rt} --> trap `,D,(J)=>`TNEI      ${J.rs} != ${J.rt} --> trap `,D,(J)=>`BLTZAL    ${J.rs} < 0 --> ${J.branchAddress}${J.writesRA()}`,(J)=>`BGEZAL    ${J.rs} >= 0 --> ${J.branchAddress}${J.writesRA()}`,(J)=>`BLTZALL   ${J.rs} < 0 --> ${J.branchAddress}${J.writesRA()}`,(J)=>`BGEZALL   ${J.rs} >= 0 --> ${J.branchAddress}${J.writesRA()}`,D,D,D,D,D,D,D,D,D,D,D,D];if(t5.length!=32)throw"Oops, didn't build the special table correctly";var e5=[F3,h3,(J)=>`J         --> ${J.jumpAddress}`,(J)=>`JAL       --> ${J.jumpAddress}${J.writesRA()}`,(J)=>{if(y(J.opcode)==I(J.opcode))return`B         --> ${J.branchAddress}`;return`BEQ       ${J.rs} == ${J.rt} --> ${J.branchAddress}`},(J)=>`BNE       ${J.rs} != ${J.rt} --> ${J.branchAddress}`,(J)=>`BLEZ      ${J.rs} <= 0 --> ${J.branchAddress}`,(J)=>`BGTZ      ${J.rs} > 0 --> ${J.branchAddress}`,(J)=>`ADDI      ${J.rt_d} = ${J.rs} + ${J.imm}`,(J)=>`ADDIU     ${J.rt_d} = ${J.rs} + ${J.imm}`,(J)=>`SLTI      ${J.rt_d} = (${J.rs} < ${J.imm})`,(J)=>`SLTIU     ${J.rt_d} = (${J.rs} < ${J.imm})`,(J)=>`ANDI      ${J.rt_d} = ${J.rs} & ${J.imm}`,(J)=>`ORI       ${J.rt_d} = ${J.rs} | ${J.imm}`,(J)=>`XORI      ${J.rt_d} = ${J.rs} ^ ${J.imm}`,(J)=>`LUI       ${J.rt_d} = ${J.imm} << 16`,$3,V3,U3,P3,(J)=>`BEQL      ${J.rs} == ${J.rt} --> ${J.branchAddress}`,(J)=>`BNEL      ${J.rs} != ${J.rt} --> ${J.branchAddress}`,(J)=>`BLEZL     ${J.rs} <= 0 --> ${J.branchAddress}`,(J)=>`BGTZL     ${J.rs} > 0 --> ${J.branchAddress}`,(J)=>`DADDI     ${J.rt_d} = ${J.rs} + ${J.imm}`,(J)=>`DADDIU    ${J.rt_d} = ${J.rs} + ${J.imm}`,(J)=>`LDL       ${J.rt_d} <- ${J.memload()}`,(J)=>`LDR       ${J.rt_d} <- ${J.memload()}`,D,D,D,D,(J)=>`LB        ${J.rt_d} <- ${J.memload()}`,(J)=>`LH        ${J.rt_d} <- ${J.memload()}`,(J)=>`LWL       ${J.rt_d} <- ${J.memload()}`,(J)=>`LW        ${J.rt_d} <- ${J.memload()}`,(J)=>`LBU       ${J.rt_d} <- ${J.memload()}`,(J)=>`LHU       ${J.rt_d} <- ${J.memload()}`,(J)=>`LWR       ${J.rt_d} <- ${J.memload()}`,(J)=>`LWU       ${J.rt_d} <- ${J.memload()}`,(J)=>`SB        ${J.rt} -> ${J.memstore()}`,(J)=>`SH        ${J.rt} -> ${J.memstore()}`,(J)=>`SWL       ${J.rt} -> ${J.memstore()}`,(J)=>`SW        ${J.rt} -> ${J.memstore()}`,(J)=>`SDL       ${J.rt} -> ${J.memstore()}`,(J)=>`SDR       ${J.rt} -> ${J.memstore()}`,(J)=>`SWR       ${J.rt} -> ${J.memstore()}`,(J)=>`CACHE     ${v(I(J.opcode),8)}, ${J.memaccess()}`,(J)=>`LL        ${J.rt_d} <- ${J.memload()}`,(J)=>`LWC1      ${J.ft_d()} <- ${J.memload()}`,D,D,(J)=>`LLD       ${J.rt_d} <- ${J.memload()}`,(J)=>`LDC1      ${J.ft_d()} <- ${J.memload()}`,(J)=>`LDC2      ${J.gt_d} <- ${J.memload()}`,(J)=>`LD        ${J.rt_d} <- ${J.memload()}`,(J)=>`SC        ${J.rt} -> ${J.memstore()}`,(J)=>`SWC1      ${J.ft()} -> ${J.memstore()}`,(J)=>"BREAKPOINT",D,(J)=>`SCD       ${J.rt} -> ${J.memstore()}`,(J)=>`SDC1      ${J.ft()} -> ${J.memstore()}`,(J)=>`SDC2      ${J.gt} -> ${J.memstore()}`,(J)=>`SD        ${J.rt} -> ${J.memstore()}`];if(e5.length!=64)throw"Oops, didn't build the simple table correctly";var WW=function(J){return J&63},k3=function(J){return J>>>6&31},e8=function(J){return J>>>11&31},i9=function(J){return J>>>16&31},s9=function(J){return J>>>21&31},D3=function(J){return J>>>26&63},qW=function(J){return J>>>21&31},O3=function(J){return J>>>16&31},dq=function(J){return J>>>7&15},QW=function(J){return(J&127)<<25>>25},ZW=function(J){return J>>>21&15},I3=function(J){return J>>>11&31},w3=function(J){return J>>>16&31},B3=function(J){return J>>>11&31},A3=function(J){return J>>>6&31},C3=function(J){return J&67108863},lX=function(J){return J&65535},R3=function(J){return lX(J)<<16>>16},XW=function(J){return J>>>21&31},YW=function(J){return lX(J)<<16>>16},y3=function(J){return J&65535},E3=function(J,q){return J+4+R3(q)*4},T3=function(J,q){return J&4026531840|C3(q)*4},zW=function(J){return v(J,16)},bJ=function(J){return J},p3=function(J){return f3[WW(J.opcode)](J)},k8=function(J){return`unknown: ${N(J.opcode)}`};function lq(J,q){const Q=new FW(J,q),Z=o3[D3(q)](Q);return{address:J,instruction:Q,disassembly:Z,isJumpTarget:!1}}function t9(J,q,Q){return aX(J,q,q,Q-q)}function aX(J,q,Q,Z){const X=[],Y=new Set,z=J.length-1;for(let K=0;K<Z;K+=4){const W=J.getU32(Q+K&z),G=lq(q+K,W);if(G.instruction.target)Y.add(G.instruction.target);X.push(G)}for(let K of X)if(Y.has(K.instruction.address))K.isJumpTarget=!0;return X}function $W(J,q,Q,Z){let X="";for(let Y=0;Y<Z;Y+=4)X+=`${v(q+Y,16)}: ${v(J.getU32(Q+Y),32)}\n`;return X}var nX=["r0","at","v0","v1","a0","a1","a2","a3","t0","t1","t2","t3","t4","t5","t6","t7","s0","s1","s2","s3","s4","s5","s6","s7","t8","t9","k0","k1","gp","sp","s8","ra"],_3=31,KW=["SP_MEM_ADDR_REG","SP_DRAM_ADDR_REG","SP_RD_LEN_REG","SP_WR_LEN_REG","SP_STATUS_REG","SP_DMA_FULL_REG","SP_DMA_BUSY_REG","SP_SEMAPHORE_REG","DPC_START_REG","DPC_END_REG","DPC_CURRENT_REG","DPC_STATUS_REG","DPC_CLOCK_REG","DPC_BUFBUSY_REG","DPC_PIPEBUSY_REG","DPC_TMEM_REG"],b3=["VCO","VCC","VCE","VCE"],S3=["All","All1","0q","1q","0h","1h","2h","3h","0","1","2","3","4","5","6","7"];class FW{constructor(J,q){this.address=J,this.opcode=q,this.srcRegs={},this.dstRegs={},this.target="",this.memory=null}get rd(){const J=this.gprName(e8);return this.dstRegs[J]=1,bJ(J)}get rt(){const J=this.gprName(i9);return this.srcRegs[J]=1,bJ(J)}get rs(){const J=this.gprName(s9);return this.srcRegs[J]=1,bJ(J)}get rt_d(){const J=this.gprName(i9);return this.dstRegs[J]=1,bJ(J)}get c0reg(){const J=e8(this.opcode);if(J<KW.length)return KW[J];return`c0reg${J}`}get cop2E(){return`${ZW(this.opcode)}`}get cop2DE(){return`${I3(this.opcode)}`}get cop2VD(){return`V${A3(this.opcode)}`}get cop2VT(){return`V${w3(this.opcode)}`}get cop2VS(){return`V${B3(this.opcode)}`}get cop2VecSelect(){return S3[ZW(this.opcode)]}get c2flag(){return b3[e8(this.opcode)&3]}get sa(){return k3(this.opcode)}gprName(J){return nX[J(this.opcode)]}writesRA(){return this.dstRegs[_3]=1,""}get imm(){return`0x${v(lX(this.opcode),16)}`}get branchAddress(){return this.target=E3(this.address,this.opcode),zW(this.target)}get jumpAddress(){return this.target=T3(this.address,this.opcode),zW(this.target)}get base(){const J=this.gprName(XW);return this.srcRegs[J]=1,bJ(J)}get offsetU16(){return`0x${v(y3(this.opcode),16)}`}get offsetS16(){return`0x${v(YW(this.opcode),16)}`}memload(){return this.memaccess("load")}memstore(){return this.memaccess("store")}memaccess(J){return this.memory={reg:XW(this.opcode),offset:YW(this.opcode),mode:J},`[${this.base}+${this.offsetU16}]`}get vmemEl(){return`E${dq(this.opcode)}`}vmemEls(J){return`[${dq(this.opcode)}..${dq(this.opcode)+J-1&15}]`}get vmemVT(){return`V${O3(this.opcode)}`}get vmemBase(){const J=this.gprName(qW);return this.srcRegs[J]=1,bJ(J)}vmemload(J){return this.vmemaccess("load",J)}vmemstore(J){return this.vmemaccess("store",J)}vmemaccess(J,q){return q=q||1,this.memory={reg:qW(this.opcode),offset:QW(this.opcode)*q,mode:J},`[${this.vmemBase}${this.sprintVOffset(q)}]`}sprintVOffset(J){const q=QW(this.opcode)*J;return(q>=0?"+":"")+q.toString()}}var v3=(()=>{let J=[];for(let q=0;q<64;q++)J[q]=k8;return J[0]=(q)=>{if(q.opcode===0)return"NOP";return`SLL       ${q.rd} = ${q.rt} << ${q.sa}`},J[2]=(q)=>`SRL       ${q.rd} = ${q.rt} >>> ${q.sa}`,J[3]=(q)=>`SRA       ${q.rd} = ${q.rt} >> ${q.sa}`,J[4]=(q)=>`SLLV      ${q.rd} = ${q.rt} << ${q.rs}`,J[6]=(q)=>`SRLV      ${q.rd} = ${q.rt} >>> ${q.rs}`,J[7]=(q)=>`SRAV      ${q.rd} = ${q.rt} >> ${q.rs}`,J[8]=(q)=>`JR        ${q.rs}`,J[9]=(q)=>`JALR      ${q.rd}, ${q.rs}`,J[13]=(q)=>`BREAK     ${v(q.opcode>>6&1048575,20)}`,J[32]=(q)=>`ADD       ${q.rd} = ${q.rs} + ${q.rt}`,J[33]=(q)=>`ADDU      ${q.rd} = ${q.rs} + ${q.rt}`,J[34]=(q)=>`SUB       ${q.rd} = ${q.rs} - ${q.rt}`,J[35]=(q)=>`SUBU      ${q.rd} = ${q.rs} - ${q.rt}`,J[36]=(q)=>`AND       ${q.rd} = ${q.rs} & ${q.rt}`,J[37]=(q)=>`OR        ${q.rd} = ${q.rs} | ${q.rt}`,J[38]=(q)=>`XOR       ${q.rd} = ${q.rs} ^ ${q.rt}`,J[39]=(q)=>`NOR       ${q.rd} = ~( ${q.rs} | ${q.rt} )`,J[42]=(q)=>`SLT       ${q.rd} = ${q.rs} < ${q.rt}`,J[43]=(q)=>`SLTU      ${q.rd} = ${q.rs} < ${q.rt}`,J})(),x3=(()=>{let J=[];for(let q=0;q<32;q++)J.push(k8);return J[0]=(q)=>`BLTZ      ${q.rs} < 0 --> ${q.branchAddress}`,J[1]=(q)=>`BGEZ      ${q.rs} >= 0 --> ${q.branchAddress}`,J[16]=(q)=>`BLTZAL    ${q.rs} < 0 --> ${q.branchAddress}${q.writesRA()}`,J[17]=(q)=>`BGEZAL    ${q.rs} >= 0 --> ${q.branchAddress}${q.writesRA()}`,J})(),u3=(()=>{let J=[];for(let q=0;q<32;q++)J.push(k8);return J[0]=(q)=>`MFC0      ${q.rt_d} <- ${q.c0reg}`,J[4]=(q)=>`MTC0      ${q.rt} -> ${q.c0reg}`,J})(),g3=(()=>{let J=[];for(let q=0;q<32;q++)J.push(k8);J[0]=(q)=>`MFC2      ${q.rt_d} = ${e8(q.opcode)}[${dq(q.opcode)}]`,J[2]=(q)=>`CFC2      ${q.rt_d} = ${q.c2flag}`,J[4]=(q)=>`MTC2      V${e8(q.opcode)}[${dq(q.opcode)}] = ${q.rt}`,J[6]=(q)=>`CTC2      ${q.c2flag} = ${q.rt}`;for(let q=16;q<32;q++)J[q]=p3;return J})(),f3=(()=>{let J=[];for(let q=0;q<64;q++)J.push(k8);return J[0]=(q)=>`VMULF     ${q.cop2VD} = ${q.cop2VS} * ${q.cop2VT}[${q.cop2VecSelect}]`,J[1]=(q)=>`VMULU     ${q.cop2VD} = ${q.cop2VS} * ${q.cop2VT}[${q.cop2VecSelect}]`,J[2]=(q)=>`VRNDP     ${q.cop2VD} = ${q.cop2VS} * ${q.cop2VT}[${q.cop2VecSelect}]`,J[3]=(q)=>`VMULQ     ${q.cop2VD} = ${q.cop2VS} * ${q.cop2VT}[${q.cop2VecSelect}]`,J[4]=(q)=>`VMUDL     ${q.cop2VD} = ${q.cop2VS} * ${q.cop2VT}[${q.cop2VecSelect}]`,J[5]=(q)=>`VMUDM     ${q.cop2VD} = ${q.cop2VS} * ${q.cop2VT}[${q.cop2VecSelect}]`,J[6]=(q)=>`VMUDN     ${q.cop2VD} = ${q.cop2VS} * ${q.cop2VT}[${q.cop2VecSelect}]`,J[7]=(q)=>`VMUDH     ${q.cop2VD} = ${q.cop2VS} * ${q.cop2VT}[${q.cop2VecSelect}]`,J[8]=(q)=>`VMACF     ${q.cop2VD} = ${q.cop2VS} * ${q.cop2VT}[${q.cop2VecSelect}]`,J[9]=(q)=>`VMACU     ${q.cop2VD} = ${q.cop2VS} * ${q.cop2VT}[${q.cop2VecSelect}]`,J[10]=(q)=>`VRNDN     ${q.cop2VD} = ${q.cop2VS} * ${q.cop2VT}[${q.cop2VecSelect}]`,J[11]=(q)=>`VMACQ     ${q.cop2VD}, ACC = oddify(ACC)`,J[12]=(q)=>`VMADL     ${q.cop2VD} = ${q.cop2VS} * ${q.cop2VT}[${q.cop2VecSelect}]`,J[13]=(q)=>`VMADM     ${q.cop2VD} = ${q.cop2VS} * ${q.cop2VT}[${q.cop2VecSelect}]`,J[14]=(q)=>`VMADN     ${q.cop2VD} = ${q.cop2VS} * ${q.cop2VT}[${q.cop2VecSelect}]`,J[15]=(q)=>`VMADH     ${q.cop2VD} = ${q.cop2VS} * ${q.cop2VT}[${q.cop2VecSelect}]`,J[16]=(q)=>`VADD      ${q.cop2VD} = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[17]=(q)=>`VSUB      ${q.cop2VD} = ${q.cop2VS} - ${q.cop2VT}[${q.cop2VecSelect}]`,J[18]=(q)=>`VSUT      ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[19]=(q)=>`VABS      ${q.cop2VD} = sign(${q.cop2VS}) * ${q.cop2VT}[${q.cop2VecSelect}]`,J[20]=(q)=>`VADDC     ${q.cop2VD} = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[21]=(q)=>`VSUBC     ${q.cop2VD} = ${q.cop2VS} - ${q.cop2VT}[${q.cop2VecSelect}]`,J[22]=(q)=>`VADDB     ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[23]=(q)=>`VSUBB     ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[24]=(q)=>`VACCB     ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[25]=(q)=>`VSUCB     ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[26]=(q)=>`VSAD      ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[27]=(q)=>`VSAC      ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[28]=(q)=>`VSUM      ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[29]=(q)=>`VSAR      ${q.cop2VD}, ${q.cop2VS}, ${q.cop2VT}[${q.cop2E}]`,J[30]=(q)=>`V30       ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[31]=(q)=>`V31       ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[32]=(q)=>`VLT       ${q.cop2VD}, CC = cmpLT(${q.cop2VS}, ${q.cop2VT}[${q.cop2VecSelect}])`,J[33]=(q)=>`VEQ       ${q.cop2VD}, CC = cmpEQ(${q.cop2VS}, ${q.cop2VT}[${q.cop2VecSelect}])`,J[34]=(q)=>`VNE       ${q.cop2VD}, CC = cmpNE(${q.cop2VS}, ${q.cop2VT}[${q.cop2VecSelect}])`,J[35]=(q)=>`VGE       ${q.cop2VD}, CC = cmpGE(${q.cop2VS}, ${q.cop2VT}[${q.cop2VecSelect}])`,J[36]=(q)=>`VCL       ${q.cop2VD}, ACC = ${q.cop2VS} clip ${q.cop2VT}[${q.cop2VecSelect}]`,J[37]=(q)=>`VCH       ${q.cop2VD}, ACC = ${q.cop2VS} clip ${q.cop2VT}[${q.cop2VecSelect}]`,J[38]=(q)=>`VCR       ${q.cop2VD}, ACC = ${q.cop2VS} crimp ${q.cop2VT}[${q.cop2VecSelect}]`,J[39]=(q)=>`VMRG      ${q.cop2VD} = VCC ? ${q.cop2VS} : ${q.cop2VT}[${q.cop2VecSelect}]`,J[40]=(q)=>`VAND      ${q.cop2VD} = ${q.cop2VS} & ${q.cop2VT}[${q.cop2VecSelect}]`,J[41]=(q)=>`VNAND     ${q.cop2VD} = ~(${q.cop2VS} & ${q.cop2VT}[${q.cop2VecSelect}])`,J[42]=(q)=>`VOR       ${q.cop2VD} = ${q.cop2VS} | ${q.cop2VT}[${q.cop2VecSelect}]`,J[43]=(q)=>`VNOR      ${q.cop2VD} = ~(${q.cop2VS} | ${q.cop2VT}[${q.cop2VecSelect}])`,J[44]=(q)=>`VXOR      ${q.cop2VD} = ${q.cop2VS} ^ ${q.cop2VT}[${q.cop2VecSelect}]`,J[45]=(q)=>`VNXOR     ${q.cop2VD} = ~(${q.cop2VS} ^ ${q.cop2VT}[${q.cop2VecSelect}])`,J[46]=(q)=>`V46       ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[47]=(q)=>`V47       ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[48]=(q)=>`VRCP      ${q.cop2VD}[${q.cop2DE}] = 1/${q.cop2VT}[${q.cop2VecSelect}]`,J[49]=(q)=>`VRCPL     ${q.cop2VD}[${q.cop2DE}] = 1/${q.cop2VT}[${q.cop2VecSelect}]`,J[50]=(q)=>`VRCPH     ${q.cop2VD}[${q.cop2DE}], DIVIN = DIVOUT, ${q.cop2VT}[${q.cop2VecSelect}]`,J[51]=(q)=>`VMOV      ${q.cop2VD}[${q.cop2DE}] = ${q.cop2VT}[${q.cop2VecSelect}]`,J[52]=(q)=>`VRSQ      ${q.cop2VD}[${q.cop2DE}] = 1/sqrt(${q.cop2VT}[${q.cop2VecSelect}])`,J[53]=(q)=>`VRSQL     ${q.cop2VD}[${q.cop2DE}] = 1/sqrt(${q.cop2VT}[${q.cop2VecSelect}])`,J[54]=(q)=>`VRSQH     ${q.cop2VD}[${q.cop2DE}], DIVIN = DIVOUT, ${q.cop2VT}[${q.cop2VecSelect}]`,J[55]=(q)=>"VNOP",J[56]=(q)=>`VEXTT     ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[57]=(q)=>`VEXTQ     ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[58]=(q)=>`VEXTN     ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[59]=(q)=>`V59       ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[60]=(q)=>`VINST     ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[61]=(q)=>`VINSQ     ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[62]=(q)=>`VINSN     ${q.cop2VD} = 0, ACC = ${q.cop2VS} + ${q.cop2VT}[${q.cop2VecSelect}]`,J[63]=(q)=>"VNULL",J})(),m3=(()=>{let J=[];for(let q=0;q<32;q++)J.push(k8);return J[0]=(q)=>`LBV       ${q.vmemVT}${q.vmemEls(1)} <- ${q.vmemload(1)}`,J[1]=(q)=>`LSV       ${q.vmemVT}${q.vmemEls(2)} <- ${q.vmemload(2)}`,J[2]=(q)=>`LLV       ${q.vmemVT}${q.vmemEls(3)} <- ${q.vmemload(4)}`,J[3]=(q)=>`LDV       ${q.vmemVT}${q.vmemEls(4)} <- ${q.vmemload(8)}`,J[4]=(q)=>`LQV       ${q.vmemVT} <- ${q.vmemload(16)}`,J[5]=(q)=>`LRV       ${q.vmemVT} <- ${q.vmemload(16)}`,J[6]=(q)=>`LPV       ${q.vmemVT} <- ${q.vmemload(8)}`,J[7]=(q)=>`LUV       ${q.vmemVT} <- ${q.vmemload(8)}`,J[8]=(q)=>`LHV       ${q.vmemVT} <- ${q.vmemload(16)}`,J[9]=(q)=>`LFV       ${q.vmemVT} <- ${q.vmemload(16)}`,J[10]=(q)=>`LWV       ${q.vmemVT} <- ${q.vmemload(16)}`,J[11]=(q)=>`LTV       ${q.vmemVT} <- ${q.vmemload(16)}`,J})(),c3=(()=>{let J=[];for(let q=0;q<32;q++)J.push(k8);return J[0]=(q)=>`SBV       ${q.vmemVT}${q.vmemEls(1)} -> ${q.vmemstore(1)}`,J[1]=(q)=>`SSV       ${q.vmemVT}${q.vmemEls(2)} -> ${q.vmemstore(2)}`,J[2]=(q)=>`SLV       ${q.vmemVT}${q.vmemEls(4)} -> ${q.vmemstore(4)}`,J[3]=(q)=>`SDV       ${q.vmemVT}${q.vmemEls(8)} -> ${q.vmemstore(8)}`,J[4]=(q)=>`SQV       ${q.vmemVT} -> ${q.vmemstore(16)}`,J[5]=(q)=>`SRV       ${q.vmemVT} -> ${q.vmemstore(16)}`,J[6]=(q)=>`SPV       ${q.vmemVT} -> ${q.vmemstore(8)}`,J[7]=(q)=>`SUV       ${q.vmemVT} -> ${q.vmemstore(8)}`,J[8]=(q)=>`SHV       ${q.vmemVT} -> ${q.vmemstore(16)}`,J[9]=(q)=>`SFV       ${q.vmemVT} -> ${q.vmemstore(16)}`,J[10]=(q)=>`SWV       ${q.vmemVT} -> ${q.vmemstore(16)}`,J[11]=(q)=>`STV       ${q.vmemVT} -> ${q.vmemstore(16)}`,J})(),o3=(()=>{let J=[];for(let q=0;q<64;q++)J.push(k8);return J[0]=(q)=>v3[WW(q.opcode)](q),J[1]=(q)=>x3[i9(q.opcode)](q),J[2]=(q)=>`J         --> ${q.jumpAddress}`,J[3]=(q)=>`JAL       --> ${q.jumpAddress}${q.writesRA()}`,J[4]=(q)=>{if(s9(q.opcode)==i9(q.opcode))return`B         --> ${q.branchAddress}`;return`BEQ       ${q.rs} == ${q.rt} --> ${q.branchAddress}`},J[5]=(q)=>`BNE       ${q.rs} != ${q.rt} --> ${q.branchAddress}`,J[6]=(q)=>`BLEZ      ${q.rs} <= 0 --> ${q.branchAddress}`,J[7]=(q)=>`BGTZ      ${q.rs} > 0 --> ${q.branchAddress}`,J[8]=(q)=>`ADDI      ${q.rt_d} = ${q.rs} + ${q.imm}`,J[9]=(q)=>`ADDIU     ${q.rt_d} = ${q.rs} + ${q.imm}`,J[10]=(q)=>`SLTI      ${q.rt_d} = (${q.rs} < ${q.imm})`,J[11]=(q)=>`SLTIU     ${q.rt_d} = (${q.rs} < ${q.imm})`,J[12]=(q)=>`ANDI      ${q.rt_d} = ${q.rs} & ${q.imm}`,J[13]=(q)=>`ORI       ${q.rt_d} = ${q.rs} | ${q.imm}`,J[14]=(q)=>`XORI      ${q.rt_d} = ${q.rs} ^ ${q.imm}`,J[15]=(q)=>`LUI       ${q.rt_d} = ${q.imm} << 16`,J[16]=(q)=>u3[s9(q.opcode)](q),J[18]=(q)=>g3[s9(q.opcode)](q),J[32]=(q)=>`LB        ${q.rt_d} <- ${q.memload()}`,J[33]=(q)=>`LH        ${q.rt_d} <- ${q.memload()}`,J[35]=(q)=>`LW        ${q.rt_d} <- ${q.memload()}`,J[36]=(q)=>`LBU       ${q.rt_d} <- ${q.memload()}`,J[37]=(q)=>`LHU       ${q.rt_d} <- ${q.memload()}`,J[39]=(q)=>`LWU       ${q.rt_d} <- ${q.memload()}`,J[40]=(q)=>`SB        ${q.rt} -> ${q.memstore()}`,J[41]=(q)=>`SH        ${q.rt} -> ${q.memstore()}`,J[43]=(q)=>`SW        ${q.rt} -> ${q.memstore()}`,J[50]=(q)=>m3[e8(q.opcode)](q),J[58]=(q)=>c3[e8(q.opcode)](q),J})();var rX=function(J){let q,Q;if(q=J.match(/(#|0x)?([a-f0-9]{6})/i))Q=q[2];else if(q=J.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))Q=parseInt(q[1]).toString(16).padStart(2,0)+parseInt(q[2]).toString(16).padStart(2,0)+parseInt(q[3]).toString(16).padStart(2,0);else if(q=J.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))Q=q[1]+q[1]+q[2]+q[2]+q[3]+q[3];if(Q)return"#"+Q;return!1},r3=function(J){return a3.find((q)=>q.match(J))},i3=function(J){const q=document.createElement("style");q.innerHTML=J;const Q=document.querySelector("head link[rel=stylesheet], head style");if(Q)document.head.insertBefore(q,Q);else document.head.appendChild(q)};class p6{constructor(J,q,Q,Z,X="div"){this.parent=J,this.object=q,this.property=Q,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(Z),this.$name=document.createElement("div"),this.$name.classList.add("name"),p6.nextNameID=p6.nextNameID||0,this.$name.id=`lil-gui-name-${++p6.nextNameID}`,this.$widget=document.createElement(X),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.domElement.addEventListener("keydown",(Y)=>Y.stopPropagation()),this.domElement.addEventListener("keyup",(Y)=>Y.stopPropagation()),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(Q)}name(J){return this._name=J,this.$name.innerHTML=J,this}onChange(J){return this._onChange=J,this}_callOnChange(){if(this.parent._callOnChange(this),this._onChange!==void 0)this._onChange.call(this,this.getValue());this._changed=!0}onFinishChange(J){return this._onFinishChange=J,this}_callOnFinishChange(){if(this._changed){if(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0)this._onFinishChange.call(this,this.getValue())}this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(J=!0){return this.disable(!J)}disable(J=!0){if(J===this._disabled)return this;return this._disabled=J,this.domElement.classList.toggle("disabled",J),this.$disable.toggleAttribute("disabled",J),this}show(J=!0){return this._hidden=!J,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(J){const q=this.parent.add(this.object,this.property,J);return q.name(this._name),this.destroy(),q}min(J){return this}max(J){return this}step(J){return this}decimals(J){return this}listen(J=!0){if(this._listening=J,this._listenCallbackID!==void 0)cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0;if(this._listening)this._listenCallback();return this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const J=this.save();if(J!==this._listenPrevValue)this.updateDisplay();this._listenPrevValue=J}getValue(){return this.object[this.property]}setValue(J){return this.object[this.property]=J,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(J){return this.setValue(J),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class jW extends p6{constructor(J,q,Q){super(J,q,Q,"boolean","label");this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}var d3={isPrimitive:!0,match:(J)=>typeof J==="string",fromHexString:rX,toHexString:rX},nq={isPrimitive:!0,match:(J)=>typeof J==="number",fromHexString:(J)=>parseInt(J.substring(1),16),toHexString:(J)=>"#"+J.toString(16).padStart(6,0)},l3={isPrimitive:!1,match:(J)=>Array.isArray(J),fromHexString(J,q,Q=1){const Z=nq.fromHexString(J);q[0]=(Z>>16&255)/255*Q,q[1]=(Z>>8&255)/255*Q,q[2]=(Z&255)/255*Q},toHexString([J,q,Q],Z=1){Z=255/Z;const X=J*Z<<16^q*Z<<8^Q*Z<<0;return nq.toHexString(X)}},n3={isPrimitive:!1,match:(J)=>Object(J)===J,fromHexString(J,q,Q=1){const Z=nq.fromHexString(J);q.r=(Z>>16&255)/255*Q,q.g=(Z>>8&255)/255*Q,q.b=(Z&255)/255*Q},toHexString({r:J,g:q,b:Q},Z=1){Z=255/Z;const X=J*Z<<16^q*Z<<8^Q*Z<<0;return nq.toHexString(X)}},a3=[d3,nq,l3,n3];class NW extends p6{constructor(J,q,Q,Z){super(J,q,Q,"color");this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=r3(this.initialValue),this._rgbScale=Z,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const X=rX(this.$text.value);if(X)this._setValueFromHexString(X)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(J){if(this._format.isPrimitive){const q=this._format.fromHexString(J);this.setValue(q)}else this._format.fromHexString(J,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(J){return this._setValueFromHexString(J),this._callOnFinishChange(),this}updateDisplay(){if(this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),!this._textFocused)this.$text.value=this.$input.value.substring(1);return this.$display.style.backgroundColor=this.$input.value,this}}class e9 extends p6{constructor(J,q,Q){super(J,q,Q,"function");this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",(Z)=>{Z.preventDefault(),this.getValue().call(this.object),this._callOnChange()}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class LW extends p6{constructor(J,q,Q,Z,X,Y){super(J,q,Q,"number");this._initInput(),this.min(Z),this.max(X);const z=Y!==void 0;this.step(z?Y:this._getImplicitStep(),z),this.updateDisplay()}decimals(J){return this._decimals=J,this.updateDisplay(),this}min(J){return this._min=J,this._onUpdateMinMax(),this}max(J){return this._max=J,this._onUpdateMinMax(),this}step(J,q=!0){return this._step=J,this._stepExplicit=q,this}updateDisplay(){const J=this.getValue();if(this._hasSlider){let q=(J-this._min)/(this._max-this._min);q=Math.max(0,Math.min(q,1)),this.$fill.style.width=q*100+"%"}if(!this._inputFocused)this.$input.value=this._decimals===void 0?J:J.toFixed(this._decimals);return this}_initInput(){if(this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),window.matchMedia("(pointer: coarse)").matches)this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any");this.$widget.appendChild(this.$input),this.$disable=this.$input;const q=()=>{let O=parseFloat(this.$input.value);if(isNaN(O))return;if(this._stepExplicit)O=this._snap(O);this.setValue(this._clamp(O))},Q=(O)=>{const R=parseFloat(this.$input.value);if(isNaN(R))return;this._snapClampSetValue(R+O),this.$input.value=this.getValue()},Z=(O)=>{if(O.key==="Enter")this.$input.blur();if(O.code==="ArrowUp")O.preventDefault(),Q(this._step*this._arrowKeyMultiplier(O));if(O.code==="ArrowDown")O.preventDefault(),Q(this._step*this._arrowKeyMultiplier(O)*-1)},X=(O)=>{if(this._inputFocused)O.preventDefault(),Q(this._step*this._normalizeMouseWheel(O))};let Y=!1,z,K,W,G,H;const j=5,L=(O)=>{z=O.clientX,K=W=O.clientY,Y=!0,G=this.getValue(),H=0,window.addEventListener("mousemove",V),window.addEventListener("mouseup",U)},V=(O)=>{if(Y){const R=O.clientX-z,S=O.clientY-K;if(Math.abs(S)>j)O.preventDefault(),this.$input.blur(),Y=!1,this._setDraggingStyle(!0,"vertical");else if(Math.abs(R)>j)U()}if(!Y){const R=O.clientY-W;if(H-=R*this._step*this._arrowKeyMultiplier(O),G+H>this._max)H=this._max-G;else if(G+H<this._min)H=this._min-G;this._snapClampSetValue(G+H)}W=O.clientY},U=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",U)},M=()=>{this._inputFocused=!0},k=()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()};this.$input.addEventListener("input",q),this.$input.addEventListener("keydown",Z),this.$input.addEventListener("wheel",X,{passive:!1}),this.$input.addEventListener("mousedown",L),this.$input.addEventListener("focus",M),this.$input.addEventListener("blur",k)}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const J=(k,O,R,S,T)=>{return(k-O)/(R-O)*(T-S)+S},q=(k)=>{const O=this.$slider.getBoundingClientRect();let R=J(k,O.left,O.right,this._min,this._max);this._snapClampSetValue(R)},Q=(k)=>{this._setDraggingStyle(!0),q(k.clientX),window.addEventListener("mousemove",Z),window.addEventListener("mouseup",X)},Z=(k)=>{q(k.clientX)},X=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",Z),window.removeEventListener("mouseup",X)};let Y=!1,z,K;const W=(k)=>{k.preventDefault(),this._setDraggingStyle(!0),q(k.touches[0].clientX),Y=!1},G=(k)=>{if(k.touches.length>1)return;if(this._hasScrollBar)z=k.touches[0].clientX,K=k.touches[0].clientY,Y=!0;else W(k);window.addEventListener("touchmove",H,{passive:!1}),window.addEventListener("touchend",j)},H=(k)=>{if(Y){const O=k.touches[0].clientX-z,R=k.touches[0].clientY-K;if(Math.abs(O)>Math.abs(R))W(k);else window.removeEventListener("touchmove",H),window.removeEventListener("touchend",j)}else k.preventDefault(),q(k.touches[0].clientX)},j=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",H),window.removeEventListener("touchend",j)},L=this._callOnFinishChange.bind(this),V=400;let U;const M=(k)=>{if(Math.abs(k.deltaX)<Math.abs(k.deltaY)&&this._hasScrollBar)return;k.preventDefault();const R=this._normalizeMouseWheel(k)*this._step;this._snapClampSetValue(this.getValue()+R),this.$input.value=this.getValue(),clearTimeout(U),U=setTimeout(L,V)};this.$slider.addEventListener("mousedown",Q),this.$slider.addEventListener("touchstart",G,{passive:!1}),this.$slider.addEventListener("wheel",M,{passive:!1})}_setDraggingStyle(J,q="horizontal"){if(this.$slider)this.$slider.classList.toggle("active",J);document.body.classList.toggle("lil-gui-dragging",J),document.body.classList.toggle(`lil-gui-${q}`,J)}_getImplicitStep(){if(this._hasMin&&this._hasMax)return(this._max-this._min)/1000;return 0.1}_onUpdateMinMax(){if(!this._hasSlider&&this._hasMin&&this._hasMax){if(!this._stepExplicit)this.step(this._getImplicitStep(),!1);this._initSlider(),this.updateDisplay()}}_normalizeMouseWheel(J){let{deltaX:q,deltaY:Q}=J;if(Math.floor(J.deltaY)!==J.deltaY&&J.wheelDelta)q=0,Q=-J.wheelDelta/120,Q*=this._stepExplicit?1:10;return q+-Q}_arrowKeyMultiplier(J){let q=this._stepExplicit?1:10;if(J.shiftKey)q*=10;else if(J.altKey)q/=10;return q}_snap(J){const q=Math.round(J/this._step)*this._step;return parseFloat(q.toPrecision(15))}_clamp(J){if(J<this._min)J=this._min;if(J>this._max)J=this._max;return J}_snapClampSetValue(J){this.setValue(this._clamp(this._snap(J)))}get _hasScrollBar(){const J=this.parent.root.$children;return J.scrollHeight>J.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class VW extends p6{constructor(J,q,Q,Z){super(J,q,Q,"option");this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(Z)?Z:Object.values(Z),this._names=Array.isArray(Z)?Z:Object.keys(Z),this._names.forEach((X)=>{const Y=document.createElement("option");Y.innerHTML=X,this.$select.appendChild(Y)}),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const J=this.getValue(),q=this._values.indexOf(J);return this.$select.selectedIndex=q,this.$display.innerHTML=q===-1?J:this._names[q],this}}class UW extends p6{constructor(J,q,Q){super(J,q,Q,"string");this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",(Z)=>{if(Z.code==="Enter")this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}var s3=`.lil-gui {
  font-family: var(--font-family);
  font-size: var(--font-size);
  line-height: 1;
  font-weight: normal;
  font-style: normal;
  text-align: left;
  background-color: var(--background-color);
  color: var(--text-color);
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  --background-color: #1f1f1f;
  --text-color: #ebebeb;
  --title-background-color: #111111;
  --title-text-color: #ebebeb;
  --widget-color: #424242;
  --hover-color: #4f4f4f;
  --focus-color: #595959;
  --number-color: #2cc9ff;
  --string-color: #a2db3c;
  --font-size: 11px;
  --input-font-size: 11px;
  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;
  --padding: 4px;
  --spacing: 4px;
  --widget-height: 20px;
  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);
  --name-width: 45%;
  --slider-knob-width: 2px;
  --slider-input-width: 27%;
  --color-input-width: 27%;
  --slider-input-min-width: 45px;
  --color-input-min-width: 45px;
  --folder-indent: 7px;
  --widget-padding: 0 0 0 3px;
  --widget-border-radius: 2px;
  --checkbox-size: calc(0.75 * var(--widget-height));
  --scrollbar-width: 5px;
}
.lil-gui, .lil-gui * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
.lil-gui.root {
  width: var(--width, 245px);
  display: flex;
  flex-direction: column;
}
.lil-gui.root > .title {
  background: var(--title-background-color);
  color: var(--title-text-color);
}
.lil-gui.root > .children {
  overflow-x: hidden;
  overflow-y: auto;
}
.lil-gui.root > .children::-webkit-scrollbar {
  width: var(--scrollbar-width);
  height: var(--scrollbar-width);
  background: var(--background-color);
}
.lil-gui.root > .children::-webkit-scrollbar-thumb {
  border-radius: var(--scrollbar-width);
  background: var(--focus-color);
}
@media (pointer: coarse) {
  .lil-gui.allow-touch-styles, .lil-gui.allow-touch-styles .lil-gui {
    --widget-height: 28px;
    --padding: 6px;
    --spacing: 6px;
    --font-size: 13px;
    --input-font-size: 16px;
    --folder-indent: 10px;
    --scrollbar-width: 7px;
    --slider-input-min-width: 50px;
    --color-input-min-width: 65px;
  }
}
.lil-gui.force-touch-styles, .lil-gui.force-touch-styles .lil-gui {
  --widget-height: 28px;
  --padding: 6px;
  --spacing: 6px;
  --font-size: 13px;
  --input-font-size: 16px;
  --folder-indent: 10px;
  --scrollbar-width: 7px;
  --slider-input-min-width: 50px;
  --color-input-min-width: 65px;
}
.lil-gui.autoPlace {
  max-height: 100%;
  position: fixed;
  top: 0;
  right: 15px;
  z-index: 1001;
}

.lil-gui .controller {
  display: flex;
  align-items: center;
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
}
.lil-gui .controller.disabled {
  opacity: 0.5;
}
.lil-gui .controller.disabled, .lil-gui .controller.disabled * {
  pointer-events: none !important;
}
.lil-gui .controller > .name {
  min-width: var(--name-width);
  flex-shrink: 0;
  white-space: pre;
  padding-right: var(--spacing);
  line-height: var(--widget-height);
}
.lil-gui .controller .widget {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  min-height: var(--widget-height);
}
.lil-gui .controller.string input {
  color: var(--string-color);
}
.lil-gui .controller.boolean .widget {
  cursor: pointer;
}
.lil-gui .controller.color .display {
  width: 100%;
  height: var(--widget-height);
  border-radius: var(--widget-border-radius);
  position: relative;
}
@media (hover: hover) {
  .lil-gui .controller.color .display:hover:before {
    content: " ";
    display: block;
    position: absolute;
    border-radius: var(--widget-border-radius);
    border: 1px solid #fff9;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
.lil-gui .controller.color input[type=color] {
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
.lil-gui .controller.color input[type=text] {
  margin-left: var(--spacing);
  font-family: var(--font-family-mono);
  min-width: var(--color-input-min-width);
  width: var(--color-input-width);
  flex-shrink: 0;
}
.lil-gui .controller.option select {
  opacity: 0;
  position: absolute;
  width: 100%;
  max-width: 100%;
}
.lil-gui .controller.option .display {
  position: relative;
  pointer-events: none;
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  line-height: var(--widget-height);
  max-width: 100%;
  overflow: hidden;
  word-break: break-all;
  padding-left: 0.55em;
  padding-right: 1.75em;
  background: var(--widget-color);
}
@media (hover: hover) {
  .lil-gui .controller.option .display.focus {
    background: var(--focus-color);
  }
}
.lil-gui .controller.option .display.active {
  background: var(--focus-color);
}
.lil-gui .controller.option .display:after {
  font-family: "lil-gui";
  content: "\u2195";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  padding-right: 0.375em;
}
.lil-gui .controller.option .widget,
.lil-gui .controller.option select {
  cursor: pointer;
}
@media (hover: hover) {
  .lil-gui .controller.option .widget:hover .display {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number input {
  color: var(--number-color);
}
.lil-gui .controller.number.hasSlider input {
  margin-left: var(--spacing);
  width: var(--slider-input-width);
  min-width: var(--slider-input-min-width);
  flex-shrink: 0;
}
.lil-gui .controller.number .slider {
  width: 100%;
  height: var(--widget-height);
  background-color: var(--widget-color);
  border-radius: var(--widget-border-radius);
  padding-right: var(--slider-knob-width);
  overflow: hidden;
  cursor: ew-resize;
  touch-action: pan-y;
}
@media (hover: hover) {
  .lil-gui .controller.number .slider:hover {
    background-color: var(--hover-color);
  }
}
.lil-gui .controller.number .slider.active {
  background-color: var(--focus-color);
}
.lil-gui .controller.number .slider.active .fill {
  opacity: 0.95;
}
.lil-gui .controller.number .fill {
  height: 100%;
  border-right: var(--slider-knob-width) solid var(--number-color);
  box-sizing: content-box;
}

.lil-gui-dragging .lil-gui {
  --hover-color: var(--widget-color);
}
.lil-gui-dragging * {
  cursor: ew-resize !important;
}

.lil-gui-dragging.lil-gui-vertical * {
  cursor: ns-resize !important;
}

.lil-gui .title {
  height: var(--title-height);
  line-height: calc(var(--title-height) - 4px);
  font-weight: 600;
  padding: 0 var(--padding);
  -webkit-tap-highlight-color: transparent;
  cursor: pointer;
  outline: none;
  text-decoration-skip: objects;
}
.lil-gui .title:before {
  font-family: "lil-gui";
  content: "\u25BE";
  padding-right: 2px;
  display: inline-block;
}
.lil-gui .title:active {
  background: var(--title-background-color);
  opacity: 0.75;
}
@media (hover: hover) {
  body:not(.lil-gui-dragging) .lil-gui .title:hover {
    background: var(--title-background-color);
    opacity: 0.85;
  }
  .lil-gui .title:focus {
    text-decoration: underline var(--focus-color);
  }
}
.lil-gui.root > .title:focus {
  text-decoration: none !important;
}
.lil-gui.closed > .title:before {
  content: "\u25B8";
}
.lil-gui.closed > .children {
  transform: translateY(-7px);
  opacity: 0;
}
.lil-gui.closed:not(.transition) > .children {
  display: none;
}
.lil-gui.transition > .children {
  transition-duration: 300ms;
  transition-property: height, opacity, transform;
  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);
  overflow: hidden;
  pointer-events: none;
}
.lil-gui .children:empty:before {
  content: "Empty";
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
  display: block;
  height: var(--widget-height);
  font-style: italic;
  line-height: var(--widget-height);
  opacity: 0.5;
}
.lil-gui.root > .children > .lil-gui > .title {
  border: 0 solid var(--widget-color);
  border-width: 1px 0;
  transition: border-color 300ms;
}
.lil-gui.root > .children > .lil-gui.closed > .title {
  border-bottom-color: transparent;
}
.lil-gui + .controller {
  border-top: 1px solid var(--widget-color);
  margin-top: 0;
  padding-top: var(--spacing);
}
.lil-gui .lil-gui .lil-gui > .title {
  border: none;
}
.lil-gui .lil-gui .lil-gui > .children {
  border: none;
  margin-left: var(--folder-indent);
  border-left: 2px solid var(--widget-color);
}
.lil-gui .lil-gui .controller {
  border: none;
}

.lil-gui input {
  -webkit-tap-highlight-color: transparent;
  border: 0;
  outline: none;
  font-family: var(--font-family);
  font-size: var(--input-font-size);
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  background: var(--widget-color);
  color: var(--text-color);
  width: 100%;
}
@media (hover: hover) {
  .lil-gui input:hover {
    background: var(--hover-color);
  }
  .lil-gui input:active {
    background: var(--focus-color);
  }
}
.lil-gui input:disabled {
  opacity: 1;
}
.lil-gui input[type=text],
.lil-gui input[type=number] {
  padding: var(--widget-padding);
}
.lil-gui input[type=text]:focus,
.lil-gui input[type=number]:focus {
  background: var(--focus-color);
}
.lil-gui input::-webkit-outer-spin-button,
.lil-gui input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
.lil-gui input[type=number] {
  -moz-appearance: textfield;
}
.lil-gui input[type=checkbox] {
  appearance: none;
  -webkit-appearance: none;
  height: var(--checkbox-size);
  width: var(--checkbox-size);
  border-radius: var(--widget-border-radius);
  text-align: center;
  cursor: pointer;
}
.lil-gui input[type=checkbox]:checked:before {
  font-family: "lil-gui";
  content: "\u2713";
  font-size: var(--checkbox-size);
  line-height: var(--checkbox-size);
}
@media (hover: hover) {
  .lil-gui input[type=checkbox]:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui button {
  -webkit-tap-highlight-color: transparent;
  outline: none;
  cursor: pointer;
  font-family: var(--font-family);
  font-size: var(--font-size);
  color: var(--text-color);
  width: 100%;
  height: var(--widget-height);
  text-transform: none;
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
  border: 1px solid var(--widget-color);
  text-align: center;
  line-height: calc(var(--widget-height) - 4px);
}
@media (hover: hover) {
  .lil-gui button:hover {
    background: var(--hover-color);
    border-color: var(--hover-color);
  }
  .lil-gui button:focus {
    border-color: var(--focus-color);
  }
}
.lil-gui button:active {
  background: var(--focus-color);
}

@font-face {
  font-family: "lil-gui";
  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");
}`,GW=!1;class sX{constructor({parent:J,autoPlace:q=J===void 0,container:Q,width:Z,title:X="Controls",closeFolders:Y=!1,injectStyles:z=!0,touchStyles:K=!0}={}){if(this.parent=J,this.root=J?J.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",(W)=>{if(W.code==="Enter"||W.code==="Space")W.preventDefault(),this.$title.click()}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(X),this.parent){this.parent.children.push(this),this.parent.folders.push(this),this.parent.$children.appendChild(this.domElement);return}if(this.domElement.classList.add("root"),K)this.domElement.classList.add("allow-touch-styles");if(!GW&&z)i3(s3),GW=!0;if(Q)Q.appendChild(this.domElement);else if(q)this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement);if(Z)this.domElement.style.setProperty("--width",Z+"px");this._closeFolders=Y}add(J,q,Q,Z,X){if(Object(Q)===Q)return new VW(this,J,q,Q);const Y=J[q];switch(typeof Y){case"number":return new LW(this,J,q,Q,Z,X);case"boolean":return new jW(this,J,q);case"string":return new UW(this,J,q);case"function":return new e9(this,J,q)}console.error(`gui.add failed
	property:`,q,`
	object:`,J,`
	value:`,Y)}addColor(J,q,Q=1){return new NW(this,J,q,Q)}addFolder(J){const q=new sX({parent:this,title:J});if(this.root._closeFolders)q.close();return q}load(J,q=!0){if(J.controllers)this.controllers.forEach((Q)=>{if(Q instanceof e9)return;if(Q._name in J.controllers)Q.load(J.controllers[Q._name])});if(q&&J.folders)this.folders.forEach((Q)=>{if(Q._title in J.folders)Q.load(J.folders[Q._title])});return this}save(J=!0){const q={controllers:{},folders:{}};if(this.controllers.forEach((Q)=>{if(Q instanceof e9)return;if(Q._name in q.controllers)throw new Error(`Cannot save GUI with duplicate property "${Q._name}"`);q.controllers[Q._name]=Q.save()}),J)this.folders.forEach((Q)=>{if(Q._title in q.folders)throw new Error(`Cannot save GUI with duplicate folder "${Q._title}"`);q.folders[Q._title]=Q.save()});return q}open(J=!0){return this._setClosed(!J),this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}_setClosed(J){if(this._closed===J)return;this._closed=J,this._callOnOpenClose(this)}show(J=!0){return this._hidden=!J,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(J=!0){return this._setClosed(!J),this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const q=this.$children.clientHeight;this.$children.style.height=q+"px",this.domElement.classList.add("transition");const Q=(X)=>{if(X.target!==this.$children)return;this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",Q)};this.$children.addEventListener("transitionend",Q);const Z=!J?0:this.$children.scrollHeight;this.domElement.classList.toggle("closed",!J),requestAnimationFrame(()=>{this.$children.style.height=Z+"px"})}),this}title(J){return this._title=J,this.$title.innerHTML=J,this}reset(J=!0){return(J?this.controllersRecursive():this.controllers).forEach((Q)=>Q.reset()),this}onChange(J){return this._onChange=J,this}_callOnChange(J){if(this.parent)this.parent._callOnChange(J);if(this._onChange!==void 0)this._onChange.call(this,{object:J.object,property:J.property,value:J.getValue(),controller:J})}onFinishChange(J){return this._onFinishChange=J,this}_callOnFinishChange(J){if(this.parent)this.parent._callOnFinishChange(J);if(this._onFinishChange!==void 0)this._onFinishChange.call(this,{object:J.object,property:J.property,value:J.getValue(),controller:J})}onOpenClose(J){return this._onOpenClose=J,this}_callOnOpenClose(J){if(this.parent)this.parent._callOnOpenClose(J);if(this._onOpenClose!==void 0)this._onOpenClose.call(this,J)}destroy(){if(this.parent)this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1);if(this.domElement.parentElement)this.domElement.parentElement.removeChild(this.domElement);Array.from(this.children).forEach((J)=>J.destroy())}controllersRecursive(){let J=Array.from(this.controllers);return this.folders.forEach((q)=>{J=J.concat(q.controllersRecursive())}),J}foldersRecursive(){let J=Array.from(this.folders);return this.folders.forEach((q)=>{J=J.concat(q.foldersRecursive())}),J}}var PW=sX;function t3(){q6.show()}function e3(){q6.hide()}function MW(J){if(J)t3();else e3()}var q6=new PW;q6.title("Options");q6.hide();function DW(){iX=new Map,JQ=new Map}function tX(){return JQ}function SJ(J){let q=JQ.get(J);if(!q){if(!hW.enableDynarec)return null;let Q=iX.get(J)||0;if(Q++,iX.set(J,Q),Q<QN)return null;q=new kW(J),JQ.set(J,q)}if(!q.func)q.invalidate();return q}var hW={enableDynarec:!0},qN=q6.addFolder("Performance");qN.add(hW,"enableDynarec").name("Dynamic Recompilation");var QN=500,JQ=new Map,iX=new Map;class kW{constructor(J){this.entryPC=J,this.minPC=J,this.maxPC=J+4,this.func=void 0,this.opsCompiled=0,this.executionCount=0,this.bailedOut=!1,this.nextFragments=[],this.bodyCode="",this.needsDelayCheck=!0,this.cop1statusKnown=!1,this.usesCop1=!1}invalidate(){this.minPC=this.entryPC,this.maxPC=this.entryPC+4,this.func=void 0,this.opsCompiled=0,this.executionCount=0,this.bailedOut=!1,this.nextFragments=[],this.bodyCode="",this.needsDelayCheck=!0,this.cop1statusKnown=!1,this.usesCop1=!1}updateMinMax(J){this.minPC=Math.min(this.minPC,J),this.maxPC=Math.max(this.maxPC,J+4)}getNextFragment(J,q){let Q=this.nextFragments[q];if(!Q||Q.entryPC!==J)Q=J===this.entryPC?this:SJ(J),this.nextFragments[q]=Q;if(Q&&Q.opsCompiled>0&&!Q.func)Q.invalidate();return Q}}function zQ(J){let q="";if(J&P0.AA_EN)q+="|AA_EN";if(J&P0.Z_CMP)q+="|Z_CMP";if(J&P0.Z_UPD)q+="|Z_UPD";if(J&P0.IM_RD)q+="|IM_RD";if(J&P0.CLR_ON_CVG)q+="|CLR_ON_CVG";const Q=J&768;if(Q===P0.CVG_DST_CLAMP)q+="|CVG_DST_CLAMP";else if(Q===P0.CVG_DST_WRAP)q+="|CVG_DST_WRAP";else if(Q===P0.CVG_DST_FULL)q+="|CVG_DST_FULL";else if(Q===P0.CVG_DST_SAVE)q+="|CVG_DST_SAVE";const Z=J&3072;if(Z===P0.ZMODE_OPA)q+="|ZMODE_OPA";else if(Z===P0.ZMODE_INTER)q+="|ZMODE_INTER";else if(Z===P0.ZMODE_XLU)q+="|ZMODE_XLU";else if(Z===P0.ZMODE_DEC)q+="|ZMODE_DEC";if(J&P0.CVG_X_ALPHA)q+="|CVG_X_ALPHA";if(J&P0.ALPHA_CVG_SEL)q+="|ALPHA_CVG_SEL";if(J&P0.FORCE_BL)q+="|FORCE_BL";const X=J>>>X7,Y=q.length>0?q.substr(1):"0",z="GBL_c1("+YQ(X>>>2)+") | GBL_c2("+YQ(X)+") /*"+Q0(X)+"*/";return Y+", "+z}function p0(J){let q=J;if(J===K7)q="G_TX_LOADTILE";if(J===ZN)q="G_TX_RENDERTILE";return q}function mJ(J){switch(J){case XN:return"G_TX_WRAP";case iq:return"G_TX_MIRROR";case D8:return"G_TX_CLAMP";case iq|D8:return"G_TX_MIRROR|G_TX_CLAMP"}return J}function cJ(J,q){let Q="";if(q&J.G_ZBUFFER)Q+="|G_ZBUFFER";if(q&J.G_TEXTURE_ENABLE)Q+="|G_TEXTURE_ENABLE";if(q&J.G_SHADE)Q+="|G_SHADE";if(q&J.G_SHADING_SMOOTH)Q+="|G_SHADING_SMOOTH";const Z=q&J.G_CULL_BOTH;if(Z===J.G_CULL_FRONT)Q+="|G_CULL_FRONT";else if(Z===J.G_CULL_BACK)Q+="|G_CULL_BACK";else if(Z===J.G_CULL_BOTH)Q+="|G_CULL_BOTH";if(q&J.G_FOG)Q+="|G_FOG";if(q&J.G_LIGHTING)Q+="|G_LIGHTING";if(q&J.G_TEXTURE_GEN)Q+="|G_TEXTURE_GEN";if(q&J.G_TEXTURE_GEN_LINEAR)Q+="|G_TEXTURE_GEN_LINEAR";if(q&J.G_LOD)Q+="|G_LOD";return Q.length>0?Q.substr(1):"0"}function YQ(J){const q=J>>>12&3,Q=J>>>8&3,Z=J>>>4&3,X=J>>>0&3;return IW[q]+","+YN[Q]+","+IW[Z]+","+zN[X]}var P0={AA_EN:8,Z_CMP:16,Z_UPD:32,IM_RD:64,CLR_ON_CVG:128,CVG_DST_CLAMP:0,CVG_DST_WRAP:256,CVG_DST_FULL:512,CVG_DST_SAVE:768,ZMODE_OPA:0,ZMODE_INTER:1024,ZMODE_XLU:2048,ZMODE_DEC:3072,CVG_X_ALPHA:4096,ALPHA_CVG_SEL:8192,FORCE_BL:16384,TEX_EDGE:0},eX=0,OW=2;var X7=16,vJ=3,KQ=4,wW=4294967288,BW=0,aq=4,rq=6,J7=8,qQ=9,QQ=12,ZQ=14,q7=16,XQ=17,Q7=19,sq=20;var Z7=23,j6=e({G_GBI2_MV_VIEWPORT:8,G_GBI2_MV_LIGHT:10,G_GBI2_MV_POINT:12,G_GBI2_MV_MATRIX:14,G_GBI2_MVO_LOOKATX:0,G_GBI2_MVO_LOOKATY:24,G_GBI2_MVO_L0:48,G_GBI2_MVO_L1:72,G_GBI2_MVO_L2:96,G_GBI2_MVO_L3:120,G_GBI2_MVO_L4:144,G_GBI2_MVO_L5:168,G_GBI2_MVO_L6:192,G_GBI2_MVO_L7:216}),WQ=1<<Z7,xJ=3<<sq,FQ=1<<Q7,$Q=3<<XQ,HQ=1<<q7,uJ=3<<ZQ,gJ=3<<QQ,GQ=7<<qQ,jQ=1<<J7,NQ=3<<rq,LQ=3<<aq;var VQ=1;var Y7=2;var z7=4,fJ=0;var A0=e({G_MW_MATRIX:0,G_MW_NUMLIGHT:2,G_MW_CLIP:4,G_MW_SEGMENT:6,G_MW_FOG:8,G_MW_LIGHTCOL:10,G_MW_POINTS:12,G_MW_PERSPNORM:14}),h0=e({G_MV_VIEWPORT:128,G_MV_LOOKATY:130,G_MV_LOOKATX:132,G_MV_L0:134,G_MV_L1:136,G_MV_L2:138,G_MV_L3:140,G_MV_L4:142,G_MV_L5:144,G_MV_L6:146,G_MV_L7:148,G_MV_TXTATT:150,G_MV_MATRIX_1:158,G_MV_MATRIX_2:152,G_MV_MATRIX_3:154,G_MV_MATRIX_4:156}),AW=0,UQ=e({G_MWO_CLIP_RNX:4,G_MWO_CLIP_RNY:12,G_MWO_CLIP_RPX:20,G_MWO_CLIP_RPY:28}),PQ=1,MQ=2,hQ=4,kQ=8,DQ=16,OQ=32,IQ=e({FR_NEG_FRUSTRATIO_1:1,FR_POS_FRUSTRATIO_1:65535,FR_NEG_FRUSTRATIO_2:2,FR_POS_FRUSTRATIO_2:65534,FR_NEG_FRUSTRATIO_3:3,FR_POS_FRUSTRATIO_3:65533,FR_NEG_FRUSTRATIO_4:4,FR_POS_FRUSTRATIO_4:65532,FR_NEG_FRUSTRATIO_5:5,FR_POS_FRUSTRATIO_5:65531,FR_NEG_FRUSTRATIO_6:6,FR_POS_FRUSTRATIO_6:65530}),wQ=e({G_MWO_SEGMENT_0:0,G_MWO_SEGMENT_1:1,G_MWO_SEGMENT_2:2,G_MWO_SEGMENT_3:3,G_MWO_SEGMENT_4:4,G_MWO_SEGMENT_5:5,G_MWO_SEGMENT_6:6,G_MWO_SEGMENT_7:7,G_MWO_SEGMENT_8:8,G_MWO_SEGMENT_9:9,G_MWO_SEGMENT_A:10,G_MWO_SEGMENT_B:11,G_MWO_SEGMENT_C:12,G_MWO_SEGMENT_D:13,G_MWO_SEGMENT_E:14,G_MWO_SEGMENT_F:15});var pJ=e({G_MWO_POINT_RGBA:16,G_MWO_POINT_ST:20,G_MWO_POINT_XYSCREEN:24,G_MWO_POINT_ZSCREEN:28}),BQ=e({NUMLIGHTS_1:1,NUMLIGHTS_2:2,NUMLIGHTS_3:3,NUMLIGHTS_4:4,NUMLIGHTS_5:5,NUMLIGHTS_6:6,NUMLIGHTS_7:7}),K7=7,ZN=0,XN=0,iq=1,D8=2,CW=e({G_SC_NON_INTERLACE:0,G_SC_ODD_INTERLACE:3,G_SC_EVEN_INTERLACE:2}),C6={G_ZBUFFER:1,G_TEXTURE_ENABLE:2,G_SHADE:4,G_SHADING_SMOOTH:512,G_CULL_FRONT:4096,G_CULL_BACK:8192,G_CULL_BOTH:12288,G_FOG:65536,G_LIGHTING:131072,G_TEXTURE_GEN:262144,G_TEXTURE_GEN_LINEAR:524288,G_LOD:1048576},Q8={G_TEXTURE_ENABLE:2,G_SHADE:0,G_ZBUFFER:1,G_CULL_BACK:512,G_CULL_FRONT:1024,G_CULL_BOTH:1536,G_FOG:65536,G_LIGHTING:131072,G_TEXTURE_GEN:262144,G_TEXTURE_GEN_LINEAR:524288,G_LOD:1048576,G_SHADING_SMOOTH:2097152},N0=e({G_IM_FMT_RGBA:0,G_IM_FMT_YUV:1,G_IM_FMT_CI:2,G_IM_FMT_IA:3,G_IM_FMT_I:4}),n=e({G_IM_SIZ_4b:0,G_IM_SIZ_8b:1,G_IM_SIZ_16b:2,G_IM_SIZ_32b:3}),AQ=e({G_PM_1PRIMITIVE:1<<Z7,G_PM_NPRIMITIVE:0<<Z7}),L0=e({G_CYC_1CYCLE:0<<sq,G_CYC_2CYCLE:1<<sq,G_CYC_COPY:2<<sq,G_CYC_FILL:3<<sq}),CQ=e({G_TP_NONE:0<<Q7,G_TP_PERSP:1<<Q7}),RQ=e({G_TD_CLAMP:0<<XQ,G_TD_SHARPEN:1<<XQ,G_TD_DETAIL:2<<XQ}),yQ=e({G_TL_TILE:0<<q7,G_TL_LOD:1<<q7}),oJ=e({G_TT_NONE:0<<ZQ,G_TT_RGBA16:2<<ZQ,G_TT_IA16:3<<ZQ}),dJ=e({G_TF_POINT:0<<QQ,G_TF_AVERAGE:3<<QQ,G_TF_BILERP:2<<QQ}),EQ=e({G_TC_CONV:0<<qQ,G_TC_FILTCONV:5<<qQ,G_TC_FILT:6<<qQ}),TQ=e({G_CK_NONE:0<<J7,G_CK_KEY:1<<J7}),_Q=e({G_CD_MAGICSQ:0<<rq,G_CD_BAYER:1<<rq,G_CD_NOISE:2<<rq,G_CD_DISABLE:3<<rq}),bQ=e({G_AD_PATTERN:0<<aq,G_AD_NOTPATTERN:1<<aq,G_AD_NOISE:2<<aq,G_AD_DISABLE:3<<aq}),JJ=e({G_AC_NONE:0<<eX,G_AC_THRESHOLD:1<<eX,G_AC_DITHER:3<<eX}),O8=e({G_ZS_PIXEL:0<<OW,G_ZS_PRIM:1<<OW}),IW=["G_BL_CLR_IN","G_BL_CLR_MEM","G_BL_CLR_BL","G_BL_CLR_FOG"],YN=["G_BL_A_IN","G_BL_A_FOG","G_BL_A_SHADE","G_BL_0"],zN=["G_BL_1MA","G_BL_A_MEM","G_BL_1","G_BL_0"];function KN(J){const q=J>>>8&255,Q=J&255;return q<<24|q<<16|q<<8|Q}function $7(J){const q=nJ[J>>>11&31],Q=nJ[J>>>6&31],Z=nJ[J>>>1&31],X=J&1?255:0;return q<<24|Q<<16|Z<<8|X}var WN=function(J,q,Q){const Z=J.data,X=J.width*4;let Y=0;const z=Q.line<<4;let K=Q.tmem<<3,W=0;for(let G=0;G<Q.height;++G){let H=K,j=Y;for(let L=0;L<Q.width;++L){const V=H^W;Z[j+0]=q[V+0],Z[j+1]=q[V+1],Z[j+2]=q[V+2],Z[j+3]=q[V+3],H+=4,j+=4}K+=z,Y+=X,W^=8}},FN=function(J,q,Q){let Z=J.data,X=J.width*4,Y=0,z=Q.line<<3,K=Q.tmem<<3,W=0;for(let G=0;G<Q.height;++G){let H=K,j=Y;for(let L=0;L<Q.width;++L){let V=H^W,U=q[V]<<8|q[V+1];Z[j+0]=nJ[U>>>11&31],Z[j+1]=nJ[U>>>6&31],Z[j+2]=nJ[U>>>1&31],Z[j+3]=U&1?255:0,H+=2,j+=4}K+=z,Y+=X,W^=4}},$N=function(J,q,Q){let Z=J.data,X=J.width*4,Y=0,z=Q.line<<3,K=Q.tmem<<3,W=0;for(let G=0;G<Q.height;++G){let H=K,j=Y;for(let L=0;L<Q.width;++L){let V=H^W,U=q[V],M=q[V+1];Z[j+0]=U,Z[j+1]=U,Z[j+2]=U,Z[j+3]=M,H+=2,j+=4}K+=z,Y+=X,W^=4}},HN=function(J,q,Q){let Z=J.data,X=J.width*4,Y=0,z=Q.line<<3,K=Q.tmem<<3,W=0;for(let G=0;G<Q.height;++G){let H=K,j=Y;for(let L=0;L<Q.width;++L){let V=H^W,U=q[V],M=tq[U>>>4&15],k=tq[U&15];Z[j+0]=M,Z[j+1]=M,Z[j+2]=M,Z[j+3]=k,H+=1,j+=4}K+=z,Y+=X,W^=4}},GN=function(J,q,Q){let Z=J.data,X=J.width*4,Y=0,z=Q.line<<3,K=Q.tmem<<3,W=0;for(let G=0;G<Q.height;++G){let H=K,j=Y;for(let L=0;L+1<Q.width;L+=2){let V=H^W,U=q[V],M=F7[(U&224)>>>5],k=W7[(U&16)>>>4],O=F7[(U&14)>>>1],R=W7[(U&1)>>>0];Z[j+0]=M,Z[j+1]=M,Z[j+2]=M,Z[j+3]=k,Z[j+4]=O,Z[j+5]=O,Z[j+6]=O,Z[j+7]=R,H+=1,j+=8}if(Q.width&1){let L=H^W,V=q[L],U=F7[(V&224)>>>5],M=W7[(V&16)>>>4];Z[j+0]=U,Z[j+1]=U,Z[j+2]=U,Z[j+3]=M,H+=1,j+=4}K+=z,Y+=X,W^=4}},jN=function(J,q,Q){let Z=J.data,X=J.width*4,Y=0,z=Q.line<<3,K=Q.tmem<<3,W=0;for(let G=0;G<Q.height;++G){let H=K,j=Y;for(let L=0;L<Q.width;++L){let V=q[H^W];Z[j+0]=V,Z[j+1]=V,Z[j+2]=V,Z[j+3]=V,H+=1,j+=4}K+=z,Y+=X,W^=4}},NN=function(J,q,Q){let Z=J.data,X=J.width*4,Y=0,z=Q.line<<3,K=Q.tmem<<3,W=0;for(let G=0;G<Q.height;++G){let H=K,j=Y;for(let L=0;L+1<Q.width;L+=2){let V=q[H^W],U=tq[(V&240)>>>4],M=tq[(V&15)>>>0];Z[j+0]=U,Z[j+1]=U,Z[j+2]=U,Z[j+3]=U,Z[j+4]=M,Z[j+5]=M,Z[j+6]=M,Z[j+7]=M,H+=1,j+=8}if(Q.width&1){let L=q[H^W],V=tq[(L&240)>>>4];Z[j+0]=V,Z[j+1]=V,Z[j+2]=V,Z[j+3]=V,H+=1,j+=4}K+=z,Y+=X,W^=4}},RW=function(J,q,Q,Z){const X=J.data,Y=J.width*4;let z=0;const K=Q.line<<3;let W=Q.tmem<<3;const G=0;for(let j=0;j<256;++j){const U=2048+(j*4+G)*2,M=q[U+0]<<8|q[U+1];lJ[j]=Z(M)}let H=0;for(let j=0;j<Q.height;++j){let L=W,V=z;for(let U=0;U<Q.width;++U){const M=lJ[q[L^H]];X[V+0]=M>>24&255,X[V+1]=M>>16&255,X[V+2]=M>>8&255,X[V+3]=M&255,L+=1,V+=4}W+=K,z+=Y,H^=4}},yW=function(J,q,Q,Z,X){const Y=J.data,z=J.width*4;let K=0;const W=Q.line<<3;let G=Q.tmem<<3;const H=0;for(let L=0;L<16;++L){const M=2048+((Z*16|L)*4+H)*2,k=q[M+0]<<8|q[M+1];lJ[L]=X(k)}let j=0;for(let L=0;L<Q.height;++L){let V=G,U=K;for(let M=0;M+1<Q.width;M+=2){let k=q[V^j],O=lJ[(k&240)>>>4],R=lJ[(k&15)>>>0];Y[U+0]=O>>24&255,Y[U+1]=O>>16&255,Y[U+2]=O>>8&255,Y[U+3]=O&255,Y[U+4]=R>>24&255,Y[U+5]=R>>16&255,Y[U+6]=R>>8&255,Y[U+7]=R&255,V+=1,U+=8}if(Q.width&1){let M=q[V^j],k=lJ[(M&240)>>>4];Y[U+0]=k>>24&255,Y[U+1]=k>>16&255,Y[U+2]=k>>8&255,Y[U+3]=k&255,V+=1,U+=4}G+=W,K+=z,j^=4}};function EW(J,q,Q,Z){const X=Z===oJ.G_TT_IA16?KN:$7;switch(Q.format){case N0.G_IM_FMT_RGBA:switch(Q.size){case n.G_IM_SIZ_32b:return WN(J,q,Q),!0;case n.G_IM_SIZ_16b:return FN(J,q,Q),!0;case n.G_IM_SIZ_8b:return RW(J,q,Q,X),!0;case n.G_IM_SIZ_4b:return yW(J,q,Q,Q.palette,X),!0}break;case N0.G_IM_FMT_IA:switch(Q.size){case n.G_IM_SIZ_16b:return $N(J,q,Q),!0;case n.G_IM_SIZ_8b:return HN(J,q,Q),!0;case n.G_IM_SIZ_4b:return GN(J,q,Q),!0}break;case N0.G_IM_FMT_I:switch(Q.size){case n.G_IM_SIZ_8b:return jN(J,q,Q),!0;case n.G_IM_SIZ_4b:return NN(J,q,Q),!0}break;case N0.G_IM_FMT_CI:switch(Q.size){case n.G_IM_SIZ_8b:return RW(J,q,Q,X),!0;case n.G_IM_SIZ_4b:return yW(J,q,Q,Q.palette,X),!0}break}return!1}var W7=[0,255],F7=[0,36,73,109,146,182,219,255],tq=[0,17,34,51,68,85,102,119,136,153,170,187,204,221,238,255],nJ=[0,8,16,24,33,41,49,57,66,74,82,90,99,107,115,123,132,140,148,156,165,173,181,189,198,206,214,222,231,239,247,255],lJ=new Uint32Array(256);function SQ(J,q,Q){let Z;switch(q){case vJ:Z=`gsDPSetAlphaCompare(${JJ.nameOf(Q)});`;break;case KQ:Z=`gsDPSetDepthSource(${O8.nameOf(Q)});`;break;case wW:Z=`gsDPSetRenderMode(${zQ(Q)});`;break;default:Z=`gsSPSetOtherMode(G_SETOTHERMODE_L, ${N(q)}, ${N(Q)}`;break}J.text(Z)}function vQ(J,q,Q,Z,X){let Y;switch(q){case BW:break;case LQ:Y=`gsDPSetAlphaDither(${bQ.nameOf(X)});`;break;case NQ:Y=`gsDPSetColorDither(${_Q.nameOf(X)});`;break;case jQ:Y=`gsDPSetCombineKey(${TQ.nameOf(X)});`;break;case GQ:Y=`gsDPSetTextureConvert(${EQ.nameOf(X)});`;break;case gJ:Y=`gsDPSetTextureFilter(${dJ.nameOf(X)});`;break;case HQ:Y=`gsDPSetTextureLOD(${yQ.nameOf(X)});`;break;case uJ:Y=`gsDPSetTextureLUT(${oJ.nameOf(X)});`;break;case $Q:Y=`gsDPSetTextureDetail(${RQ.nameOf(X)});`;break;case FQ:Y=`gsDPSetTexturePersp(${CQ.nameOf(X)});`;break;case xJ:Y=`gsDPSetCycleType(${L0.nameOf(X)});`;break;case WQ:Y=`gsDPPipelineMode(${AQ.nameOf(X)});`;break;default:Y=`gsSPSetOtherMode(G_SETOTHERMODE_H, ${N(q)}, ${N(X)});`;break}J.text(Y)}var TW=function(J,q,Q,Z){const X=`${J}, ${q}, ${Q}`,Y=`${X}, ${Z}`;if(J<128&&q<128||q<128&&Q<128||Q<128&&J<128)return`<span style="color: white; background-color: rgb(${X})">${Y}</span>`;return`<span style="background-color: rgb(${X})">${Y}</span>`};function I8(J){const q=J>>>24&255,Q=J>>>16&255,Z=J>>>8&255,X=J&255;return TW(q,Q,Z,X)}function xQ(J){const q=J&255,Q=J>>>8&255,Z=J>>>16&255,X=J>>>24&255;return TW(q,Q,Z,X)}function _W(J){return I8($7(J))}class qJ{constructor(J){this.gl=J,this.vao=J.createVertexArray(),this.posBuffer=null,this.uvBuffer=null,this.colBuffer=null}bind(){this.gl.bindVertexArray(this.vao)}unbind(){this.gl.bindVertexArray(null)}initPosAttr(J,q){const Q=this.gl;this.bind();const Z=Q.getAttribLocation(J,q),X=Q.createBuffer();Q.enableVertexAttribArray(Z),Q.bindBuffer(Q.ARRAY_BUFFER,X),Q.vertexAttribPointer(Z,4,Q.FLOAT,!1,0,0),this.unbind(),this.posBuffer=X}initColorAttr(J,q){const Q=this.gl;this.bind();const Z=Q.getAttribLocation(J,q),X=Q.createBuffer();Q.enableVertexAttribArray(Z),Q.bindBuffer(Q.ARRAY_BUFFER,X),Q.vertexAttribPointer(Z,4,Q.UNSIGNED_BYTE,!0,0,0),this.unbind(),this.colBuffer=X}initUVsAttr(J,q){const Q=this.gl;this.bind();const Z=Q.getAttribLocation(J,q),X=Q.createBuffer();Q.enableVertexAttribArray(Z),Q.bindBuffer(Q.ARRAY_BUFFER,X),Q.vertexAttribPointer(Z,2,Q.FLOAT,!1,0,0),this.unbind(),this.uvBuffer=X}setPosData(J,q){this.setData(this.posBuffer,J,q)}setColorData(J,q){this.setData(this.colBuffer,J,q)}setUVData(J,q){this.setData(this.uvBuffer,J,q)}setData(J,q,Q){const Z=this.gl;Z.bindBuffer(Z.ARRAY_BUFFER,J),Z.bufferData(Z.ARRAY_BUFFER,q,Q)}}function N7(J,q,Q){let Z=j7(J,q),X=j7(J,Q),Y=J.createProgram();if(J.attachShader(Y,Z),J.attachShader(Y,X),J.linkProgram(Y),!J.getProgramParameter(Y,J.LINK_STATUS))q0(!1,"Unable to initialize the shader program.");return Y}var j7=function(J,q){let Q=document.getElementById(q);if(!Q)return null;let Z=gW(Q),X;if(Q.type==="x-shader/x-fragment")X=J.FRAGMENT_SHADER;else if(Q.type==="x-shader/x-vertex")X=J.VERTEX_SHADER;else return null;return fW(J,Z,X)},gW=function(J){let q="",Q=J.firstChild;while(Q){if(Q.nodeType==Node.TEXT_NODE)q+=Q.textContent;Q=Q.nextSibling}return q},fW=function(J,q,Q){let Z=J.createShader(Q);if(J.shaderSource(Z,q),J.compileShader(Z),!J.getShaderParameter(Z,J.COMPILE_STATUS))return q0(!1,"An error occurred compiling the shaders: "+J.getShaderInfoLog(Z)),null;return Z};function mW(J,q,Q,Z,X){let Y=Z<L0.G_CYC_COPY?`${q.toString(16)+Q.toString(16)}_${Z}`:Z.toString();if(X)Y+="_alphaThreshold";let z=SW.get(Y);if(z)return z;if(!G7)G7=j7(J,"n64-shader-vs");if(!H7){let H0=document.getElementById("n64-shader-fs");if(H0)H7=gW(H0)}let K=q>>>20&15,W=Q>>>28&15,G=q>>>15&31,H=Q>>>15&7,j=q>>>12&7,L=Q>>>12&7,V=q>>>9&7,U=Q>>>9&7,M=q>>>5&15,k=Q>>>24&15,O=q>>>0&31,R=Q>>>6&7,S=Q>>>21&7,T=Q>>>3&7,b=Q>>>18&7,m=Q>>>0&7,l;if(Z===L0.G_CYC_FILL)l="col = shade;\n";else if(Z===L0.G_CYC_COPY)l="col = tex0;\n";else if(Z===L0.G_CYC_1CYCLE)l="",l+="col.rgb = ("+uQ[K]+" - "+uQ[W]+") * "+vW[G]+" + "+uW[H]+";\n",l+="col.a = ("+w8[j]+" - "+w8[L]+") * "+w8[V]+" + "+w8[U]+";\n";else l="",l+="col.rgb = ("+uQ[K]+" - "+uQ[W]+") * "+vW[G]+" + "+uW[H]+";\n",l+="col.a = ("+w8[j]+" - "+w8[L]+") * "+w8[V]+" + "+w8[U]+";\n",l+="combined = vec4(col.rgb, col.a);\n",l+="col.rgb = ("+xW[M]+" - "+xW[k]+") * "+VN[O]+" + "+UN[R]+";\n",l+="col.a = ("+gQ[S]+" - "+gQ[T]+") * "+gQ[b]+" + "+gQ[m]+";\n";if(X)l+="if(col.a <= uAlphaThreshold) discard;\n";let U0=H7.replace("{{body}}",l);if(LN){let H0="\n";H0+="\tRGB0 = ("+pQ[K]+" - "+mQ[W]+") * "+fQ[G]+" + "+cQ[H]+"\n",H0+="\t  A0 = ("+B8[j]+" - "+B8[L]+") * "+oQ[V]+" + "+dQ[U]+"\n",H0+="\tRGB1 = ("+pQ[M]+" - "+mQ[k]+") * "+fQ[O]+" + "+cQ[R]+"\n",H0+="\t  A1 = ("+B8[S]+" - "+B8[T]+") * "+oQ[b]+" + "+dQ[m]+"\n";let W6=U0.split("\n").join("<br>");h("Compiled "+H0+"\nto\n"+W6)}let O0=fW(J,U0,J.FRAGMENT_SHADER);if(!O0)return null;let $0=J.createProgram();if(J.attachShader($0,G7),J.attachShader($0,O0),J.linkProgram($0),!J.getProgramParameter($0,J.LINK_STATUS))q0(!1,"Unable to initialize the shader program.");return z=new pW(J,$0,U0),SW.set(Y,z),z}function lQ(J,q){let Q=J>>>20&15,Z=q>>>28&15,X=J>>>15&31,Y=q>>>15&7,z=J>>>12&7,K=q>>>12&7,W=J>>>9&7,G=q>>>9&7,H=J>>>5&15,j=q>>>24&15,L=J>>>0&31,V=q>>>6&7,U=q>>>21&7,M=q>>>3&7,k=q>>>18&7,O=q>>>0&7,R="";return R+="RGB0 = ("+pQ[Q]+" - "+mQ[Z]+") * "+fQ[X]+" + "+cQ[Y]+"\n",R+="  A0 = ("+B8[z]+" - "+B8[K]+") * "+oQ[W]+" + "+dQ[G]+"\n",R+="RGB1 = ("+pQ[H]+" - "+mQ[j]+") * "+fQ[L]+" + "+cQ[V]+"\n",R+="  A1 = ("+B8[U]+" - "+B8[M]+") * "+oQ[k]+" + "+dQ[O]+"\n",R}var LN=!1,SW=new Map,H7=null,G7=null,vW=["combined.rgb","tex0.rgb","tex1.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","combined.a","tex0.a","tex1.a","prim.a","shade.a","env.a","lod_frac","prim_lod_frac","k5","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","zero.rgb"],VN=["combined.rgb","tex1.rgb","tex0.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","combined.a","tex1.a","tex0.a","prim.a","shade.a","env.a","lod_frac","prim_lod_frac","k5","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","zero.rgb"],uQ=["combined.rgb","tex0.rgb","tex1.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","combined.a","tex0.a","tex1.a","prim.a","shade.a","env.a","lod_frac","prim_lod_frac","zero.rgb"],xW=["combined.rgb","tex1.rgb","tex0.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","combined.a","tex1.a","tex0.a","prim.a","shade.a","env.a","lod_frac","prim_lod_frac","zero.rgb"],uW=["combined.rgb","tex0.rgb","tex1.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","zero.rgb"],UN=["combined.rgb","tex1.rgb","tex0.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","zero.rgb"],w8=["combined.a","tex0.a","tex1.a","prim.a","shade.a","env.a","one.a","zero.a"],gQ=["combined.a","tex1.a","tex0.a","prim.a","shade.a","env.a","one.a","zero.a"],fQ=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","KeyScale    ","CombinedAlph","Texel0_Alpha","Texel1_Alpha","Prim_Alpha  ","Shade_Alpha ","Env_Alpha   ","LOD_Frac    ","PrimLODFrac ","K5          ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           "],pQ=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","1           ","Noise       ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           "],mQ=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","KeyCenter   ","K4          ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           "],cQ=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","1           ","0           "],B8=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","PrimLODFrac ","0           "],oQ=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","1           ","0           "],dQ=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","1           ","0           "];class pW{constructor(J,q,Q){this.program=q,this.shaderSource=Q,this.vertexArray=new qJ(J),this.vertexArray.initPosAttr(q,"aPosition"),this.vertexArray.initUVsAttr(q,"aUV"),this.vertexArray.initColorAttr(q,"aColor"),this.uSamplerUniform0=J.getUniformLocation(q,"uSampler0"),this.uSamplerUniform1=J.getUniformLocation(q,"uSampler1"),this.uTexScaleUniform0=J.getUniformLocation(q,"uTexScale0"),this.uTexScaleUniform1=J.getUniformLocation(q,"uTexScale1"),this.uTexOffsetUniform0=J.getUniformLocation(q,"uTexOffset0"),this.uTexOffsetUniform1=J.getUniformLocation(q,"uTexOffset1"),this.uPrimColorUniform=J.getUniformLocation(q,"uPrimColor"),this.uEnvColorUniform=J.getUniformLocation(q,"uEnvColor"),this.uAlphaThresholdUniform=J.getUniformLocation(q,"uAlphaThresholdUniform")}}var MN=function(J){const q=V7("x",J,kQ,PQ),Q=V7("y",J,DQ,MQ),Z=V7("z",J,OQ,hQ);return`${q} ${Q} ${Z}`},V7=function(J,q,Q,Z){const X=q&Q,Y=q&Z;let z="",K="";if(X&&Y)z="clip-err",K="!";else if(X)z="clip-pos",K=">";else if(Y)z="clip-neg",K="<";else z="clip-none",K="0";return`<span class="${z}">${J}${K}</span>`},nQ,aJ,A8,cW=$("#dlist-content"),PN=0,oW="";class U7{constructor(J,q){this.state=J,this.processDList=q,this.currentOp=0,this.numOps=0,this.bailAfter=-1,this.lastTask,this.stateTimeShown=-1,this.running=!1,this.requested=!1,this.dlFocusCounter=0}onNewTask(J){if(this.lastTask=J,this.requested){if(oW==""||J.detectVersionString().includes(oW)){if(this.dlFocusCounter==PN)this.requested=!1,n64js.breakEmulationForDisplayListDebug(),this.stateTimeShown=-1,this.running=!0;this.dlFocusCounter++}}else this.dlFocusCounter=0}toggle(){if(this.running)this.hideUI(),this.bailAfter=-1,this.running=!1,n64js.toggleRun();else this.showUI(),this.requested=!0}halt(){this.showUI(),this.requested=!1,this.running=!0,this.bailAfter=this.currentOp,this.stateTimeShown=-1}debugDisplayList(){if(this.stateTimeShown==-1){const J=new dW(this);this.processDList(this.lastTask,J,-1),J.finalise(),this.numOps=J.numOps>0?J.numOps-1:0,this.setScrubRange(this.numOps);const q=this.bailAfter==-1?this.numOps:this.bailAfter;this.setScrubTime(q)}if(this.processDList(this.lastTask,null,this.bailAfter),this.stateTimeShown!==this.bailAfter)this.updateStateUI(),this.stateTimeShown=this.bailAfter}postOp(J){if(J>-1&&this.currentOp>=J)return!0;return this.currentOp++,!1}updateStateUI(){aJ.find("#dl-geometrymode-content").html(this.buildStateTab()),aJ.find("#dl-vertices-content").html(this.buildVerticesTab()),aJ.find("#dl-tiles-content").html(this.buildTilesTab()),aJ.find("#dl-combiner-content").html(this.buildCombinerTab()),aJ.find("#dl-rdp-content").html(this.buildRDPTab())}setScrubText(J,q){nQ.find(".scrub-text").html(`uCode op ${J}/${q}.`)}setScrubRange(J){nQ.find("input").attr({min:0,max:J,value:J}),this.setScrubText(J,J)}setScrubTime(J){this.bailAfter=J,this.setScrubText(this.bailAfter,this.numOps);const q=A8.find(`#I${this.bailAfter}`);A8.scrollTop(A8.scrollTop()+q.position().top-A8.height()/2+q.height()/2);const Q="hle-cur-instr";A8.find(".hle-instr").removeClass(Q),q.addClass(Q)}initUI(){const J=cW.find("#controls");this.bailAfter=-1,this.numOps=0;const q=this;J.find("#rwd").click(()=>{if(q.running&&q.bailAfter>0)q.setScrubTime(q.bailAfter-1)}),J.find("#fwd").click(()=>{if(q.running&&q.bailAfter<q.numOps)q.setScrubTime(q.bailAfter+1)}),J.find("#stop").click(()=>{this.toggle()}),nQ=J.find(".scrub"),nQ.find("input").change(function(){q.setScrubTime($(this).val()|0)}),this.setScrubRange(0),aJ=cW.find(".hle-state"),A8=$('<div class="hle-disasm"></div>'),$("#adjacent-debug").empty().append(A8)}showUI(){n64js.debugger().show(),$("#dlist-tab").tab("show")}hideUI(){n64js.debugger().hide()}setDisplayListOutput(J){A8.html(J),J.find(".dl-tip").parent().click(function(){$(this).find(".dl-tip").toggle()})}buildStateTab(){const J=$('<table class="table table-condensed dl-debug-table" style="width: auto;"></table>'),q=$("<tr />");for(let Q in this.state.geometryMode)if(Object.prototype.hasOwnProperty.call(this.state.geometryMode,Q)){const Z=$(`<td>${Q}</td>`);Z.addClass(this.state.geometryMode[Q]?"dl-debug-geommode-enabled":"dl-debug-geommode-disabled"),q.append(Z)}return J.append(q),J}buildRDPTab(){const J=this.state.rdpOtherModeL,q=this.state.rdpOtherModeH,Q=this.state.textureImage,Z=new Map([["alphaCompare",JJ.nameOf(J&vJ)],["depthSource",O8.nameOf(J&KQ)],["renderMode",zQ(J)],["alphaDither",bQ.nameOf(q&LQ)],["colorDither",_Q.nameOf(q&NQ)],["combineKey",TQ.nameOf(q&jQ)],["textureConvert",EQ.nameOf(q&GQ)],["textureFilter",dJ.nameOf(q&gJ)],["textureLUT",oJ.nameOf(q&uJ)],["textureLOD",yQ.nameOf(q&HQ)],["texturePersp",CQ.nameOf(q&FQ)],["textureDetail",RQ.nameOf(q&$Q)],["cycleType",L0.nameOf(q&xJ)],["pipelineMode",AQ.nameOf(q&WQ)],["","&nbsp"],["TI.format",N0.nameOf(Q.format)],["TI.size",n.nameOf(Q.size)],["TI.width",Q.width],["TI.address",N(Q.address)]]),X=$('<table class="table table-condensed dl-debug-table" style="width: auto;"></table>');for(let[Y,z]of Z){let K=$(`<tr><td>${Y}</td><td>${z}</td></tr>`);X.append(K)}return X}buildColorsTable(){const J=["fillColor","envColor","primColor","blendColor","fogColor"],q=$('<table class="table table-condensed dl-debug-table" style="width: auto;"></table>');for(let Q of J){let Z=$(`<tr><td>${Q}</td><td>${I8(this.state[Q])}</td></tr>`);q.append(Z)}return q}buildCombinerTab(){const J=$('<pre class="combine"></pre>');J.append(L0.nameOf(this.state.getCycleType())+"\n"),J.append(this.buildColorsTable()),J.append(lQ(this.state.combine.hi,this.state.combine.lo));const q=this.renderer.getCurrentN64Shader();if(q)J.append(q.shaderSource);return J}buildTexture(J){const q=this.renderer.lookupTexture(J);if(q)return q.createScaledCanvas(8)}buildTilesTab(){const J=$("<div />");J.append(this.buildTilesTable());const q=[],Q=$("<tr />");for(let X=0;X<8;++X){let Y=this.buildTexture(X);q.push(p0(X));let z=$("<td />");z.append(Y?Y:""),Q.append(z)}const Z=$('<table class="table table-condensed dl-debug-table" style="width: auto"></table>');return Z.append($(`<tr><th>${q.join("</th><th>")}</th></tr>`)),Z.append(Q),J.append(Z),J}buildTilesTable(){const J=["tile #","format","size","line","tmem","palette","cmS","maskS","shiftS","cmT","maskT","shiftT","left","top","right","bottom","width","height","unmasked w","unmasked h"],q=$('<table class="table table-condensed dl-debug-table" style="width: auto"></table>'),Q=$(`<tr><th>${J.join("</th><th>")}</th></tr>`);q.append(Q);for(let Z=0;Z<this.state.tiles.length;++Z){const X=this.state.tiles[Z];if(X.format===-1)continue;const Y=[];Y.push(p0(Z)),Y.push(N0.nameOf(X.format)),Y.push(n.nameOf(X.size)),Y.push(X.line),Y.push(X.tmem),Y.push(X.palette),Y.push(mJ(X.cmS)),Y.push(X.maskS),Y.push(X.shiftS),Y.push(mJ(X.cmT)),Y.push(X.maskT),Y.push(X.shiftT),Y.push(X.left),Y.push(X.top),Y.push(X.right),Y.push(X.bottom),Y.push(X.width),Y.push(X.height),Y.push(X.unmaskedWidth),Y.push(X.unmaskedHeight);const z=$(`<tr><td>${Y.join("</td><td>")}</td></tr>`);q.append(z)}return q}buildVerticesTab(){const J=["vtx #","x","y","z","px","py","pz","pw","color","u","v","clip"],q=$('<table class="table table-condensed dl-debug-table" style="width: auto"></table>'),Q=$(`<tr><th>${J.join("</th><th>")}</th></tr>`);q.append(Q);for(let Z=0;Z<this.state.projectedVertices.length;++Z){const X=this.state.projectedVertices[Z];if(!X.set)continue;const Y=X.pos.x/X.pos.w,z=X.pos.y/X.pos.w,K=X.pos.z/X.pos.w,W=[];W.push(Z),W.push(Y.toFixed(3)),W.push(z.toFixed(3)),W.push(K.toFixed(3)),W.push(X.pos.x.toFixed(3)),W.push(X.pos.y.toFixed(3)),W.push(X.pos.z.toFixed(3)),W.push(X.pos.w.toFixed(3)),W.push(xQ(X.color)),W.push(X.u.toFixed(3)),W.push(X.v.toFixed(3)),W.push(MN(X.clipFlags));const G=$(`<tr><td>${W.join("</td><td>")}</td></tr>`);q.append(G)}return q}}class dW{constructor(J){this.debugController=J,this.$currentDis=$("<pre></pre>"),this.$span=void 0,this.numOps=0}begin(J,q,Q){const Z=new Array(Q+1).join("  ");this.$span=$(`<span class="hle-instr" id="I${this.numOps}" />`),this.$span.append(`${X5(this.numOps,5)} ${v(J,32)}${v(q,32)} ${Z}`),this.$currentDis.append(this.$span)}text(J){this.$span.append(J)}tip(J){const q=$(`<div class="dl-tip">${J}</div>`);q.hide(),this.$span.append(q)}end(){this.$span.append("<br>"),this.numOps++}finalise=function(){this.debugController.setDisplayListOutput(this.$currentDis)};rgba8888(J){return I8(J)}rgba5551(J){return _W(J)}}class k0{constructor(J,q,Q){if(Q!==void 0)this.elems=new Float32Array(3),this.elems[0]=J,this.elems[1]=q,this.elems[2]=Q;else this.elems=J||new Float32Array(3)}get x(){return this.elems[0]}get y(){return this.elems[1]}get z(){return this.elems[2]}set x(J){this.elems[0]=J}set y(J){this.elems[1]=J}set z(J){this.elems[2]=J}set(J,q,Q){return this.x=J,this.y=q,this.z=Q,this}dot(J){let q=0;for(let Q=0;Q<this.elems.length;++Q)q+=this.elems[Q]*J.elems[Q];return q}lengthSqr(){return this.dot(this)}length(){return Math.sqrt(this.lengthSqr())}addInPlace(J){for(let q=0;q<this.elems.length;++q)this.elems[q]+=J.elems[q];return this}subInPlace(J){for(let q=0;q<this.elems.length;++q)this.elems[q]-=J.elems[q];return this}scaleInPlace(J){for(let q=0;q<this.elems.length;++q)this.elems[q]*=J;return this}vecScaleInPlace(J){for(let q=0;q<this.elems.length;++q)this.elems[q]*=J.elems[q];return this}invVecScaleInPlace(J){for(let q=0;q<this.elems.length;++q)this.elems[q]/=J.elems[q];return this}normaliseInPlace(){let J=this.length();if(J>0)return this.scaleInPlace(1/J);return this}static create(J){const q=new k0;return q.elems[0]=J[0],q.elems[1]=J[1],q.elems[2]=J[2],q}}var lW=function(J,q,Q){return J.getU32(q)&4294901760|J.getU32(Q)>>>16&65535},nW=function(J,q,Q){return J.getU32(q)<<16|J.getU32(Q)&65535},P7=function(J){return J<<18>>18},rJ=function(J){return J<<4>>4},E=e({Nop:0,FillTriangle:8,FillZBufferTriangle:9,TextureTriangle:10,TextureZBufferTriangle:11,ShadeTriangle:12,ShadeZBufferTriangle:13,ShadeTextureTriangle:14,ShadeTextureZBufferTriangle:15,TextureRectangle:36,TextureRectangleFlip:37,SyncLoad:38,SyncPipe:39,SyncTile:40,SyncFull:41,SetKeyGB:42,SetKeyR:43,SetConvert:44,SetScissor:45,SetPrimDepth:46,SetOtherModes:47,LoadTLut:48,SetTileSize:50,LoadBlock:51,LoadTile:52,SetTile:53,FillRectangle:54,SetFillColor:55,SetFogColor:56,SetBlendColor:57,SetPrimColor:58,SetEnvColor:59,SetCombine:60,SetTextureImage:61,SetMaskImage:62,SetColorImage:63}),eq=[1,1,1,1,1,1,1,1,4,6,12,14,12,14,20,22,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],iQ=16,hN=1<<iQ,kN=2,aQ=1<<kN,rQ=16,sQ=16;class QJ{constructor(J,q,Q,Z){Z=Z||4294967295,this.dv=J,this.curAddr=q,this.endAddr=Q,this.addrMask=Z}clone(){return new QJ(this.dv,this.curAddr,this.endAddr,this.addrMask)}getU32(J){return this.dv.getUint32(this.curAddr+J&this.addrMask,!1)}getU64(J){return this.dv.getBigUint64(this.curAddr+J&this.addrMask,!1)}advance(J){this.curAddr+=J}bytesRemaining(){return this.endAddr-this.curAddr}empty(){return this.curAddr>=this.endAddr}}class m6{constructor(J){this.displayPrecisionBits=J,this.elems=[0,0,0,0]}loadHiLo(J,q){this.elems[0]=lW(J,q+0,q+16),this.elems[1]=nW(J,q+0,q+16),this.elems[2]=lW(J,q+4,q+20),this.elems[3]=nW(J,q+4,q+20)}toString(){const J=1/(1<<this.displayPrecisionBits);return`[${this.elems[0]*J}, ${this.elems[1]*J}, ${this.elems[2]*J}, ${this.elems[3]*J}]`}}class J9{constructor(){this.type=0,this.tile=0,this.rightMajor=!1,this.shade=!1,this.texture=!1,this.zbuffer=!1,this.yh=0,this.ym=0,this.yl=0,this.xh=0,this.xm=0,this.xl=0,this.dxhdy=0,this.dxmdy=0,this.dxldy=0,this.rgba=new m6(rQ),this.drgba_dx=new m6(rQ),this.drgba_de=new m6(rQ),this.drgba_dy=new m6(rQ),this.stw=new m6(sQ+5),this.dstw_dx=new m6(sQ+5),this.dstw_de=new m6(sQ+5),this.dstw_dy=new m6(sQ+5)}load(J){const q=J.getU32(0)>>24&63;if(this.type=q,this.shade=(q&4)!=0,this.texture=(q&2)!=0,this.zbuffer=(q&1)!=0,this.loadEdge(J),J.advance(32),this.shade)this.loadShade(J),J.advance(64);if(this.texture)this.loadTexture(J),J.advance(64)}loadEdge(J){this.tile=J.getU32(0)>>16&7,this.rightMajor=(J.getU32(0)&8388608)!=0,this.yl=P7(J.getU32(0)>>0),this.ym=P7(J.getU32(4)>>16),this.yh=P7(J.getU32(4)>>0),this.xl=rJ(J.getU32(8)),this.xh=rJ(J.getU32(16)),this.xm=rJ(J.getU32(24)),this.dxldy=rJ(J.getU32(12)),this.dxhdy=rJ(J.getU32(20)),this.dxmdy=rJ(J.getU32(28))}loadShade(J){this.rgba.loadHiLo(J,0),this.drgba_dx.loadHiLo(J,8),this.drgba_de.loadHiLo(J,32),this.drgba_dy.loadHiLo(J,40)}loadTexture(J){this.stw.loadHiLo(J,0),this.dstw_dx.loadHiLo(J,8),this.dstw_de.loadHiLo(J,32),this.dstw_dy.loadHiLo(J,40)}interpolateX(J){let q=this.yh&~(aQ-1),Q=this.ym,Z=this.xh+(J-q)*this.dxhdy,X;if(J<this.ym)X=this.xm+(J-q)*this.dxmdy;else X=this.xl+(J-Q)*this.dxldy;const Y=this.rightMajor?Z:X,z=this.rightMajor?X:Z;return[Y>>iQ,z>>iQ]}interpolate(J,q,Q,Z,X){const Y=this.yh&~(aQ-1),z=(q-Y)/aQ,W=this.xh+z*this.dxhdy>>iQ,G=J-W,H=new m6(Q.precisionBits);for(let j=0;j<4;j++)H.elems[j]=Q.elems[j]+Z.elems[j]*z+(X.elems[j]&~31)*G;return H}interpolateShade(J,q){return this.interpolate(J,q,this.rgba,this.drgba_de,this.drgba_dx)}interpolateTexture(J,q){return this.interpolate(J,q,this.stw,this.dstw_de,this.dstw_dx)}calculateRectUVs(){const J=this.yh,q=this.ym,Q=this.interpolateX(this.yh),Z=this.interpolateX(this.ym),X=Math.min(Q[0],Z[0]),Y=Math.max(Q[1],Z[1]),z=this.interpolateTexture(X,J),K=this.interpolateTexture(Y,J),W=this.interpolateTexture(X,q),G=this.interpolateTexture(Y,q),H=1/(1<<16)/32;return[z.elems[0]*H,z.elems[1]*H,K.elems[0]*H,K.elems[1]*H,W.elems[0]*H,W.elems[1]*H,G.elems[0]*H,G.elems[1]*H]}toString(){const J=1/hN,q=1/aQ;let Q="";if(Q+=`\nEdge:
  tile ${this.tile}
  yl ${this.yl*q}, ym ${this.ym*q}, yh ${this.yh*q}
  xl ${this.xl*J}, xm ${this.xm*J}, xh ${this.xh*J}
  dxldy ${this.dxldy*J}, dxmdy ${this.dxmdy*J}, dxhdy ${this.dxhdy*J}
`,this.shade)Q+=`\nShade:
  rgba ${this.rgba.toString()}
  drgba_dx ${this.drgba_dx.toString()}
  drgba_de ${this.drgba_de.toString()}
  drgba_dy ${this.drgba_dy.toString()}
`;if(this.texture)Q+=`Texture:
  stw ${this.stw.toString()}
  dstw_dx ${this.dstw_dx.toString()}
  dstw_de ${this.dstw_de.toString()}
  dstw_dy ${this.dstw_dy.toString()}
`;return Q}}class M7{constructor(J){this.hardware=J,this.commandTable=this.makeCommandTable()}makeCommandTable(){let J=[];for(let q=0;q<64;q++)J.push(this.executeUnknown.bind(this));return J[E.Nop]=this.executeNop.bind(this),J[E.FillTriangle]=this.executeTriangle.bind(this),J[E.FillZBufferTriangle]=this.executeTriangle.bind(this),J[E.TextureTriangle]=this.executeTriangle.bind(this),J[E.TextureZBufferTriangle]=this.executeTriangle.bind(this),J[E.ShadeTriangle]=this.executeTriangle.bind(this),J[E.ShadeZBufferTriangle]=this.executeTriangle.bind(this),J[E.ShadeTextureTriangle]=this.executeTriangle.bind(this),J[E.ShadeTextureZBufferTriangle]=this.executeTriangle.bind(this),J[E.TextureRectangle]=this.executeUnhandled.bind(this),J[E.TextureRectangleFlip]=this.executeUnhandled.bind(this),J[E.SyncLoad]=this.executeSyncLoad.bind(this),J[E.SyncPipe]=this.executeSyncPipe.bind(this),J[E.SyncTile]=this.executeSyncTile.bind(this),J[E.SyncFull]=this.executeSyncFull.bind(this),J[E.SetKeyGB]=this.executeSetKeyGB.bind(this),J[E.SetKeyR]=this.executeSetKeyR.bind(this),J[E.SetConvert]=this.executeSetConvert.bind(this),J[E.SetScissor]=this.executeSetScissor.bind(this),J[E.SetPrimDepth]=this.executeSetPrimDepth.bind(this),J[E.SetOtherModes]=this.executeSetOtherModes.bind(this),J[E.LoadTLut]=this.executeLoadTLut.bind(this),J[E.SetTileSize]=this.executeSetTileSize.bind(this),J[E.LoadBlock]=this.executeLoadBlock.bind(this),J[E.LoadTile]=this.executeLoadTile.bind(this),J[E.SetTile]=this.executeSetTile.bind(this),J[E.FillRectangle]=this.executeFillRectangle.bind(this),J[E.SetFillColor]=this.executeSetFillColor.bind(this),J[E.SetFogColor]=this.executeSetFogColor.bind(this),J[E.SetBlendColor]=this.executeSetBlendColor.bind(this),J[E.SetPrimColor]=this.executeSetPrimColor.bind(this),J[E.SetEnvColor]=this.executeSetEnvColor.bind(this),J[E.SetCombine]=this.executeSetCombine.bind(this),J[E.SetTextureImage]=this.executeSetTextureImage.bind(this),J[E.SetMaskImage]=this.executeSetMaskImage.bind(this),J[E.SetColorImage]=this.executeSetColorImage.bind(this),J}run(J){while(!J.empty()){const Q=J.getU32(0)>>24&63,Z=eq[Q]*8,X=J.curAddr+Z;this.commandTable[Q](Q,J),J.curAddr=X}}executeNop(J,q){}executeUnknown(J,q){console.log(`Unknown RDP command: ${E.nameOf(J)}`)}executeUnhandled(J,q){console.log(`Unhandled RDP command: ${E.nameOf(J)}`)}executeTriangle(J,q){this.executeUnhandled(J,q)}executeSyncLoad(J,q){this.executeUnhandled(J,q)}executeSyncPipe(J,q){this.executeUnhandled(J,q)}executeSyncTile(J,q){this.executeUnhandled(J,q)}executeSyncFull(J,q){this.hardware.dpcDevice.syncFull()}executeSetKeyGB(J,q){this.executeUnhandled(J,q)}executeSetKeyR(J,q){this.executeUnhandled(J,q)}executeSetConvert(J,q){this.executeUnhandled(J,q)}executeSetScissor(J,q){this.executeUnhandled(J,q)}executeSetPrimDepth(J,q){this.executeUnhandled(J,q)}executeSetOtherModes(J,q){this.executeUnhandled(J,q)}executeLoadTLut(J,q){this.executeUnhandled(J,q)}executeSetTileSize(J,q){this.executeUnhandled(J,q)}executeLoadBlock(J,q){this.executeUnhandled(J,q)}executeLoadTile(J,q){this.executeUnhandled(J,q)}executeSetTile(J,q){this.executeUnhandled(J,q)}executeFillRectangle(J,q){this.executeUnhandled(J,q)}executeSetFillColor(J,q){this.executeUnhandled(J,q)}executeSetFogColor(J,q){this.executeUnhandled(J,q)}executeSetBlendColor(J,q){this.executeUnhandled(J,q)}executeSetPrimColor(J,q){this.executeUnhandled(J,q)}executeSetEnvColor(J,q){this.executeUnhandled(J,q)}executeSetCombine(J,q){this.executeUnhandled(J,q)}executeSetTextureImage(J,q){this.executeUnhandled(J,q)}executeSetMaskImage(J,q){this.executeUnhandled(J,q)}executeSetColorImage(J,q){this.executeUnhandled(J,q)}}var ON=function(J,q){let Q=[];const Z=eq[J]*8;for(let X=0;X<Z;X+=8)Q.push(v(q.getU64(X),64));return Q.join(" ")},IN=function(J,q){return"Unknown"},z0=function(J,q){return""},wN=function(J,q){return""},C8=function(J,q){return rW.load(q),"\n"+rW.toString()},BN=function(J,q){while(J.length<q)J+=" ";return J};function h7(J){if(J=J.clone(),J.bytesRemaining()<4)return null;const q=J.curAddr,Z=J.getU32(0)>>24&63,X=eq[Z]*8;if(J.bytesRemaining()<X)return null;let z=`${BN(E.nameOf(Z),24)}${ON(Z,J)}`;return z+=DN[Z](Z,J),{address:q,disassembly:z}}function sW(J){J=J.clone();const q=[];while(!J.empty()){const Z=J.getU32(0)>>24&63,X=eq[Z]*8,Y=h7(J);if(Y!=null)q.push(Y);J.advance(X)}return q}var rW=new J9,DN=(()=>{let J=[];for(let q=0;q<64;q++)J.push(IN);return J[E.Nop]=wN,J[E.FillTriangle]=C8,J[E.FillZBufferTriangle]=C8,J[E.TextureTriangle]=C8,J[E.TextureZBufferTriangle]=C8,J[E.ShadeTriangle]=C8,J[E.ShadeZBufferTriangle]=C8,J[E.ShadeTextureTriangle]=C8,J[E.ShadeTextureZBufferTriangle]=C8,J[E.TextureRectangle]=z0,J[E.TextureRectangleFlip]=z0,J[E.SyncLoad]=z0,J[E.SyncPipe]=z0,J[E.SyncTile]=z0,J[E.SyncFull]=z0,J[E.SetKeyGB]=z0,J[E.SetKeyR]=z0,J[E.SetConvert]=z0,J[E.SetScissor]=z0,J[E.SetPrimDepth]=z0,J[E.SetOtherModes]=z0,J[E.LoadTLut]=z0,J[E.SetTileSize]=z0,J[E.LoadBlock]=z0,J[E.LoadTile]=z0,J[E.SetTile]=z0,J[E.FillRectangle]=z0,J[E.SetFillColor]=z0,J[E.SetFogColor]=z0,J[E.SetBlendColor]=z0,J[E.SetPrimColor]=z0,J[E.SetEnvColor]=z0,J[E.SetCombine]=z0,J[E.SetTextureImage]=z0,J[E.SetMaskImage]=z0,J[E.SetColorImage]=z0,J})();class s0{constructor(J){this.elems=J||new Float32Array(16)}multiply(J){let q=this.elems,Q=J.elems,Z=new Float32Array(16);for(let X=0;X<4;++X)for(let Y=0;Y<4;++Y)Z[X*4+Y]+=q[X*4+0]*Q[0+Y],Z[X*4+Y]+=q[X*4+1]*Q[4+Y],Z[X*4+Y]+=q[X*4+2]*Q[8+Y],Z[X*4+Y]+=q[X*4+3]*Q[12+Y];return new s0(Z)}transformNormal(J,q){let Q=this.elems,Z=J.elems,X=Z[0],Y=Z[1],z=Z[2];q.elems[0]=Q[0]*X+Q[1]*Y+Q[2]*z,q.elems[1]=Q[4]*X+Q[5]*Y+Q[6]*z,q.elems[2]=Q[8]*X+Q[9]*Y+Q[10]*z}transformPoint(J,q){let Q=this.elems,Z=J.elems,X=Z[0],Y=Z[1],z=Z[2];q.elems[0]=Q[0]*X+Q[1]*Y+Q[2]*z+Q[3],q.elems[1]=Q[4]*X+Q[5]*Y+Q[6]*z+Q[7],q.elems[2]=Q[8]*X+Q[9]*Y+Q[10]*z+Q[11],q.elems[3]=Q[12]*X+Q[13]*Y+Q[14]*z+Q[15]}static identity(){let J=new Float32Array(16);return J[0]=1,J[5]=1,J[10]=1,J[15]=1,new s0(J)}copy(){let J=new Float32Array(16);for(let q=0;q<16;q++)J[q]=this.elems[q];return new s0(J)}static makeOrtho(J,q,Q,Z,X,Y){let z=-(q+J)/(q-J),K=-(Z+Q)/(Z-Q),W=-(Y+X)/(Y-X),G=new Float32Array(16);return G[0]=2/(q-J),G[1]=0,G[2]=0,G[3]=0,G[4]=0,G[5]=2/(Z-Q),G[6]=0,G[7]=0,G[8]=0,G[9]=0,G[10]=-2/(Y-X),G[11]=0,G[12]=z,G[13]=K,G[14]=W,G[15]=1,new s0(G)}}var m0={canvasScale:1,haltOnWarning:!1,dumpMicrocodeSubstring:"",emulationMode:"HLE",dumpRDP:!1},q9=q6.addFolder("Graphics");q9.add(m0,"canvasScale").name("Canvas Scale").min(1).max(4).step(0.25);q9.add(m0,"haltOnWarning").name("Halt on Warning");q9.add(m0,"dumpMicrocodeSubstring").name("Dump Microcode");q9.add(m0,"emulationMode",{HLE:"HLE",LLE:"LLE"}).name("Emulation Mode");q9.add(m0,"dumpRDP").name("Dump RDP");function sJ(J,q){return(J>>>2)-(q>>>2)+1&1023}var iW=function(J,q){return q?Math.min(1<<q,J):J};class k7{constructor(){this.format=-1,this.size=0,this.line=0,this.tmem=0,this.palette=0,this.cmT=0,this.maskT=0,this.shiftT=0,this.cmS=0,this.maskS=0,this.shiftS=0,this.uls=0,this.ult=0,this.lrs=0,this.lrt=0,this.hash=0}get left(){return this.uls/4}get top(){return this.ult/4}get right(){return this.lrs/4}get bottom(){return this.lrt/4}get unmaskedWidth(){return sJ(this.lrs,this.uls)}get unmaskedHeight(){return sJ(this.lrt,this.ult)}get width(){return iW(this.unmaskedWidth,this.maskS)}get height(){return iW(this.unmaskedHeight,this.maskT)}set(J,q,Q,Z,X,Y,z,K,W,G,H){this.format=J,this.size=q,this.line=Q,this.tmem=Z,this.palette=X,this.cmS=Y,this.maskS=z,this.shiftS=K,this.cmT=W,this.maskT=G,this.shiftT=H,this.hash=0}setSize(J,q,Q,Z){this.uls=J,this.ult=q,this.lrs=Q,this.lrt=Z,this.hash=0}}class D7{constructor(J){this.numTris=0,this.maxTris=J,this.positions=new Float32Array(J*3*4),this.colours=new Uint32Array(J*3*1),this.coords=new Float32Array(J*3*2)}reset(){this.numTris=0}empty(){return this.numTris==0}hasCapacity(J){return this.numTris+J<this.maxTris}pushTri(J,q,Q){return this.pushTriWithUV(J,q,Q,J.u,J.v,q.u,q.v,Q.u,Q.v)}pushTriWithUV(J,q,Q,Z,X,Y,z,K,W){if(this.numTris>=this.maxTris)return!1;const G=J.pos,H=q.pos,j=Q.pos;let L=this.numTris*3*4;this.positions[L++]=G.x,this.positions[L++]=G.y,this.positions[L++]=G.z,this.positions[L++]=G.w,this.positions[L++]=H.x,this.positions[L++]=H.y,this.positions[L++]=H.z,this.positions[L++]=H.w,this.positions[L++]=j.x,this.positions[L++]=j.y,this.positions[L++]=j.z,this.positions[L++]=j.w;let V=this.numTris*3*1;this.colours[V++]=J.color,this.colours[V++]=q.color,this.colours[V++]=Q.color;let U=this.numTris*3*2;return this.coords[U++]=Z,this.coords[U++]=X,this.coords[U++]=Y,this.coords[U++]=z,this.coords[U++]=K,this.coords[U++]=W,this.numTris++,!0}}var RN=function(J){return{r:(J>>>11&31)/31,g:(J>>>6&31)/31,b:(J>>>1&31)/31,a:(J>>>0&1)/1}},JF=function(J){return{r:(J>>>24&255)/255,g:(J>>>16&255)/255,b:(J>>>8&255)/255,a:(J>>>0&255)/255}},CN=!0,tW=new Map,eW=new Map;class Q9{constructor(J,q){this.state=J,this.ramDV=q,this.vertexStride=2,this.version="",this.triangleBuffer=new D7(64),this.onLoadUcodeHandler=null,this.gbiCommonCommands=new Map([[228,this.executeTexRect.bind(this)],[229,this.executeTexRectFlip.bind(this)],[230,this.executeRDPLoadSync.bind(this)],[231,this.executeRDPPipeSync.bind(this)],[232,this.executeRDPTileSync.bind(this)],[233,this.executeRDPFullSync.bind(this)],[234,this.executeSetKeyGB.bind(this)],[235,this.executeSetKeyR.bind(this)],[236,this.executeSetConvert.bind(this)],[237,this.executeSetScissor.bind(this)],[238,this.executeSetPrimDepth.bind(this)],[239,this.executeSetRDPOtherMode.bind(this)],[240,this.executeLoadTLut.bind(this)],[242,this.executeSetTileSize.bind(this)],[243,this.executeLoadBlock.bind(this)],[244,this.executeLoadTile.bind(this)],[245,this.executeSetTile.bind(this)],[246,this.executeFillRect.bind(this)],[247,this.executeSetFillColor.bind(this)],[248,this.executeSetFogColor.bind(this)],[249,this.executeSetBlendColor.bind(this)],[250,this.executeSetPrimColor.bind(this)],[251,this.executeSetEnvColor.bind(this)],[252,this.executeSetCombine.bind(this)],[253,this.executeSetTImg.bind(this)],[254,this.executeSetZImg.bind(this)],[255,this.executeSetCImg.bind(this)]])}buildCommandTable(){const J=[];for(let q=0;q<256;++q){let Q=this.getHandler(q);if(!Q)Q=this.executeUnknown.bind(this);J.push(Q)}return J}getHandler(J){const q=this.gbiCommonCommands.get(J);if(q)return q;return null}onLoadUcode(J){this.onLoadUcodeHandler=J}executeUnknown(J,q){this.warn(`Unknown display list op ${v0(J>>>24)}`,`cmd0 ${N(J)}, cmd1 ${N(q)}`)}warnUnimplemented(J){this.warn(J,"unimplemented")}warn(J,q){if(eW.get(J))return;eW.set(J,!0);const Q=q!==void 0?`${J}: ${q}`:J;if(m0.haltOnWarning)this.hleHalt(Q);else n64js.warn(Q)}loadMatrix(J,q){const Z=new DataView(this.ramDV.buffer,J);if(q!=64)this.warn("Unusual matrix length",`${q}`);const X=new Float32Array(16);for(let Y=0;Y<4;++Y)X[0+Y]=(Z.getInt16(Y*8+0)<<16|Z.getUint16(Y*8+0+32))*0.0000152587890625,X[4+Y]=(Z.getInt16(Y*8+2)<<16|Z.getUint16(Y*8+2+32))*0.0000152587890625,X[8+Y]=(Z.getInt16(Y*8+4)<<16|Z.getUint16(Y*8+4+32))*0.0000152587890625,X[12+Y]=(Z.getInt16(Y*8+6)<<16|Z.getUint16(Y*8+6+32))*0.0000152587890625;return new s0(X)}previewMatrix(J){const q=J.elems,Q=[q[0],q[1],q[2],q[3]],Z=[q[4],q[5],q[6],q[7]],X=[q[8],q[9],q[10],q[11]],Y=[q[12],q[13],q[14],q[15]];return`<div><table class="matrix-table">
      <tr><td>${Q.join("</td><td>")}</td></tr>
      <tr><td>${Z.join("</td><td>")}</td></tr>
      <tr><td>${X.join("</td><td>")}</td></tr>
      <tr><td>${Y.join("</td><td>")}</td></tr>
    </table></div>`}loadViewport(J){const q=new k0(+this.ramDV.getInt16(J+0)/4,-this.ramDV.getInt16(J+2)/4,+this.ramDV.getInt16(J+4)),Q=new k0(this.ramDV.getInt16(J+8)/4,this.ramDV.getInt16(J+10)/4,this.ramDV.getInt16(J+12));this.state.viewport.set(q,Q)}previewViewport(J){const q=new k0(this.ramDV.getInt16(J+0)/4,this.ramDV.getInt16(J+2)/4,this.ramDV.getInt16(J+4)),Q=new k0(this.ramDV.getInt16(J+8)/4,this.ramDV.getInt16(J+10)/4,this.ramDV.getInt16(J+12));let Z="";return Z+=`scale = (${q.x}, ${q.y}, ${q.z}) `,Z+=`trans = (${Q.x}, ${Q.y}, ${Q.z}) `,Z}loadLight(J,q){if(J>=this.state.lights.length){h(`light index ${J} out of range`);return}this.state.lights[J].color=JF(this.ramDV.getUint32(q+0)),this.state.lights[J].dir=k0.create([this.ramDV.getInt8(q+8),this.ramDV.getInt8(q+9),this.ramDV.getInt8(q+10)]).normaliseInPlace()}previewLight(J){let q="";q+=`color = ${I8(this.ramDV.getUint32(J+0))} `,q+=`colorCopy = ${I8(this.ramDV.getUint32(J+4))} `;const Q=k0.create([this.ramDV.getInt8(J+8),this.ramDV.getInt8(J+9),this.ramDV.getInt8(J+10)]).normaliseInPlace();return q+=`norm = (${Q.x}, ${Q.y}, ${Q.z})`,q}loadVertices(J,q,Q,Z){const X=this.state.geometryMode.lighting,Y=this.state.geometryMode.textureGen,z=this.state.geometryMode.textureGenLinear,K=new DataView(this.ramDV.buffer,Q);if(Z)this.previewVertex(J,q,K,Z,X);if(J+q>=this.state.projectedVertices.length){this.warn("Too many verts");return}const W=this.state.modelview[this.state.modelview.length-1],H=this.state.projection[this.state.projection.length-1].multiply(W),j=this.state.texture.scaleS/32,L=this.state.texture.scaleT/32,V=new k0,U=new k0,M=new k0,k=this.renderer.nativeTransform.viTransform,O=this.state.viewport.transform,R=16;for(let S=0;S<q;++S){const T=S*R,b=this.state.projectedVertices[J+S];if(b.set=!0,V.x=K.getInt16(T+0),V.y=K.getInt16(T+2),V.z=K.getInt16(T+4),b.u=K.getInt16(T+8)*j,b.v=K.getInt16(T+10)*L,b.color=K.getUint32(T+12,!0),this.projectInPlace(b,V,H,O,k),X){if(this.unpackNormal(U,b.color),W.transformNormal(U,M),M.normaliseInPlace(),b.color=this.calculateLighting(M,255),Y)if(z)b.calculateLinearUV(M);else b.calculateSphericalUV(M)}}}projectInPlace(J,q,Q,Z,X){const Y=J.pos;Q.transformPoint(q,Y),J.clipFlags=this.calculateClipFlags(Y);const z=Y.w;Y.scaleInPlace(1/z),Z.transformInPlace(Y),X.invTransformInPlace(Y),Y.scaleInPlace(z)}calculateClipFlags(J){let q=0;if(J.x<-J.w)q|=kQ;else if(J.x>J.w)q|=PQ;if(J.y<-J.w)q|=DQ;else if(J.y>J.w)q|=MQ;if(J.z<-J.w)q|=OQ;else if(J.z>J.w)q|=hQ;return q}unpackNormal(J,q){J.x=q<<24>>24,J.y=q<<16>>24,J.z=q<<8>>24}calculateLighting(J,q){const Q=this.state.numLights;let Z=this.state.lights[Q].color.r,X=this.state.lights[Q].color.g,Y=this.state.lights[Q].color.b;for(let z=0;z<Q;++z){const K=this.state.lights[z],W=J.dot(K.dir);if(W>0)Z+=K.color.r*W,X+=K.color.g*W,Y+=K.color.b*W}return Z=Math.min(Z,1)*255,X=Math.min(X,1)*255,Y=Math.min(Y,1)*255,q<<24|Y<<16|X<<8|Z}previewVertex(J,q,Q,Z,X){const Y=["#","x","y","z","?","u","v",X?"norm":"rgba"];let z="";z+='<table class="vertex-table">',z+=`<tr><th>${Y.join("</th><th>")}</th></tr>\n`;for(let K=0;K<q;++K){const W=K*16,G=X?`${Q.getInt8(W+12)},${Q.getInt8(W+13)},${Q.getInt8(W+14)}`:I8(Q.getUint32(W+12)),H=[J+K,Q.getInt16(W+0),Q.getInt16(W+2),Q.getInt16(W+4),Q.getInt16(W+6),Q.getInt16(W+8),Q.getInt16(W+10),G];z+=`<tr><td>${H.join("</td><td>")}</td></tr>\n`}z+="</table>",Z.tip(z)}executeNoop(J,q,Q){if(Q)Q.text("gsDPNoOp();")}executeSpNoop(J,q,Q){if(Q)Q.text("gsSPNoOp();")}executeLoadUcode(J,q,Q){const Z=q&268435455,Y=this.state.rdpHalf1Cmd1,z=(J&65535)+1;let K="?";if(this.onLoadUcodeHandler){const W=this.onLoadUcodeHandler(Z,4096,Y,z);W.onLoadUcode(this.onLoadUcodeHandler),K=W.version}else this.warn("No loadUcodeHandler set!");if(Q)Q.text(`gsSPLoadUCode(${N(Z)}, 4096, ${N(Y)} ${z}); // ${K}`)}executeRDPHalf1(J,q,Q){if(Q)Q.text(`gsImmp1(G_RDPHALF_1, ${N(q)});`);this.state.rdpHalf1Cmd1=q}executeRDPHalf2(J,q,Q){if(Q)Q.text(`gsImmp1(G_RDPHALF_2, ${N(q)});`);this.state.rdpHalf2Cmd1=q}executeRDPLoadSync(J,q,Q){if(Q)Q.text("gsDPLoadSync();")}executeRDPPipeSync(J,q,Q){if(Q)Q.text("gsDPPipeSync();")}executeRDPTileSync(J,q,Q){if(Q)Q.text("gsDPTileSync();")}executeRDPFullSync(J,q,Q){if(Q)Q.text("gsDPFullSync();")}executeSetKeyGB(J,q,Q){if(Q)Q.text("gsDPSetKeyGB(???);")}executeSetKeyR(J,q,Q){if(Q)Q.text("gsDPSetKeyR(???);")}executeSetConvert(J,q,Q){if(Q)Q.text("gsDPSetConvert(???);")}executeSetScissor(J,q,Q){const Z=(J>>>12&4095)/4,X=(J>>>0&4095)/4,Y=(q>>>12&4095)/4,z=(q>>>0&4095)/4,K=q>>>24&2;if(Q)Q.text(`gsDPSetScissor(${CW.nameOf(K)}, ${Z}, ${X}, ${Y}, ${z});`);this.state.scissor.x0=Z,this.state.scissor.y0=X,this.state.scissor.x1=Y,this.state.scissor.y1=z,this.state.scissor.mode=K}executeSetRDPOtherMode(J,q,Q){if(Q)Q.text(`gsDPSetOtherMode(${N(J)}, ${N(q)}); // TODO: fix formatting`);this.state.rdpOtherModeH=J,this.state.rdpOtherModeL=q}executeSetTile(J,q,Q){const Z=J>>>21&7,X=J>>>19&3,Y=J>>>9&511,z=J>>>0&511,K=q>>>24&7,W=q>>>20&15,G=q>>>18&3,H=q>>>14&15,j=q>>>10&15,L=q>>>8&3,V=q>>>4&15,U=q>>>0&15;if(this.state.tiles[K].set(Z,X,Y,z,W,L,V,U,G,H,j),Q){const k=N0.nameOf(Z),O=n.nameOf(X),R=p0(K),S=mJ(L),T=mJ(G);Q.text(`gsDPSetTile(${k}, ${O}, ${Y}, ${z}, ${R}, ${W}, ${T}, ${H}, ${j}, ${S}, ${V}, ${U});`)}}executeSetTileSize(J,q,Q){const Z=J>>>12&4095,X=J>>>0&4095,Y=q>>>24&7,z=q>>>12&4095,K=q>>>0&4095,W=this.state.tiles[Y];if(W.setSize(Z,X,z,K),Q){const G=p0(Y);Q.text(`gsDPSetTileSize(${G}, ${W.left}, ${W.top}, ${W.right}, ${W.bottom});`),Q.tip(`size (${W.width} x ${W.height}), unmasked (${W.unmaskedWidth} x ${W.unmaskedHeight})`)}}executeSetFillColor(J,q,Q){if(Q)Q.text(`gsDPSetFillColor(${Q.rgba8888(q)}); // hi as 5551 = ${Q.rgba5551(q>>>16)}, lo as 5551 = ${Q.rgba5551(q&65535)} `);this.state.fillColor=q}executeSetFogColor(J,q,Q){if(Q)Q.text(`gsDPSetFogColor(${Q.rgba8888(q)});`);this.state.fogColor=q}executeSetBlendColor(J,q,Q){if(Q)Q.text(`gsDPSetBlendColor(${Q.rgba8888(q)});`);this.state.blendColor=q}executeSetPrimColor(J,q,Q){if(Q){const Z=J>>>8&255,X=J>>>0&255;Q.text(`gsDPSetPrimColor(${Z}, ${X}, ${Q.rgba8888(q)});`)}this.state.primColor=q}executeSetPrimDepth(J,q,Q){const Z=q>>>16&65535,X=q&65535;if(Q)Q.text(`gsDPSetPrimDepth(${Z},${X});`)}executeSetEnvColor(J,q,Q){if(Q)Q.text(`gsDPSetEnvColor(${Q.rgba8888(q)});`);this.state.envColor=q}executeSetCombine(J,q,Q){if(Q){const Z=J&16777215,X=q,Y=lQ(Z,X);Q.text(`gsDPSetCombine(${N(Z)}, ${N(X)});\n${Y}`)}this.state.combine.hi=J&16777215,this.state.combine.lo=q}executeSetTImg(J,q,Q){const Z=J>>>21&7,X=J>>>19&3,Y=(J>>>0&4095)+1,z=this.state.rdpSegmentAddress(q);if(Q)Q.text(`gsDPSetTextureImage(${N0.nameOf(Z)}, ${n.nameOf(X)}, ${Y}, ${N(z)});`);this.state.textureImage.set(Z,X,Y,z)}executeSetZImg(J,q,Q){const Z=this.state.rdpSegmentAddress(q);if(Q)Q.text(`gsDPSetDepthImage(${N(Z)});`);this.state.depthImage.address=Z}executeSetCImg(J,q,Q){const Z=J>>>21&7,X=J>>>19&3,Y=(J>>>0&4095)+1,z=this.state.rdpSegmentAddress(q);if(Q)Q.text(`gsDPSetColorImage(${N0.nameOf(Z)}, ${n.nameOf(X)}, ${Y}, ${N(z)});`);if(this.state.colorImage={format:Z,size:X,width:Y,address:z},n64js.hardware().timeline.addEvent(`SetColorImage ${N(z)}`),CN&&!tW.get(z))h(`Setting colorImage to ${N(z)}, ${Y}, size ${n.nameOf(X)}, format ${N0.nameOf(Z)}`),tW.set(z,!0)}executeLoadBlock(J,q,Q){const Z=q>>>24&7,X=J>>>12&4095,Y=J>>>0&4095,z=q>>>12&4095,K=q>>>0&4095;if(X!==0)this.warn("Unexpected non-zero uls in load block");if(Y!==0)this.warn("Unexpected non-zero ult in load block");if(Q){const H=p0(Z);Q.text(`gsDPLoadBlock(${H}, ${X}, ${Y}, ${z}, ${K});`)}const W=this.state.textureImage,G=this.state.tiles[Z];this.state.tmem.loadBlock(W,G,X,Y,z,K,Q),this.state.invalidateTileHashes()}executeLoadTile(J,q,Q){const Z=q>>>24&7,X=J>>>12&4095,Y=J>>>0&4095,z=q>>>12&4095,K=q>>>0&4095;if(Q){const H=p0(Z);Q.text(`gsDPLoadTile(${H}, ${X/4}, ${Y/4}, ${z/4}, ${K/4});`)}const W=this.state.textureImage,G=this.state.tiles[Z];this.state.tmem.loadTile(W,G,X,Y,z,K,Q),this.state.invalidateTileHashes()}executeLoadTLut(J,q,Q){const Z=q>>>24&7,X=J>>>12&4095,Y=J>>>0&4095,z=q>>>12&4095,K=q>>>0&4095;if(Q){const H=p0(Z);Q.text(`gsDPLoadTLUTCmd(${H}, ${sJ(z,X)}); //${X}, ${Y}, ${z}, ${K}`)}const W=this.state.textureImage,G=this.state.tiles[Z];this.state.tmem.loadTLUT(W,G,X,Y,z,K,Q),this.state.invalidateTileHashes()}executeFillRect(J,q,Q){const Z=(q>>>12&4095)>>>2,X=(q>>>0&4095)>>>2;let Y=(J>>>12&4095)>>>2,z=(J>>>0&4095)>>>2;const K=this.gl;if(Q)Q.text(`gsDPFillRectangle(${Z}, ${X}, ${Y}, ${z});`);if(this.state.depthImage.address==this.state.colorImage.address){K.clearDepth(1),K.depthMask(!0),K.clear(K.DEPTH_BUFFER_BIT);return}const W=this.state.getCycleType();let G={r:0,g:0,b:0,a:0};if(W===L0.G_CYC_FILL){if(Y+=1,z+=1,this.state.colorImage.size===n.G_IM_SIZ_16b)G=RN(this.state.fillColor&65535);else G=JF(this.state.fillColor);const H=Y-Z,j=z-X;if(H===this.renderer.nativeTransform.viWidth&&j===this.renderer.nativeTransform.viHeight){K.clearColor(G.r,G.g,G.b,G.a),K.clear(K.COLOR_BUFFER_BIT);return}}else if(W===L0.G_CYC_COPY)Y+=1,z+=1;this.renderer.fillRect(Z,X,Y,z,G)}executeTexRect(J,q,Q){this.state.nextCommand();const Z=this.state.cmd1;this.state.nextCommand();const X=this.state.cmd1;this.rdpTexRect(J,q,Z,X,Q)}rdpTexRect(J,q,Q,Z,X){let Y=(J>>>12&4095)/4,z=(J>>>0&4095)/4;const K=q>>>24&7,W=(q>>>12&4095)/4,G=(q>>>0&4095)/4;let H=(Q>>>16&65535)/32,j=(Q>>>0&65535)/32,L=((Z|0)>>16)/1024;const V=(Z<<16>>16)/1024,U=this.state.getCycleType();if(U===L0.G_CYC_COPY)L*=0.25;if(U===L0.G_CYC_COPY||U===L0.G_CYC_FILL)Y+=1,z+=1;if(L<0)H++;if(V<0)j++;const M=H+L*(Y-W),k=j+V*(z-G);if(X){const O=p0(K);X.text(`gsSPTextureRectangle(${W},${G},${Y},${z},${O},${H},${j},${L},${V});`),X.tip(`cmd2 = ${N(Q)}, cmd3 = ${N(Z)}`),X.tip(`st0 = (${H}, ${j}) st1 = (${M}, ${k})`)}this.renderer.texRect(K,W,G,Y,z,H,j,M,k,!1)}executeTexRectFlip(J,q,Q){this.state.nextCommand();const Z=this.state.cmd1;this.state.nextCommand();const X=this.state.cmd1;this.rdpTexRectFlip(J,q,Z,X,Q)}rdpTexRectFlip(J,q,Q,Z,X){let Y=(J>>>12&4095)/4,z=(J>>>0&4095)/4;const K=q>>>24&7,W=(q>>>12&4095)/4,G=(q>>>0&4095)/4;let H=(Q>>>16&65535)/32,j=(Q>>>0&65535)/32,L=((Z|0)>>16)/1024;const V=(Z<<16>>16)/1024,U=this.state.getCycleType();if(U===L0.G_CYC_COPY)L*=0.25;if(U===L0.G_CYC_COPY||U===L0.G_CYC_FILL)Y+=1,z+=1;if(L<0)H++;if(V<0)j++;const M=H+L*(z-G),k=j+V*(Y-W);if(X){const O=p0(K);X.text(`gsSPTextureRectangleFlip(${W},${G},${Y},${z},${O},${H},${j},${L},${V});`),X.tip(`cmd2 = ${N(Q)}, cmd3 = ${N(Z)}`),X.tip(`st0 = (${H}, ${j}) st1 = (${M}, ${k})`)}this.renderer.texRect(K,W,G,Y,z,H,j,M,k,!0)}executeCullDL(J,q,Q){const Z=(J&65535)>>>1,X=(q&65535)>>>1,Y=this.testClipFlags(Z,X);if(Q)Q.text(`gSPCullDisplayList(${Z}, ${X}); // ${Y?"continue":"end"}`);if(!Y)this.state.endDisplayList()}testClipFlags(J,q){if(q<=J)return this.warn("begin and end vertices for testClipFlags are inverted or empty"),!0;if(q>=this.state.projectedVertices.length)return this.warn("end vertex for testClipFlags is out of bounds"),!0;let Q=~0;for(let Z=J;Z<=q;Z++)Q&=this.state.projectedVertices[Z].clipFlags;return Q==0}calcTextureScale(J){if(J===0||J===65535)return 1;return J/65536}}var tQ=!1;class R8 extends Q9{constructor(J,q){super(J,q);this.vertexStride=2,this.gbi1Commands=new Map([[0,this.executeSpNoop.bind(this)],[1,this.executeMatrix.bind(this)],[3,this.executeMoveMem.bind(this)],[4,this.executeVertex.bind(this)],[6,this.executeDL.bind(this)],[9,this.executeSprite2DBase.bind(this)],[175,this.executeLoadUcode.bind(this)],[176,this.executeBranchZ.bind(this)],[177,this.executeTri2.bind(this)],[178,this.executeModifyVertex.bind(this)],[179,this.executeRDPHalf2.bind(this)],[180,this.executeRDPHalf1.bind(this)],[181,this.executeLine3D.bind(this)],[182,this.executeClearGeometryMode.bind(this)],[183,this.executeSetGeometryMode.bind(this)],[184,this.executeEndDL.bind(this)],[185,this.executeSetOtherModeL.bind(this)],[186,this.executeSetOtherModeH.bind(this)],[187,this.executeTexture.bind(this)],[188,this.executeMoveWord.bind(this)],[189,this.executePopMatrix.bind(this)],[190,this.executeCullDL.bind(this)],[191,this.executeTri1.bind(this)],[192,this.executeNoop.bind(this)]])}getHandler(J){const q=this.gbi1Commands.get(J);if(q)return q;return super.getHandler(J)}executeDL(J,q,Q){const Z=J>>>16&255,X=this.state.rdpSegmentAddress(q);if(Q){const Y=Z===fJ?"gsSPDisplayList":"gsSPBranchList";Q.text(`${Y}(<span class="dl-branch">${N(X)}</span>);`)}if(Z===fJ)this.state.pushDisplayList(X);else this.state.branchDisplayList(X)}executeEndDL(J,q,Q){if(Q)Q.text("gsSPEndDisplayList();");this.state.endDisplayList()}executeBranchZ(J,q,Q){const Z=this.state.rdpSegmentAddress(this.state.rdpHalf1Cmd1);if(this.warnUnimplemented("BranchLessZ"),Q)Q.text("gsSPBranchLessZ(/* TODO */);");this.state.branchDisplayList(Z)}executeClearGeometryMode(J,q,Q){if(Q)Q.text(`gsSPClearGeometryMode(${cJ(C6,q)});`);this.state.geometryModeBits&=~q,this.state.updateGeometryModeFromBits(C6)}executeSetGeometryMode(J,q,Q){if(Q)Q.text(`gsSPSetGeometryMode(${cJ(C6,q)});`);this.state.geometryModeBits|=q,this.state.updateGeometryModeFromBits(C6)}executeSetOtherModeL(J,q,Q){const Z=J>>>8&255,X=J>>>0&255,Y=q,z=(1<<X)-1<<Z>>>0;if(Q)SQ(Q,z,Y);this.state.rdpOtherModeL=this.state.rdpOtherModeL&~z|Y}executeSetOtherModeH(J,q,Q){const Z=J>>>8&255,X=J>>>0&255,Y=q,z=(1<<X)-1<<Z>>>0;if(Q)vQ(Q,z,X,Z,Y);this.state.rdpOtherModeH=this.state.rdpOtherModeH&~z|Y}executeTexture(J,q,Q){const Z=J>>>16&255,X=J>>>11&3,Y=J>>>8&7,z=J>>>0&255,K=this.calcTextureScale(q>>>16&65535),W=this.calcTextureScale(q>>>0&65535);if(Q){const G=K.toString(),H=W.toString(),j=p0(Y),L=z?"G_ON":"G_OFF";if(Z!==0)Q.text(`gsSPTextureL(${G}, ${H}, ${X}, ${Z}, ${j}, ${L});`);else Q.text(`gsSPTexture(${G}, ${H}, ${X}, ${j}, ${L});`)}if(this.state.setTexture(K,W,X,Y),z)this.state.geometryModeBits|=C6.G_TEXTURE_ENABLE;else this.state.geometryModeBits&=~C6.G_TEXTURE_ENABLE;this.state.updateGeometryModeFromBits(C6)}executeMatrix(J,q,Q){const Z=J>>>16&255,X=J>>>0&65535,Y=this.state.rdpSegmentAddress(q);let z=this.loadMatrix(Y,X);if(Q){let W="";W+=Z&VQ?"G_MTX_PROJECTION":"G_MTX_MODELVIEW",W+=Z&Y7?"|G_MTX_LOAD":"|G_MTX_MUL",W+=Z&z7?"|G_MTX_PUSH":"",Q.text(`gsSPMatrix(${N(Y)}, ${W});`),Q.tip(this.previewMatrix(z))}const K=Z&VQ?this.state.projection:this.state.modelview;if((Z&Y7)==0)z=K[K.length-1].multiply(z);if(Z&z7)K.push(z);else K[K.length-1]=z}executePopMatrix(J,q,Q){const Z=q>>>0&255;if(Q){let X="";X+=Z&VQ?"G_MTX_PROJECTION":"G_MTX_MODELVIEW",Q.text(`gsSPPopMatrix(${X});`)}if(this.state.modelview.length>0)this.state.modelview.pop()}executeVertex(J,q,Q){const Z=(J>>>16&255)/this.vertexStride,X=J>>>10&63,Y=this.state.rdpSegmentAddress(q);if(Q)Q.text(`gsSPVertex(${N(Y)}, ${Z}, ${X});`);this.loadVertices(Z,X,Y,Q)}executeModifyVertex(J,q,Q){if(this.warnUnimplemented("ModifyVertex"),Q)Q.text("gsSPModifyVertex(???);")}executeSprite2DBase(J,q,Q){if(this.warnUnimplemented("Sprite2DBase"),Q)Q.text("gsSPSprite2DBase(/* TODO */);")}executeMoveMem(J,q,Q){const Z=J>>>16&255,X=J>>>0&65535,Y=this.state.rdpSegmentAddress(q);if(Q){const z=N(Y),K=h0.nameOf(Z);let W=`gsDma1p(G_MOVEMEM, ${z}, ${X}, ${K});`;switch(Z){case h0.G_MV_VIEWPORT:if(X===16)W=`gsSPViewport(${z});`;break}Q.text(W),this.previewMoveMem(Z,X,Y,Q)}switch(Z){case h0.G_MV_VIEWPORT:this.loadViewport(Y);break;case h0.G_MV_L0:case h0.G_MV_L1:case h0.G_MV_L2:case h0.G_MV_L3:case h0.G_MV_L4:case h0.G_MV_L5:case h0.G_MV_L6:case h0.G_MV_L7:{const z=(Z-h0.G_MV_L0)/2;this.loadLight(z,Y)}break}}previewMoveMem(J,q,Q,Z){let X="";for(let Y=0;Y<q;++Y)X+=v(this.ramDV.getUint8(Q+Y),8)+" ";switch(X+="<br>",J){case h0.G_MV_VIEWPORT:X+=this.previewViewport(Q);break;case h0.G_MV_L0:case h0.G_MV_L1:case h0.G_MV_L2:case h0.G_MV_L3:case h0.G_MV_L4:case h0.G_MV_L5:case h0.G_MV_L6:case h0.G_MV_L7:X+=this.previewLight(Q);break}Z.tip(X)}executeMoveWord(J,q,Q){const Z=J&255,X=J>>>8&65535,Y=q;let z="";switch(Z){case A0.G_MW_MATRIX:this.warnUnimplemented("MoveWord Matrix");break;case A0.G_MW_NUMLIGHT:{let K=(Y-2147483648>>>5)-1;if(Q){if(X===AW)z=`gsSPNumLights(${BQ.nameOf(K)});`}this.state.numLights=K}break;case A0.G_MW_CLIP:if(Q)z=`gSPClipRatio(${UQ.nameOf(X)}, ${IQ.nameOf(Y)});`;break;case A0.G_MW_SEGMENT:{const K=X>>>2&15;if(Q)z=`gsSPSegment(${wQ.nameOf(K)}, ${N(Y)});`;this.state.segments[K]=Y}break;case A0.G_MW_FOG:{const K=q>>16,W=q&65535;if(Q)z=`gSPFogPosition(${K}, ${W});`;this.state.fogParameters.set(K,W)}break;case A0.G_MW_LIGHTCOL:this.warnUnimplemented("MoveWord LightCol");break;case A0.G_MW_POINTS:this.warnUnimplemented("MoveWord Points");break;case A0.G_MW_PERSPNORM:if(Q)z=`gSPPerspNormalize(${Y});`;break;default:this.warnUnimplemented("MoveWord Unknown");break}if(Q){if(!z)z=`gMoveWd(${A0.nameOf(Z)}, ${Q0(X)}, ${N(Y)});`;Q.text(z)}}executeTri1(J,q,Q){const Z=this.vertexStride,X=this.state.projectedVertices,Y=this.triangleBuffer;Y.reset();let z=Q?1:0,K=this.state.executeBatch(z,(W,G)=>{const H=G>>>24&255,j=(G>>>16&255)/Z,L=(G>>>8&255)/Z,V=(G>>>0&255)/Z;if(Q)Q.text(`gsSP1Triangle(${j}, ${L}, ${V}, ${H});`);return Y.pushTri(X[j],X[L],X[V]),Y.hasCapacity(1)});this.debugController.currentOp+=K-1,this.renderer.flushTris(Y)}executeTri2(J,q,Q){const Z=this.vertexStride,X=this.state.projectedVertices,Y=this.triangleBuffer;Y.reset();let z=Q?1:0,K=this.state.executeBatch(z,(W,G)=>{const H=(W>>>16&255)/Z,j=(W>>>8&255)/Z,L=(W>>>0&255)/Z,V=(G>>>16&255)/Z,U=(G>>>8&255)/Z,M=(G>>>0&255)/Z;if(Q)Q.text(`gsSP1Triangle2(${H},${j},${L}, ${V},${U},${M});`);return Y.pushTri(X[H],X[j],X[L]),Y.pushTri(X[V],X[U],X[M]),Y.hasCapacity(2)});this.debugController.currentOp+=K-1,this.renderer.flushTris(Y)}executeLine3D(J,q,Q){const Z=this.vertexStride,X=this.state.projectedVertices,Y=this.triangleBuffer;Y.reset();let z=Q?1:0,K=this.state.executeBatch(z,(W,G)=>{const H=(G>>>24&255)/Z,j=(G>>>16&255)/Z,L=(G>>>8&255)/Z,V=(G>>>0&255)/Z;if(Q)Q.text(`gsSPLine3D(${j}, ${L}, ${V}, ${H});`);if(j<X.length&&L<X.length&&V<X.length)Y.pushTri(X[j],X[L],X[V]);else if(!tQ)console.log(`verts out of bounds, ignoring: ${j}, ${L}, ${V} vs ${X.length}, stride ${Z}`),tQ=!0;if(V<X.length&&H<X.length&&j<X.length)Y.pushTri(X[V],X[H],X[j]);else if(!tQ)console.log(`verts out of bounds, ignoring: ${V}, ${H}, ${j} vs ${X.length}, stride ${Z}`),tQ=!0;return Y.hasCapacity(2)});this.debugController.currentOp+=K-1,this.renderer.flushTris(Y)}}class O7 extends R8{constructor(J,q){super(J,q);this.vertexStride=2}}class c6 extends R8{constructor(J,q){super(J,q);this.vertexStride=10,this.rdpCommandBuffer=new ArrayBuffer(0,{maxByteLength:16384}),this.rdpCommandDV=new DataView(this.rdpCommandBuffer),this.rdpTriangle=new J9,this.gbi0Commands=new Map([[176,this.executeUnknown.bind(this)],[177,this.executeTri4.bind(this)],[178,this.executeRDPHalf_Cont.bind(this)]])}getHandler(J){const q=this.gbi0Commands.get(J);if(q)return q;return super.getHandler(J)}executeCullDL(J,q,Q){const Z=(J&16777215)/40&15,X=q/40&15,Y=this.testClipFlags(Z,X);if(Q)Q.text(`gSPCullDisplayList(${Z}, ${X}); // ${Y?"continue":"end"}`);if(!Y)this.state.endDisplayList()}executeVertex(J,q,Q){const Z=(J>>>20&15)+1,X=J>>>16&15,Y=this.state.rdpSegmentAddress(q);if(Q)Q.text(`gsSPVertex(${N(Y)}, ${X}, ${Z});`);this.loadVertices(X,Z,Y,Q)}executeRDPHalf_Cont(J,q,Q){if(this.warnUnimplemented("RDPHalf_Cont"),Q)Q.text("gsDPHalf_Cont(/* TODO */);")}pushRDPCommandU32(J){const q=this.rdpCommandBuffer.byteLength;this.rdpCommandBuffer.resize(q+4),this.rdpCommandDV.setUint32(q,J,!1)}executeRDPCommandHalf1(J,q,Q){if(Q)Q.text(`gsSPRDPCommandHalf1(${N(q)});`);this.pushRDPCommandU32(q)}executeRDPCommandHalf2(J,q,Q){if(Q)Q.text(`gsSPRDPCommandHalf2(${N(q)});`);this.pushRDPCommandU32(q)}executeRDPCommandHalf22Final(J,q,Q){if(this.warnUnimplemented("executeRDPCommandHalf22Final"),Q)Q.text(`gsSPRDPCommandHalf2Final(${N(q)});`);this.pushRDPCommandU32(q);const Z=new QJ(this.rdpCommandDV,0,this.rdpCommandDV.byteLength);this.rdpTriangle.load(Z);const X=this.rdpTriangle,Y=X.tile,z=X.yh,K=X.ym,W=X.interpolateX(X.yh),G=X.interpolateX(X.ym),H=Math.min(W[0],G[0]),j=Math.max(W[1],G[1]),L=this.renderer.calculateRectVertices(H,z/4,j,K/4),V=X.calculateRectUVs(),U=[4294967295,4294967295,4294967295,4294967295];if(this.renderer.lleRect(Y,L,V,U),Q){let M=`lleRect(${Y}, [${L}], [${V}], [${U}])`;const k=h7(Z);if(k)M+=k.disassembly;Q.tip(M)}this.rdpCommandBuffer.resize(0)}executeTri4(J,q,Q){const Z=this.state.projectedVertices,X=this.triangleBuffer;X.reset();let Y=Q?1:0,z=this.state.executeBatch(Y,(K,W)=>{const G=K>>>12&15,H=K>>>8&15,j=K>>>4&15,L=K>>>0&15,V=W>>>28&15,U=W>>>24&15,M=W>>>20&15,k=W>>>16&15,O=W>>>12&15,R=W>>>8&15,S=W>>>4&15,T=W>>>0&15;if(Q)Q.text(`gsSP1Triangle4(${L},${T},${S}, ${j},${R},${O}, ${H},${k},${M}, ${G},${U},${V});`);if(L!==T)X.pushTri(Z[L],Z[T],Z[S]);if(j!==R)X.pushTri(Z[j],Z[R],Z[O]);if(H!==k)X.pushTri(Z[H],Z[k],Z[M]);if(G!==U)X.pushTri(Z[G],Z[U],Z[V]);return X.hasCapacity(4)});this.debugController.currentOp+=z-1,this.renderer.flushTris(X)}}class I7 extends c6{constructor(J,q){super(J,q);this.vertexStride=10,this.geCommands=new Map([[178,this.executeRDPCommandHalf2.bind(this)],[179,this.executeRDPCommandHalf22Final.bind(this)],[180,this.executeRDPCommandHalf1.bind(this)]])}getHandler(J){const q=this.geCommands.get(J);if(q)return q;return super.getHandler(J)}}class w7 extends c6{constructor(J,q){super(J,q);this.vertexStride=10,this.auxAddress=0,this.pdCommands=new Map([[7,this.executeSetVertexColorIndex.bind(this)],[178,this.executeRDPCommandHalf2.bind(this)],[179,this.executeRDPCommandHalf22Final.bind(this)],[180,this.executeRDPCommandHalf1.bind(this)]])}getHandler(J){const q=this.pdCommands.get(J);if(q)return q;return super.getHandler(J)}executeSetVertexColorIndex(J,q,Q){const Z=this.state.rdpSegmentAddress(q);if(Q)Q.text(`gsSPSetVertexColorIndex(${N(Z)});`);this.auxAddress=Z}loadVertices(J,q,Q,Z){const X=this.state.geometryMode.lighting,Y=this.state.geometryMode.textureGen,z=this.state.geometryMode.textureGenLinear,K=new DataView(this.ramDV.buffer,Q),W=new DataView(this.ramDV.buffer,this.auxAddress);if(Z)this.previewVertex(J,q,K,Z,X);if(J+q>=this.state.projectedVertices.length){this.warn("Too many verts");return}const G=12,H=this.state.modelview[this.state.modelview.length-1],L=this.state.projection[this.state.projection.length-1].multiply(H),V=this.state.texture.scaleS/32,U=this.state.texture.scaleT/32,M=new k0,k=new k0,O=new k0,R=this.renderer.nativeTransform.viTransform,S=this.state.viewport.transform;for(let T=0;T<q;++T){const b=T*G,m=this.state.projectedVertices[J+T];m.set=!0,M.x=K.getInt16(b+0),M.y=K.getInt16(b+2),M.z=K.getInt16(b+4);const l=K.getUint8(b+7);if(m.u=K.getInt16(b+8)*V,m.v=K.getInt16(b+10)*U,m.color=W.getUint32(l+0,!0),this.projectInPlace(m,M,L,S,R),X){const U0=m.color&255;if(this.unpackNormal(k,m.color),H.transformNormal(k,O),O.normaliseInPlace(),m.color=this.calculateLighting(O,U0),z)m.calculateLinearUV(O);else if(Y)m.calculateSphericalUV(O)}}}}class B7 extends c6{constructor(J,q){super(J,q);this.vertexStride=5}executeVertex(J,q,Q){const Z=J>>>9&127,X=(J>>>16&255)/5,Y=this.state.rdpSegmentAddress(q);if(Q)Q.text(`gsSPVertex(${N(Y)}, ${X}, ${Z});`);this.loadVertices(X,Z,Y,Q)}}class A7 extends c6{constructor(J,q){super(J,q);this.vertexStride=5}executeVertex(J,q,Q){const Z=(J>>>4&4095)/33+1,Y=this.state.rdpSegmentAddress(q);if(Q)Q.text(`gsSPVertex(${N(Y)}, 0, ${Z});`);this.loadVertices(0,Z,Y,Q)}}class C7 extends c6{constructor(J,q){super(J,q);this.vertexStride=10,this.matrixAddress=0,this.matrixIndex=0,this.matrixArray=[s0.identity(),s0.identity(),s0.identity(),s0.identity()],this.vertexAddress=0,this.vertexOffset=0,this.billboardMode=!1,this.dkrCommands=new Map([[5,this.executeTriDMA.bind(this)],[7,this.executeDisplayListLen.bind(this)],[191,this.executeSetAddresses.bind(this)]])}getHandler(J){const q=this.dkrCommands.get(J);if(q)return q;return super.getHandler(J)}executeDisplayListLen(J,q,Q){const Z=J>>>16&255,X=this.state.rdpSegmentAddress(q);if(Q)Q.text(`gsSPDisplayListLen(<span class="dl-branch">${N(X)}</span>, ${Z});`);this.state.pushDisplayList(X,Z)}executeSetAddresses(J,q,Q){if(this.matrixAddress=this.state.rdpSegmentAddress(J),this.vertexAddress=this.state.rdpSegmentAddress(q),this.vertexOffset=0,Q)Q.text(`gsSPSetAddress(${N(this.matrixAddress)}, ${N(this.vertexAddress)};`)}executeMoveWord(J,q,Q){const Z=J&255;if(Z==2){if(this.billboardMode=(q&1)!=0,Q)Q.text(`gSetBillboardMode(${this.billboardMode});`)}else if(Z==10){if(this.matrixIndex=q>>6&3,Q)Q.text(`gSetMatrixIndex(${this.matrixIndex});`)}else super.executeMoveWord(J,q,Q)}executeTexture(J,q,Q){const Z=J>>>16&255,X=J>>>11&3,Y=J>>>8&7,K=this.calcTextureScale(q>>>16&65535),W=this.calcTextureScale(q>>>0&65535);if(Q){const G=K.toString(),H=W.toString(),j=p0(Y);if(Z!==0)Q.text(`gsSPTextureL(${G}, ${H}, ${X}, ${Z}, ${j}, G_ON);`);else Q.text(`gsSPTexture(${G}, ${H}, ${X}, ${j}, G_ON);`)}this.state.setTexture(K,W,X,Y),this.state.geometryModeBits|=C6.G_TEXTURE_ENABLE,this.state.updateGeometryModeFromBits(C6)}executeMatrix(J,q,Q){const Z=this.matrixAddress+q,X=J>>22&3,Y=J&65535,z=this.loadMatrix(Z,Y);if(Q)Q.text(`gsSPMatrix(${N(Z)}, ${X});`),Q.tip(this.previewMatrix(z));this.matrixArray[X]=z,this.matrixIndex=X}executeVertex(J,q,Q){const Z=this.vertexAddress+q,X=(J>>>19&31)+1,Y=J&65536,z=J>>>9&31;if(this.billboardMode)this.vertexOffset=Y?1:0;else if(!Y)this.vertexOffset=0;const K=this.vertexOffset+z;if(Q)Q.text(`gsSPVertex(${N(Z)}, ${K}, ${X});`);this.loadVertices(K,X,Z,Q),this.vertexOffset+=X}loadVertices(J,q,Q,Z){if(J+q>=this.state.projectedVertices.length){this.warn("Too many verts");return}const X=10,Y=new DataView(this.ramDV.buffer,Q);let z=this.matrixArray[this.matrixIndex];const K=this.renderer.nativeTransform.viTransform,W=this.state.viewport.transform,G=new k0;if(this.billboardMode){z=z.copy();const j=this.state.projectedVertices[0].pos;z.elems[3]+=j.x,z.elems[7]+=j.y,z.elems[11]+=j.z,z.elems[15]+=j.w}let H="";if(Z){const j=["#","x","y","z","rgba"];H+='<table class="vertex-table">',H+=`<tr><th>${j.join("</th><th>")}</th></tr>\n`}for(let j=0,L=0;j<q;j++,L+=X){const V=this.state.projectedVertices[J+j];if(V.set=!0,G.x=Y.getInt16(L+0),G.y=Y.getInt16(L+2),G.z=Y.getInt16(L+4),V.color=Y.getUint32(L+6,!0),this.projectInPlace(V,G,z,W,K),Z){const U=[J+j,G.x,G.y,G.z,xQ(Y.getUint32(L+6,!0))];H+=`<tr><td>${U.join("</td><td>")}</td></tr>\n`}}if(Z)H+="</table>",Z.tip(H)}executeTriDMA(J,q,Q){const Z=J>>>4&31,X=this.state.rdpSegmentAddress(q),Y=new DataView(this.ramDV.buffer,X),z=this.state.projectedVertices,K=this.triangleBuffer;if(K.reset(),Q)Q.text(`gsSPTriDMA(${N(X)}, ${Z});`);let W="";if(Z>K.maxTris)this.warn(`Too many triangles for buffer: ${Z} > ${K.maxTris}`);const G=16;for(let H=0;H<Z&&K.hasCapacity(1);++H){const j=H*G,L=Y.getUint8(j+0),V=Y.getUint8(j+1),U=Y.getUint8(j+2),M=Y.getUint8(j+3),k=Y.getInt16(j+4)/32,O=Y.getInt16(j+6)/32,R=Y.getInt16(j+8)/32,S=Y.getInt16(j+10)/32,T=Y.getInt16(j+12)/32,b=Y.getInt16(j+14)/32;if(K.pushTriWithUV(z[V],z[U],z[M],k,O,R,S,T,b),Q)W+=`${H}: ${L}, v${V} (${k}, ${O}), v${U} (${R}, ${S}), v${M} (${T}, ${b})\n`}if(this.renderer.flushTris(K),this.vertexOffset=0,Q)Q.tip(W)}}class iJ extends Q9{constructor(J,q){super(J,q);this.vertexStride=2,this.gbi2Commands=new Map([[0,this.executeNoop.bind(this)],[1,this.executeVertex.bind(this)],[2,this.executeModifyVtx.bind(this)],[3,this.executeCullDL.bind(this)],[4,this.executeBranchZ.bind(this)],[5,this.executeTri1.bind(this)],[6,this.executeTri2.bind(this)],[7,this.executeQuad.bind(this)],[8,this.executeLine3D.bind(this)],[9,this.executeBgRect1Cyc.bind(this)],[10,this.executeBgRectCopy.bind(this)],[11,this.executeObjRenderMode.bind(this)],[214,this.executeDmaIo.bind(this)],[215,this.executeTexture.bind(this)],[216,this.executePopMatrix.bind(this)],[217,this.executeGeometryMode.bind(this)],[218,this.executeMatrix.bind(this)],[219,this.executeMoveWord.bind(this)],[220,this.executeMoveMem.bind(this)],[221,this.executeLoadUcode.bind(this)],[222,this.executeDL.bind(this)],[223,this.executeEndDL.bind(this)],[224,this.executeSpNoop.bind(this)],[225,this.executeRDPHalf1.bind(this)],[226,this.executeSetOtherModeL.bind(this)],[227,this.executeSetOtherModeH.bind(this)],[241,this.executeRDPHalf2.bind(this)]])}getHandler(J){const q=this.gbi2Commands.get(J);if(q)return q;return super.getHandler(J)}executeDL(J,q,Q){const Z=J>>>16&255,X=this.state.rdpSegmentAddress(q);if(Q){const Y=Z===fJ?"gsSPDisplayList":"gsSPBranchList";Q.text(`${Y}(<span class="dl-branch">${N(X)}</span>);`)}if(Z===fJ)this.state.pushDisplayList(X);else this.state.branchDisplayList(X)}executeEndDL(J,q,Q){if(Q)Q.text("gsSPEndDisplayList();");this.state.endDisplayList()}executeSetOtherModeL(J,q,Q){const Z=J>>>8&255,X=J>>>0&255,Y=q,z=2147483648>>X>>>Z;if(Q)SQ(Q,z,Y);this.state.rdpOtherModeL=this.state.rdpOtherModeL&~z|Y}executeSetOtherModeH(J,q,Q){const Z=J>>>8&255,X=J>>>0&255,Y=q,z=2147483648>>X>>>Z;if(Q)vQ(Q,z,X,Z,Y);this.state.rdpOtherModeH=this.state.rdpOtherModeH&~z|Y}executeMatrix(J,q,Q){const Z=this.state.rdpSegmentAddress(q),X=(J&1)===0,Y=J>>>1&1,z=J>>>2&1;let K=this.loadMatrix(Z,64);if(Q){let G="";G+=z?"G_MTX_PROJECTION":"G_MTX_MODELVIEW",G+=Y?"|G_MTX_LOAD":"|G_MTX_MUL",G+=X?"|G_MTX_PUSH":"",Q.text(`gsSPMatrix(${N(Z)}, ${G});`),Q.tip(this.previewMatrix(K))}const W=z?this.state.projection:this.state.modelview;if(!Y)K=W[W.length-1].multiply(K);if(X)W.push(K);else W[W.length-1]=K}executeVertex(J,q,Q){const Z=(J&255)>>1,X=J>>>12&255,Y=Z-X,z=this.state.rdpSegmentAddress(q);if(Q)Q.text(`gsSPVertex(${N(z)}, ${Y}, ${X});`);this.loadVertices(Y,X,z,Q)}executeBranchZ(J,q,Q){if(this.warnUnimplemented("BranchZ"),Q)Q.text("gsSPBranchZ(/* TODO */);")}executeLine3D(J,q,Q){if(this.warnUnimplemented("Line3D"),Q)Q.text("gsSPLine3D(/* TODO */);")}executeBgRect1Cyc(J,q,Q){if(this.warnUnimplemented("BgRect1Cyc"),Q)Q.text("gsSPBgRect1Cyc(/* TODO */);")}executeBgRectCopy(J,q,Q){if(this.warnUnimplemented("BgRectCopy"),Q)Q.text("gsSPBgRectCopy(/* TODO */);")}executeObjRenderMode(J,q,Q){if(this.warnUnimplemented("ObjRenderMode"),Q)Q.text("gsSPObjRenderMode(/* TODO */);")}executeDmaIo(J,q,Q){if(Q)Q.text("DmaIo(/* TODO */);")}executeTri1(J,q,Q){const Z=this.state.projectedVertices,X=this.triangleBuffer;X.reset();let Y=Q?1:0,z=this.state.executeBatch(Y,(K,W)=>{const G=K>>>1&127,H=K>>>9&127,j=K>>>17&127,L=W>>>24&255;if(Q)Q.text(`gsSP1Triangle(${G},${H},${j}, ${L});`);return X.pushTri(Z[G],Z[H],Z[j]),X.hasCapacity(1)});this.debugController.currentOp+=z-1,this.renderer.flushTris(X)}executeTri2(J,q,Q){const Z=this.state.projectedVertices,X=this.triangleBuffer;X.reset();let Y=Q?1:0,z=this.state.executeBatch(Y,(K,W)=>{const G=W>>>1&127,H=W>>>9&127,j=W>>>17&127,L=K>>>1&127,V=K>>>9&127,U=K>>>17&127;if(Q)Q.text(`gsSP2Triangles(${G},${H},${j}, ${L},${V},${U});`);return X.pushTri(Z[G],Z[H],Z[j]),X.pushTri(Z[L],Z[V],Z[U]),X.hasCapacity(2)});this.debugController.currentOp+=z-1,this.renderer.flushTris(X)}executeQuad(J,q,Q){const Z=this.state.projectedVertices,X=this.triangleBuffer;X.reset();let Y=Q?1:0,z=this.state.executeBatch(Y,(K,W)=>{const G=W>>>1&127,H=W>>>9&127,j=W>>>17&127,L=K>>>1&127,V=K>>>9&127,U=K>>>17&127;if(Q)Q.text(`gSP1Quadrangle(${G},${H},${j}, ${L},${V},${U});`);return X.pushTri(Z[G],Z[H],Z[j]),X.pushTri(Z[L],Z[V],Z[U]),X.hasCapacity(2)});this.debugController.currentOp+=z-1,this.renderer.flushTris(X)}executeModifyVtx(J,q,Q){const Z=J>>>1&32767,X=J>>>16&255,Y=q;if(Q)Q.text(`gsSPModifyVertex(${Z},${pJ.nameOf(X)},${N(Y)});`);if(Z>=this.state.projectedVertices.length){this.warn("crazy vertex index",Z);return}const z=this.state.projectedVertices[Z];switch(X){case pJ.G_MWO_POINT_RGBA:this.warnUnimplemented("modifyVtx RGBA");break;case pJ.G_MWO_POINT_ST:{const K=Y>>16,W=(Y&65535)<<16>>16;z.set=!0,z.u=K*this.state.texture.scaleS/32,z.v=W*this.state.texture.scaleT/32}break;case pJ.G_MWO_POINT_XYSCREEN:this.warnUnimplemented("modifyVtx XYSCREEN");break;case pJ.G_MWO_POINT_ZSCREEN:this.warnUnimplemented("modifyVtx ZSCREEN");break;default:this.warnUnimplemented("modifyVtx");break}}executeTexture(J,q,Q){const Z=J>>>16&255,X=J>>>11&3,Y=J>>>8&7,z=J>>>1&1,K=this.calcTextureScale(q>>>16&65535),W=this.calcTextureScale(q>>>0&65535);if(Q){const G=K.toString(),H=W.toString(),j=p0(Y);if(Z!==0)Q.text(`gsSPTextureL(${G}, ${H}, ${X}, ${Z}, ${j}, ${z});`);else Q.text(`gsSPTexture(${G}, ${H}, ${X}, ${j}, ${z});`)}if(this.state.setTexture(K,W,X,Y),z)this.state.geometryModeBits|=Q8.G_TEXTURE_ENABLE;else this.state.geometryModeBits&=~Q8.G_TEXTURE_ENABLE;this.state.updateGeometryModeFromBits(Q8)}executeGeometryMode(J,q,Q){const Z=J&16777215,X=q;if(Q){const Y=cJ(Q8,~Z),z=cJ(Q8,X);Q.text(`gsSPGeometryMode(~(${Y}),${z});`)}this.state.geometryModeBits&=Z|Q8.G_TEXTURE_ENABLE,this.state.geometryModeBits|=X&~Q8.G_TEXTURE_ENABLE,this.state.updateGeometryModeFromBits(Q8)}executePopMatrix(J,q,Q){if(Q)Q.text("gsSPPopMatrix(G_MTX_MODELVIEW);");const X=this.state.modelview;if(X.length>0)X.pop()}executeMoveWord(J,q,Q){const Z=J>>>16&255,X=J&65535,Y=q;let z="";switch(Z){case A0.G_MW_MATRIX:this.warnUnimplemented("MoveWord Matrix");break;case A0.G_MW_NUMLIGHT:{let K=Math.floor(Y/24);if(Q)z=`gsSPNumLights(${BQ.nameOf(K)});`;this.state.numLights=K}break;case A0.G_MW_CLIP:if(Q)z=`gSPClipRatio(${UQ.nameOf(X)}, ${IQ.nameOf(Y)});`;break;case A0.G_MW_SEGMENT:{const K=X>>>2&15;if(Q)z=`gsSPSegment(${wQ.nameOf(K)}, ${N(Y)});`;this.state.segments[K]=Y}break;case A0.G_MW_FOG:{const K=q>>16,W=q&65535;if(Q)z=`gSPFogPosition(${K}, ${W});`;this.state.fogParameters.set(K,W)}break;case A0.G_MW_LIGHTCOL:this.warnUnimplemented("MoveWord LightCol");break;case A0.G_MW_POINTS:this.warnUnimplemented("MoveWord Points");break;case A0.G_MW_PERSPNORM:if(Q)z=`gSPPerspNormalize(${Y});`;break;default:this.warnUnimplemented("MoveWord Unknown");break}if(Q){if(!z)z=`gMoveWd(${A0.nameOf(Z)}, ${Q0(X)}, ${N(Y)});`;Q.text(z)}}executeMoveMem(J,q,Q){const Z=this.state.rdpSegmentAddress(q),X=(J>>>16&255)<<1,Y=(J>>>8&255)<<3,z=J&254;let K;if(Q)K=`gsDma1p(G_MOVEMEM, ${N(Z)}, ${X}, ${Y}, ${j6.nameOf(z)});`;switch(z){case j6.G_GBI2_MV_VIEWPORT:if(Q)K=`gsSPViewport(${N(Z)});`;this.loadViewport(Z);break;case j6.G_GBI2_MV_LIGHT:if(Y==j6.G_GBI2_MVO_LOOKATX){if(Q)K=`gSPLookAtX(${N(Z)});`}else if(Y==j6.G_GBI2_MVO_LOOKATY){if(Q)K=`gSPLookAtY(${N(Z)});`}else if(Y>=j6.G_GBI2_MVO_L0&&Y<=j6.G_GBI2_MVO_L7){let W=(Y-j6.G_GBI2_MVO_L0)/24>>>0;if(Q)K=`gsSPLight(${N(Z)}, ${W})`;if(this.loadLight(W,Z),X!=16)console.log(`unexpected gsSPLight length ${X}. Is this setting multiple lights?`)}else if(Q)K+=` // (unknown offset ${Q0(Y)})`;break;case j6.G_GBI2_MV_POINT:this.warnUnimplemented("MoveMem G_GBI2_MV_POINT");break;case j6.G_GBI2_MV_MATRIX:this.warnUnimplemented("MoveMem G_GBI2_MV_MATRIX");break;default:this.warnUnimplemented(`MoveMem ${z.toString(16)}`)}if(Q)Q.text(K),this.previewMoveMem(z,X,Z,Q)}previewMoveMem(J,q,Q,Z){let X="";for(let Y=0;Y<q;Y+=4)X+=v(this.ramDV.getUint32(Q+Y),32)+" ";switch(X+="<br>",J){case j6.G_GBI2_MV_VIEWPORT:X+=this.previewViewport(Q);break;case j6.G_GBI2_MV_LIGHT:X+=this.previewLight(Q);break}Z.tip(X)}}class R7 extends iJ{constructor(J,q){super(J,q);this.vertexStride=2}}var y7=0,E7=1,T7=2,_7=3;class qF{constructor(){this.imageX=0,this.imageW=0,this.frameX=0,this.frameW=0,this.imageY=0,this.imageH=0,this.frameY=0,this.frameH=0,this.imagePtr=0,this.imageLoad=0,this.imageFmt=0,this.imageSiz=0,this.imagePal=0,this.imageFlip=0,this.scaleW=0,this.scaleH=0,this.imageYorig=0}load(J,q){this.imageX=J.getUint16(q+0,!1)/32,this.imageW=J.getUint16(q+2,!1)/4,this.frameX=J.getInt16(q+4,!1)/4,this.frameW=J.getUint16(q+6,!1)/4,this.imageY=J.getUint16(q+8,!1)/32,this.imageH=J.getUint16(q+10,!1)/4,this.frameY=J.getInt16(q+12,!1)/4,this.frameH=J.getUint16(q+14,!1)/4,this.imagePtr=J.getUint32(q+16,!1),this.imageLoad=J.getUint16(q+20,!1),this.imageFmt=J.getUint8(q+22,!1),this.imageSiz=J.getUint8(q+23,!1),this.imagePal=J.getUint16(q+24,!1),this.imageFlip=J.getUint16(q+26,!1),this.scaleW=J.getUint16(q+28,!1)/1024,this.scaleH=J.getUint16(q+30,!1)/1024,this.imageYorig=J.getInt32(q+32,!1)/32}toString(){return`imageX/Y = (${this.imageX}, ${this.imageY}), imageW/H = (${this.imageW}, ${this.imageH})
frameX/Y = (${this.frameX}, ${this.frameY}), frameW/H = (${this.frameW}, ${this.frameH})
imagePtr = ${N(this.imagePtr)}, imageLoad = ${this.imageLoad}
imageFmt = ${N0.nameOf(this.imageFmt)}, imageSiz = ${n.nameOf(this.imageSiz)}
imagePal = ${this.imagePal}, imageFlip = ${this.imageFlip}
scaleW/H = (${this.scaleW}, ${this.scaleH})`}}class QF{constructor(){this.a=1,this.b=0,this.c=0,this.d=1,this.x=0,this.y=0,this.sx=1,this.sy=1}loadFullMatrix(J,q){this.a=J.getInt32(q+0,!1)/65536,this.b=J.getInt32(q+4,!1)/65536,this.c=J.getInt32(q+8,!1)/65536,this.d=J.getInt32(q+12,!1)/65536,this.loadSubMatrix(J,q+16)}loadSubMatrix(J,q){this.x=J.getInt16(q+0,!1)/4,this.y=J.getInt16(q+2,!1)/4,this.sx=J.getUint16(q+4,!1)/1024,this.sy=J.getUint16(q+6,!1)/1024}toString(){return`rot = (${this.a}, ${this.b}, ${this.c}, ${this.d}), trans = (${this.x}, ${this.y}), scale = (${this.sx}, ${this.sy})`}}class ZF{constructor(){this.objX=0,this.scaleW=0,this.imageW=0,this.objY=0,this.scaleH=0,this.imageH=0,this.imageStride=0,this.imageAdrs=0,this.imageFmt=0,this.imageSiz=0,this.imagePal=0,this.imageFlags=0}load(J,q){this.objX=J.getInt16(q+0,!1)/4,this.scaleW=J.getUint16(q+2,!1)/1024,this.imageW=J.getUint16(q+4,!1)/32,this.objY=J.getInt16(q+8,!1)/4,this.scaleH=J.getUint16(q+10,!1)/1024,this.imageH=J.getUint16(q+12,!1)/32,this.imageStride=J.getUint16(q+16,!1),this.imageAdrs=J.getUint16(q+18,!1),this.imageFmt=J.getUint8(q+20,!1),this.imageSiz=J.getUint8(q+21,!1),this.imagePal=J.getUint8(q+22,!1),this.imageFlags=J.getUint8(q+23,!1)}get objW(){return this.imageW/this.scaleW}get objH(){return this.imageH/this.scaleH}toString(){return`pos = (${this.objX}, ${this.objY}), scale = (${this.scaleW}, ${this.scaleH}), image = (${this.imageW}, ${this.imageH})
stride = ${this.imageStride}, address = ${Q0(this.imageAdrs)}, format = ${N0.nameOf(this.imageFmt)}, size = ${n.nameOf(this.imageSiz)}
paletteIdx = ${this.imagePal}, flags = ${this.imageFlags}`}}var yN=48;var EN=51,TN=52;class XF{constructor(){this.type=0,this.image=0,this.tileTMEM=0,this.texLoadSize=0,this.texLoadRows=0,this.sid=0,this.flag=0,this.mask=0}load(J,q){this.type=J.getUint32(q+0,!1),this.image=J.getUint32(q+4,!1),this.tileTMEM=J.getUint16(q+8,!1),this.texLoadSize=J.getUint16(q+10,!1),this.texLoadRows=J.getUint16(q+12,!1),this.sid=J.getUint16(q+14,!1),this.flag=J.getUint32(q+16,!1),this.mask=J.getUint32(q+20,!1)}toString(){let J=`type = ${N(this.type)}, image = ${N(this.image)}\n`;return J+=`tmem = ${Q0(this.tileTMEM)}, size (qwords) = ${Q0(this.texLoadSize)}, rows (texels) = ${this.texLoadRows}`,J}}class b7{constructor(J,q,Q){this.state=J,this.ramDV=q,this.gbi=Q,this.scaleBg=new qF,this.matrix=new QF,this.sprite=new ZF,this.texture=new XF}executeBg1cyc(J,q,Q){const Z=this.state.rdpSegmentAddress(q);if(this.scaleBg.load(this.ramDV,Z),this.gbi.warnUnimplemented("gSPBgRect1Cyc"),Q)Q.text(`gSPBgRect1Cyc(${N(Z)});`),Q.tip(this.scaleBg.toString())}executeBgCopy(J,q,Q){if(this.gbi.warnUnimplemented("gSPBgRectCopy"),Q)Q.text("gSPBgRectCopy(/* TODO */);")}executeObjRectangle(J,q,Q){this.execLoadTxRenderObj("gSPObjRectangle",!1,_7,q,Q)}executeObjRectangleR(J,q,Q){this.execLoadTxRenderObj("gSPObjRectangleR",!1,T7,q,Q)}executeObjSprite(J,q,Q){this.execLoadTxRenderObj("gSPObjSprite",!1,E7,q,Q)}executeObjLoadTxRect(J,q,Q){this.execLoadTxRenderObj("gSPObjLoadTxRect",!0,_7,q,Q)}executeObjLoadTxRectR(J,q,Q){this.execLoadTxRenderObj("gSPObjLoadTxRectR",!0,T7,q,Q)}executeObjLoadTxSprite(J,q,Q){this.execLoadTxRenderObj("gSPObjLoadTxSprite",!0,E7,q,Q)}executeObjLoadTxtr(J,q,Q){this.execLoadTxRenderObj("gSPObjLoadTxtr",!0,y7,q,Q)}execLoadTxRenderObj(J,q,Q,Z,X){const Y=this.state.rdpSegmentAddress(Z);let z=Y;if(q)this.texture.load(this.ramDV,z),this.loadTexture(),z+=24;if(Q!=y7)this.sprite.load(this.ramDV,z),this.renderSprite(Q),z+=24;let K="";if(X){if(X.text(`${J}(${N(Y)});`),q)K+=this.texture.toString()+"\n";if(Q!=y7)K+=this.sprite.toString()+"\n";X.tip(K)}}executeObjMoveMem(J,q,Q){const Z=this.state.rdpSegmentAddress(q),X=J&65535;switch(X){case 0:if(Q)Q.text(`gSPObjMatrix(${N(Z)});`);this.setObjMatrix(Z,Q);break;case 2:if(Q)Q.text(`gSPObjSubMatrix(${N(Z)});`);this.setObjSubMatrix(Z,Q);break;default:if(Q)Q.text(`gSPObjMoveMem(${X}, ${N(Z)});`)}}setObjMatrix(J,q){if(this.matrix.loadFullMatrix(this.ramDV,J),q)q.tip(this.matrix.toString())}setObjSubMatrix(J,q){if(this.matrix.loadSubMatrix(this.ramDV,J),q)q.tip(this.matrix.toString())}executeSelectDL(J,q,Q){if(this.gbi.warnUnimplemented("gSPSelectDL"),Q)Q.text("gSPSelectDL(/* TODO */);")}executeObjRendermode(J,q,Q){if(Q)Q.text("gSPObjRenderMode(/* ignored */);")}executeTriRSP(J,q,Q){if(this.gbi.warnUnimplemented("executeTriRSP"),Q)Q.text("executeTriRSP(); // ignored")}loadTexture(){const J=this.texture,q=this.state.tiles[K7],Q=this.state.rdpSegmentAddress(J.image),Z=this.state.textureImage;Z.set(N0.G_IM_FMT_RGBA,n.G_IM_SIZ_16b,J.texLoadSize+1,Q);const X=J.type>>>8&255,Y=X>>>5&7,z=X>>>3&3,K=J.type<<8>>24,W=(J.texLoadSize+1&K)>>>2,G=0;q.set(Y,z,W,J.tileTMEM,G,0,0,0,0,0,0);const H=2,j=J.texLoadSize<<H;switch(J.type>>>0&255){case EN:this.state.tmem.loadBlock(Z,q,0,0,j,J.texLoadRows);break;case TN:this.state.tmem.loadTile(Z,q,0,0,j,J.texLoadRows);break;case yN:this.state.tmem.loadTLUT(Z,q,0,0,j,J.texLoadRows);break;default:this.gbi.warnUnimplemented(`load texture type ${J.type}`);break}this.state.invalidateTileHashes()}renderSprite(J){const q=this.sprite,Q=this.matrix,X=q.objX,Y=q.objY,z=q.objW+X,K=q.objH+Y,W=this.state.tiles[0];W.set(q.imageFmt,q.imageSiz,q.imageStride,q.imageAdrs,q.imagePal,D8,0,0,D8,0,0),W.setSize(0,0,q.imageW-1<<2,q.imageH-1<<2);const G=q.imageFlags&1,H=q.imageFlags&16;if(G||H)this.gbi.warnUnimplemented("swapX/Y");const j=0,L=0,V=q.imageW,U=q.imageH;if(J==E7){const M=Q.x+Q.a*X+Q.b*Y,k=Q.y+Q.c*X+Q.d*Y,O=Q.x+Q.a*z+Q.b*Y,R=Q.y+Q.c*z+Q.d*Y,S=Q.x+Q.a*X+Q.b*K,T=Q.y+Q.c*X+Q.d*K,b=Q.x+Q.a*z+Q.b*K,m=Q.y+Q.c*z+Q.d*K;this.gbi.renderer.texRectRot(0,M,k,O,R,S,T,b,m,j,L,V,U)}else if(J==T7){const M=Q.x+X/Q.sx,k=Q.y+Y/Q.sy,O=Q.x+z/Q.sx,R=Q.y+K/Q.sy;this.gbi.renderer.texRect(0,M,k,O,R,j,L,V,U,!1)}else if(J==_7){const M=X,k=z,O=Y,R=K;this.gbi.renderer.texRect(0,M,O,k,R,j,L,V,U,!1)}}}class S7 extends R8{constructor(J,q){super(J,q);this.vertexStride=2,this.s2dex=new b7(J,q,this),this.sdexCommands=new Map([[1,this.s2dex.executeBg1cyc.bind(this.s2dex)],[2,this.s2dex.executeBgCopy.bind(this.s2dex)],[3,this.s2dex.executeObjRectangle.bind(this.s2dex)],[4,this.s2dex.executeObjSprite.bind(this.s2dex)],[5,this.s2dex.executeObjMoveMem.bind(this.s2dex)],[176,this.s2dex.executeSelectDL.bind(this.s2dex)],[177,this.s2dex.executeObjRendermode.bind(this.s2dex)],[178,this.s2dex.executeObjRectangleR.bind(this.s2dex)],[193,this.s2dex.executeObjLoadTxtr.bind(this.s2dex)],[194,this.s2dex.executeObjLoadTxSprite.bind(this.s2dex)],[195,this.s2dex.executeObjLoadTxRect.bind(this.s2dex)],[196,this.s2dex.executeObjLoadTxRectR.bind(this.s2dex)],[200,this.s2dex.executeTriRSP.bind(this.s2dex)],[201,this.s2dex.executeTriRSP.bind(this.s2dex)],[202,this.s2dex.executeTriRSP.bind(this.s2dex)],[203,this.s2dex.executeTriRSP.bind(this.s2dex)],[204,this.s2dex.executeTriRSP.bind(this.s2dex)],[205,this.s2dex.executeTriRSP.bind(this.s2dex)],[206,this.s2dex.executeTriRSP.bind(this.s2dex)],[207,this.s2dex.executeTriRSP.bind(this.s2dex)],[228,this.executeRDPHalf0.bind(this.s2dex)]])}getHandler(J){const q=this.sdexCommands.get(J);if(q)return q;return super.getHandler(J)}executeRDPHalf0(J,q,Q){if(Q)Q.text(`gsImmp1(G_RDPHALF_0, ${N(J)}, ${N(q)});`);this.state.rdpHalf0Cmd0=J,this.state.rdpHalf0Cmd1=q}executeRDPHalf2(J,q,Q){if(Q)Q.text(`gsImmp1(G_RDPHALF_2, ${N(q)});`);this.rdpTexRect(this.state.rdpHalf0Cmd0,this.state.rdpHalf0Cmd1,this.state.rdpHalf1Cmd1,q,Q)}}class v7 extends iJ{constructor(J,q){super(J,q);this.vertexStride=2,this.s2dex=new b7(J,q,this),this.sdexCommands=new Map([[1,this.s2dex.executeObjRectangle.bind(this.s2dex)],[2,this.s2dex.executeObjSprite.bind(this.s2dex)],[4,this.s2dex.executeSelectDL.bind(this.s2dex)],[5,this.s2dex.executeObjLoadTxtr.bind(this.s2dex)],[6,this.s2dex.executeObjLoadTxSprite.bind(this.s2dex)],[7,this.s2dex.executeObjLoadTxRect.bind(this.s2dex)],[8,this.s2dex.executeObjLoadTxRectR.bind(this.s2dex)],[9,this.s2dex.executeBg1cyc.bind(this.s2dex)],[10,this.s2dex.executeBgCopy.bind(this.s2dex)],[11,this.s2dex.executeObjRendermode.bind(this.s2dex)],[200,this.s2dex.executeTriRSP.bind(this.s2dex)],[201,this.s2dex.executeTriRSP.bind(this.s2dex)],[202,this.s2dex.executeTriRSP.bind(this.s2dex)],[203,this.s2dex.executeTriRSP.bind(this.s2dex)],[204,this.s2dex.executeTriRSP.bind(this.s2dex)],[205,this.s2dex.executeTriRSP.bind(this.s2dex)],[206,this.s2dex.executeTriRSP.bind(this.s2dex)],[207,this.s2dex.executeTriRSP.bind(this.s2dex)],[213,this.executeDLCount.bind(this)],[218,this.s2dex.executeObjRectangleR.bind(this.s2dex)]])}getHandler(J){const q=this.sdexCommands.get(J);if(q)return q;return super.getHandler(J)}executeDLCount(J,q,Q){if(this.warnUnimplemented("executeDL_Count"),Q)Q.text("executeDL_Count(/* TODO */);")}executeMoveMem(J,q,Q){const Z=J&254;if(Z==0){const X=this.state.rdpSegmentAddress(q);if(Q)Q.text(`gSPObjMatrix(${N(X)});`);this.s2dex.setObjMatrix(X,Q);return}else if(Z==2){const X=this.state.rdpSegmentAddress(q);if(Q)Q.text(`gSPObjSubMatrix(${N(X)});`);this.s2dex.setObjSubMatrix(X,Q);return}super.executeMoveMem(J,q,Q)}}function VF(J,q,Q){const Z=J.detectVersionString(),X=m0.dumpMicrocodeSubstring;if(X!=""&&!YF&&Z.includes(X))J.dumpCode(),YF=!0;const Y=J.computeMicrocodeHash(),z=SN(Z,Y),K=bN(z,q,Q);return K.version=Z,K}var bN=function(J,q,Q){switch(J){case qZ:return new c6(q,Q);case eQ:return new C7(q,Q);case GF:return new A7(q,Q);case LF:return new w7(q,Q);case jF:return new I7(q,Q);case HF:return new B7(q,Q);case KF:return new R8(q,Q);case JZ:return new O7(q,Q);case FF:return new S7(q,Q);case WF:return new iJ(q,Q);case NF:return new R7(q,Q);case $F:return new v7(q,Q)}return h(`unhandled ucode during table init: ${J}`),new c6(q,Q)},SN=function(J,q){let Q=_N.get(q);if(Q===void 0)Q=xN(J);return vN(J,Q),Q},vN=function(J,q){if(zF.get(J))return;zF.set(J,!0),h(`New RSP graphics ucode seen: ${J} = ucode ${q}`)},xN=function(J){const q=["F3","L3","S2DEX"];let Q=-1;for(let Z of q)if(Q=J.indexOf(Z),Q>=0)break;if(Q>=0){if(J.indexOf("fifo",Q)>=0||J.indexOf("xbux",Q)>=0)return J.indexOf("S2DEX")>=0?$F:WF;return J.indexOf("S2DEX")>=0?FF:KF}return qZ},qZ=0,KF=1,WF=2,FF=3,$F=4,HF=5,eQ=6,JZ=7,GF=8,jF=9,NF=10,LF=11,_N=new Map([[1613065980,NF],[1837886526,JZ],[202381338,eQ],[1899172316,eQ],[603530562,jF],[379440285,eQ],[651856460,JZ],[3401874884,LF],[1824215581,GF],[3713401635,JZ],[1691120285,HF],[3610907332,qZ],[826213259,qZ]]),YF=!1,zF=new Map;class N6{constructor(J,q,Q,Z){if(Z!==void 0)this.elems=new Float32Array(4),this.elems[0]=J,this.elems[1]=q,this.elems[2]=Q,this.elems[3]=Z;else this.elems=J||new Float32Array(4)}get x(){return this.elems[0]}get y(){return this.elems[1]}get z(){return this.elems[2]}get w(){return this.elems[3]}set x(J){this.elems[0]=J}set y(J){this.elems[1]=J}set z(J){this.elems[2]=J}set w(J){this.elems[3]=J}set(J,q,Q,Z){return this.x=J,this.y=q,this.z=Q,this.w=Z,this}setV3(J,q){return this.x=J.x,this.y=J.y,this.z=J.z,this.w=q,this}dot(J){let q=0;for(let Q=0;Q<this.elems.length;++Q)q+=this.elems[Q]*J.elems[Q];return q}lengthSqr(){return this.dot(this)}length(){return Math.sqrt(this.lengthSqr())}addInPlace(J){for(let q=0;q<this.elems.length;++q)this.elems[q]+=J.elems[q];return this}subInPlace(J){for(let q=0;q<this.elems.length;++q)this.elems[q]-=J.elems[q];return this}scaleInPlace(J){for(let q=0;q<this.elems.length;++q)this.elems[q]*=J;return this}vecScaleInPlace(J){for(let q=0;q<this.elems.length;++q)this.elems[q]*=J.elems[q];return this}invVecScaleInPlace(J){for(let q=0;q<this.elems.length;++q)this.elems[q]/=J.elems[q];return this}normaliseInPlace(){let J=this.length();if(J>0)return this.scaleInPlace(1/J);return this}static create(J){const q=new N6;return q.elems[0]=J[0],q.elems[1]=J[1],q.elems[2]=J[2],q.elems[3]=J[3],q}}class x7{constructor(){this.pos=new N6,this.color=0,this.u=0,this.v=0,this.clipFlags=0,this.set=!1}calculateLinearUV(J){this.u=0.5*(1+J.x),this.v=0.5*(1+J.y)}calculateSphericalUV(J){this.u=Math.acos(J.x)/Math.PI,this.v=Math.acos(J.y)/Math.PI}}class Z9{constructor(J,q){this.scale=J||new N6(1,1,1,1),this.trans=q||new N6(0,0,0,0)}transformInPlace(J){J.vecScaleInPlace(this.scale),J.addInPlace(this.trans)}invTransformInPlace(J){J.subInPlace(this.trans),J.invVecScaleInPlace(this.scale)}}var gN=function(){return n64js.hardware().cachedMemDevice.s32},UF=function(){return n64js.hardware().cachedMemDevice.u8},u7=function(J,q,Q,Z){let X=q>>2;const Y=q+Q>>2;while(X<Y)Z=Z*17+J[X]>>>0,++X;return Z},PF=function(J,q,Q,Z,X){for(let Y=0;Y<X;++Y)J[q+0]=Q[Z+0],J[q+1]=Q[Z+1],q+=2,Z+=2},fN=function(J,q,Q,Z,X,Y){q0((q&1)==0,"tmem isn't qword aligned");for(let z=0;z<X;++z)J[q+0^Y]=Q[Z+0],J[q+1^Y]=Q[Z+1],q+=2,Z+=2},pN=function(J,q,Q,Z,X,Y){for(let z=0;z<X;++z)J[q+z]=Q[Z+z];for(let z=X;z<Y;++z)J[q+z]=0},mN=function(J,q,Q,Z,X,Y,z){for(let K=0;K<X;++K)J[q+K^z]=Q[Z+K];for(let K=X;K<Y;++K)J[q+K^z]=0},cN=function(J,q,Q,Z,X){for(let Y=0;Y<X;Y++){const z=Q[Z+Y*2+0],K=Q[Z+Y*2+1];J[q+Y*8+0]=z,J[q+Y*8+1]=K,J[q+Y*8+2]=z,J[q+Y*8+3]=K,J[q+Y*8+4]=z,J[q+Y*8+5]=K,J[q+Y*8+6]=z,J[q+Y*8+7]=K}};class g7{constructor(){const J=new ArrayBuffer(4096);this.tmemData32=new Int32Array(J),this.tmemData=new Uint8Array(J)}loadBlock(J,q,Q,Z,X,Y,z){const K=Q>>>2,W=Z>>>2,G=J.calcAddress(K,W),H=X-Q+1&4095,j=J.texelsToBytes(H),L=j+7>>>3,V=this.tmemData32;let U=G>>>2,M=q.tmem<<3>>>2;const k=gN(),O=q.size==n.G_IM_SIZ_32b?2:1;if(z)z.tip(`bytes ${j}, qwords ${L}`);if(Y===0)PF(V,M,k,U,L);else{const R=Math.ceil(2048/Y);let S=0;for(let T=0;T<L;){const b=Math.min(L-T,R);if(S)fN(V,M,k,U,b,O);else PF(V,M,k,U,b);T+=b,M+=b*2,U+=b*2,S^=1}}}loadTile(J,q,Q,Z,X,Y,z){const K=Q>>>2,W=Z>>>2,G=X>>>2,H=Y>>>2,j=G+1-K,L=H+1-W,V=J.calcAddress(K,W),U=J.texelsToBytes(j),M=J.stride(),k=this.tmemData;let O=q.tmem<<3,R=V;const S=J.size==n.G_IM_SIZ_32b?q.line<<4:q.line<<3,T=q.size==n.G_IM_SIZ_32b?8:4;if(z)z.tip(`size (${j} x ${L}), rowBytes ${U}, ramStride ${M}, tmemStride ${S}, ramOffset ${N(R)}, tmemOffset ${Q0(O)}`);const b=UF();for(let m=0;m<L;++m){if(m&1)mN(k,O,b,R,U,S,T);else pN(k,O,b,R,U,S);O+=S,R+=M}}loadTLUT(J,q,Q,Z,X,Y,z){const K=Q>>>2,W=Z>>>2,G=J.calcAddress(K,W,n.G_IM_SIZ_16b),H=sJ(X,Q),j=UF(),L=q.tmem<<3;if(z)z.tip(`count ${H}, tmemOffset ${Q0(L)}`);cN(this.tmemData,L,j,G,H)}convertTexels(J,q,Q){return EW(Q,this.tmemData,J,q)}calculateCRC(J){if(J.hash)return J.hash;const q=J.height,Q=this.tmemData32,Z=J.tmem<<3;let X=J.line<<3;if(J.format==N0.G_IM_FMT_RGBA&&J.size==n.G_IM_SIZ_32b)X*=2;const Y=q*X;let z=u7(Q,Z,Y,0);if(J.format===N0.G_IM_FMT_CI||J.format===N0.G_IM_FMT_RGBA){if(J.size===n.G_IM_SIZ_8b)z=u7(Q,2048,2048,z);else if(J.size===n.G_IM_SIZ_4b)z=u7(Q,2048+J.palette*16*2,128,z)}return J.hash=z,z}}var f7=function(J,q){return J<<q>>>1};class p7{constructor(){this.ramDV=null,this.pc=0,this.pcEnd=0,this.dlistStack=[],this.cmd0=0,this.cmd1=0,this.segments=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.tiles=new Array(8),this.lights=new Array(8),this.numLights=0,this.geometryModeBits=0,this.geometryMode={zbuffer:0,texture:0,shade:0,shadeSmooth:0,cullFront:0,cullBack:0,fog:0,lighting:0,textureGen:0,textureGenLinear:0,lod:0},this.rdpOtherModeL=0,this.rdpOtherModeH=0,this.rdpHalf0Cmd0=0,this.rdpHalf0Cmd1=0,this.rdpHalf1Cmd1=0,this.rdpHalf2Cmd1=0,this.viewport=new MF,this.projection=[],this.modelview=[],this.projectedVertices=new Array(64),this.scissor={mode:0,x0:0,y0:0,x1:320,y1:240},this.texture={tile:0,level:0,scaleS:1,scaleT:1},this.combine={lo:0,hi:0},this.fillColor=0,this.envColor=0,this.primColor=0,this.blendColor=0,this.fogColor=0,this.primDepth=0,this.fogParameters=new hF,this.colorImage={format:0,size:0,width:0,address:0},this.textureImage=new kF,this.depthImage={address:0},this.tmem=new g7,this.screenContext2d=null}reset(J,q){this.ramDV=J,this.pc=q,this.pcEnd=0,this.dlistStack=[],this.cmd0=0,this.cmd1=0;for(let Q=0;Q<this.segments.length;++Q)this.segments[Q]=0;this.rdpOtherModeL=5242881,this.rdpOtherModeH=0,this.projection=[s0.identity()],this.modelview=[s0.identity()],this.geometryModeBits=0,this.geometryMode.zbuffer=0,this.geometryMode.texture=0,this.geometryMode.shade=0,this.geometryMode.shadeSmooth=0,this.geometryMode.cullFront=0,this.geometryMode.cullBack=0,this.geometryMode.fog=0,this.geometryMode.lighting=0,this.geometryMode.textureGen=0,this.geometryMode.textureGenLinear=0,this.geometryMode.lod=0;for(let Q=0;Q<this.tiles.length;++Q)this.tiles[Q]=new k7;this.numLights=0;for(let Q=0;Q<this.lights.length;++Q)this.lights[Q]={color:{r:0,g:0,b:0,a:0},dir:k0.create([1,0,0])};for(let Q=0;Q<this.projectedVertices.length;++Q)this.projectedVertices[Q]=new x7;this.viewport.reset(),this.fogParameters.reset()}nextCommand(){if(this.pcEnd&&this.pc>=this.pcEnd)this.endDisplayList();if(this.pc==0)return!1;return this.cmd0=this.ramDV.getUint32(this.pc+0),this.cmd1=this.ramDV.getUint32(this.pc+4),this.pc+=8,!0}advanceIfCommand(J){if(this.pc==0||this.pcEnd&&this.pc>this.pcEnd)return!1;const q=this.ramDV.getUint32(this.pc+0);if(q>>>24!==J)return!1;return this.cmd0=q,this.cmd1=this.ramDV.getUint32(this.pc+4),this.pc+=8,!0}executeBatch(J,q){const Q=this.cmd0>>>24,Z=J<=0;let X=0;do if(X++,!q(this.cmd0,this.cmd1))break;while((Z||X<J)&&this.advanceIfCommand(Q));return X}pushDisplayList(J,q){const Q=q==void 0?0:J+q*8;this.dlistStack.push({pc:this.pc,pcEnd:this.pcEnd}),this.pc=J,this.pcEnd=Q}branchDisplayList(J){this.pc=J}endDisplayList(){if(this.dlistStack.length<=0){this.pc=0,this.pcEnd=0;return}const J=this.dlistStack.pop();this.pc=J.pc,this.pcEnd=J.pcEnd}invalidateTileHashes(){for(let J=0;J<8;++J)this.tiles[J].hash=0}rdpSegmentAddress(J){const q=J>>>24&15;return(this.segments[q]&8388607)+(J&8388607)}setTexture(J,q,Q,Z){this.texture.scaleS=J,this.texture.scaleT=q,this.texture.level=Q,this.texture.tile=Z}updateGeometryModeFromBits(J){const q=this.geometryMode,Q=this.geometryModeBits;q.zbuffer=Q&J.G_ZBUFFER?1:0,q.texture=Q&J.G_TEXTURE_ENABLE?1:0,q.shade=Q&J.G_SHADE?1:0,q.shadeSmooth=Q&J.G_SHADING_SMOOTH?1:0,q.cullFront=Q&J.G_CULL_FRONT?1:0,q.cullBack=Q&J.G_CULL_BACK?1:0,q.fog=Q&J.G_FOG?1:0,q.lighting=Q&J.G_LIGHTING?1:0,q.textureGen=Q&J.G_TEXTURE_GEN?1:0,q.textureGenLinear=Q&J.G_TEXTURE_GEN_LINEAR?1:0,q.lod=Q&J.G_LOD?1:0}getCycleType(){return this.rdpOtherModeH&xJ}getTextureFilterType(){return this.rdpOtherModeH&gJ}getTextureLUTType(){return this.rdpOtherModeH&uJ}getAlphaCompareType(){return this.rdpOtherModeL&vJ}getAntiAliasEnabled(){return(this.rdpOtherModeL&P0.AA_EN)!==0}getCoverageTimesAlpha(){return(this.rdpOtherModeL&P0.CVG_X_ALPHA)!==0}getAlphaCoverageSelect(){return(this.rdpOtherModeL&P0.ALPHA_CVG_SEL)!==0}}class MF{constructor(){this.reset()}reset(){const J=new k0(160,-120,1),q=new k0(160,120,0);this.set(J,q)}set(J,q){this.scale=J,this.trans=q;const Q=new N6().setV3(J,1),Z=new N6().setV3(q,0);this.transform=new Z9(Q,Z)}}class hF{constructor(){this.reset()}reset(){this.multiplier=0,this.offset=0}set(J,q){this.multiplier=J,this.offset=q}}class kF{constructor(){this.format=0,this.size=0,this.width=0,this.address=0}set(J,q,Q,Z){this.format=J,this.size=q,this.width=Q,this.address=Z}calcAddress(J,q,Q){const Z=Q===void 0?this.size:Q;return this.address+q*f7(this.width,Z)+f7(J,Z)}texelsToBytes(J){return f7(J,this.size)}stride(){return this.texelsToBytes(this.width)}}class R0{constructor(J,q){this.x=J,this.y=q}dot(J){return this.x*J.x+this.y*J.y}lengthSqr(){return this.dot(this)}length(){return Math.sqrt(this.lengthSqr())}add(J){return new R0(this.x+J.x,this.y+J.y)}sub(J){return new R0(this.x-J.x,this.y-J.y)}scale(J){return new R0(this.x*J,this.y*J)}normaliseInPlace(){const J=this.length();if(J>0)this.x/=J,this.y/=J;return this}}class m7{constructor(J,q){this.scale=J||new R0(1,1),this.trans=q||new R0(0,0)}transform(J){const q=this.scale.x*J.x+this.trans.x,Q=this.scale.y*J.y+this.trans.y;return new R0(q,Q)}}class c7{constructor(J,q,Q){this.width=q,this.height=Q,this.$canvas=$(`<canvas width="${q}" height="${Q}" />`,{width:q,height:Q}),this.texture=J.createTexture()}createScaledCanvas(J){const q=this.width*J,Q=this.height*J,Z=$('<canvas width="'+q+'" height="'+Q+'" style="background-color: black" />',{width:q,height:Q}),X=this.$canvas[0].getContext("2d"),Y=Z[0].getContext("2d"),z=X.getImageData(0,0,this.width,this.height),K=Y.createImageData(q,Q),W=z.data,G=K.data,H=z.width*4,j=K.width*4;for(let L=0;L<Q;++L){const V=H*Math.floor(L/J);let U=j*L;for(let M=0;M<q;++M){const k=V+Math.floor(M/J)*4;G[U+0]=W[k+0],G[U+1]=W[k+1],G[U+2]=W[k+2],G[U+3]=W[k+3],U+=4}}return Y.putImageData(K,0,0),Z}}var AF=function(J){if(J<=10)return 1/(1<<J);return 1<<16-J},DF=0,o7=1,OF=2,IF=3,wF=4,BF=new Map;class d7{constructor(J,q,Q,Z){this.gl=J,this.state=q,this.nativeTransform=new CF,this.textureCache=new Map,this.frameBuffer=J.createFramebuffer(),J.bindFramebuffer(J.FRAMEBUFFER,this.frameBuffer),this.frameBuffer.width=Q,this.frameBuffer.height=Z,this.frameBufferTexture2D=J.createTexture(),J.bindTexture(J.TEXTURE_2D,this.frameBufferTexture2D),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.NEAREST),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.NEAREST),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),this.frameBufferTexture3D=J.createTexture(),J.bindTexture(J.TEXTURE_2D,this.frameBufferTexture3D),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.NEAREST),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.NEAREST),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texImage2D(J.TEXTURE_2D,0,J.RGBA,Q,Z,0,J.RGBA,J.UNSIGNED_BYTE,null),J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_2D,this.frameBufferTexture3D,0),J.bindTexture(J.TEXTURE_2D,null);const X=J.createRenderbuffer();J.bindRenderbuffer(J.RENDERBUFFER,X),J.renderbufferStorage(J.RENDERBUFFER,J.DEPTH_COMPONENT16,Q,Z),J.framebufferRenderbuffer(J.FRAMEBUFFER,J.DEPTH_ATTACHMENT,J.RENDERBUFFER,X),J.bindRenderbuffer(J.RENDERBUFFER,null),J.bindFramebuffer(J.FRAMEBUFFER,null),this.blitShaderProgram=N7(J,"blit-shader-vs","blit-shader-fs"),this.blitSamplerUniform=J.getUniformLocation(this.blitShaderProgram,"uSampler"),this.blitVA=this.initBlitVA(this.blitShaderProgram),this.fillShaderProgram=N7(J,"fill-shader-vs","fill-shader-fs"),this.fillFillColorUniform=J.getUniformLocation(this.fillShaderProgram,"uFillColor"),this.fillRectVA=this.initFillRectVA(this.fillShaderProgram),this.debugClearVA=this.initClearVA(this.fillShaderProgram),this.$textureOutput=$("#texture-content")}reset(){this.textureCache.clear(),this.$textureOutput.html("")}newFrame(){const J=this.gl;J.bindFramebuffer(J.FRAMEBUFFER,this.frameBuffer),J.viewport(0,0,this.frameBuffer.width,this.frameBuffer.height)}initBlitVA(J){const q=this.gl,Q=new qJ(q),Z=[-1,-1,0,1,1,-1,0,1,-1,1,0,1,1,1,0,1];Q.initPosAttr(J,"aPosition"),Q.setPosData(new Float32Array(Z),q.STATIC_DRAW);const X=[0,0,1,0,0,1,1,1];return Q.initUVsAttr(J,"aUV"),Q.setUVData(new Float32Array(X),q.STATIC_DRAW),Q}copyTextureToFrontBuffer(J){const q=this.gl;q.bindFramebuffer(q.FRAMEBUFFER,null),q.useProgram(this.blitShaderProgram);const Q=document.getElementById("display");q.viewport(0,0,Q.width,Q.height),this.blitVA.bind(),q.activeTexture(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,J),q.uniform1i(this.blitSamplerUniform,0),q.disable(q.CULL_FACE),q.disable(q.BLEND),q.disable(q.DEPTH_TEST),q.depthMask(!1),q.drawArrays(q.TRIANGLE_STRIP,0,4),this.blitVA.unbind()}copyBackBufferToFrontBuffer(){this.copyTextureToFrontBuffer(this.frameBufferTexture3D)}copyPixelsToFrontBuffer(J,q,Q,Z){const X=this.gl;if(X.activeTexture(X.TEXTURE0),X.bindTexture(X.TEXTURE_2D,this.frameBufferTexture2D),Z==32)X.texImage2D(X.TEXTURE_2D,0,X.RGBA,q,Q,0,X.RGBA,X.UNSIGNED_BYTE,J);else if(Z==16)X.texImage2D(X.TEXTURE_2D,0,X.RGBA,q,Q,0,X.RGBA,X.UNSIGNED_SHORT_5_5_5_1,J);this.copyTextureToFrontBuffer(this.frameBufferTexture2D)}flushTris(J){const q=this.gl;if(J.empty())return;const Q=this.state.geometryMode.texture,Z=this.state.geometryMode.lighting&&this.state.geometryMode.textureGen;if(this.setProgramState(J.positions,J.colours,J.coords,Q,Z,this.state.texture.tile),this.initDepth(),this.state.geometryMode.cullFront||this.state.geometryMode.cullBack){q.enable(q.CULL_FACE);const X=this.state.geometryMode.cullFront?q.FRONT:q.BACK;q.cullFace(X)}else q.disable(q.CULL_FACE);q.drawArrays(q.TRIANGLES,0,J.numTris*3),J.reset(),q.bindVertexArray(null)}initClearVA(J){const q=this.gl,Q=new qJ(q),Z=[1,1,0,1,-1,1,0,1,1,-1,0,1,-1,-1,0,1];return Q.initPosAttr(J,"aPosition"),Q.setPosData(new Float32Array(Z),q.STATIC_DRAW),Q}debugClear(){const J=this.gl;J.useProgram(this.fillShaderProgram),this.debugClearVA.bind(),J.uniform4f(this.fillFillColorUniform,1,0,1,1),J.disable(J.BLEND),J.disable(J.CULL_FACE),J.disable(J.DEPTH_TEST),J.depthMask(!1),J.drawArrays(J.TRIANGLE_STRIP,0,4),this.debugClearVA.unbind()}initFillRectVA(J){const q=this.gl,Q=new qJ(q);return Q.initPosAttr(J,"aPosition"),Q.setPosData(new Float32Array(16),q.DYNAMIC_DRAW),Q}fillRect(J,q,Q,Z,X){const Y=this.gl;this.setGLBlendMode();const z=this.nativeTransform.convertN64ToDisplay(new R0(J,q)),K=this.nativeTransform.convertN64ToDisplay(new R0(Q,Z)),W=[K.x,K.y,0,1,z.x,K.y,0,1,K.x,z.y,0,1,z.x,z.y,0,1];Y.useProgram(this.fillShaderProgram),this.fillRectVA.bind(),this.fillRectVA.setPosData(new Float32Array(W),Y.DYNAMIC_DRAW),Y.uniform4f(this.fillFillColorUniform,X.r,X.g,X.b,X.a),Y.disable(Y.CULL_FACE),Y.disable(Y.DEPTH_TEST),Y.depthMask(!1),Y.drawArrays(Y.TRIANGLE_STRIP,0,4),this.fillRectVA.unbind()}calculateRectVertices(J,q,Q,Z){const X=this.nativeTransform.convertN64ToDisplay(new R0(J,q)),Y=this.nativeTransform.convertN64ToDisplay(new R0(Q,Z)),K=(this.state.rdpOtherModeL&O8.G_ZS_PRIM)!==0?this.state.primDepth:0;return[X.x,X.y,K,1,Y.x,X.y,K,1,X.x,Y.y,K,1,Y.x,Y.y,K,1]}lleRect(J,q,Q,Z){const X=this.gl;if(this.setProgramState(new Float32Array(q),new Uint32Array(Z),new Float32Array(Q),!0,!1,J),X.disable(X.CULL_FACE),(this.state.rdpOtherModeL&O8.G_ZS_PRIM)!==0?!0:!1)this.initDepth();else X.disable(X.DEPTH_TEST),X.depthMask(!1);X.drawArrays(X.TRIANGLE_STRIP,0,4),X.bindVertexArray(null)}texRect(J,q,Q,Z,X,Y,z,K,W,G){const H=this.calculateRectVertices(q,Q,Z,X);let j;if(G)j=[Y,z,Y,W,K,z,K,W];else j=[Y,z,K,z,Y,W,K,W];const L=[4294967295,4294967295,4294967295,4294967295];this.lleRect(J,H,j,L)}texRectRot(J,q,Q,Z,X,Y,z,K,W,G,H,j,L){const V=this.nativeTransform.convertN64ToDisplay(new R0(q,Q)),U=this.nativeTransform.convertN64ToDisplay(new R0(Z,X)),M=this.nativeTransform.convertN64ToDisplay(new R0(Y,z)),k=this.nativeTransform.convertN64ToDisplay(new R0(K,W)),R=(this.state.rdpOtherModeL&O8.G_ZS_PRIM)!==0?this.state.primDepth:0,S=[V.x,V.y,R,1,U.x,U.y,R,1,M.x,M.y,R,1,k.x,k.y,R,1],T=[G,H,j,H,G,L,j,L],b=[4294967295,4294967295,4294967295,4294967295];this.lleRect(J,S,T,b)}initDepth(){const J=this.gl,q=this.state.geometryMode.zbuffer!==0,Q=(this.state.rdpOtherModeL&P0.Z_CMP)!==0,Z=(this.state.rdpOtherModeL&P0.Z_UPD)!==0;if(q&&Q||Z)J.enable(J.DEPTH_TEST),J.depthFunc(J.LEQUAL);else J.disable(J.DEPTH_TEST);J.depthMask(Z)}setProgramState(J,q,Q,Z,X,Y){const z=this.gl;this.setGLBlendMode();const K=this.state.getCycleType();let W,G,H,j;if(Z){const k=Y+0&7,O=Y+1&7;W=this.state.tiles[k],G=this.state.tiles[O],H=this.lookupTexture(k),j=K==L0.G_CYC_2CYCLE?this.lookupTexture(O):null}const L=(this.state.getAlphaCompareType()&JJ.G_AC_THRESHOLD)!=0,V=this.state.getAntiAliasEnabled()&&this.state.getCoverageTimesAlpha();let U=0;if(L)U=(this.state.blendColor>>>0&255)/255;else if(V)U=0;const M=this.getCurrentN64Shader();z.useProgram(M.program),M.vertexArray.bind(),M.vertexArray.setPosData(J,z.DYNAMIC_DRAW),M.vertexArray.setColorData(q,z.DYNAMIC_DRAW),M.vertexArray.setUVData(Q,z.DYNAMIC_DRAW),this.bindTexture(0,z.TEXTURE0,W,H,X,M.uSamplerUniform0,M.uTexScaleUniform0,M.uTexOffsetUniform0),this.bindTexture(1,z.TEXTURE1,G,j,X,M.uSamplerUniform1,M.uTexScaleUniform1,M.uTexOffsetUniform1),z.uniform1f(M.uAlphaThresholdUniform,U),z.uniform4f(M.uPrimColorUniform,(this.state.primColor>>>24&255)/255,(this.state.primColor>>>16&255)/255,(this.state.primColor>>>8&255)/255,(this.state.primColor>>>0&255)/255),z.uniform4f(M.uEnvColorUniform,(this.state.envColor>>>24&255)/255,(this.state.envColor>>>16&255)/255,(this.state.envColor>>>8&255)/255,(this.state.envColor>>>0&255)/255)}getCurrentN64Shader(){const J=this.state.combine.hi,q=this.state.combine.lo,Q=this.state.getCycleType(),Z=(this.state.getAlphaCompareType()&JJ.G_AC_THRESHOLD)!=0,X=this.state.getAntiAliasEnabled()&&this.state.getCoverageTimesAlpha();return mW(this.gl,J,q,Q,Z||X)}lookupTexture(J){const q=this.state.tiles[J];if(q.line===0)return null;const Q=this.state.tmem.calculateCRC(q),Z=`${N(Q)}_${q.format}_${q.size}_${q.width}_${q.height}_${q.palette}`;if(this.textureCache.has(Z))return this.textureCache.get(Z);const X=this.decodeTexture(q,this.state.getTextureLUTType(),Z);return this.textureCache.set(Z,X),X}decodeTexture(J,q,Q){const Z=this.gl;if(J.width==0||J.height==0)return null;const X=new c7(Z,J.width,J.height);if(!X.$canvas[0].getContext)return null;this.$textureOutput.append(`${Q}: ${N0.nameOf(J.format)}, ${n.nameOf(J.size)},${J.width}x${J.height}, <br>`);const Y=X.$canvas[0].getContext("2d"),z=Y.createImageData(X.width,X.height);if(this.state.tmem.convertTexels(J,q,z))Y.putImageData(z,0,0),this.$textureOutput.append(X.$canvas),this.$textureOutput.append("<br>");else{const W=`${N0.nameOf(J.format)}/${n.nameOf(J.size)} is unhandled`;this.$textureOutput.append(W),this.hleHalt(W)}return Z.activeTexture(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,X.texture),Z.texImage2D(Z.TEXTURE_2D,0,Z.RGBA,Z.RGBA,Z.UNSIGNED_BYTE,X.$canvas[0]),Z.generateMipmap(Z.TEXTURE_2D),Z.bindTexture(Z.TEXTURE_2D,null),X}bindTexture(J,q,Q,Z,X,Y,z,K){const W=this.gl;if(W.activeTexture(q),!Z){W.bindTexture(W.TEXTURE_2D,null);return}let{left:G,top:H}=Q,j=1/Z.width,L=1/Z.height;if(Z.width===56&&Z.height===29)j*=0.5,L*=0.5;if(X)j=1,L=1,G=0,H=0;if(j*=AF(Q.shiftS),L*=AF(Q.shiftT),W.bindTexture(W.TEXTURE_2D,Z.texture),W.uniform1i(Y,J),W.uniform2f(z,j,L),W.uniform2f(K,G,H),this.state.getTextureFilterType()==dJ.G_TF_POINT)W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.NEAREST),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.NEAREST_MIPMAP_NEAREST);else W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR_MIPMAP_NEAREST);const V=Q.cmS===D8||Q.maskS===0,U=Q.cmT===D8||Q.maskT===0,M=Q.cmS===iq,k=Q.cmT===iq,O=V?W.CLAMP_TO_EDGE:M?W.MIRRORED_REPEAT:W.REPEAT,R=U?W.CLAMP_TO_EDGE:k?W.MIRRORED_REPEAT:W.REPEAT;W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,O),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,R)}setGLBlendMode(){const J=this.gl,q=this.state.getCoverageTimesAlpha(),Q=this.state.getAlphaCoverageSelect(),Z=this.state.getCycleType();if(Z==L0.G_CYC_FILL||Z==L0.G_CYC_COPY){J.disable(J.BLEND);return}const X=this.state.rdpOtherModeL>>X7,Y=(Z===L0.G_CYC_2CYCLE?X:X>>>2)&13107;let z=DF;switch(Y){case 0:case 770:z=o7;break;case 16:case 17:if(!Q||q)z=OF;break;case 272:z=o7;break;case 784:case 4880:z=IF;break;case 12560:z=wF;break}let K=!1;switch(z){case o7:J.disable(J.BLEND);break;case OF:J.blendFunc(J.SRC_ALPHA,J.ONE_MINUS_SRC_ALPHA),J.blendEquation(J.FUNC_ADD),J.enable(J.BLEND);break;case IF:J.blendFunc(J.ZERO,J.ONE_MINUS_SRC_ALPHA),J.blendEquation(J.FUNC_ADD),J.enable(J.BLEND);break;case wF:K=!0,J.disable(J.BLEND);break;case DF:K=!0,J.disable(J.BLEND);break}if(K)this.logUnhandledBlendMode(Y,Q,q)}logUnhandledBlendMode(J,q,Q){if(BF.get(J))return;BF.set(J,!0),n64js.warn(`Unhandled blend mode: ${Q0(J)} = ${YQ(J)}, alphaCvgSel ${q}, cvgXAlpha ${Q}`)}}class CF{constructor(){this.initDimensions(320,240)}initDimensions(J,q){this.viWidth=J,this.viHeight=q,this.n64FramebufferToDevice=new m7(new R0(2/J,-2/q),new R0(-1,1));const Q=J/2,Z=q/2,X=512,Y=511,z=new N6(Q,-Z,X,1),K=new N6(Q,+Z,Y,0);this.viTransform=new Z9(z,K)}convertN64ToDisplay(J){return this.n64FramebufferToDevice.transform(J)}}function EF(J){t0.initUI();const q=J[0];if(oN(q),!Z8)return;R6=new d7(Z8,i0,640,480),R6.hleHalt=fF,t0.renderer=R6}function TF(){if(R6)R6.reset()}var oN=function(J){if(Z8)return;try{Z8=J.getContext("webgl2")}catch(q){}if(!Z8)alert("Unable to initialize WebGL. Your browser may not support it.")};function _F(){return t0.running}function bF(){return t0.requested}function SF(){t0.toggle()}function vF(){t0.debugDisplayList()}function xF(J){t0.onNewTask(J),uF(J,null,-1)}function QZ(){n64js.onPresent();const J=n64js.hardware(),q=J.viRegDevice;if(J.timeline.addEvent(`Present ${N(q.dramAddrReg)}`),yF!==0){R6.copyBackBufferToFrontBuffer();return}gF(q);const Q=q.renderBackBuffer();if(!Q)return;R6.copyPixelsToFrontBuffer(Q,q.screenWidth,q.screenHeight,q.bitDepth)}var uF=function(J,q,Q){if(yF++,!Z8)return;const Z=n64js.hardware(),X=Z.cachedMemDevice.mem.dataView;i0.reset(X,J.dataPtr);let Y=RF(J,X),z=Y.buildCommandTable();if(Y.onLoadUcode((K,W,G,H)=>{return J.loadUcode(K,W,G,H),Y=RF(J,X),z=Y.buildCommandTable(),Y}),gF(Z.viRegDevice),R6.newFrame(),t0.running)R6.debugClear();if(q){t0.currentOp=0;while(i0.nextCommand())q.begin(i0.cmd0,i0.cmd1,i0.dlistStack.length),z[i0.cmd0>>>24](i0.cmd0,i0.cmd1,q),q.end(),t0.currentOp++}else{t0.currentOp=0;while(i0.nextCommand())if(z[i0.cmd0>>>24](i0.cmd0,i0.cmd1),t0.postOp(Q))break}Z8.bindFramebuffer(Z8.FRAMEBUFFER,null)},gF=function(J){const q=J.computeDimensions();if(!q)return;R6.nativeTransform.initDimensions(q.srcWidth,q.srcHeight);const Q=document.getElementById("display");Q.width=q.screenWidth*m0.canvasScale,Q.height=q.screenHeight*m0.canvasScale},RF=function(J,q){const Q=VF(J,i0,q);return Q.debugController=t0,Q.hleHalt=fF,Q.gl=Z8,Q.renderer=R6,Q},fF=function(J){if(t0.running)return;n64js.ui().displayWarning(J),n64js.breakEmulationForDisplayListDebug(),t0.halt()};window.n64js=window.n64js||{};var yF=0,Z8=null,R6,i0=new p7,t0=new U7(i0,uF);var l7={emulationMode:"LLE"},dN=q6.addFolder("Audio");dN.add(l7,"emulationMode",{LLE:"LLE",Disabled:"Disabled"}).name("Emulation Mode");function mF(){const J=n64js.hardware(),q=J.cachedMemDevice.u8,Q=J.sp_mem.subRegion(lN,nN),Z=new pF(q,Q);let X=!1;switch(Z.type){case aN:if(m0.emulationMode=="HLE"){const Y=J.timeline.startEvent(`HLE Task ${Z.detectVersionString()}`);if(xF(Z),J.miRegDevice.interruptDP(),Y)Y.stop();X=!0}break;case rN:if(l7.emulationMode=="Disabled")X=!0;break;case sN:break;case iN:break}return X}var lN=4032,nN=64,y8=e({type:0,flags:4,ucodeBootPtr:8,ucodeBootSize:12,ucodePtr:16,ucodeSize:20,ucodeDataPtr:24,ucodeDataSize:28,dramStackPtr:32,dramStackSize:36,outputBuffPtr:40,outputBuffSize:44,dataPtr:48,dataSize:52,yieldDataPtr:56,yieldDataSize:60}),aN=1,rN=2,sN=3,iN=4;class pF{constructor(J,q){this.ram_u8=J,this.type=q.getU32(y8.type),this.codeAddr=q.getU32(y8.ucodePtr)&536870911,this.codeSize=this.clampCodeSize(q.getU32(y8.ucodeSize)),this.codeDataAddr=q.getU32(y8.ucodeDataPtr)&536870911,this.codeDataSize=q.getU32(y8.ucodeDataSize),this.dataPtr=q.getU32(y8.dataPtr)}dumpCode(){const J=n64js.hardware().cachedMemDevice.mem,Q=aX(J,4224,this.codeAddr,this.codeSize);let Z=`${this.detectVersionString()}\n`;for(let X of Q)Z+=`${v(X.address,16)} ${X.disassembly}\n`;Z+="\nDMEM\n",Z+=$W(J,0,this.codeDataAddr,this.codeDataSize),console.log(Z)}loadUcode(J,q,Q,Z){this.codeAddr=J&536870911,this.codeSize=this.clampCodeSize(q),this.codeDataAddr=Q&536870911,this.codeDataSize=Z}clampCodeSize(J){if(J==0||J>4096)return 4096;return J}dataByte(J){return this.ram_u8[this.codeDataAddr+J]}codeByte(J){return this.ram_u8[this.codeAddr+J]}detectVersionString(){const J="R".charCodeAt(0),q="S".charCodeAt(0),Q="P".charCodeAt(0);for(let Z=0;Z+2<this.codeDataSize;++Z)if(this.dataByte(Z+0)===J&&this.dataByte(Z+1)===q&&this.dataByte(Z+2)===Q){let X="";for(let Y=Z;Y<this.codeDataSize;++Y){const z=this.dataByte(Y);if(z===0)break;if(z>=32)X+=String.fromCharCode(z)}return X}return""}computeMicrocodeHash(){let J=0;for(let q=0;q<this.codeSize;++q)J=J*17+this.codeByte(q)>>>0;return J}}function cF(J,q){Q6=J.memMap.getMemoryHandler.bind(J.memMap),P6=J.cachedMemDevice.mem.dataView,X8=q}function tN(J){if(J&7)X8.unalignedLoad(J);return Q6(J).readU64(J)}function eN(J){if(J&1)X8.unalignedLoad(J);return Q6(J).readU16(J)}function JL(J){if(J&3)X8.unalignedLoad(J);return Q6(J).readU32(J)}function qL(J){return Q6(J).readU8(J)}function n7(J){if(J&3)X8.unalignedLoad(J);return Q6(J).readS32(J)}function QL(J){if(J&1)X8.unalignedLoad(J);return Q6(J).readS16(J)}function ZL(J){return Q6(J).readS8(J)}function XL(J,q){if(J&7)X8.unalignedStore(J);Q6(J).write64(J,q)}function YL(J,q){if(J&3)X8.unalignedStore(J);Q6(J).write32(J,q)}function zL(J,q){if(J&1)X8.unalignedStore(J);Q6(J).write16(J,q)}function KL(J,q){Q6(J).write8(J,q)}function ZZ(J,q,Q){Q6(J).write32masked(J,q,Q)}function XZ(J,q,Q){Q6(J).write64masked(J,q,Q)}function a7(J){if(J<-2139095040){const q=J+2147483648|0;return P6.getUint8(q,!1)}return qL(J>>>0)}function r7(J){if(J<-2139095040){const q=J+2147483648|0;return P6.getInt8(q,!1)}return ZL(J>>>0)}function s7(J){if((J&1)==0&&J<-2139095040){const q=J+2147483648|0;return P6.getUint16(q,!1)}return eN(J>>>0)}function i7(J){if((J&1)==0&&J<-2139095040){const q=J+2147483648|0;return P6.getInt16(q,!1)}return QL(J>>>0)}function X9(J){if((J&3)==0&&J<-2139095040){const q=J+2147483648|0;return P6.getUint32(q,!1)}return JL(J>>>0)}function Y9(J){if((J&3)==0&&J<-2139095040){const q=J+2147483648|0;return P6.getInt32(q,!1)}return n7(J>>>0)}function ZJ(J){if((J&7)==0&&J<-2139095040){const q=J+2147483648|0;return P6.getBigUint64(q,!1)}return tN(J>>>0)}function t7(J,q){if(J<-2139095040){const Q=J+2147483648|0;P6.setUint8(Q,q,!1);return}KL(J>>>0,q)}function e7(J,q){if((J&1)==0&&J<-2139095040){const Q=J+2147483648|0;P6.setUint16(Q,q,!1);return}zL(J>>>0,q)}function z9(J,q){if((J&3)==0&&J<-2139095040){const Q=J+2147483648|0;P6.setUint32(Q,q,!1);return}YL(J>>>0,q)}function K9(J,q){if((J&7)==0&&J<-2139095040){const Q=J+2147483648|0;P6.setBigUint64(Q,q,!1);return}XL(J>>>0,q)}var Q6,P6,X8;class JY{constructor(){this.cyclesToFirstEvent=0,this.firstEvent=null}reset(){this.cyclesToFirstEvent=0,this.firstEvent=null}nextEventCountdown(){return this.cyclesToFirstEvent}incrementCount(J){this.cyclesToFirstEvent-=J;while(this.cyclesToFirstEvent<=0){const q=this.firstEvent;if(!q)break;this.unlink(q),q.handler()}}unlink(J){if(J.prev)J.prev.cyclesToNextEvent=J.next?J.prev.cyclesToNextEvent+J.cyclesToNextEvent:0,J.prev.next=J.next;else this.cyclesToFirstEvent=J.next?this.cyclesToFirstEvent+J.cyclesToNextEvent:0,this.firstEvent=J.next;if(J.next)J.next.prev=J.prev;J.prev=null,J.next=null}insertAfter(J,q,Q,Z){const X=J?J.next:this.firstEvent;if(Q.cyclesToNextEvent=X?q-Z:0,q0(Q.cyclesToNextEvent>=0,"cyclesToNextEvent must be positive or zero"),Q.next=X,Q.prev=J,X)X.prev=Q;if(J)J.cyclesToNextEvent=Z,J.next=Q;else this.cyclesToFirstEvent=Z,this.firstEvent=Q}skipToNextEvent(J){if(!this.firstEvent||this.cyclesToFirstEvent<J)return 0;const q=this.cyclesToFirstEvent-J;return this.cyclesToFirstEvent=J,q}addEvent(J,q,Q){q0(!this.hasEvent(J),`Already has event of type ${J}`),q0(q>0,"cycles must be positive");const Z=new oF(J,Q);let X=null,Y=this.cyclesToFirstEvent;for(let z=this.firstEvent;z;z=z.next){if(q<=Y){this.insertAfter(X,Y,Z,q);return}q-=Y,Y=z.cyclesToNextEvent,X=z}this.insertAfter(X,Y,Z,q)}removeEvent(J){let q=this.cyclesToFirstEvent;for(let Q=this.firstEvent;Q;Q=Q.next){if(Q.type==J)return this.unlink(Q),q;q+=Q.cyclesToNextEvent}return-1}getEvent(J){for(let q=this.firstEvent;q;q=q.next)if(q.type==J)return q;return null}getCyclesUntilEvent(J){let q=this.cyclesToFirstEvent;for(let Q=this.firstEvent;Q;Q=Q.next){if(Q.type==J)return q;q+=Q.cyclesToNextEvent}return-1}hasEvent(J){return Boolean(this.getEvent(J))}}class oF{constructor(J,q){this.type=J,this.cyclesToNextEvent=0,this.handler=q,this.prev=null,this.next=null}getName(){return this.type}}var ML=function(J){return J<<VL},hL=function(J){return J<<k4},kL=function(J){return J<<D4},y6=function(J){const q=J&DZ,Q=J&DL;if(q==DZ){if(Q==0)return J&KJ?z8:Y8;return J&OL?V6:K8}if(q==0){if(Q!=0)return E6;return J&KJ?KY:zY}return w4},d6=function(J){const q=J&OZ,Q=J&wL;if(q==OZ){if(Q==0)return J&WJ?z8:Y8;return J&BL?V6:K8}if(q==0){if(Q!=0)return E6;return J&WJ?KY:zY}return w4},kZ=function(J){return J==V6||J==K8},XJ=function(J){return J==zY||J==KY},l6=function(J){return J==Y8||J==z8},YY=function(J,q,Q){return J[q*2+(Q?1:0)]},B4=function(J){if(J.length!=8)throw"Case table is unexpected size.";return J},G4=function(J,q){return J[q]},WY=function(J){if(J.length!=IZ)throw"Case table is unexpected size.";return J},V4=function(J,q,Q){return J[q*IZ+Q]},wZ=function(J){if(J.length!=IZ*IZ)throw"Case table is unexpected size.";return J},dF=0,lF=1,nF=2,aF=3,rF=4,sF=5,iF=6,tF=7,YZ=8,zZ=9,KZ=10,WZ=11,FZ=12,$Z=13,HZ=14,GZ=15,jZ=32,NZ=33,LZ=36,VZ=37,FL=0,$L=1,HL=2,GL=3;var jL=128,NL=256;var eF=131072,J4=8388608,LL=16777216,UZ=3,y0=1,PZ=2,W9=4,q4=8,o6=16,VL=2,k4=7,D4=12;var UL=3968,Q4=258048,PL=25427967,KJ=2147483648,DZ=2139095040,DL=8388607,OL=1<<22,MZ=2143289343,qY=0,QY=KJ,O4=8388608,IL=KJ|O4,Z4=DZ,X4=KJ|DZ,WJ=0x8000_0000_0000_0000n,OZ=0x7ff0_0000_0000_0000n,wL=0x000f_ffff_ffff_ffffn,BL=1n<<51n,hZ=0x7ff7_ffff_ffff_ffffn,ZY=0n,XY=WJ,I4=0x0010_0000_0000_0000n,AL=WJ|I4,Y4=OZ,z4=WJ|OZ,K4=Number.MAX_SAFE_INTEGER,W4=Number.MIN_SAFE_INTEGER,F4=2147483647,$4=-2147483648,w4=0,zY=1,KY=2,Y8=3,z8=4,V6=5,K8=6,E6=7,IZ=8,H4=B4([QY,qY,QY,qY,QY,O4,IL,qY]),CL=B4([XY,ZY,XY,ZY,XY,I4,AL,ZY]),_=0,w=1,n6=2,K0=3,X0=4,E0=5,L6=6,tJ=7,YJ=8,zJ=9,j4=WY([tJ,tJ,tJ,tJ,_,_,w,w]),N4=WY([YJ,YJ,YJ,YJ,YJ,_,w,w]),L4=WY([zJ,zJ,zJ,zJ,zJ,_,w,w]),U4=wZ([K0,K0,K0,K0,K0,_,w,w,K0,K0,K0,K0,K0,_,w,w,K0,K0,K0,K0,K0,_,w,w,K0,K0,K0,K0,_,_,w,w,K0,K0,K0,_,K0,_,w,w,_,_,_,_,_,_,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w]),P4=wZ([X0,X0,X0,X0,X0,_,w,w,X0,X0,X0,X0,X0,_,w,w,X0,X0,X0,X0,X0,_,w,w,X0,X0,X0,X0,X0,_,w,w,X0,X0,X0,X0,X0,_,w,w,_,_,_,_,_,_,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w]),M4=wZ([E0,E0,E0,E0,E0,_,w,w,E0,E0,E0,_,_,_,w,w,E0,E0,E0,_,_,_,w,w,E0,_,_,E0,E0,_,w,w,E0,_,_,E0,E0,_,w,w,_,_,_,_,_,_,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w]),h4=wZ([L6,n6,n6,L6,L6,_,w,w,L6,_,n6,L6,L6,_,w,w,L6,_,n6,L6,L6,_,w,w,L6,n6,n6,_,_,_,w,w,L6,n6,n6,_,_,_,w,w,_,_,_,_,_,_,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w]),M6=0,T6=1,_6=2,b6=3;class FY{constructor(J){this.hardware=J,this.control=new Uint32Array(32),this.mem=new ArrayBuffer(256),this.regF32=new Float32Array(this.mem),this.regF64=new Float64Array(this.mem),this.regS32=new Int32Array(this.mem),this.regU32=new Uint32Array(this.mem),this.regS64=new BigInt64Array(this.mem),this.regU64=new BigUint64Array(this.mem),this.regIdx32_cop=new Uint32Array(new ArrayBuffer(128)),this.regIdx32_d=new Uint32Array(new ArrayBuffer(128)),this.regIdx32_s=new Uint32Array(new ArrayBuffer(128)),this.regIdx32_t=new Uint32Array(new ArrayBuffer(128)),this.regIdx64_cop=new Uint32Array(new ArrayBuffer(128)),this.regIdx64_d=new Uint32Array(new ArrayBuffer(128)),this.regIdx64_s=new Uint32Array(new ArrayBuffer(128)),this.regIdx64_t=new Uint32Array(new ArrayBuffer(128)),this.tempBuf=new ArrayBuffer(8),this.tempF32=new Float32Array(this.tempBuf),this.tempF64=new Float64Array(this.tempBuf),this.tempU32=new Uint32Array(this.tempBuf),this.tempS32=new Int32Array(this.tempBuf),this.tempU64=new BigUint64Array(this.tempBuf),this.tempS64=new BigInt64Array(this.tempBuf),this._fullMode=!0,this.fullMode=!0,this.reset()}reset(){for(let J=0;J<32;++J)this.control[J]=0,this.regS64[J]=0n;this.control[0]=2560,this.fullMode=!0}set fullMode(J){if(this._fullMode=J,this._fullMode)for(let q=0;q<32;q++)this.regIdx32_cop[q]=q*2,this.regIdx32_d[q]=q*2,this.regIdx32_s[q]=q*2,this.regIdx32_t[q]=q*2,this.regIdx64_cop[q]=q,this.regIdx64_d[q]=q,this.regIdx64_s[q]=q,this.regIdx64_t[q]=q;else for(let q=0;q<32;q++){const Q=q&~1;this.regIdx32_cop[q]=Q*2+(q&1),this.regIdx32_d[q]=q*2,this.regIdx32_s[q]=Q*2,this.regIdx32_t[q]=q*2,this.regIdx64_cop[q]=Q,this.regIdx64_d[q]=q,this.regIdx64_s[q]=Q,this.regIdx64_t[q]=q}}execSInstr(J,q,Q,Z){if(J<48){switch(J){case dF:this.ADD_S(q,Q,Z);return;case lF:this.SUB_S(q,Q,Z);return;case nF:this.MUL_S(q,Q,Z);return;case aF:this.DIV_S(q,Q,Z);return;case rF:this.SQRT_S(q,Q);return;case sF:this.ABS_S(q,Q);return;case iF:this.MOV_S(q,Q);return;case tF:this.NEG_S(q,Q);return;case YZ:this.ConvertSToL(q,Q,M6);return;case zZ:this.ConvertSToL(q,Q,T6);return;case KZ:this.ConvertSToL(q,Q,_6);return;case WZ:this.ConvertSToL(q,Q,b6);return;case FZ:this.ConvertSToW(q,Q,M6);return;case $Z:this.ConvertSToW(q,Q,T6);return;case HZ:this.ConvertSToW(q,Q,_6);return;case GZ:this.ConvertSToW(q,Q,b6);return;case jZ:this.raiseUnimplemented();return;case NZ:this.CVT_D_S(q,Q);return;case LZ:this.ConvertSToW(q,Q,this.roundingMode);return;case VZ:this.ConvertSToL(q,Q,this.roundingMode);return}q0(!1,"unhandled S instruction"),this.raiseUnimplemented()}else this.handleFloatCompareSingle(J,Q,Z)}execDInstr(J,q,Q,Z){if(J<48){switch(J){case dF:this.ADD_D(q,Q,Z);return;case lF:this.SUB_D(q,Q,Z);return;case nF:this.MUL_D(q,Q,Z);return;case aF:this.DIV_D(q,Q,Z);return;case rF:this.SQRT_D(q,Q);return;case sF:this.ABS_D(q,Q);return;case iF:this.MOV_D(q,Q);return;case tF:this.NEG_D(q,Q);return;case YZ:this.ConvertDToL(q,Q,M6);return;case zZ:this.ConvertDToL(q,Q,T6);return;case KZ:this.ConvertDToL(q,Q,_6);return;case WZ:this.ConvertDToL(q,Q,b6);return;case FZ:this.ConvertDToW(q,Q,M6);return;case $Z:this.ConvertDToW(q,Q,T6);return;case HZ:this.ConvertDToW(q,Q,_6);return;case GZ:this.ConvertDToW(q,Q,b6);return;case jZ:this.CVT_S_D(q,Q);return;case NZ:this.raiseUnimplemented();return;case LZ:this.ConvertDToW(q,Q,this.roundingMode);return;case VZ:this.ConvertDToL(q,Q,this.roundingMode);return}q0(!1,"unhandled D instruction"),this.raiseUnimplemented()}else this.handleFloatCompareDouble(J,Q,Z)}execWInstr(J,q,Q,Z){switch(J){case YZ:this.raiseUnimplemented();return;case zZ:this.raiseUnimplemented();return;case KZ:this.raiseUnimplemented();return;case WZ:this.raiseUnimplemented();return;case FZ:this.raiseUnimplemented();return;case $Z:this.raiseUnimplemented();return;case HZ:this.raiseUnimplemented();return;case GZ:this.raiseUnimplemented();return;case jZ:this.CVT_S_W(q,Q);return;case NZ:this.CVT_D_W(q,Q);return;case LZ:this.raiseUnimplemented();return;case VZ:this.raiseUnimplemented();return}q0(!1,"unhandled W instruction"),this.raiseUnimplemented()}execLInstr(J,q,Q,Z){switch(J){case YZ:this.raiseUnimplemented();return;case zZ:this.raiseUnimplemented();return;case KZ:this.raiseUnimplemented();return;case WZ:this.raiseUnimplemented();return;case FZ:this.raiseUnimplemented();return;case $Z:this.raiseUnimplemented();return;case HZ:this.raiseUnimplemented();return;case GZ:this.raiseUnimplemented();return;case jZ:this.CVT_S_L(q,Q);return;case NZ:this.CVT_D_L(q,Q);return;case LZ:this.raiseUnimplemented();return;case VZ:this.raiseUnimplemented();return}q0(!1,"unhandled L instruction"),this.raiseUnimplemented()}handleFloatCompareSingle(J,q,Q){const Z=y6(this.loadU32(this.fsRegIdx32(q))),X=y6(this.loadU32(this.ftRegIdx32(Q)));let Y=!1;if(kZ(Z)||kZ(X)){if(J&8||Z==V6||X==V6){if(this.raiseException(o6))return}if(J&1)Y=!0}else{const z=this.loadF32(this.fsRegIdx32(q)),K=this.loadF32(this.ftRegIdx32(Q));if(J&4)Y|=z<K;if(J&2)Y|=z==K}this.setCondition(Y)}handleFloatCompareDouble(J,q,Q){const Z=d6(this.loadU64(this.fsRegIdx64(q))),X=d6(this.loadU64(this.ftRegIdx64(Q)));let Y=!1;if(kZ(Z)||kZ(X)){if(J&8||Z==V6||X==V6){if(this.raiseException(o6))return}if(J&1)Y=!0}else{const z=this.loadF64(this.fsRegIdx64(q)),K=this.loadF64(this.ftRegIdx64(Q));if(J&4)Y|=z<K;if(J&2)Y|=z==K}this.setCondition(Y)}DCFC1(J,q){this.clearCause(),this.raiseUnimplemented()}DCTC1(J,q){this.clearCause(),this.raiseUnimplemented()}MOV_S(J,q){this.store64(this.fdRegIdx64(J),this.loadU64(this.fsRegIdx64(q)))}SQRT_S(J,q){this.f32UnaryOp(J,q,j4)}ABS_S(J,q){this.f32UnaryOp(J,q,N4)}NEG_S(J,q){this.f32UnaryOp(J,q,L4)}ADD_S(J,q,Q){this.f32BinaryOp(J,q,Q,U4)}SUB_S(J,q,Q){this.f32BinaryOp(J,q,Q,P4)}MUL_S(J,q,Q){this.f32BinaryOp(J,q,Q,M4)}DIV_S(J,q,Q){this.f32BinaryOp(J,q,Q,h4)}MOV_D(J,q){this.store64(this.fdRegIdx64(J),this.loadU64(this.fsRegIdx64(q)))}SQRT_D(J,q){this.f64UnaryOp(J,q,j4)}ABS_D(J,q){this.f64UnaryOp(J,q,N4)}NEG_D(J,q){this.f64UnaryOp(J,q,L4)}ADD_D(J,q,Q){this.f64BinaryOp(J,q,Q,U4)}SUB_D(J,q,Q){this.f64BinaryOp(J,q,Q,P4)}MUL_D(J,q,Q){this.f64BinaryOp(J,q,Q,M4)}DIV_D(J,q,Q){this.f64BinaryOp(J,q,Q,h4)}CVT_S_D(J,q){this.clearCause();const Q=d6(this.loadU64(this.fsRegIdx64(q)));let Z=0;switch(Q){case K8:case E6:this.raiseUnimplemented();return;case V6:Z|=o6,this.tempU32[0]=MZ;break;case Y8:this.tempU32[0]=Z4;break;case z8:this.tempU32[0]=X4;break;default:{const X=this.loadF64(this.fsRegIdx64(q));this.tempF32[0]=X;const Y=y6(this.tempU32[0]);if(X!=this.tempF32[0])Z|=y0;if((Y==E6||XJ(Y))&&X!=0)Z|=y0|PZ,this.tempU32[0]=YY(H4,this.control[31]&UZ,X>0);if(!isFinite(this.tempF32[0]))Z|=W9}break}if(this.raiseException(Z))return;this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}CVT_S_W(J,q){this.clearCause();const Q=this.loadS32(this.fsRegIdx32(q));this.tempF32[0]=Q;let Z=0;if(Q!=this.tempF32[0])Z|=y0;if(this.raiseException(Z))return;this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}CVT_S_L(J,q){this.clearCause();const Q=this.loadS64(this.fsRegIdx64(q));if(Q>=1n<<55n||Q<-(1n<<55n)){this.raiseUnimplemented();return}this.tempF32[0]=Number(Q);let Z=0;if(Q!=this.tempF32[0])Z|=y0;if(this.raiseException(Z))return;this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}f32UnaryOp(J,q,Q){this.clearCause();const Z=this.loadF32(this.fsRegIdx32(q)),X=y6(this.loadU32(this.fsRegIdx32(q))),Y=G4(Q,X);let z;switch(Y){case w:this.raiseUnimplemented();return;case _:if(!this.raiseException(o6))this.store32ZeroExtend(this.fdRegIdx32(J),MZ);return;case tJ:if(Z<0){if(!this.raiseException(o6))this.store32ZeroExtend(this.fdRegIdx32(J),MZ);return}z=Math.sqrt(Z);break;case YJ:z=Math.abs(Z);break;case zJ:z=-Z;break;default:throw`unhandled op case: ${Y}`}this.tempF32[0]=z;const K=y6(this.tempU32[0]);let W=0;if(z!=this.tempF32[0])W|=y0;if(l6(K)&&!l6(X))W|=y0|W9;if(!this.raiseException(W))this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}f32BinaryOp(J,q,Q,Z){this.clearCause();const X=this.loadF32(this.fsRegIdx32(q)),Y=this.loadF32(this.ftRegIdx32(Q)),z=this.loadU32(this.fsRegIdx32(q)),K=this.loadU32(this.ftRegIdx32(Q)),W=y6(z),G=y6(K),H=V4(Z,W,G);let j;switch(H){case w:this.raiseUnimplemented();return;case _:if(!this.raiseException(o6))this.store32ZeroExtend(this.fdRegIdx32(J),MZ);return;case n6:if(!this.raiseException(q4)){const U=(z&KJ)==(K&KJ);this.store32ZeroExtend(this.fdRegIdx32(J),U?Z4:X4)}return;case K0:j=X+Y;break;case X0:j=X-Y;break;case E0:j=X*Y;break;case L6:j=X/Y;break;default:throw`unhandled op case: ${H}`}this.tempF32[0]=j;const L=y6(this.tempU32[0]);let V=0;if(j!=this.tempF32[0])V|=y0;if(H==K0||H==X0){if(!XJ(G)&&j==X||!XJ(W)&&j==Y)V|=y0}if(l6(L)&&!l6(W)&&!l6(G))V|=y0|W9;if((L==E6||XJ(L))&&j!=0)V|=y0|PZ,this.tempU32[0]=YY(H4,this.control[31]&UZ,j>0);if(!this.raiseException(V))this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}CVT_D_S(J,q){this.clearCause();let Q=0;switch(y6(this.loadU32(this.fsRegIdx32(q)))){case K8:case E6:this.raiseUnimplemented();return;case V6:Q|=o6,this.tempU64[0]=hZ;break;case Y8:this.tempU64[0]=Y4;break;case z8:this.tempU64[0]=z4;break;default:{const X=this.loadF32(this.fsRegIdx32(q));this.tempF64[0]=X}break}if(this.raiseException(Q))return;this.store64(this.fdRegIdx64(J),this.tempU64[0])}CVT_D_W(J,q){this.clearCause(),this.tempF64[0]=this.loadS32(this.fsRegIdx32(q)),this.store64(this.fdRegIdx64(J),this.tempU64[0])}CVT_D_L(J,q){this.clearCause();const Q=this.loadS64(this.fsRegIdx64(q));if(Q>=1n<<55n||Q<-(1n<<55n)){this.raiseUnimplemented();return}let Z=0;if(this.tempF64[0]=Number(Q),this.raiseException(Z))return;this.store64(this.fdRegIdx64(J),this.tempU64[0])}f64UnaryOp(J,q,Q){this.clearCause();const Z=this.loadF64(this.fsRegIdx64(q)),X=d6(this.loadU64(this.fsRegIdx64(q))),Y=G4(Q,X);let z;switch(Y){case w:this.raiseUnimplemented();return;case _:if(!this.raiseException(o6))this.store64(this.fdRegIdx64(J),hZ);return;case tJ:if(Z<0){if(!this.raiseException(o6))this.store64(this.fdRegIdx64(J),hZ);return}z=Math.sqrt(Z);break;case YJ:z=Math.abs(Z);break;case zJ:z=-Z;break;default:throw`unhandled op case: ${Y}`}this.tempF64[0]=z;const K=d6(this.tempU64[0]);let W=0;if(z!=this.tempF64[0])W|=y0;if(l6(K)&&!l6(X))W|=y0|W9;if(!this.raiseException(W))this.store64(this.fdRegIdx64(J),this.tempU64[0])}f64BinaryOp(J,q,Q,Z){this.clearCause();const X=this.loadF64(this.fsRegIdx64(q)),Y=this.loadF64(this.ftRegIdx64(Q)),z=this.loadU64(this.fsRegIdx64(q)),K=this.loadU64(this.ftRegIdx64(Q)),W=d6(z),G=d6(K),H=V4(Z,W,G);let j;switch(H){case w:this.raiseUnimplemented();return;case _:if(!this.raiseException(o6))this.store64(this.fdRegIdx64(J),hZ);return;case n6:if(!this.raiseException(q4)){const U=(z&WJ)==(K&WJ);this.store64(this.fdRegIdx64(J),U?Y4:z4)}return;case K0:j=X+Y;break;case X0:j=X-Y;break;case E0:j=X*Y;break;case L6:j=X/Y;break;default:throw`unhandled op case: ${H}`}this.tempF64[0]=j;const L=d6(this.tempU64[0]);let V=0;if(H==K0||H==X0){if(!XJ(G)&&j==X||!XJ(W)&&j==Y)V|=y0}if(l6(L)&&!l6(W)&&!l6(G))V|=y0|W9;if((L==E6||XJ(L))&&j!=0)V|=y0|PZ,this.tempU64[0]=YY(CL,this.control[31]&UZ,j>0);if(!this.raiseException(V))this.store64(this.fdRegIdx64(J),this.tempU64[0])}ConvertSToL(J,q,Q){this.clearCause();let Z=0;switch(y6(this.loadU32(this.fsRegIdx32(q)))){case K8:case V6:case E6:case Y8:case z8:this.raiseUnimplemented();return;default:{const Y=this.loadF32(this.fsRegIdx32(q)),z=this.convertUsingMode(Y,Q);if(z>K4||z<W4){this.raiseUnimplemented();return}if(this.tempS64[0]=BigInt(z),Y!=this.tempS64[0])Z|=y0}break}if(this.raiseException(Z))return;this.store64(this.fdRegIdx64(J),this.tempS64[0])}ConvertDToL(J,q,Q){this.clearCause();const Z=d6(this.loadU64(this.fsRegIdx64(q)));let X=0;switch(Z){case K8:case V6:case E6:case Y8:case z8:this.raiseUnimplemented();return;default:{const Y=this.loadF64(this.fsRegIdx64(q)),z=this.convertUsingMode(Y,Q);if(z>K4||z<W4){this.raiseUnimplemented();return}if(this.tempS64[0]=BigInt(z),Y!=this.tempS64[0])X|=y0}break}if(this.raiseException(X))return;this.store64(this.fdRegIdx64(J),this.tempS64[0])}ConvertSToW(J,q,Q){this.clearCause();const Z=y6(this.loadU32(this.fsRegIdx32(q)));let X=0;switch(Z){case K8:case V6:case E6:case Y8:case z8:this.raiseUnimplemented();return;default:{const Y=this.loadF32(this.fsRegIdx32(q)),z=this.convertUsingMode(Y,Q);if(z>F4||z<$4){this.raiseUnimplemented();return}if(this.tempS32[0]=z,Y!=this.tempS32[0])X|=y0}break}if(this.raiseException(X))return;this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}ConvertDToW(J,q,Q){this.clearCause();const Z=d6(this.loadU64(this.fsRegIdx64(q)));let X=0;switch(Z){case K8:case V6:case E6:case Y8:case z8:this.raiseUnimplemented();return;default:{const Y=this.loadF64(this.fsRegIdx64(q)),z=this.convertUsingMode(Y,Q);if(z>F4||z<$4){this.raiseUnimplemented();return}if(this.tempS32[0]=z,Y!=this.tempS32[0])X|=y0}break}if(this.raiseException(X))return;this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}get roundingMode(){switch(this.control[31]&UZ){case FL:return M6;case $L:return T6;case HL:return _6;case GL:return b6}return q0(!1,"unknown rounding mode"),M6}convertUsingMode(J,q){switch(q){case M6:return this.round(J);case T6:return this.trunc(J);case _6:return Math.ceil(J);case b6:return Math.floor(J)}q0(!1,"unknown rounding mode")}round(J){const q=Math.floor(J);if(J-q==0.5){const Z=Math.ceil(J);if(J<0)return Z%2!=0?q:Z;return q%2!=0?Z:q}return Math.round(J)}trunc(J){if(J<0)return Math.ceil(J);return Math.floor(J)}setCondition(J){if(J)this.control[31]|=J4;else this.control[31]&=~J4}get flushSubnormals(){return(this.control[31]&LL)!=0}clearCause(){this.control[31]&=~Q4}raiseException(J){if(!J)return!1;if(J&PZ){if((this.control[31]&(NL|jL))!=0||!this.flushSubnormals)return this.raiseUnimplemented()}const q=hL(J),Q=kL(J),Z=ML(J);return this.setStatusBits(q,Q,Z)}raiseUnimplemented(){return this.control[31]|=eF,this.hardware.cpu0.raiseFPE(),!0}setStatusBits(J,q,Q){if(this.control[31]&J)return this.control[31]|=q,this.hardware.cpu0.raiseFPE(),!0;return this.control[31]|=Q|q,!1}setStatus(J){this.control[31]=J&PL;const q=(J&UL)>>k4,Q=(J&Q4)>>D4;if(q&Q||J&eF)return this.hardware.cpu0.raiseFPE(),!0;return!1}copRegIdx32(J){return this.regIdx32_cop[J]}fdRegIdx32(J){return this.regIdx32_d[J]}fsRegIdx32(J){return this.regIdx32_s[J]}ftRegIdx32(J){return this.regIdx32_t[J]}copRegIdx64(J){return this.regIdx64_cop[J]}fdRegIdx64(J){return this.regIdx64_d[J]}fsRegIdx64(J){return this.regIdx64_s[J]}ftRegIdx64(J){return this.regIdx64_t[J]}store64(J,q){this.regU64[J]=q}store32ZeroExtend(J,q){this.regU32[J]=q|0,this.regU32[J+1]=0}store32(J,q){this.regU32[J]=q|0}loadS32(J){return this.regS32[J]}loadU32(J){return this.regU32[J]}loadF32(J){return this.regF32[J]}loadU64(J){return this.regU64[J]}loadF64(J){return this.regF64[J]}loadS64(J){return this.regS64[J]}dump(){let J="Regs: ";for(let q=0;q<6;+q++)J+=N(this.regS32[q])+", ";h(J),h(`float32: [${this.regF32[0]}, ${this.regF32[1]}, ${this.regF32[2]}, ${this.regF32[3]}, ${this.regF32[4]}, ${this.regF32[5]}, ...]`),h(`float64: [${this.regF64[0]}, ${this.regF64[1]}, ...]`),console.log("")}}var eJ=!0,FJ=!1;function v4(J){J.needsDelayCheck=J.fragment.needsDelayCheck,J.isTrivial=!1;let q="";if(A4)q=Z6(`
      if (c.pc != ${N(J.pc)}) {
        throw 'expected pc ${N(J.pc)}, got ' + c.pc.toString(16);
      }
    `);let Q=q+CU(J);if(J.dump)console.log(Q);if(!J.isTrivial&&J.delayedPCUpdate!==0)J.fragment.bodyCode+=`// Applying delayed pc\nc.pc = ${N(J.delayedPCUpdate)};\n`,J.delayedPCUpdate=0;if(J.fragment.needsDelayCheck=J.needsDelayCheck,J.fragment.bailedOut|=J.bailOut,n64js.getSyncFlow())Q=`if (!n64js.checkSyncState(sync, ${N(J.pc)})) { return ${J.fragment.opsCompiled}; }\n${Q}`;const X=dX(J.pc,J.instruction,!1),Y=EL(Q,"  ");J.fragment.bodyCode+=`// ${X.disassembly}
{
${Y}
}

`}var EL=function(J,q){return Z6(J).split("\n").filter((z)=>z!="").map((z)=>q+z).join("\n")},Z6=function(J){J=J.replace(/^\n/,"");const q=J.match(/^\s+/);if(!q)return J;const Q=q[0];return q?J.replace(new RegExp("^"+Q,"gm"),""):J},$J=function(J){if(!J.startsWith("\n"))J="\n"+J;if(!J.endsWith("\n"))J+="\n";return J},x4=function(J,q,Q){let Z="";if(Z+=q.genAssert(`c.pc === ${N(q.pc)}`,"pc mismatch"),q.needsDelayCheck)Z+=`if (c.delayPC) { c.nextPC = c.delayPC; c.delayPC = 0; } else { c.nextPC = ${N(q.pc+4)}; }\n`,Z+=$J(J),Z+="c.pc = c.nextPC;\n";else if(Q)Z+=q.genAssert("c.delayPC === 0","delay pc should be zero"),Z+=`c.nextPC = ${N(q.pc+4)};\n`,Z+=$J(J),Z+="c.pc = c.nextPC;\n";else Z+=q.genAssert("c.delayPC === 0","delay pc should be zero"),Z+=$J(J),Z+=`c.pc = ${N(q.pc+4)};\n`;return Z},p=function(J,q){let Q="";if(Q+=q.genAssert(`c.pc === ${N(q.pc)}`,"pc mismatch"),q.needsDelayCheck)Q+=`c.nextPC = c.delayPC || ${N(q.pc+4)};\n`;else Q+=q.genAssert("c.delayPC === 0","delay pc should be zero"),Q+=`c.nextPC = ${N(q.pc+4)};\n`;if(Q+="c.branchTarget = 0;\n",Q+=$J(J),Q+="c.pc = c.nextPC;\n",Q+="c.delayPC = c.branchTarget;\n",q.needsDelayCheck=!0,FJ)Q+="c.incrementCount(1);\n";if(q.bailOut)Q+=`return ${q.fragment.opsCompiled};\n`;else Q+=`if (c.stuffToDo) { return ${q.fragment.opsCompiled}; }\n`,Q+=`if (c.pc !== ${N(q.postPC)}) { return ${q.fragment.opsCompiled}; }\n`;return Q},Y0=function(J,q){let Q="";if(Q+=x4(J,q,!0),Q+=q.genAssert("c.delayPC === 0","delay pc should be zero"),q.needsDelayCheck=!1,FJ)Q+="c.incrementCount(1);\n";return q0(!q.bailOut,"Not expecting bailOut to be set for memory access"),Q+=`if (c.stuffToDo) { return ${q.fragment.opsCompiled}; }\n`,Q+=`if (c.pc !== ${N(q.postPC)}) { return ${q.fragment.opsCompiled}; }\n`,Q},n0=function(J,q,Q){let Z="";const X=q.needsDelayCheck||Q||q.postPC!==q.pc+4;if(Z+=x4(J,q,Q),q.needsDelayCheck=!0,FJ)Z+="c.incrementCount(1);\n";if(Z+=q.genAssert("c.stuffToDo === 0","stuffToDo should be zero"),q.bailOut)Z+=`return ${q.fragment.opsCompiled};\n`;else if(X)Z+=`if (c.pc !== ${N(q.postPC)}) { return ${q.fragment.opsCompiled}; }\n`;else Z+="// Skipping pc test\n";return Z},c=function(J,q){let Q="";if(Q+=$J(J),q.isTrivial=!0,FJ)Q+="c.incrementCount(1);\n";if(q.needsDelayCheck)Q+=`if (c.delayPC) { c.pc = c.delayPC; c.delayPC = 0; } else { c.pc = ${N(q.pc+4)}; }\n`,Q+=`if (c.pc !== ${N(q.postPC)}) { return ${q.fragment.opsCompiled}; }\n`;else{Q+=q.genAssert("c.delayPC === 0","delay pc should be zero");const Z=q.pc+4;if(q.postPC!==Z)q0("postPC should always be pc+4 for trival ops?"),Q+=`c.pc = ${N(Z)};\n`,Q+=`if (c.pc !== ${N(q.postPC)}) { return ${q.fragment.opsCompiled}; }\n`;else if(Q+="// Delaying pc update\n",q.delayedPCUpdate=Z,A4)Q+=`c.pc = ${N(Z)};\n`}return Q+=q.genAssert("c.delayPC === 0","delay pc should be zero"),q.needsDelayCheck=!1,Q+=q.genAssert("c.stuffToDo === 0","stuffToDo should be zero"),Q},u4=function(J,q){return c(`// ${J}\n`,q)},g4=function(J){if(J===0)return"0";return`c.getRegU32Lo(${J})`},T8=function(J){if(J===0)return"0n";return`c.getRegS64(${J})`},E8=function(J){if(J===0)return"0n";return`c.getRegU64(${J})`},A=function(J){const q=`throw 'unknown op, pc ${N(J.pc)}, instruction: ${N(J.instruction)}'`;return p(q,J)},TL=function(J){if(J.instruction===0)return u4("NOP",J);const q=`c.execSLL(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return c(q,J)},_L=function(J){const q=`c.execSRL(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return c(q,J)},bL=function(J){const q=`c.execSRA(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return c(q,J)},SL=function(J){const q=`c.execSLLV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},vL=function(J){const q=`c.execSRLV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},xL=function(J){const q=`c.execSRAV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},uL=function(J){const q=`c.execDSLLV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},gL=function(J){const q=`c.execDSRLV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},fL=function(J){const q=`c.execDSRAV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},pL=function(J){const q=`c.execDSLL(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return c(q,J)},mL=function(J){const q=`c.execDSLL32(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return c(q,J)},cL=function(J){const q=`c.execDSRL(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return c(q,J)},oL=function(J){const q=`c.execDSRL32(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return c(q,J)},dL=function(J){const q=`c.execDSRA(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return c(q,J)},lL=function(J){const q=`c.execDSRA32(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return c(q,J)},nL=function(J){return p("c.execRESERVED(0);",J)},aL=function(J){return p("c.execSYSCALL();",J)},rL=function(J){return p("c.execBREAK();",J)},sL=function(J){return p("c.execSYNC();",J)},iL=function(J){const q=`c.execTGE(${J.instr_rt()}, ${J.instr_rs()});`;return p(q,J)},tL=function(J){const q=`c.execTGEU(${J.instr_rt()}, ${J.instr_rs()});`;return p(q,J)},eL=function(J){const q=`c.execTLT(${J.instr_rt()}, ${J.instr_rs()});`;return p(q,J)},J2=function(J){const q=`c.execTLTU(${J.instr_rt()}, ${J.instr_rs()});`;return p(q,J)},q2=function(J){const q=`c.execTEQ(${J.instr_rt()}, ${J.instr_rs()});`;return p(q,J)},Q2=function(J){const q=`c.execTNE(${J.instr_rt()}, ${J.instr_rs()});`;return p(q,J)},Z2=function(J){const q=`c.execMFHI(${J.instr_rd()});`;return c(q,J)},X2=function(J){const q=`c.execMFLO(${J.instr_rd()});`;return c(q,J)},Y2=function(J){const q=`c.execMTHI(${J.instr_rs()});`;return c(q,J)},z2=function(J){const q=`c.execMTLO(${J.instr_rs()});`;return c(q,J)},K2=function(J){const q=`c.execMULT(${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},W2=function(J){const q=`c.execMULTU(${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},F2=function(J){const q=`c.execDMULT(${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},$2=function(J){const q=`c.execDMULTU(${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},H2=function(J){const q=`c.execDIV(${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},G2=function(J){const q=`c.execDIVU(${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},j2=function(J){const q=`c.execDDIV(${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},N2=function(J){const q=`c.execDDIVU(${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},L2=function(J){const q=`c.execADD(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(q,J)},V2=function(J){const q=`c.execDADD(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(q,J)},U2=function(J){const q=`c.execADDU(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},P2=function(J){const q=`c.execDADDU(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},M2=function(J){const q=`c.execSUB(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(q,J)},h2=function(J){const q=`c.execDSUB(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(q,J)},k2=function(J){const q=`c.execSUBU(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},D2=function(J){const q=`c.execDSUBU(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},O2=function(J){const q=`c.execAND(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},I2=function(J){let q;if(J.instr_rt()===0)if(J.instr_rs()===0)q=`c.execCLEAR(${J.instr_rd()});`;else q=`c.execMOV(${J.instr_rd()}, ${J.instr_rs()});`;else q=`c.execOR(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},w2=function(J){const q=`c.execXOR(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},B2=function(J){const q=`c.execNOR(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},A2=function(J){const q=`c.execSLT(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},C2=function(J){const q=`c.execSLTU(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return c(q,J)},R2=function(J){const q=`c.execADDI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return p(q,J)},y2=function(J){const q=`c.execDADDI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return p(q,J)},E2=function(J){const q=`c.execADDI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return c(q,J)},T2=function(J){const q=`c.execDADDIU(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return c(q,J)},_2=function(J){const q=`c.execMFC0(${J.instr_rt()}, ${J.instr_fs()});`;return p(q,J)},b2=function(J){const q=`c.execDMFC0(${J.instr_rt()}, ${J.instr_fs()});`;return p(q,J)},S2=function(J){if(J.instr_fs()===S0)J.fragment.cop1statusKnown=!1;const q=`c.execMTC0(${J.instr_rt()}, ${J.instr_fs()});`;return p(q,J)},v2=function(J){if(J.instr_fs()===S0)J.fragment.cop1statusKnown=!1;const q=`c.execDMTC0(${J.instr_rt()}, ${J.instr_fs()});`;return p(q,J)},x2=function(J){const q=`c.execTLB(${J.instr_tlbop()});`;return p(q,J)},u2=function(J){const q=`c.execMFC2(${J.instr_rt()});`;return p(q,J)},g2=function(J){const q=`c.execDMFC2(${J.instr_rt()});`;return p(q,J)},f2=function(J){const q=`c.execCFC2(${J.instr_rt()});`;return p(q,J)},p2=function(J){const q=`c.execDCFC2(${J.instr_rt()});`;return p(q,J)},m2=function(J){const q=`c.execMTC2(${J.instr_rt()});`;return p(q,J)},c2=function(J){const q=`c.execDMTC2(${J.instr_rt()});`;return p(q,J)},o2=function(J){const q=`c.execCTC2(${J.instr_rt()});`;return p(q,J)},d2=function(J){const q=`c.execDCTC2(${J.instr_rt()});`;return p(q,J)},l2=function(J){const q=h8(J.pc,J.instruction),Q="c.delayPC = "+N(q)+";";return n0(Q,J,!1)},n2=function(J){const q=h8(J.pc,J.instruction),Q=J.nextPC+4,Z=Q&2147483648?-1:0,X=Z6(`
      c.delayPC = ${N(q)};
      c.setRegS64LoHi(${g6}, ${N(Q)}, ${Z});
      `);return n0(X,J,!1)},a2=function(J){const q=J.instr_rs(),Q=J.instr_rd(),Z=J.nextPC+4,X=Z&2147483648?-1:0,Y=Z6(`
      c.delayPC = ${g4(q)};
      c.setRegS64LoHi(${Q}, ${N(Z)}, ${X});
      `);return n0(Y,J,!1)},r2=function(J){const q=`c.delayPC = ${g4(J.instr_rs())};`;return n0(q,J,!1)},s2=function(J){const q=J.instr_rs(),Q=J.instr_rt(),Z=J.instr_offset(),X=l0(J.pc,J.instruction);let Y="";if(q===Q){if(eJ&&Z===-1)Y+="c.speedHack();\n",J.bailOut=!0;Y+=`c.delayPC = ${N(X)};\n`}else{if(Y+=`if (${E8(q)} === ${E8(Q)}) {\n`,eJ&&Z===-1)Y+="  c.speedHack();\n",J.bailOut=!0;Y+=`  c.delayPC = ${N(X)};\n`,Y+="} else {\n",Y+=`  c.delayPC = ${N(J.pc+8)};\n`,Y+="}\n"}return n0(Y,J,!1)},i2=function(J){const q=J.instr_rs(),Q=J.instr_rt(),Z=l0(J.pc,J.instruction),X=Z6(`
      if (${E8(q)} === ${E8(Q)}) {
        c.delayPC = ${N(Z)};
      } else {
        c.nextPC += 4;
      }`);return n0(X,J,!0)},t2=function(J){const q=J.instr_rs(),Q=J.instr_rt(),Z=J.instr_offset(),X=l0(J.pc,J.instruction);let Y="";if(Y+=`if (${E8(q)} !== ${E8(Q)}) {\n`,eJ&&Z===-1)Y+="  c.speedHack();\n",J.bailOut=!0;return Y+=`  c.delayPC = ${N(X)};\n`,Y+="} else {\n",Y+=`  c.delayPC = ${N(J.pc+8)};\n`,Y+="}\n",n0(Y,J,!1)},e2=function(J){const q=J.instr_rs(),Q=J.instr_rt(),Z=l0(J.pc,J.instruction),X=Z6(`
      if (${E8(q)} !== ${E8(Q)}) {
        c.delayPC = ${N(Z)};
      } else {
        c.nextPC += 4;
      }
      `);return n0(X,J,!0)},JV=function(J){const q=J.instr_rs(),Q=l0(J.pc,J.instruction),Z=Z6(`
      if ( ${T8(q)} <= 0n) {
        c.delayPC = ${N(Q)};
      } else {
        c.delayPC = ${N(J.pc+8)};
      }`);return n0(Z,J,!1)},qV=function(J){const q=J.instr_rs(),Q=l0(J.pc,J.instruction),Z=Z6(`
      if ( ${T8(q)} <= 0n) {
        c.delayPC = ${N(Q)};
      } else {
        c.nextPC += 4;
      }`);return n0(Z,J,!1)},QV=function(J){const q=J.instr_rs(),Q=l0(J.pc,J.instruction),Z=Z6(`
      if (${T8(q)} > 0) {
        c.delayPC = ${N(Q)};
      } else {
        c.delayPC = ${N(J.pc+8)};
      }`);return n0(Z,J,!1)},ZV=function(J){const q=J.instr_rs(),Q=l0(J.pc,J.instruction),Z=Z6(`
      if (${T8(q)} > 0) {
        c.delayPC = ${N(Q)};
      } else {
        c.nextPC += 4;
      }`);return n0(Z,J,!1)},XV=function(J){const q=J.instr_rs(),Q=l0(J.pc,J.instruction),Z=Z6(`
      if (${T8(q)} < 0n) {
        c.delayPC = ${N(Q)};
      } else {
        c.delayPC = ${N(J.pc+8)};
      }`);return n0(Z,J,!1)},YV=function(J){const q=J.instr_rs(),Q=l0(J.pc,J.instruction),Z=Z6(`
      if (${T8(q)} < 0n) {
        c.delayPC = ${N(Q)};
      } else {
        c.nextPC += 4;
      }`);return n0(Z,J,!0)},zV=function(J){const q=J.instr_rs(),Q=l0(J.pc,J.instruction),Z=Z6(`
      if (${T8(q)} >= 0n) {
        c.delayPC = ${N(Q)};
      } else {
        c.delayPC = ${N(J.pc+8)};
      }`);return n0(Z,J,!1)},KV=function(J){const q=J.instr_rs(),Q=l0(J.pc,J.instruction),Z=Z6(`
      if (${T8(q)} >= 0n) {
        c.delayPC = ${N(Q)};
      } else {
        c.nextPC += 4;
      }`);return n0(Z,J,!0)},WV=function(J){const q=`c.execBLTZAL(${J.instr_rs()}, ${J.instr_imms()});`;return p(q,J)},FV=function(J){const q=`c.execBGEZAL(${J.instr_rs()}, ${J.instr_imms()});`;return p(q,J)},$V=function(J){const q=`c.execBLTZALL(${J.instr_rs()}, ${J.instr_imms()});`;return p(q,J)},HV=function(J){const q=`c.execBGEZALL(${J.instr_rs()}, ${J.instr_imms()});`;return p(q,J)},GV=function(J){const q=`c.execTGEI(${J.instr_rs()}, ${J.instr_imms()});`;return p(q,J)},jV=function(J){const q=`c.execTGEIU(${J.instr_rs()}, ${J.instr_imms()});`;return p(q,J)},NV=function(J){const q=`c.execTLTI(${J.instr_rs()}, ${J.instr_imms()});`;return p(q,J)},LV=function(J){const q=`c.execTLTIU(${J.instr_rs()}, ${J.instr_imms()});`;return p(q,J)},VV=function(J){const q=`c.execTEQI(${J.instr_rs()}, ${J.instr_imms()});`;return p(q,J)},UV=function(J){const q=`c.execTNEI(${J.instr_rs()}, ${J.instr_imms()});`;return p(q,J)},PV=function(J){const q=`c.execSLTI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return c(q,J)},MV=function(J){const q=`c.execSLTIU(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return c(q,J)},hV=function(J){const q=`c.execANDI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imm()});`;return c(q,J)},kV=function(J){const q=`c.execORI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imm()});`;return c(q,J)},DV=function(J){const q=`c.execXORI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imm()});`;return c(q,J)},OV=function(J){const q=`c.execLUI(${J.instr_rt()}, ${J.instr_imm()});`;return c(q,J)},IV=function(J){const q=`c.execLB(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},wV=function(J){const q=`c.execLBU(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},BV=function(J){const q=`c.execLH(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},AV=function(J){const q=`c.execLHU(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},CV=function(J){const q=`c.execLW(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},RV=function(J){const q=`c.execLWU(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},yV=function(J){const q=`c.execLD(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},EV=function(J){const q=`c.execLWL(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},TV=function(J){const q=`c.execLWR(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},_V=function(J){const q=`c.execLDL(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},bV=function(J){const q=`c.execLDR(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},SV=function(J){J.fragment.usesCop1=!0;const q=`c.execLWC1(${J.instr_ft()}, ${J.instr_base()}, ${J.instr_imms()});`;return p(q,J)},vV=function(J){J.fragment.usesCop1=!0;const q=`c.execLDC1(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return p(q,J)},xV=function(J){const q=`c.execLWC2(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},uV=function(J){const q=`c.execLWC3(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},gV=function(J){const q=`c.execLDC2(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},fV=function(J){const q=`c.execSB(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},pV=function(J){const q=`c.execSH(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},mV=function(J){const q=`c.execSW(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},cV=function(J){const q=`c.execSD(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},oV=function(J){const q=`c.execSWL(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},dV=function(J){const q=`c.execSWR(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},lV=function(J){const q=`c.execSDL(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},nV=function(J){const q=`c.execSDR(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},aV=function(J){J.fragment.usesCop1=!0;const q=`c.execSWC1(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return p(q,J)},rV=function(J){J.fragment.usesCop1=!0;const q=`c.execSDC1(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return p(q,J)},sV=function(J){const q=`c.execSWC2(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},iV=function(J){const q=`c.execSWC3(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},tV=function(J){const q=`c.execSDC2(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},eV=function(J){const q=`c.execLL(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},JU=function(J){const q=`c.execLLD(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},qU=function(J){const q=`c.execSC(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},QU=function(J){const q=`c.execSCD(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return Y0(q,J)},ZU=function(J){if(!n64js.cpu0.ignoreCacheOp(J.instr_rt())){const q=`c.execCACHE(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return c(q,J)}else return u4("CACHE (ignored)",J)},XU=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execMFC1(${J.instr_rt()}, ${J.instr_fs()});`},YU=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execDMFC1(${J.instr_rt()}, ${J.instr_fs()});`},zU=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execMTC1(${J.instr_rt()}, ${J.instr_fs()});`},KU=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execDMTC1(${J.instr_rt()}, ${J.instr_fs()});`},WU=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execCFC1(${J.instr_rt()}, ${J.instr_fs()});`},FU=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execCTC1(${J.instr_rt()}, ${J.instr_fs()});`},$U=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!1,`c.execDCFC1(${J.instr_rt()}, ${J.instr_fs()});`},HU=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!1,`c.execDCTC1(${J.instr_rt()}, ${J.instr_fs()});`},GU=function(J){const q=J.instruction;q0((q>>>18&7)===0,"cc bit is not 0");const Q=(q&65536)!==0,Z=(q&131072)!==0,X=l0(J.pc,q);J.fragment.usesCop1=!0,J.isTrivial=!1;let z=`const cond = (cpu1.control[31] & FPCSR_C) ${Q?"!==":"==="} 0;\n`;if(Z)z+="if (cond) {\n",z+=`  c.branchTarget = ${N(X)};\n`,z+="} else {\n",z+="  c.nextPC += 4;\n",z+="}\n";else z+="if (cond) {\n",z+=`  c.branchTarget = ${N(X)};\n`,z+="} else {\n",z+=`  c.branchTarget = ${N(J.pc+8)};\n`,z+="}\n";return z},jU=function(J){const q=J.instr_fs(),Q=J.instr_ft(),Z=J.instr_fd();J.fragment.usesCop1=!0,J.isTrivial=!1;const X=G6(J.instruction);if(X<48){switch(X){case C4:return`cpu1.ADD_S(${Z}, ${q}, ${Q});`;case R4:return`cpu1.SUB_S(${Z}, ${q}, ${Q});`;case y4:return`cpu1.MUL_S(${Z}, ${q}, ${Q});`;case E4:return`cpu1.DIV_S(${Z}, ${q}, ${Q});`;case T4:return`cpu1.SQRT_S(${Z}, ${q});`;case _4:return`cpu1.ABS_S(${Z}, ${q});`;case b4:return`cpu1.MOV_S(${Z}, ${q});`;case S4:return`cpu1.NEG_S(${Z}, ${q});`;case BZ:return`cpu1.ConvertSToL(${Z}, ${q}, ${M6});`;case AZ:return`cpu1.ConvertSToL(${Z}, ${q}, ${T6});`;case CZ:return`cpu1.ConvertSToL(${Z}, ${q}, ${_6});`;case RZ:return`cpu1.ConvertSToL(${Z}, ${q}, ${b6});`;case yZ:return`cpu1.ConvertSToW(${Z}, ${q}, ${M6});`;case EZ:return`cpu1.ConvertSToW(${Z}, ${q}, ${T6});`;case TZ:return`cpu1.ConvertSToW(${Z}, ${q}, ${_6});`;case _Z:return`cpu1.ConvertSToW(${Z}, ${q}, ${b6});`;case bZ:return"cpu1.raiseUnimplemented();";case SZ:return`cpu1.CVT_D_S(${Z}, ${q});`;case vZ:return`cpu1.ConvertSToW(${Z}, ${q}, cpu1.roundingMode);`;case xZ:return`cpu1.ConvertSToL(${Z}, ${q}, cpu1.roundingMode);`}return`unimplemented(${N(J.pc)},${N(J.instruction)});`}return`cpu1.handleFloatCompareSingle(${X}, ${q}, ${Q});`},NU=function(J){const q=J.instr_fs(),Q=J.instr_ft(),Z=J.instr_fd();J.fragment.usesCop1=!0,J.isTrivial=!1;const X=G6(J.instruction);if(X<48){switch(X){case C4:return`cpu1.ADD_D(${Z}, ${q}, ${Q});`;case R4:return`cpu1.SUB_D(${Z}, ${q}, ${Q});`;case y4:return`cpu1.MUL_D(${Z}, ${q}, ${Q});`;case E4:return`cpu1.DIV_D(${Z}, ${q}, ${Q});`;case T4:return`cpu1.SQRT_D(${Z}, ${q});`;case _4:return`cpu1.ABS_D(${Z}, ${q});`;case b4:return`cpu1.MOV_D(${Z}, ${q});`;case S4:return`cpu1.NEG_D(${Z}, ${q});`;case BZ:return`cpu1.ConvertDToL(${Z}, ${q}, ${M6});`;case AZ:return`cpu1.ConvertDToL(${Z}, ${q}, ${T6});`;case CZ:return`cpu1.ConvertDToL(${Z}, ${q}, ${_6});`;case RZ:return`cpu1.ConvertDToL(${Z}, ${q}, ${b6});`;case yZ:return`cpu1.ConvertDToW(${Z}, ${q}, ${M6});`;case EZ:return`cpu1.ConvertDToW(${Z}, ${q}, ${T6});`;case TZ:return`cpu1.ConvertDToW(${Z}, ${q}, ${_6});`;case _Z:return`cpu1.ConvertDToW(${Z}, ${q}, ${b6});`;case bZ:return`cpu1.CVT_S_D(${Z}, ${q});`;case SZ:return"cpu1.raiseUnimplemented();";case vZ:return`cpu1.ConvertDToW(${Z}, ${q}, cpu1.roundingMode);`;case xZ:return`cpu1.ConvertDToL(${Z}, ${q}, cpu1.roundingMode);`}return`unimplemented(${N(J.pc)},${N(J.instruction)});`}return`cpu1.handleFloatCompareDouble(${X}, ${q}, ${Q});`},LU=function(J){const q=J.instr_fs(),Q=J.instr_fd();switch(J.fragment.usesCop1=!0,J.isTrivial=!1,G6(J.instruction)){case BZ:return"cpu1.raiseUnimplemented();";case AZ:return"cpu1.raiseUnimplemented();";case CZ:return"cpu1.raiseUnimplemented();";case RZ:return"cpu1.raiseUnimplemented();";case yZ:return"cpu1.raiseUnimplemented();";case EZ:return"cpu1.raiseUnimplemented();";case TZ:return"cpu1.raiseUnimplemented();";case _Z:return"cpu1.raiseUnimplemented();";case bZ:return`cpu1.CVT_S_W(${Q}, ${q});`;case SZ:return`cpu1.CVT_D_W(${Q}, ${q});`;case vZ:return"cpu1.raiseUnimplemented();";case xZ:return"cpu1.raiseUnimplemented();"}return`unimplemented(${N(J.pc)},${N(J.instruction)});`},VU=function(J){const q=J.instr_fs(),Q=J.instr_fd();switch(J.fragment.usesCop1=!0,J.isTrivial=!1,G6(J.instruction)){case BZ:return"cpu1.raiseUnimplemented();";case AZ:return"cpu1.raiseUnimplemented();";case CZ:return"cpu1.raiseUnimplemented();";case RZ:return"cpu1.raiseUnimplemented();";case yZ:return"cpu1.raiseUnimplemented();";case EZ:return"cpu1.raiseUnimplemented();";case TZ:return"cpu1.raiseUnimplemented();";case _Z:return"cpu1.raiseUnimplemented();";case bZ:return`cpu1.CVT_S_L(${Q}, ${q});`;case SZ:return`cpu1.CVT_D_L(${Q}, ${q});`;case vZ:return"cpu1.raiseUnimplemented();";case xZ:return"cpu1.raiseUnimplemented();"}return`unimplemented(${N(J.pc)},${N(J.instruction)});`},UU=function(J){const q=IU[H6(J.instruction)],Q=q(J);let Z="";if(J.fragment.usesCop1=!0,J.fragment.cop1statusKnown)Z+=J.genAssert("(c.getControlU32(12) & SR_CU1) !== 0","cop1 should be enabled"),Z+=$J(Q);else return Z+="if( (c.getControlU32(12) & SR_CU1) === 0 ) {\n",Z+=`  n64js.executeCop1_disabled(${N(J.instruction)});\n`,Z+="} else {\n",Z+="  "+$J(Q),Z+="}\n",J.isTrivial=!1,J.fragment.cop1statusKnown=!0,p(Z,J);if(J.isTrivial)return c(Z,J);return p(Z,J)},PU=function(J){return p("c.execBreakpoint();",J)},MU=function(J){if(J.length!=64)throw"Special table is unexpected size.";return J},HY=function(J){if(J.length!=32)throw"Cop table is unexpected size.";return J},hU=function(J){if(J.length!=32)throw"RegImm table is unexpected size.";return J},kU=function(J){if(J.length!=64)throw"Simple table is unexpected size.";return J},CU=function(J){if(yL)return AU[RJ(J.instruction)](J);const q=`n64js.executeOp(${J.instruction});`;return p(q,J)},RU=function(J){return DU[EJ(J.instruction)](J)},yU=function(J){return BU[yJ(J.instruction)](J)},EU=function(J){return OU[H6(J.instruction)](J)},TU=function(J){return wU[H6(J.instruction)](J)},_U=function(J){return p("c.execRESERVED(0);",J)},RL=!1,A4=!1,yL=!0,C4=0,R4=1,y4=2,E4=3,T4=4,_4=5,b4=6,S4=7,BZ=8,AZ=9,CZ=10,RZ=11,yZ=12,EZ=13,TZ=14,_Z=15,bZ=32,SZ=33,vZ=36,xZ=37;class $Y{constructor(){this.fragment=void 0,this.pc=0,this.instruction=0,this.postPC=0,this.bailOut=!1,this.nextPC=0,this.needsDelayCheck=!0,this.isTrivial=!1,this.delayedPCUpdate=0,this.dump=!1}genAssert(J,q){if(RL)return"window.n64jsAssert("+J+', "'+q+'");\n';return""}newFragment(){this.delayedPCUpdate=0}set(J,q,Q,Z,X){this.fragment=J,this.pc=q,this.instruction=Q,this.postPC=Z,this.nextPC=X,this.bailOut=!1,this.needsDelayCheck=!0,this.isTrivial=!1,this.dump=!1}instr_rs(){return y(this.instruction)}instr_rt(){return I(this.instruction)}instr_rd(){return u(this.instruction)}instr_sa(){return J6(this.instruction)}instr_fs(){return W0(this.instruction)}instr_ft(){return f6(this.instruction)}instr_fd(){return J8(this.instruction)}instr_base(){return d(this.instruction)}instr_offset(){return G0(this.instruction)}instr_imms(){return g(this.instruction)}instr_imm(){return q8(this.instruction)}instr_tlbop(){return TJ(this.instruction)}}var DU=MU([TL,A,_L,bL,SL,A,vL,xL,r2,a2,A,A,aL,rL,A,sL,Z2,Y2,X2,z2,uL,A,gL,fL,K2,W2,H2,G2,F2,$2,j2,N2,L2,U2,M2,k2,O2,I2,w2,B2,A,A,A2,C2,V2,P2,h2,D2,iL,tL,eL,J2,q2,A,Q2,A,pL,A,cL,dL,mL,A,oL,lL]),OU=HY([_2,b2,A,A,S2,v2,A,A,A,A,A,A,A,A,A,A,x2,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A]),IU=HY([XU,YU,WU,$U,zU,KU,FU,HU,GU,A,A,A,A,A,A,A,jU,NU,A,A,LU,VU,A,A,A,A,A,A,A,A,A,A]),wU=HY([u2,g2,f2,p2,m2,c2,o2,d2,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A]),BU=hU([XV,zV,YV,KV,A,A,A,A,GV,jV,NV,LV,VV,A,UV,A,WV,FV,$V,HV,A,A,A,A,A,A,A,A,A,A,A,A]),AU=kU([RU,yU,l2,n2,s2,t2,JV,QV,R2,E2,PV,MV,hV,kV,DV,OV,EU,UU,TU,_U,i2,e2,qV,ZV,y2,T2,_V,bV,PU,A,A,nL,IV,BV,EV,CV,wV,AV,TV,RV,fV,pV,oV,mV,lV,nV,dV,ZU,eV,SV,xV,uV,JU,vV,gV,yV,qU,aV,sV,iV,QU,rV,tV,cV]);window.n64jsAssert=(J,q)=>{q0(J,q)};var SU=function(J){const q=J<256?BigInt(J)+256n:(BigInt(J)-256n<<1n)+512n;let Q=1n<<17n,Z=512n;while(Z!=0){while(q*(Q+Z)*(Q+Z)<1n<<44n)Q+=Z;Z>>=1n}return Number(Q>>1n&0xffffn)};function GY(J){if(J==-32768)return 4294901760;else if(J==0)return 2147483647;const q=J>>>0>4294934528?J-1:J,Q=q>>31,Z=q^Q,X=Math.clz32(Z)+1,z=Z<<X>>>23;return(65536|bU[z])<<14>>>32-X^Q}function jY(J){if(J==-32768)return 4294901760;else if(J==0)return 2147483647;const q=J>>>0>4294934528?J-1:J,Q=q>>31,Z=q^Q,X=Math.clz32(Z)+1,z=Z<<X>>>24|(X&1)<<8;return(65536|vU[z])<<14>>>(32-X>>1)^Q}var bU=function(){const J=[];J.push(65535);for(let q=1;q<512;q++){const Q=(1n<<34n)/(BigInt(q)+512n);J.push(Number(Q+1n>>8n&0xffffn))}return J}(),vU=function(){const J=[];for(let q=0;q<512;q++)J.push(SU(q));return J}();function Z$(J){F=new z$(J)}var X$=function(J){return J&63},_8=function(J){return(J&65535)<<16>>16},LY=function(J){return J>>>6&31},j0=function(J){return J>>>11&31},o=function(J){return J>>>16&31},J0=function(J){return J>>>21&31},xU=function(J){return J>>>26&63},uU=function(J){return J>>>21&31},c0=function(J){return J>>>16&31},T0=function(J){return J>>>7&15},gU=function(J){return(J&127)<<25>>25},s=function(J){return J>>>21&15},VY=function(J){return J>>>11&31},i=function(J){return J>>>16&31},Z0=function(J){return J>>>11&31},a=function(J){return J>>>6&31},fU=function(J){return J&67108863},uZ=function(J){return J&65535},Jq=function(J){return uZ(J)<<16>>16},pU=function(J){return J>>>21&31},Y$=function(J,q){return J&4026531840|fU(q)*4},q$=function(J){return J*4},Q$=function(J){return(J-NY)*4},rU=function(J){return aU[X$(J)](J)},b8=function(J){F.disassembleAll(),n64js.halt(`RSP: unknown op, pc: ${Q0(F.pc)}, instruction: ${N(J)}`)},eU=function(J){F.setRegS32(j0(J),F.getRegS32(o(J))<<LY(J))},JP=function(J){F.setRegS32(j0(J),F.getRegS32(o(J))>>>LY(J))},qP=function(J){F.setRegS32(j0(J),F.getRegS32(o(J))>>LY(J))},QP=function(J){F.setRegS32(j0(J),F.getRegS32(o(J))<<(F.getRegS32(J0(J))&31))},ZP=function(J){F.setRegS32(j0(J),F.getRegS32(o(J))>>>(F.getRegS32(J0(J))&31))},XP=function(J){F.setRegS32(j0(J),F.getRegS32(o(J))>>(F.getRegS32(J0(J))&31))},YP=function(J){F.jump(F.getRegS32(J0(J)))},zP=function(J){const q=F.getRegS32(J0(J));F.setRegS32(j0(J),F.nextPC+4),F.jump(q)},KP=function(J){F.halt(cU)},WP=function(J){F.setRegS32(j0(J),F.getRegS32(J0(J))+F.getRegS32(o(J)))},FP=function(J){F.setRegU32(j0(J),F.getRegU32(J0(J))+F.getRegU32(o(J)))},$P=function(J){F.setRegS32(j0(J),F.getRegS32(J0(J))-F.getRegS32(o(J)))},HP=function(J){F.setRegU32(j0(J),F.getRegU32(J0(J))-F.getRegU32(o(J)))},GP=function(J){F.setRegU32(j0(J),F.getRegU32(J0(J))&F.getRegU32(o(J)))},jP=function(J){F.setRegU32(j0(J),F.getRegU32(J0(J))|F.getRegU32(o(J)))},NP=function(J){F.setRegU32(j0(J),F.getRegU32(J0(J))^F.getRegU32(o(J)))},LP=function(J){F.setRegU32(j0(J),~(F.getRegU32(J0(J))|F.getRegU32(o(J))))},VP=function(J){F.setRegS32(j0(J),F.getRegS32(J0(J))<F.getRegS32(o(J))?1:0)},UP=function(J){F.setRegU32(j0(J),F.getRegU32(J0(J))<F.getRegU32(o(J))?1:0)},PP=function(J){F.conditionalBranch(F.getRegS32(J0(J))<0,_8(J))},MP=function(J){F.conditionalBranch(F.getRegS32(J0(J))>=0,_8(J))},hP=function(J){const q=F.getRegS32(J0(J))<0;F.setRegS32(UY,F.nextPC+4),F.conditionalBranch(q,_8(J))},kP=function(J){const q=F.getRegS32(J0(J))>=0;F.setRegS32(UY,F.nextPC+4),F.conditionalBranch(q,_8(J))},DP=function(J){F.setRegU32(o(J),F.moveFromControl(j0(J)))},OP=function(J){F.moveToControl(j0(J),F.getRegU32(o(J)))},IP=function(J){F.setRegS16SignExtend(o(J),F.getVecU16UnalignedWrap(j0(J),T0(J)))},wP=function(J){F.setVecU16UnalignedNoWrap(j0(J),T0(J),F.getRegU32(o(J)))},BP=function(J){let q;switch(j0(J)&3){case 0:q=F.VCO<<16>>16;break;case 1:q=F.VCC<<16>>16;break;case 2:q=F.VCE;break;case 3:q=F.VCE;break}F.setRegU32(o(J),q)},AP=function(J){const q=F.getRegS32(o(J));switch(j0(J)&3){case 0:F.VCO=q;break;case 1:F.VCC=q;break;case 2:F.VCE=q;break;case 3:F.VCE=q;break}},CP=function(J,q,Q,Z){if(J>=0)return(J&~0x7fff_ffffn)!=0?Z:Number(J>>q);return(~J&~0x7fff_ffffn)!=0?Q:Number(J>>q)},RP=function(J,q,Q,Z){if(J>=0)return(J&~0x7fff_ffffn)!=0?Z:Number(J>>q);return Q},K$=function(J){if(J<-32768)return-32768;if(J>32767)return 32767;return J},_0=function(J){const q=Z0(J),Q=i(J);for(let Z=0,X=F.vecSelectU32[s(J)];Z<8;Z++,X>>=4){const Y=F.getVecS16(q,Z),z=F.getVecS16(Q,X&7);F.setAccLow(Z,Y+z)}F.setVecZero(a(J))},yP=function(J){_0(J)},EP=function(J){_0(J)},TP=function(J){_0(J)},_P=function(J){_0(J)},bP=function(J){_0(J)},SP=function(J){_0(J)},vP=function(J){_0(J)},xP=function(J){_0(J)},uP=function(J){_0(J)},gP=function(J){_0(J)},fP=function(J){_0(J)},pP=function(J){_0(J)},mP=function(J){_0(J)},cP=function(J){_0(J)},oP=function(J){_0(J)},dP=function(J){_0(J)},lP=function(J){_0(J)},nP=function(J){_0(J)},aP=function(J){_0(J)},gZ=function(J,q,Q,Z,X){for(let Y=0,z=F.vecSelectU32[Q];Y<8;Y++,z>>=4){const K=F.getVecS16(J,Y),W=F.getVecS16(q,z&7),G=K*W*2+X;F.updateAcc32Signed(Y,G,Z)}},W$=function(J,q,Q,Z){for(let X=0,Y=F.vecSelectU32[Q];X<8;X++,Y>>=4){const z=F.getVecU16(J,X),K=F.getVecU16(q,Y&7),W=z*K>>>16;F.updateAccU32(X,W,Z)}},F$=function(J,q,Q,Z){for(let X=0,Y=F.vecSelectU32[Q];X<8;X++,Y>>=4){const z=F.getVecS16(J,X),K=F.getVecU16(q,Y&7);F.updateAcc32Signed(X,z*K,Z)}},$$=function(J,q,Q,Z){for(let X=0,Y=F.vecSelectU32[Q];X<8;X++,Y>>=4){const z=F.getVecU16(J,X),K=F.getVecS16(q,Y&7);F.updateAcc32Signed(X,z*K,Z)}},H$=function(J,q,Q,Z){for(let X=0,Y=F.vecSelectU32[Q];X<8;X++,Y>>=4){const z=F.getVecS16(J,X),K=F.getVecS16(q,Y&7);F.updateAcc32SignedShift16(X,z*K,Z)}},G$=function(J,q,Q,Z){const X=J&1?16:0;for(let Y=0,z=F.vecSelectU32[Q];Y<8;Y++,z>>=4){const K=F.getAccS48(Y),W=F.getVecS16(q,z&7)<<X,G=Z?K>=0:K<0;F.setAccS48(Y,K+(G?BigInt(W):0n))}},rP=function(J){gZ(Z0(J),i(J),s(J),!1,32768),F.setVecFromAccSignedMid(a(J))},sP=function(J){gZ(Z0(J),i(J),s(J),!1,32768),F.setVecFromAccUnsignedMid(a(J))},iP=function(J){gZ(Z0(J),i(J),s(J),!0,0),F.setVecFromAccSignedMid(a(J))},tP=function(J){gZ(Z0(J),i(J),s(J),!0,0),F.setVecFromAccUnsignedMid(a(J))},eP=function(J){G$(Z0(J),i(J),s(J),!1),F.setVecFromAccSignedMid(a(J))},J1=function(J){G$(Z0(J),i(J),s(J),!0),F.setVecFromAccSignedMid(a(J))},q1=function(J){W$(Z0(J),i(J),s(J),!1),F.setVecFromAccLow(a(J))},Q1=function(J){W$(Z0(J),i(J),s(J),!0),F.setVecFromAccSignedLow(a(J))},Z1=function(J){F$(Z0(J),i(J),s(J),!1),F.setVecFromAccMid(a(J))},X1=function(J){F$(Z0(J),i(J),s(J),!0),F.setVecFromAccSignedMid(a(J))},Y1=function(J){$$(Z0(J),i(J),s(J),!1),F.setVecFromAccLow(a(J))},z1=function(J){$$(Z0(J),i(J),s(J),!0),F.setVecFromAccSignedLow(a(J))},K1=function(J){H$(Z0(J),i(J),s(J),!1),F.setVecFromAccSignedMid(a(J))},W1=function(J){H$(Z0(J),i(J),s(J),!0),F.setVecFromAccSignedMid(a(J))},F1=function(J){const q=Z0(J),Q=i(J);for(let Z=0,X=F.vecSelectU32[s(J)];Z<8;Z++,X>>=4){const Y=F.getVecS16(q,Z),z=F.getVecS16(Q,X&7),K=BigInt(Y*z)<<16n;F.setAccS48(Z,K+(K<0?0x1f0000n:0n))}F.setVecFromAccOddified(a(J))},$1=function(J){for(let q=0;q<8;q++){const Q=F.getAccS48(q);let Z=0n;if((Q&0x20_0000n)==0){const X=Q>>22n;if(X<0)Z=0x20_0000n;else if(X>0)Z=-0x20_0000n}F.setAccS48(q,Q+Z)}F.setVecFromAccOddified(a(J))},H1=function(J){const q=Z0(J),Q=i(J),Z=F.VCO,X=F.vecTemp;for(let Y=0,z=F.vecSelectU32[s(J)];Y<8;Y++,z>>=4){const K=F.getVecS16(q,Y),W=F.getVecS16(Q,z&7),G=Z>>Y&1,H=K+W+G;F.setAccLow(Y,H),X.setInt16(Y*2,K$(H))}F.setVecFromTemp(a(J)),F.VCO=0},G1=function(J){const q=Z0(J),Q=i(J),Z=F.VCO,X=F.vecTemp;for(let Y=0,z=F.vecSelectU32[s(J)];Y<8;Y++,z>>=4){const K=F.getVecS16(q,Y),W=F.getVecS16(Q,z&7),G=Z>>Y&1,H=K-(W+G);F.setAccLow(Y,H),X.setInt16(Y*2,K$(H))}F.setVecFromTemp(a(J)),F.VCO=0},j1=function(J,q){if(J<0)return-q;if(J>0)return q;return 0},N1=function(J){const q=Z0(J),Q=i(J),Z=F.vecTemp;for(let X=0,Y=F.vecSelectU32[s(J)];X<8;X++,Y>>=4){const z=F.getVecS16(q,X),K=F.getVecU16(Q,Y&7),W=z<0&&K==32768,G=j1(z,K);F.setAccLow(X,W?32768:G),Z.setInt16(X*2,W?32767:G)}F.setVecFromTemp(a(J))},L1=function(J){const q=Z0(J),Q=i(J);let Z=0;for(let X=0,Y=F.vecSelectU32[s(J)];X<8;X++,Y>>=4){const z=F.getVecU16(q,X),K=F.getVecU16(Q,Y&7),W=z+K;F.setAccLow(X,W),Z|=W&~65535?1<<X:0}F.setVecFromAccLow(a(J)),F.VCO=Z},V1=function(J){const q=Z0(J),Q=i(J);let Z=0;for(let X=0,Y=F.vecSelectU32[s(J)];X<8;X++,Y>>=4){const z=F.getVecU16(q,X),K=F.getVecU16(Q,Y&7),W=z-K;F.setAccLow(X,W),Z|=W!=0?1<<X+8:0,Z|=W<0?1<<X+0:0}F.setVecFromAccLow(a(J)),F.VCO=Z},h1=function(J){let q=64n;switch(s(J)){case U1:q=32n;break;case P1:q=16n;break;case M1:q=0n;break}const Q=a(J);for(let Z=0;Z<8;Z++)F.setVecS16(Q,Z,Number(F.vAcc[Z]>>q))},k1=function(J){const q=Z0(J),Q=i(J),Z=F.VCO;let X=0,Y=0;for(let z=0,K=F.vecSelectU32[s(J)];z<8;z++,K>>=4){const W=F.getVecS16(q,z),G=F.getVecS16(Q,K&7),H=1<<z,j=(Z&H)!=0,L=(Z&H<<8)!=0,V=j&&L,U=W<G||W==G&&V,M=U?W:G;X|=U?H:0,F.setAccLow(z,M)}F.setVecFromAccLow(a(J)),F.setVCCHiLo(Y,X),F.VCO=0},D1=function(J){const q=Z0(J),Q=i(J),Z=F.VCO;let X=0,Y=0;for(let z=0,K=F.vecSelectU32[s(J)];z<8;z++,K>>=4){const W=F.getVecS16(q,z),G=F.getVecS16(Q,K&7),H=1<<z,j=(Z&H<<8)!=0,L=W==G&&!j,V=G;X|=L?H:0,F.setAccLow(z,V)}F.setVecFromAccLow(a(J)),F.setVCCHiLo(Y,X),F.VCO=0},O1=function(J){const q=Z0(J),Q=i(J),Z=F.VCO;let X=0,Y=0;for(let z=0,K=F.vecSelectU32[s(J)];z<8;z++,K>>=4){const W=F.getVecS16(q,z),G=F.getVecS16(Q,K&7),H=1<<z,j=(Z&H<<8)!=0,L=W!=G||j,V=W;X|=L?H:0,F.setAccLow(z,V)}F.setVecFromAccLow(a(J)),F.VCC=Y<<8|X,F.setVCCHiLo(Y,X),F.VCO=0},I1=function(J){const q=Z0(J),Q=i(J),Z=F.VCO;let X=0,Y=0;for(let z=0,K=F.vecSelectU32[s(J)];z<8;z++,K>>=4){const W=F.getVecS16(q,z),G=F.getVecS16(Q,K&7),H=1<<z,j=(Z&H)!=0,L=(Z&H<<8)!=0,V=j&&L,U=W>G||W==G&&!V,M=U?W:G;X|=U?H:0,F.setAccLow(z,M)}F.setVecFromAccLow(a(J)),F.setVCCHiLo(Y,X),F.VCO=0},w1=function(J){const q=Z0(J),Q=i(J),Z=F.VCCHi,X=F.VCCLo,Y=F.VCE,z=F.VCOHi,K=F.VCOLo;let W=0,G=0;for(let H=0,j=F.vecSelectU32[s(J)];H<8;H++,j>>=4){const L=F.getVecU16(q,H),V=F.getVecU16(Q,j&7);let U=X>>H&1,M=Z>>H&1;const k=Y>>H&1,O=~(z>>H)&1,R=K>>H&1;let S;if(R){if(O){const T=L+V&65535,b=L+V>65535;U=!k&&(!T&&!b)||k&&(!T||!b)}S=U?-V:L}else{if(O)M=L-V>=0;S=M?V:L}F.setAccLow(H,S),W|=M<<H,G|=U<<H}F.setVecFromAccLow(a(J)),F.setVCCHiLo(W,G),F.VCO=0,F.VCE=0},B1=function(J){const q=Z0(J),Q=i(J);let Z=0,X=0,Y=0,z=0,K=0;for(let W=0,G=F.vecSelectU32[s(J)];W<8;W++,G>>=4){const H=F.getVecS16(q,W),j=F.getVecS16(Q,G&7);let L,V,U,M,k;const O=(H^j)<0;if(O){const R=H+j<<16>>16;V=j<0,L=R<=0,U=R==-1,M=R!=0&&H!=~j,k=L?-j:H}else{const R=H-j<<16>>16;L=j<0,V=R>=0,U=0,M=R!=0,k=V?j:H}F.setAccLow(W,k),Z|=V<<W,X|=L<<W,Y|=M<<W,z|=O<<W,K|=U<<W}F.setVecFromAccLow(a(J)),F.setVCCHiLo(Z,X),F.setVCOHiLo(Y,z),F.VCE=K},A1=function(J){const q=Z0(J),Q=i(J);let Z=0,X=0;for(let Y=0,z=F.vecSelectU32[s(J)];Y<8;Y++,z>>=4){const K=F.getVecS16(q,Y),W=F.getVecS16(Q,z&7);let G,H,j;if((K^W)<0)H=W<0,G=K+W+1<=0,j=G?~W:K;else G=W<0,H=K-W>=0,j=H?W:K;X|=G<<Y,Z|=H<<Y,F.setAccLow(Y,j)}F.setVecFromAccLow(a(J)),F.setVCCHiLo(Z,X),F.VCO=0,F.VCE=0},C1=function(J){const q=Z0(J),Q=i(J);let Z=F.VCC;for(let X=0,Y=F.vecSelectU32[s(J)];X<8;X++,Z>>=1,Y>>=4){const z=F.getVecU16(q,X),K=F.getVecU16(Q,Y&7),W=Z&1?z:K;F.setAccLow(X,W)}F.setVecFromAccLow(a(J)),F.VCO=0},R1=function(J){qq(J,(q,Q)=>q&Q)},y1=function(J){qq(J,(q,Q)=>~(q&Q))},E1=function(J){qq(J,(q,Q)=>q|Q)},T1=function(J){qq(J,(q,Q)=>~(q|Q))},_1=function(J){qq(J,(q,Q)=>q^Q)},b1=function(J){qq(J,(q,Q)=>~(q^Q))},qq=function(J,q){const Q=Z0(J),Z=i(J);for(let X=0,Y=F.vecSelectU32[s(J)];X<8;X++,Y>>=4){const z=F.getVecU16(Q,X),K=F.getVecU16(Z,Y&7);F.setAccLow(X,q(z,K))}F.setVecFromAccLow(a(J))},S1=function(J){const q=i(J),Q=a(J),Z=VY(J)&7,X=F.vecSelectU32[s(J)];for(let Y=0,z=X;Y<8;Y++,z>>=4){const K=F.getVecS16(q,z&7);F.setAccLow(Y,K)}F.setVecS16(Q,Z&7,F.getVecS16(q,X>>4*Z&7))},j$=function(J,q){for(let Q=0,Z=F.vecSelectU32[q];Q<8;Q++,Z>>=4){const X=F.getVecS16(J,Z&7);F.setAccLow(Q,X)}},N$=function(J){const q=i(J),Q=s(J);j$(q,Q),F.divDP=!0,F.divIn=F.getVecS16(q,Q&7),F.setVecS16(a(J),VY(J)&7,F.divOut)},fZ=function(J,q,Q){const Z=i(J),X=s(J),Y=F.getVecS16(Z,X&7),z=Q&&F.divDP?F.divIn<<16|Y&65535:Y;j$(Z,X);const K=q(z);F.divDP=!1,F.divOut=K>>16,F.setVecS16(a(J),VY(J)&7,K&65535)},v1=function(J){fZ(J,GY,!1)},x1=function(J){fZ(J,GY,!0)},u1=function(J){N$(J)},g1=function(J){fZ(J,jY,!1)},f1=function(J){fZ(J,jY,!0)},p1=function(J){N$(J)},m1=function(J){},c1=function(J){},o1=function(J){F.jump(Y$(F.pc,J))},d1=function(J){F.setRegS32(UY,F.nextPC+4),F.jump(Y$(F.pc,J))},l1=function(J){F.conditionalBranch(F.getRegS32(J0(J))===F.getRegS32(o(J)),_8(J))},n1=function(J){F.conditionalBranch(F.getRegS32(J0(J))!==F.getRegS32(o(J)),_8(J))},a1=function(J){F.conditionalBranch(F.getRegS32(J0(J))<=0,_8(J))},r1=function(J){F.conditionalBranch(F.getRegS32(J0(J))>0,_8(J))},s1=function(J){F.setRegS32(o(J),F.getRegS32(J0(J))+Jq(J))},i1=function(J){F.setRegS32(o(J),F.getRegS32(J0(J))+Jq(J))},t1=function(J){F.setRegS32(o(J),F.getRegS32(J0(J))<Jq(J)?1:0)},e1=function(J){F.setRegS32(o(J),F.getRegU32(J0(J))<Jq(J)>>>0?1:0)},JM=function(J){F.setRegS32(o(J),F.getRegS32(J0(J))&uZ(J))},qM=function(J){F.setRegS32(o(J),F.getRegS32(J0(J))|uZ(J))},QM=function(J){F.setRegS32(o(J),F.getRegS32(J0(J))^uZ(J))},ZM=function(J){F.setRegS32(o(J),Jq(J)<<16)},XM=function(J){F.setRegS32(o(J),F.loadS8(F.calcAddress(J)))},YM=function(J){F.setRegU32(o(J),F.loadU8(F.calcAddress(J)))},zM=function(J){F.setRegS32(o(J),F.loadS16(F.calcAddress(J)))},KM=function(J){F.setRegU32(o(J),F.loadU16(F.calcAddress(J)))},WM=function(J){F.setRegS32(o(J),F.loadS32(F.calcAddress(J)))},FM=function(J){F.setRegU32(o(J),F.loadU32(F.calcAddress(J)))},$M=function(J){F.store8(F.calcAddress(J),F.getRegS32(o(J)))},HM=function(J){F.store16(F.calcAddress(J),F.getRegS32(o(J)))},GM=function(J){F.store32(F.calcAddress(J),F.getRegS32(o(J)))},pZ=function(J,q){const Q=F.calcVecAddress(J,q),Z=c0(J),X=T0(J),Y=16-X<q?16-X:q;for(let z=0;z<Y;z++)F.setVecS8(Z,X+z,F.loadS8(Q+z))},mZ=function(J,q){const Q=F.calcVecAddress(J,q),Z=c0(J),X=T0(J);for(let Y=0;Y<q;Y++)F.store8(Q+Y,F.getVecS8(Z,X+Y&15))},jM=function(J){pZ(J,1)},NM=function(J){pZ(J,2)},LM=function(J){pZ(J,4)},VM=function(J){pZ(J,8)},UM=function(J){const q=F.calcVecAddress(J,16),Q=(q&4080)+16,Z=c0(J),X=T0(J),Y=Math.min(Q-q,16-X);for(let z=0;z<Y;z++)F.setVecS8(Z,X+z,F.loadU8(q+z))},PM=function(J){const q=F.calcVecAddress(J,16),Q=q&4080,Z=c0(J),X=T0(J),Y=q&15,z=16-Y+X,K=Math.min(Y,16-z);for(let W=0;W<K;W++)F.setVecS8(Z,z+W,F.loadU8(Q+W))},PY=function(J,q,Q,Z,X){const Y=J&7,z=J&4088;for(let K=0;K<8;K++){const W=16-Q+K*X+Y&15;F.setVecS16(q,K,F.loadU8(z+W)<<Z)}},MM=function(J){PY(F.calcVecAddress(J,8),c0(J),T0(J),8,1)},hM=function(J){PY(F.calcVecAddress(J,8),c0(J),T0(J),7,1)},kM=function(J){PY(F.calcVecAddress(J,16),c0(J),T0(J),7,2)},DM=function(J){const q=F.calcVecAddress(J,16),Q=c0(J),Z=T0(J),X=q&7,Y=q&4088,z=F.vecTemp;z.setInt16(0,F.loadU8(Y+(X+0-Z&15))<<7,!1),z.setInt16(2,F.loadU8(Y+(X+4-Z&15))<<7,!1),z.setInt16(4,F.loadU8(Y+(X+8-Z&15))<<7,!1),z.setInt16(6,F.loadU8(Y+(X+12-Z&15))<<7,!1),z.setInt16(8,F.loadU8(Y+(X+8-Z&15))<<7,!1),z.setInt16(10,F.loadU8(Y+(X+12-Z&15))<<7,!1),z.setInt16(12,F.loadU8(Y+(X+0-Z&15))<<7,!1),z.setInt16(14,F.loadU8(Y+(X+4-Z&15))<<7,!1);const K=Math.min(8,16-Z);for(let W=Z,G=Z+K;W<G;W++)F.setVecS8(Q,W,z.getInt8(W,!1))},OM=function(J){},IM=function(J){const q=F.calcVecAddress(J,16),Q=c0(J),Z=T0(J),X=Q&~7,Y=Z>>1,z=q&~7,K=(q&8)+Z;for(let W=0;W<8;W++){const G=Y+W&7;F.setVecS8(X+G,W*2+0,F.loadU8(z+(K+W*2+0&15))),F.setVecS8(X+G,W*2+1,F.loadU8(z+(K+W*2+1&15)))}},wM=function(J){mZ(J,1)},BM=function(J){mZ(J,2)},AM=function(J){mZ(J,4)},CM=function(J){mZ(J,8)},RM=function(J){const q=F.calcVecAddress(J,16),Q=(q&4080)+16,Z=c0(J),X=T0(J);let Y=Q-q;for(let z=0;z<Y;z++)F.store8(q+z,F.getVecS8(Z,X+z&15))},yM=function(J){const q=F.calcVecAddress(J,16),Q=q&4080,Z=c0(J),X=T0(J),Y=q&15,z=16-Y+X,K=Y;for(let W=0;W<K;W++)F.store8(Q+W,F.getVecS8(Z,z+W&15))},EM=function(J){const q=F.calcVecAddress(J,8),Q=c0(J),Z=T0(J);for(let X=0;X<8;X++){const Y=Z+X,z=Y&8?7:8,K=F.getVecS16(Q,Y&7)>>>z;F.store8(q+X,K)}},TM=function(J){const q=F.calcVecAddress(J,8),Q=c0(J),Z=T0(J);for(let X=0;X<8;X++){const Y=Z+X,z=Y&8?8:7,K=F.getVecS16(Q,Y&7)>>>z;F.store8(q+X,K)}},_M=function(J){const q=F.calcVecAddress(J,16),Q=c0(J),Z=T0(J),X=q&7,Y=q-X;for(let z=0;z<8;z++){const K=Z+z*2,W=X+z*2&15,G=F.getVecU16UnalignedWrap(Q,K)>>>7;F.store8(Y+W,G)}},SM=function(J){const q=F.calcVecAddress(J,16),Q=c0(J),Z=T0(J),X=q&7,Y=q-X,z=bM.get(Z);if(z)for(let K=0;K<4;K++){const W=X+K*4&15;F.store8(Y+W,F.getVecU16(Q,z[K])>>>7)}else for(let K=0;K<4;K++){const W=X+K*4&15;F.store8(Y+W,0)}},vM=function(J){const q=F.calcVecAddress(J,16),Q=c0(J),Z=T0(J),X=q&7,Y=q-X;for(let z=0;z<16;z++){const K=Z+z&15,W=X+z&15;F.store8(Y+W,F.getVecS8(Q,K))}},xM=function(J){const q=F.calcVecAddress(J,16),Q=c0(J),Z=T0(J),X=q&4088,Y=q&15,z=q&8,K=Q&~7,W=Z-(q&8)>>1;for(let G=0;G<16;G++){const H=X+(Y+G&15),j=K+(W+(G>>1)&7),L=z+G&15;F.store8(H,F.getVecS8(j,L))}};window.n64js=window.n64js||{};var F,UY=31,f4=0,p4=1,m4=2,c4=3,o4=4,d4=5,l4=6,n4=7,NY=8,a4=9,r4=10,s4=11,i4=12,t4=13,e4=14,J$=15;var mU=1,cU=2;class z${constructor(J){this.hardware=J,this.dmem=J.sp_mem.subRegion(0,4096),this.imem=J.sp_mem.subRegion(4096,4096),this.halted=!0,this.runEvent=null,this.pcDataView=J.sp_ibist_mem.dataView,this.pc=0,this.delayPC=0,this.nextPC=0,this.branchTarget=0;const q=new ArrayBuffer(128);this.gprU32=new Uint32Array(q),this.gprS32=new Int32Array(q);const Q=new ArrayBuffer(512);this.vpr=new DataView(Q),this.vprS16=new Int16Array(Q),this.vprS8=new Int8Array(Q),this.vprU64=new BigUint64Array(Q);const Z=new ArrayBuffer(64);this.vAcc=new BigInt64Array(Z),this.vAccS32=new Int32Array(Z),this.vAccU32=new Uint32Array(Z),this.vAccS16=new Int16Array(Z),this.vAccU16=new Uint16Array(Z),this.vuVCOReg=new Uint16Array(new ArrayBuffer(2)),this.vuVCCReg=new Uint16Array(new ArrayBuffer(2)),this.vuVCEReg=new Uint8Array(new ArrayBuffer(1)),this.divDP=!1,this.divIn=0,this.divOut=0,this.vecSelectU32=new Uint32Array(new ArrayBuffer(64)),this.vecSelectU32[0]=1985229328,this.vecSelectU32[1]=1985229328,this.vecSelectU32[2]=1715741184,this.vecSelectU32[3]=2002072337,this.vecSelectU32[4]=1145307136,this.vecSelectU32[5]=1431638289,this.vecSelectU32[6]=1717969442,this.vecSelectU32[7]=2004300595,this.vecSelectU32[8]=0,this.vecSelectU32[9]=286331153,this.vecSelectU32[10]=572662306,this.vecSelectU32[11]=858993459,this.vecSelectU32[12]=1145324612,this.vecSelectU32[13]=1431655765,this.vecSelectU32[14]=1717986918,this.vecSelectU32[15]=2004318071;const X=new ArrayBuffer(128);this.vecTemp=new DataView(X),this.vecTempU64=new BigUint64Array(X),this.reset()}reset(){this.halted=!0,this.runEvent=null,this.pc=0,this.delayPC=0,this.nextPC=0,this.branchTarget=0;for(let J=0;J<32;++J){this.gprS32[J]=0;for(let q=0;q<8;q++)this.vprS16[J*8+q]=0}this.vAcc[0]=0n,this.vuVCOReg[0]=0,this.vuVCCReg[0]=0,this.vuVCEReg[0]=0,this.divDP=!1,this.divIn=0,this.divOut=0}getRegS32(J){return this.gprS32[J]}getRegU32(J){return this.gprU32[J]}setRegS32(J,q){if(J!=0)this.gprS32[J]=q}setRegU32(J,q){if(J!=0)this.gprU32[J]=q}setRegS16SignExtend(J,q){if(J!=0)this.gprS32[J]=q<<16>>16}getAccS48(J){return this.vAcc[J]}setAccS48(J,q){this.vAcc[J]=BigInt.asIntN(48,q)}updateAcc32Signed(J,q,Q){if(Q)this.setAccS48(J,this.vAcc[J]+BigInt(q));else this.vAccS32[J*2+1]=q>=0?0:4294967295,this.vAccS32[J*2+0]=q}updateAccU32(J,q,Q){if(Q)this.setAccS48(J,this.vAcc[J]+BigInt(q));else this.vAccU32[J*2+1]=0,this.vAccU32[J*2+0]=q}updateAcc32SignedShift16(J,q,Q){if(Q)this.setAccS48(J,this.vAcc[J]+(BigInt(q)<<16n));else this.vAccS32[J*2+1]=q>>16,this.vAccS32[J*2+0]=q<<16}setAccLow(J,q){this.vAccS16[J*4+0]=q}getAccLow(J){return this.vAccS16[J*4+0]}setAccMid(J,q){this.vAccS16[J*4+1]=q}getAccMid(J){return this.vAccS16[J*4+1]}setAccHigh(J,q){this.vAccS16[J*4+2]=q}getAccHigh(J){return this.vAccS16[J*4+2]}getAccHighMid(J){return this.vAccS16[J*4+2]<<16|this.vAccU16[J*4+1]}setVecFromAccSignedMid(J){for(let q=0;q<8;q++){const Q=this.getAccHighMid(q);let Z;if(Q>=0)Z=Q&4294934528?32767:Q;else Z=~Q&4294934528?32768:Q;this.setVecS16(J,q,Z)}}setVecFromAccSignedLow(J){for(let q=0;q<8;q++){const Q=this.getAccHighMid(q),Z=this.getAccLow(q);let X;if(Q>=0)X=Q&4294934528?65535:Z;else X=~Q&4294934528?0:Z;this.setVecS16(J,q,X)}}setVecFromAccOddified(J){for(let q=0;q<8;q++)this.setVecS16(J,q,CP(this.vAcc[q]>>1n,16n,32768,32767)&65520)}setVecFromAccUnsignedMid(J){for(let q=0;q<8;q++)this.setVecS16(J,q,RP(this.vAcc[q],16n,0,65535))}setVecFromAccMid(J){for(let q=0;q<8;q++)this.setVecS16(J,q,this.getAccMid(q))}setVecFromAccLow(J){for(let q=0;q<8;q++)this.setVecS16(J,q,this.getAccLow(q))}get VCO(){return this.vuVCOReg[0]}get VCOHi(){return this.vuVCOReg[0]>>>8&255}get VCOLo(){return this.vuVCOReg[0]>>>0&255}get VCC(){return this.vuVCCReg[0]}get VCCHi(){return this.vuVCCReg[0]>>>8&255}get VCCLo(){return this.vuVCCReg[0]>>>0&255}get VCE(){return this.vuVCEReg[0]}set VCO(J){this.vuVCOReg[0]=J}set VCC(J){this.vuVCCReg[0]=J}set VCE(J){this.vuVCEReg[0]=J}setVCOHiLo(J,q){this.vuVCOReg[0]=J<<8|q}setVCCHiLo(J,q){this.vuVCCReg[0]=J<<8|q}getVecS16(J,q){return this.vpr.getInt16(16*J+q*2,!1)}getVecU16(J,q){return this.vpr.getUint16(16*J+q*2,!1)}getVecS8(J,q){return this.vpr.getInt8(16*J+q,!1)}getVecU8(J,q){return this.vpr.getUint8(16*J+q,!1)}setVecZero(J){this.vprU64[J*2+0]=0n,this.vprU64[J*2+1]=0n}setVecFromTemp(J){this.vprU64[J*2+0]=this.vecTempU64[0],this.vprU64[J*2+1]=this.vecTempU64[1]}setVecS16(J,q,Q){this.vpr.setInt16(16*J+q*2,Q,!1)}setVecS8(J,q,Q){this.vpr.setInt8(16*J+q,Q,!1)}getVecU16UnalignedWrap(J,q){const Q=this.getVecU8(J,q&15),Z=this.getVecU8(J,q+1&15);return Q<<8|Z}setVecU16UnalignedNoWrap(J,q,Q){if(this.setVecS8(J,q+0,Q>>8),q<15)this.setVecS8(J,q+1,Q)}sprintVecReg(J){let q=[];for(let Q=0;Q<8;Q++)q.push(Q0(this.getVecS16(J,Q)));return`V${J}: [${q.join(", ")}]`}loadU8(J){return this.dmem.getU8(J&4095)}loadU16(J){return J<=4094?this.dmem.getU16(J):this.loadU16Wrapped(J)}loadU32(J){return J<=4092?this.dmem.getU32(J):this.loadU32Wrapped(J)}loadS8(J){return this.dmem.getS8(J&4095)}loadS16(J){return J<=4094?this.dmem.getS16(J):this.loadS16Wrapped(J)}loadS32(J){return J<=4092?this.dmem.getS32(J):this.loadS32Wrapped(J)}store8(J,q){return this.dmem.set8(J&4095,q)}store16(J,q){return J<=4094?this.dmem.set16(J,q):this.store16Wrapped(J,q)}store32(J,q){return J<=4092?this.dmem.set32(J,q):this.store32Wrapped(J,q)}store32masked(J,q,Q){const X=this.loadU32(J,!1)&~Q|q&Q;this.store32(J,X)}loadU16Wrapped(J){return(this.loadU8(J+0)<<8|this.loadU8(J+1)<<0)>>>0}loadS16Wrapped(J){return this.loadU16Wrapped(J)<<16>>16}loadU32Wrapped(J){return(this.loadU8(J+0)<<24|this.loadU8(J+1)<<16|this.loadU8(J+2)<<8|this.loadU8(J+3)<<0)>>>0}loadS32Wrapped(J){return this.loadU32Wrapped(J)>>0}store16Wrapped(J,q){this.store8(J+0,q>>>8),this.store8(J+1,q>>>0)}store32Wrapped(J,q){this.store8(J+0,q>>>24),this.store8(J+1,q>>>16),this.store8(J+2,q>>>8),this.store8(J+3,q>>>0)}calcDebuggerAddress(J){return this.calcAddress(J)+2751463424}calcAddress(J){return this.getRegS32(pU(J))+Jq(J)&4095}calcVecAddress(J,q){return this.getRegS32(uU(J))+gU(J)*q&4095}conditionalBranch(J,q){const Q=J?q*4:4;this.branchTarget=this.pc+4+Q&4092}jump(J){this.branchTarget=J>>>0&4092}get pc(){return this.pcDataView.getInt32(0,!1)}set pc(J){this.pcDataView.setUint32(0,J,!1)}unhalt(){if(this.halted=!1,this.runEvent)this.runEvent.stop();this.runEvent=this.hardware.timeline.startEvent("RSP")}step(){if(this.halted)return;this.nextPC=this.delayPC||this.pc+4&4092;const J=this.imem.getU32(this.pc);this.branchTarget=0,this.executeOp(J),this.pc=this.nextPC,this.delayPC=this.branchTarget}halt(J){if(this.hardware.spRegDevice.setStatusBits(J|mU),this.halted=!0,this.runEvent)this.runEvent.stop(),this.runEvent=null}disassembleAll(){const J=t9(this.imem,0,4096);for(let q of J)console.log(`${v(q.address,16)} ${q.disassembly}`)}disassembleOp(J,q){const Q=lq(J,q);console.log(`${v(Q.address,16)} ${Q.disassembly}`)}executeOp(J){tU[xU(J)](J)}moveFromControl(J){switch(J){case f4:case p4:case m4:case c4:case o4:case d4:case l4:case n4:return this.hardware.spRegDevice.readRegU32(q$(J));case NY:case a4:case r4:case s4:case i4:case t4:case e4:case J$:return this.hardware.dpcDevice.readRegU32(Q$(J))}return console.log(`MFC0: ${J} unhandled - returning 0`),0}moveToControl(J,q){switch(J){case f4:case p4:case m4:case c4:case o4:case d4:case l4:case n4:this.hardware.spRegDevice.writeReg32(q$(J),q);break;case NY:case a4:case r4:case s4:case i4:case t4:case e4:case J$:this.hardware.dpcDevice.writeReg32(Q$(J),q);break;default:console.log(`Unhandled RSP MTC0 register: ${J} = ${N(q)}`);break}}}var oU=(()=>{let J=[];for(let q=0;q<64;q++)J[q]=b8;return J[0]=eU,J[2]=JP,J[3]=qP,J[4]=QP,J[6]=ZP,J[7]=XP,J[8]=YP,J[9]=zP,J[13]=KP,J[32]=WP,J[33]=FP,J[34]=$P,J[35]=HP,J[36]=GP,J[37]=jP,J[38]=NP,J[39]=LP,J[42]=VP,J[43]=UP,J})(),dU=(()=>{let J=[];for(let q=0;q<32;q++)J.push(b8);return J[0]=PP,J[1]=MP,J[16]=hP,J[17]=kP,J})(),lU=(()=>{let J=[];for(let q=0;q<32;q++)J.push(b8);return J[0]=DP,J[4]=OP,J})(),nU=(()=>{let J=[];for(let q=0;q<32;q++)J.push(b8);J[0]=IP,J[2]=BP,J[4]=wP,J[6]=AP;for(let q=16;q<32;q++)J[q]=rU;return J})(),aU=(()=>{let J=[];for(let q=0;q<64;q++)J.push(b8);return J[0]=rP,J[1]=sP,J[2]=J1,J[3]=F1,J[4]=q1,J[5]=Z1,J[6]=Y1,J[7]=K1,J[8]=iP,J[9]=tP,J[10]=eP,J[11]=$1,J[12]=Q1,J[13]=X1,J[14]=z1,J[15]=W1,J[16]=H1,J[17]=G1,J[18]=yP,J[19]=N1,J[20]=L1,J[21]=V1,J[22]=EP,J[23]=TP,J[24]=_P,J[25]=bP,J[26]=SP,J[27]=vP,J[28]=xP,J[29]=h1,J[30]=uP,J[31]=gP,J[32]=k1,J[33]=D1,J[34]=O1,J[35]=I1,J[36]=w1,J[37]=B1,J[38]=A1,J[39]=C1,J[40]=R1,J[41]=y1,J[42]=E1,J[43]=T1,J[44]=_1,J[45]=b1,J[46]=fP,J[47]=pP,J[48]=v1,J[49]=x1,J[50]=u1,J[51]=S1,J[52]=g1,J[53]=f1,J[54]=p1,J[55]=m1,J[56]=mP,J[57]=cP,J[58]=oP,J[59]=dP,J[60]=lP,J[61]=nP,J[62]=aP,J[63]=c1,J})(),sU=(()=>{let J=[];for(let q=0;q<32;q++)J.push(b8);return J[0]=jM,J[1]=NM,J[2]=LM,J[3]=VM,J[4]=UM,J[5]=PM,J[6]=MM,J[7]=hM,J[8]=kM,J[9]=DM,J[10]=OM,J[11]=IM,J})(),iU=(()=>{let J=[];for(let q=0;q<32;q++)J.push(b8);return J[0]=wM,J[1]=BM,J[2]=AM,J[3]=CM,J[4]=RM,J[5]=yM,J[6]=EM,J[7]=TM,J[8]=_M,J[9]=SM,J[10]=vM,J[11]=xM,J})(),tU=(()=>{let J=[];for(let q=0;q<64;q++)J.push(b8);return J[0]=(q)=>oU[X$(q)](q),J[1]=(q)=>dU[o(q)](q),J[2]=o1,J[3]=d1,J[4]=l1,J[5]=n1,J[6]=a1,J[7]=r1,J[8]=s1,J[9]=i1,J[10]=t1,J[11]=e1,J[12]=JM,J[13]=qM,J[14]=QM,J[15]=ZM,J[16]=(q)=>lU[J0(q)](q),J[18]=(q)=>nU[J0(q)](q),J[32]=XM,J[33]=zM,J[35]=WM,J[36]=YM,J[37]=KM,J[39]=FM,J[40]=$M,J[41]=HM,J[43]=GM,J[50]=(q)=>sU[j0(q)](q),J[58]=(q)=>iU[j0(q)](q),J})(),U1=8,P1=9,M1=10,bM=new Map([[0,[0,1,2,3]],[1,[6,7,4,5]],[4,[1,2,3,0]],[5,[7,4,5,6]],[8,[4,5,6,7]],[11,[3,0,1,2]],[12,[5,6,7,4]],[15,[0,1,2,3]]]);function I$(J){P=J.cpu0,t=J.cpu1,HJ=J.cpu2,cF(J,P),n64js.cpu0=P}var Dh=function(J){return J>>>13},Oh=function(J){return(J&j9)>>rM},Ih=function(J){return(J&OY)>>aM},IY=function(J,q,Q){return(~(J^q)&(Q^J)&B$)!=0},C$=function(J,q,Q){return((J^q)&(Q^J)&B$)!=0},wY=function(J,q,Q){return(~(J^q)&(Q^J)&A$)!=0n},R$=function(J,q,Q){return((J^q)&(Q^J)&A$)!=0n},AY=function(J){return J>>13&4095},Bh=function(J){const Q=AY(J)&2730;return(Q|Q>>1)<<13},Ah=function(J){const q=AY(J);if(q&2048)return 1<<24;if(q&512)return 1<<22;if(q&128)return 1<<20;if(q&32)return 1<<18;if(q&8)return 1<<16;if(q&2)return 1<<14;return 1<<12},Ch=function(J){const q=wh.get(J);if(q)return q;return`Unknown(${AY(J).toString(2)})`},B=function(J){throw`CPU: unknown op, pc: ${N(P.pc)}, instruction: ${N(J)}`},D$=function(){},Rh=function(J){return J&~3758096384},O$=function(J){return Rh(J>>>0)>>>4},yh=function(J){q0((J>>>18&7)===0,"cc bit is not 0");const q=(J&65536)!==0,Q=(J&131072)!==0,X=(t.control[31]&w$)!==0===q;if(Q)P.conditionalBranchLikely(X,G0(J));else P.conditionalBranch(X,G0(J))},Eh=function(J){if(J.length!=64)throw"Special table is unexpected size.";return J},_h=function(J){Th[EJ(J)](J)},yY=function(J){if(J.length!=32)throw"Cop table is unexpected size.";return J},Sh=function(J){bh[H6(J)](J)},xh=function(J){vh[H6(J)](J)},gh=function(J){uh[H6(J)](J)},fh=function(J){P.raiseRESERVEDException(0)},EY=function(J){q0((P.getControlU32(S0)&BY)===0,"SR_CU1 in inconsistent state"),P.raiseCopXUnusable(1)},ph=function(J){if(J.length!=32)throw"RegImm table is unexpected size.";return J},ch=function(J){return mh[yJ(J)](J)},oh=function(J){if(J.length!=64)throw"Simple table is unexpected size.";return J},E$=function(J){return T$[RJ(J)](J)},dh=function(J,q,Q){return J-=q,J-=Q,J^=Q>>>13,q-=Q,q-=J,q^=J<<8,Q-=J,Q-=q,Q^=q>>>13,J-=q,J-=Q,J^=Q>>>12,q-=Q,q-=J,q^=J<<16,Q-=J,Q-=q,Q^=q>>>5,J-=q,J-=Q,J^=Q>>>3,q-=Q,q-=J,q^=J<<10,Q-=J,Q-=q,Q^=q>>>15,J},lh=function(J,q){if(!J.sync32(q,"pc"))return!1;{let Q=0;for(let Z=0;Z<32;++Z)Q=dh(Q,P.getRegU32Lo(Z),0);if(Q=Q>>>0,!J.sync32(Q,"regs"))return!1}return!0},nh=function(J,q,Q){if(Q.nextEventCountdown()<J.opsCompiled*Qq)return null;J.executionCount++;const Z=J.func(),X=Z*Qq;if(!FJ)q.incrementCount(X);return Q.incrementCount(X),J.getNextFragment(q.pc,Z)},ah=function(J,q,Q,Z){if(q0(!J.func,`attempting to append op to already-compiled fragment ${N(J.entryPC)}`),J.opsCompiled===0)Zq.newFragment();J.opsCompiled++,b$.addInstructionToFragment(J,q),J.bodyCode+="rsp.step();\n",J.bodyCode+=`if (c.stuffToDo) { return ${J.opsCompiled-1}; }\n`,J.bodyCode+="\n";const X=q,Y=Z.pc;if(Zq.set(J,X,Q,Y,Z.nextPC),v4(Zq),J.opsCompiled>8&&Z.pc!==q+4||J.opsCompiled>=uM||Z.stuffToDo)rh(J),J=SJ(Z.pc);else J.bodyCode+=`// Keep going: ops ${J.opsCompiled}, pc: ${N(Z.pc)}, entry+4: ${N(q+4)}, stuff: ${Z.stuffToDo}\n`;return J},rh=function(J){let q="";if(n64js.getSyncFlow())q+="const sync = n64js.getSyncFlow();\n";if(J.usesCop1)q+=`const SR_CU1 = ${N(BY)};\n`,q+=`const FPCSR_C = ${N(w$)};\n`;if(Zq.delayedPCUpdate!==0)J.bodyCode+=`c.pc = ${N(Zq.delayedPCUpdate)};\n`,Zq.delayedPCUpdate=0;J.bodyCode+=`return ${J.opsCompiled};\n`;const Z=`
  return function fragment_${N(J.entryPC)}_${J.opsCompiled}() {
  ${q}
  ${J.bodyCode}
}`;J.bodyCode="",J.func=new Function("c","cpu1","rsp",Z)(P,t,F),J.nextFragments=[];for(let X=0;X<J.opsCompiled;X++)J.nextFragments.push(void 0)};window.n64js=window.n64js||{};var P,t,HJ,dZ=!1,uM=250,Qq=1,L$=2147483648;var X6=2147484032,lZ=1,H9=2,G9=4;var gM=67108864;var BY=536870912;var fM=28,pM=0xfff7_ffffn,V$=2147483648,mM=805306368,cM=28,oM=256,dM=512,MY=1024;var U$=32768,lM=65280;var P$=124,nM=BigInt(oM|dM);var w$=8388608;var OY=0xc000000000000000n,aM=62n,j9=0x000000ffffffe000n,rM=13n,F9=0xffn,sM=0xc00000ffffffe0ffn;var iM=4,hY=2,kY=1,tM=0x3fffffffn,eM=2147483648;var Jh=0x8000003fn;var qh=0x3fn;var Qh=8388592,Zh=4,Xh=~0x7fffffn,Yh=0x7fff_fff0n,zh=4n,Kh=0x1_8000_0000n,Wh=31n,Fh=0xfffffffe_00000000n,$h=0,Hh=24576,Gh=122880,jh=516096,Nh=2088960,Lh=8380416,Vh=33546240,Uh=8191,Ph=0x01ffe000n,Mh=0x0f00800fn,hh=0xffffffffn,kh=0xffn,DY=1<<0,cZ=1<<1,M$=1<<2,h$="Compare",$9="Run For Cycles";n64js.getSyncFlow=()=>t8;var B$=2147483648,A$=0x8000_0000_0000_0000n,oZ=4294967295,S6=0xffff_ffff_ffff_ffffn,k$=0xffff_ffffn;n64js.s32CheckAddOverflow=IY;n64js.s32CheckSubOverflow=C$;n64js.s64CheckAddOverflow=wY;n64js.s64CheckSubOverflow=R$;class y${constructor(){this.pagemask=0,this.hi=0n,this.pfne=0,this.pfno=0,this.global=0,this.offsetMask=0,this.vpnmask64=j9,this.vpn2bits=0n,this.physEven=0,this.physOdd=0,this.checkbit=0}update(J,q,Q,Z,X){if(dZ)h(`TLB update: index=${J}, pagemask=${N(q)}, entryhi=${M8(Q)}, entrylo0=${N(Z)}, entrylo1=${N(X)}`),h(`       ${Ch(q)} Pagesize`);const Y=Z&X&kY;this.pagemask=Bh(q),this.hi=Q,this.pfne=Z&~kY|Y,this.pfno=X&~kY|Y,this.global=Y,this.offsetMask=(this.pagemask|Uh)>>>1,this.vpnmask64=j9&BigInt(~this.pagemask),this.vpn2bits=Q&this.vpnmask64,this.physEven=this.pfne<<6&~this.offsetMask,this.physOdd=this.pfno<<6&~this.offsetMask,this.checkbit=Ah(this.pagemask)}}var wh=new Map([[$h,"4k"],[Hh,"16k"],[Gh,"64k"],[jh,"256k"],[Nh,"1M"],[Lh,"4M"],[Vh,"16M"]]);class CY{constructor(J){this.hardware=J,this.opsExecuted=0,this.ramDV=J.cachedMemDevice.mem.dataView;const q=new ArrayBuffer(256);this.gprU32=new Uint32Array(q),this.gprS32=new Int32Array(q),this.gprU64=new BigUint64Array(q),this.gprS64=new BigInt64Array(q);const Q=new ArrayBuffer(256);this.controlRegU32=new Uint32Array(Q),this.controlRegS32=new Int32Array(Q),this.controlRegU64=new BigUint64Array(Q),this.controlRegS64=new BigInt64Array(Q),this.controlCountValue=0,this.lastControlRegWrite=0n,this.pc=0,this.delayPC=0,this.nextPC=0,this.branchTarget=0,this.llBit=0,this.stuffToDo=0,this.eventQueue=new JY;const Z=new ArrayBuffer(8);this.multHiU32=new Uint32Array(Z),this.multHiS32=new Int32Array(Z),this.multHiU64=new BigUint64Array(Z),this.multHiS64=new BigInt64Array(Z);const X=new ArrayBuffer(8);this.multLoU32=new Uint32Array(X),this.multLoS32=new Int32Array(X),this.multLoU64=new BigUint64Array(X),this.multLoS64=new BigInt64Array(X),this.tlbEntries=[];for(let Y=0;Y<32;++Y)this.tlbEntries.push(new y$);this.loadU8fast=a7,this.loadU16fast=s7,this.loadU32fast=X9,this.loadU64fast=ZJ,this.loadS8fast=r7,this.loadS16fast=i7,this.loadS32fast=Y9,this.store8fast=t7,this.store16fast=e7,this.store32fast=z9,this.store64fast=K9,this.store32masked=ZZ,this.store64masked=XZ,this.reset()}conditionalBranch(J,q){const Q=J?q*4:4;this.branchTarget=this.pc+4+Q}conditionalBranchLikely(J,q){if(J)this.branchTarget=this.pc+4+q*4;else this.nextPC+=4}jump(J){this.branchTarget=J}getOpsExecuted(){return this.controlCountValue}incrementCount(J){this.controlCountValue+=J}getRegS32Lo(J){return this.gprS32[J*2+0]}getRegU32Lo(J){return this.gprU32[J*2+0]}getRegS64(J){return this.gprS64[J]}getRegU64(J){return this.gprU64[J]}setRegU64(J,q){if(J==0)return;const Q=q&S6;this.gprU64[J]=Q}setRegU64Masked(J,q,Q){if(J==0)return;this.gprU64[J]=this.gprU64[J]&~Q|q&Q}setRegS64LoHi(J,q,Q){if(J==0)return;this.gprS32[J*2+0]=q,this.gprS32[J*2+1]=Q}setRegS32ExtendMasked(J,q,Q){if(J==0)return;const Z=this.gprS32[J*2+0]&~Q|q&Q;this.gprS32[J*2+0]=Z,this.gprS32[J*2+1]=Z>>31}setRegS32Extend(J,q){if(J==0)return;this.gprS32[J*2+0]=q,this.gprS32[J*2+1]=q>>31}setRegU32Extend(J,q){if(J==0)return;this.gprU32[J*2+0]=q,this.gprU32[J*2+1]=0}getMultLoS64(){return this.multLoS64[0]}getMultLoU64(){return this.multLoU64[0]}setMultLoS32Extend(J){this.multLoS64[0]=BigInt.asIntN(32,J)}setMultLoS64(J){this.multLoS64[0]=J}setMultLoU64(J){this.multLoU64[0]=J}getMultHiS64(){return this.multHiS64[0]}getMultHiU64(){return this.multHiU64[0]}setMultHiS32Extend(J){this.multHiS64[0]=BigInt.asIntN(32,J)}setMultHiS64(J){this.multHiS64[0]=J}setMultHiU64(J){this.multHiU64[0]=J}setControlU32(J,q){this.controlRegU32[J*2+0]=q}setControlS32(J,q){this.controlRegS32[J*2+0]=q}getControlU32(J){return this.controlRegU32[J*2+0]}getControlS32(J){return this.controlRegS32[J*2+0]}setControlS32Extend(J,q){this.controlRegS32[J*2+0]=q,this.controlRegS32[J*2+1]=q>>31}setControlU64(J,q){this.controlRegU64[J]=q}setControlS64(J,q){this.controlRegS64[J]=q}getControlU64(J){return this.controlRegU64[J]}getControlS64(J){return this.controlRegS64[J]}maskControlBits32(J,q,Q){const Z=J*2+0;this.controlRegU32[Z]=this.controlRegU32[Z]&~q|Q&q}setControlBits32(J,q){this.controlRegU32[J*2+0]|=q}clearControlBits32(J,q){this.controlRegU32[J*2+0]&=~q}maskControlBits64(J,q,Q){this.controlRegU64[J]=this.controlRegU64[J]&~q|Q&q}setControlBits64(J,q){this.controlRegU64[J]|=q}clearControlBits64(J,q){this.controlRegU64[J]&=~q}reset(){DW();for(let J=0;J<32;++J)this.gprU64[J]=0n,this.controlRegU64[J]=0n;for(let J=0;J<32;++J)this.tlbEntries[J].update(J,0,0x80000000n,0,0);this.pc=0,this.delayPC=0,this.nextPC=0,this.branchTarget=0,this.stuffToDo=0,this.eventQueue.reset(),this.multLoU32[0]=this.multLoU32[1]=0,this.multHiU32[0]=this.multHiU32[1]=0,this.setControlU32(Eq,31),this.setControlU32(S0,1883242500),this.setControlU32(xq,1879499875),this.cop1ControlChanged()}cop1ControlChanged(){const J=this.getControlU32(S0),q=(J&BY)!==0;if(T$[17]=q?xh:EY,this.hardware.cpu1)this.hardware.cpu1.fullMode=(J&gM)!==0}moveToControl(J,q){switch(this.lastControlRegWrite=q,J){case BJ:this.setControlU64(J,q&Jh);break;case Tq:case _q:this.setControlU64(J,q&tM);break;case bq:this.setControlU64(J,q&Xh);break;case Sq:this.setControlU64(J,q&Ph);break;case IX:this.setControlU64(J,q&qh),this.setControlU64(Eq,31n);break;case P8:this.setControlU64(J,q&sM);break;case Eq:case vq:case n9:case gK:break;case xq:this.maskControlBits64(J,Mh,q);break;case d0:h(`Setting cause register to ${N(q)}`),n64js.check(q===0,"Should only write 0 to Cause register."),this.maskControlBits64(J,nM,q);break;case S0:this.setControlU64(J,q&pM),this.statusRegisterChanged();break;case i8:this.controlCountValue=Number(q)*2;break;case AJ:this.setCompare(Number(q&0xffff_ffffn));break;case BX:this.maskControlBits64(J,Fh,q);break;case t6:case fK:case pK:this.setControlU64(J,q);break;case a9:this.maskControlBits64(J,hh,q);break;case wX:case AX:case CX:case RX:case yX:case EX:case TX:break;case uK:this.setControlU64(J,q&kh);break;case uq:this.setControlU64(J,q);break;default:this.setControlU64(J,q),h(`Write to cpu0 control register. ${M8(q)} --> ${_J[J]}`);break}}moveFromControl(J){if(J===d0)this.checkCauseIP3Consistent();switch(J){case Eq:return BigInt(this.getRandom());case wX:case AX:case CX:case RX:case yX:case EX:case TX:return this.lastControlRegWrite;case i8:return BigInt(this.controlCountValue)>>1n;default:return this.getControlU64(J)}}breakExecution(){this.stuffToDo|=DY}run(J){this.stuffToDo&=~DY,this.checkCauseIP3Consistent(),n64js.hardware().checkSIStatusConsistent(),this.addRunForCyclesEvent(J);while(this.hasEvent($9))try{this.runImpl();break}catch(Q){if(Q instanceof W8)this.handleEmulatedException();else if(Q instanceof D$)n64js.stopForBreakpoint();else{n64js.halt("Exception :"+Q);break}}let q=this.removeEvent($9);if(q<0)q=0;if(q<J)this.opsExecuted+=J-q}runImpl(){const J=this.eventQueue,q=this.ramDV;while(this.hasEvent($9)){let Q=SJ(this.pc);while(!this.stuffToDo)if(Q&&Q.func)Q=nh(Q,this,J);else{if(F.step(),this.stuffToDo)break;const Z=this.pc|0;this.nextPC=this.delayPC||this.pc+4;let X;if((Z&3)!=0){this.raiseAdELException(Z),this.pc=this.nextPC,Q=SJ(this.pc);continue}else if(Z<-2139095040){const Y=Z+2147483648|0;X=q.getInt32(Y,!1)}else X=n7(Z>>>0);if(this.branchTarget=0,E$(X),this.pc=this.nextPC,this.delayPC=this.branchTarget,this.incrementCount(Qq),J.incrementCount(Qq),Q)Q=ah(Q,Z>>>0,X,this);else if(this.pc<Z)Q=SJ(this.pc)}if(this.stuffToDo&=~M$,this.stuffToDo&cZ)this.stuffToDo&=~cZ,this.handleInterrupt();else if(this.stuffToDo&DY)break;else if(this.stuffToDo){n64js.warn("Don't know how to handle this event!");break}}}handleEmulatedException(){this.pc=this.nextPC,this.delayPC=0,this.branchTarget=0,this.incrementCount(Qq),this.eventQueue.incrementCount(Qq)}speedHack(){if(!F.halted)return;if(n64js.hardware().memMap.readMemoryInternal32(this.pc+4)!==0)return;const q=this.removeEvent($9),Q=this.eventQueue.skipToNextEvent(1);if(this.controlCountValue+=Q,q>=0)this.addRunForCyclesEvent(q)}updateCause3(){if(n64js.hardware().miRegDevice.interruptsUnmasked())this.setControlBits32(d0,MY),this.updateStuffToDoForInterrupts();else this.clearControlBits32(d0,MY);this.checkCauseIP3Consistent()}checkCauseIP3Consistent(){const q=n64js.hardware().miRegDevice.interruptsUnmasked(),Q=(this.getControlU32(d0)&MY)!==0;q0(q===Q,`CAUSE_IP3 ${Q} inconsistent with MI_INTR_REG ${q}`)}statusRegisterChanged(){this.cop1ControlChanged(),this.updateStuffToDoForInterrupts()}checkForUnmaskedInterrupts(){const J=this.getControlU32(S0);if((J&(H9|G9|lZ))===lZ){const q=this.getControlU32(d0);if((J&q&lM)!==0)return!0}return!1}updateStuffToDoForInterrupts(){if(this.checkForUnmaskedInterrupts())this.stuffToDo|=cZ;else this.stuffToDo&=~cZ}setBadVAddr(J){this.setControlU64(vq,J)}setContext(J){const q=Number(J&0xffffffffn),Q=Dh(q)<<Zh;this.maskControlBits32(bq,Qh,Q)}setXContext(J){const q=Oh(J)<<zh|Ih(J)<<Wh,Q=Yh|Kh;this.maskControlBits64(BX,Q,q)}checkCopXUsable(J){const q=1<<fM+J;if((this.getControlU32(S0)&q)==0)return this.raiseCopXUnusable(J),!1;return!0}maybeRaiseTRAPException(J){if(J)this.raiseTRAPException()}raiseCopXUnusable(J){this.raiseExceptionCopCode(X6,J,rK)}raiseSYSCALLException(){this.raiseExceptionCopCode(X6,0,lK)}raiseBREAKException(){this.raiseExceptionCopCode(X6,0,nK)}raiseRESERVEDException(J){this.raiseExceptionCopCode(X6,J,aK)}raiseTRAPException(){this.raiseExceptionCopCode(X6,0,iK)}raiseOverflowException(){this.raiseExceptionCopCode(X6,0,sK)}raiseFPE(){this.raiseExceptionCopCode(X6,0,tK)}raiseAdELException(J){this.raiseAddressException(X6,oK,J)}raiseAdESException(J){this.raiseAddressException(X6,dK,J)}raiseTLBException(J,q,Q){const Z=BigInt(Q>>0);this.setBadVAddr(Z),this.setContext(Z),this.setXContext(Z),this.maskControlBits64(P8,j9,Z),this.raiseExceptionCopCode(J,0,q)}raiseAddressException(J,q,Q){const Z=BigInt(Q>>0);this.setBadVAddr(Z),this.setContext(Z),this.setXContext(Z),this.raiseExceptionCopCode(J,0,q)}raiseExceptionCopCode(J,q,Q){const Z=P$|mM,X=Q<<_X,Y=q<<cM;this.raiseException(Z,X|Y,J)}raiseException(J,q,Q){if(this.maskControlBits32(d0,J,q),this.setControlBits32(S0,H9),this.delayPC)this.setControlBits32(d0,V$),this.setControlS32Extend(t6,this.pc-4);else this.clearControlBits32(d0,V$),this.setControlS32Extend(t6,this.pc);this.nextPC=Q}handleInterrupt(){if(this.checkForUnmaskedInterrupts())this.raiseException(P$,mK<<_X,X6),this.pc=X6,this.delayPC=0;else q0(!1,"Was expecting an unmasked interrupt - something wrong with kStuffToDoCheckInterrupts?")}setCompare(J){if(this.clearControlBits32(d0,U$),J===this.getControlU32(AJ));else{const q=this.controlCountValue/2>>0,Q=J-q>>>0;this.removeEvent(h$),this.addCompareEvent(Q),this.setControlU32(AJ,J)}}addEvent(J,q,Q){return this.eventQueue.addEvent(J,q,Q)}removeEvent(J){return this.eventQueue.removeEvent(J)}getCyclesUntilEvent(J){this.eventQueue.getCyclesUntilEvent(J)}hasEvent(J){return this.eventQueue.hasEvent(J)}addCompareEvent(J){const q=this;this.addEvent(h$,J,()=>{q.setControlBits32(d0,U$),q.updateStuffToDoForInterrupts()})}addRunForCyclesEvent(J){const q=this;this.addEvent($9,J,()=>{q.stuffToDo|=M$})}getRandom(){const J=this.getControlU32(IX),q=J>=32?0:J&31,Q=J>=32?64:32;let Z=Math.floor(Math.random()*(Q-q))+q;if(q0(Z>=q&&Z<Q,`Ooops - random should be in range [${q},${Q}), but got ${Z}`),t8)Z=t8.reflect32(Z);return Z}setTLB(J){const q=J&31,Q=this.getControlU32(Sq),Z=this.getControlU64(P8),X=this.getControlU32(_q),Y=this.getControlU32(Tq);this.tlbEntries[q].update(q,Q,Z,Y,X)}tlbWriteIndex(){this.setTLB(this.getControlU32(BJ))}tlbWriteRandom(){this.setTLB(this.getRandom())}tlbRead(){const J=this.getControlU32(BJ)&31,q=this.tlbEntries[J],Q=(OY|j9|F9)&BigInt(~q.pagemask);if(this.setControlU32(Sq,q.pagemask),this.setControlU64(P8,q.hi&Q),this.setControlU32(Tq,q.pfne&67108863),this.setControlU32(_q,q.pfno&67108863),dZ)h("TLB Read Index "+v0(J)+"."),h("  PageMask: "+N(this.getControlU32(Sq))),h("  EntryHi:  "+M8(this.getControlU64(P8))),h("  EntryLo0: "+N(this.getControlU32(Tq))),h("  EntryLo1: "+N(this.getControlU32(_q)))}tlbProbe(){const J=this.getControlU64(P8),q=J&F9;for(let Q=0;Q<32;++Q){const Z=this.tlbEntries[Q],X=Z.vpnmask64|OY;if((Z.hi&X)!==(J&X))continue;if(!Z.global&&(Z.hi&F9)!==q)continue;if(dZ)h("TLB Probe. EntryHi:"+N(J)+". Found matching TLB entry - "+v0(Q));this.setControlU32(BJ,Q);return}if(dZ)h("TLB Probe. EntryHi:"+N(J)+". Didn't find matching entry");this.setControlU32(BJ,eM)}tlbFindEntry(J){const Q=this.getControlU64(P8)&F9,Z=BigInt(J>>>0);for(let X=0;X<32;++X){const Y=this.tlbEntries[X];if((Z&Y.vpnmask64)!==Y.vpn2bits)continue;if(!Y.global&&(Y.hi&F9)!==Q)continue;return Y}return null}translateReadInternal(J){const q=this.tlbFindEntry(J);if(!q)return 0;const Q=J&q.checkbit;if(((Q?q.pfno:q.pfne)&hY)===0)return 0;const X=Q?q.physOdd:q.physEven,Y=J&q.offsetMask;return X|Y}translateRead(J){const q=this.tlbFindEntry(J);if(!q)throw this.raiseTLBException(L$,bX,J),new W8;const Q=J&q.checkbit;if(((Q?q.pfno:q.pfne)&hY)===0)throw this.raiseTLBException(X6,bX,J),new W8;const X=Q?q.physOdd:q.physEven,Y=J&q.offsetMask;return X|Y}translateWrite(J){const q=this.tlbFindEntry(J);if(!q)throw this.raiseTLBException(L$,SX,J),new W8;const Q=J&q.checkbit,Z=Q?q.pfno:q.pfne;if((Z&hY)===0)throw this.raiseTLBException(X6,SX,J),new W8;if((Z&iM)===0)throw this.raiseTLBException(X6,cK,J),new W8;const X=Q?q.physOdd:q.physEven,Y=J&q.offsetMask;return X|Y}unalignedLoad(J){throw this.raiseAdELException(J),new W8}unalignedStore(J){throw this.raiseAdESException(J),new W8}execBreakpoint(){throw new D$}execSLL(J,q,Q){this.setRegS32Extend(J,this.getRegS32Lo(q)<<Q)}execSRL(J,q,Q){this.setRegS32Extend(J,this.getRegU32Lo(q)>>>Q)}execSRA(J,q,Q){this.setRegS32Extend(J,Number(this.getRegS64(q)>>BigInt(Q)&0xffff_ffffn))}execSLLV(J,q,Q){this.setRegS32Extend(J,this.getRegS32Lo(q)<<(this.getRegS32Lo(Q)&31))}execSRLV(J,q,Q){this.setRegS32Extend(J,this.getRegS32Lo(q)>>>(this.getRegS32Lo(Q)&31))}execSRAV(J,q,Q){this.setRegS32Extend(J,Number(this.getRegS64(q)>>BigInt(this.getRegS32Lo(Q)&31)&0xffff_ffffn))}execDSLLV(J,q,Q){this.setRegU64(J,this.getRegU64(q)<<BigInt(this.getRegU32Lo(Q)&63))}execDSRLV(J,q,Q){this.setRegU64(J,this.getRegU64(q)>>BigInt(this.getRegU32Lo(Q)&63))}execDSRAV(J,q,Q){this.setRegU64(J,this.getRegS64(q)>>BigInt(this.getRegU32Lo(Q)&63))}execDSLL(J,q,Q){this.setRegU64(J,this.getRegU64(q)<<BigInt(Q))}execDSRL(J,q,Q){this.setRegU64(J,this.getRegU64(q)>>BigInt(Q))}execDSRA(J,q,Q){this.setRegU64(J,this.getRegS64(q)>>BigInt(Q))}execDSLL32(J,q,Q){this.setRegU64(J,this.getRegU64(q)<<BigInt(Q+32))}execDSRL32(J,q,Q){this.setRegU64(J,this.getRegU64(q)>>BigInt(Q+32))}execDSRA32(J,q,Q){this.setRegU64(J,this.getRegS64(q)>>BigInt(Q+32))}execRESERVED(J){this.raiseRESERVEDException(J)}execSYSCALL(){this.raiseSYSCALLException()}execBREAK(){this.raiseBREAKException()}execSYNC(){}execMFHI(J){this.setRegU64(J,this.getMultHiU64())}execMFLO(J){this.setRegU64(J,this.getMultLoU64())}execMTHI(J){this.setMultHiU64(this.getRegU64(J))}execMTLO(J){this.setMultLoU64(this.getRegU64(J))}execMULT(J,q){const Q=BigInt(this.getRegS32Lo(q))*BigInt(this.getRegS32Lo(J));this.setMultLoS32Extend(Q&k$),this.setMultHiS32Extend(Q>>32n)}execDMULT(J,q){const Q=this.getRegS64(q)*this.getRegS64(J);this.setMultLoS64(Q&S6),this.setMultHiS64(Q>>64n)}execMULTU(J,q){const Q=BigInt(this.getRegU32Lo(q))*BigInt(this.getRegU32Lo(J));this.setMultLoS32Extend(Q&k$),this.setMultHiS32Extend(Q>>32n)}execDMULTU(J,q){const Q=this.getRegU64(q)*this.getRegU64(J);this.setMultLoU64(Q&S6),this.setMultHiU64(Q>>64n)}execDIV(J,q){const Q=this.getRegS32Lo(q),Z=this.getRegS32Lo(J);let X,Y;if(Z)X=Q/Z>>0,Y=Q%Z;else X=Q<0?1:-1,Y=Q;this.setMultLoS32Extend(BigInt(X)),this.setMultHiS32Extend(BigInt(Y))}execDDIV(J,q){const Q=this.getRegS64(J),Z=this.getRegS64(q);let X,Y;if(Q)X=Z/Q,Y=Z%Q;else X=Z<0?1n:-1n,Y=Z;this.setMultLoS64(X),this.setMultHiS64(Y)}execDIVU(J,q){const Q=this.getRegU32Lo(q),Z=this.getRegU32Lo(J);let X,Y;if(Z)X=Q/Z>>0,Y=Q%Z;else X=-1,Y=Q;this.setMultLoS32Extend(BigInt(X)),this.setMultHiS32Extend(BigInt(Y))}execDDIVU(J,q){const Q=this.getRegU64(J),Z=this.getRegU64(q);let X,Y;if(Q)X=Z/Q,Y=Z%Q;else X=-1n,Y=Z;this.setMultLoU64(X),this.setMultHiU64(Y)}execADD(J,q,Q){const Z=this.getRegS32Lo(Q),X=this.getRegS32Lo(q),Y=Z+X;if(IY(Z,X,Y)){this.raiseOverflowException();return}this.setRegS32Extend(J,Y)}execDADD(J,q,Q){const Z=this.getRegS64(Q),X=this.getRegS64(q),Y=Z+X;if(wY(Z,X,Y)){this.raiseOverflowException();return}this.setRegU64(J,Y)}execADDU(J,q,Q){const Z=this.getRegS32Lo(Q),X=this.getRegS32Lo(q),Y=Z+X;this.setRegS32Extend(J,Y)}execDADDU(J,q,Q){const Z=this.getRegS64(Q),X=this.getRegS64(q),Y=Z+X;this.setRegU64(J,Y)}execSUB(J,q,Q){const Z=this.getRegS32Lo(Q),X=this.getRegS32Lo(q),Y=Z-X;if(C$(Z,X,Y)){this.raiseOverflowException();return}this.setRegS32Extend(J,Y)}execDSUB(J,q,Q){const Z=this.getRegS64(Q),X=this.getRegS64(q),Y=Z-X;if(R$(Z,X,Y)){this.raiseOverflowException();return}this.setRegU64(J,Y)}execSUBU(J,q,Q){const Z=this.getRegS32Lo(Q),X=this.getRegS32Lo(q),Y=Z-X;this.setRegS32Extend(J,Y)}execDSUBU(J,q,Q){const Z=this.getRegS64(Q),X=this.getRegS64(q),Y=Z-X;this.setRegU64(J,Y)}execAND(J,q,Q){this.setRegU64(J,this.getRegU64(Q)&this.getRegU64(q))}execOR(J,q,Q){this.setRegU64(J,this.getRegU64(Q)|this.getRegU64(q))}execXOR(J,q,Q){this.setRegU64(J,this.getRegU64(Q)^this.getRegU64(q))}execNOR(J,q,Q){this.setRegU64(J,~(this.getRegU64(Q)|this.getRegU64(q)))}execCLEAR(J){this.setRegU64(J,0n)}execMOV(J,q){this.setRegU64(J,this.getRegU64(q))}execSLT(J,q,Q){const Z=this.getRegS64(Q)<this.getRegS64(q)?1:0;this.setRegU32Extend(J,Z)}execSLTU(J,q,Q){const Z=this.getRegU64(Q)<this.getRegU64(q)?1:0;this.setRegU32Extend(J,Z)}execADDI(J,q,Q){const Z=this.getRegS32Lo(q),X=Z+Q;if(IY(Z,Q,X)){this.raiseOverflowException();return}this.setRegS32Extend(J,X)}execDADDI(J,q,Q){const Z=this.getRegS64(q),X=BigInt(Q),Y=Z+X;if(wY(Z,X,Y)){this.raiseOverflowException();return}this.setRegU64(J,Y)}execADDIU(J,q,Q){this.setRegS32Extend(J,this.getRegS32Lo(q)+Q)}execDADDIU(J,q,Q){this.setRegU64(J,this.getRegS64(q)+BigInt(Q))}execSLTI(J,q,Q){this.setRegU32Extend(J,this.getRegS64(q)<BigInt(Q)?1:0)}execSLTIU(J,q,Q){const Z=BigInt.asUintN(64,BigInt(Q));this.setRegU32Extend(J,this.getRegU64(q)<Z?1:0)}execANDI(J,q,Q){this.setRegU64(J,this.getRegU64(q)&BigInt(Q))}execORI(J,q,Q){this.setRegU64(J,this.getRegU64(q)|BigInt(Q))}execXORI(J,q,Q){this.setRegU64(J,this.getRegU64(q)^BigInt(Q))}execLUI(J,q){this.setRegS32Extend(J,q<<16)}addrS32(J,q){return this.getRegS32Lo(J)+q>>0}addrU32(J,q){return this.getRegS32Lo(J)+q>>>0}calcDebuggerAddress(J){return this.addrS32(d(J),g(J))}execLB(J,q,Q){const Z=r7(this.addrS32(q,Q));this.setRegS32Extend(J,Z)}execLBU(J,q,Q){const Z=a7(this.addrS32(q,Q));this.setRegU32Extend(J,Z)}execLH(J,q,Q){const Z=i7(this.addrS32(q,Q));this.setRegS32Extend(J,Z)}execLHU(J,q,Q){const Z=s7(this.addrS32(q,Q));this.setRegU32Extend(J,Z)}execLW(J,q,Q){const Z=Y9(this.addrS32(q,Q));if(J==0){console.log("LW to register 0");return}this.setRegS32Extend(J,Z)}execLWU(J,q,Q){const Z=X9(this.addrS32(q,Q));this.setRegU32Extend(J,Z)}execLD(J,q,Q){const Z=ZJ(this.addrS32(q,Q));this.setRegU64(J,Z)}execLWL(J,q,Q){const Z=this.addrU32(q,Q),X=X9((Z&~3)>>>0),Y=8*(Z&3);this.setRegS32ExtendMasked(J,X<<Y,oZ<<Y)}execLWR(J,q,Q){const Z=this.addrU32(q,Q),X=X9((Z&~3)>>>0),Y=8*(3-(Z&3));this.setRegS32ExtendMasked(J,X>>>Y,oZ>>>Y)}execLDL(J,q,Q){const Z=this.addrU32(q,Q),X=BigInt(8*(Z&7)),Y=ZJ((Z&~7)>>>0);this.setRegU64Masked(J,Y<<X&S6,S6<<X&S6)}execLDR(J,q,Q){const Z=this.addrU32(q,Q),X=BigInt(8*(7-(Z&7))),Y=ZJ((Z&~7)>>>0);this.setRegU64Masked(J,Y>>X,S6>>X)}execLWC1(J,q,Q){if(!this.checkCopXUsable(1))return;t.store32(t.copRegIdx32(J),Y9(this.addrS32(q,Q)))}execLWC2(J,q,Q){if(!this.checkCopXUsable(2))return;this.unimplemented(this.pc,"LWC2")}execLWC3(J,q,Q){if(!this.checkCopXUsable(3))return;this.unimplemented(this.pc,"LWC3")}execLDC1(J,q,Q){if(!this.checkCopXUsable(1))return;const Z=ZJ(this.addrS32(q,Q));t.store64(t.copRegIdx64(J),Z)}execLDC2(J,q,Q){if(!this.checkCopXUsable(2))return;this.unimplemented(this.pc,"LDC2")}execSB(J,q,Q){t7(this.addrS32(q,Q),this.getRegS32Lo(J))}execSH(J,q,Q){e7(this.addrS32(q,Q),this.getRegS32Lo(J))}execSW(J,q,Q){z9(this.addrS32(q,Q),this.getRegS32Lo(J))}execSD(J,q,Q){K9(this.addrS32(q,Q),this.getRegU64(J))}execSWL(J,q,Q){const Z=this.addrU32(q,Q),X=8*(Z&3),Y=this.getRegU32Lo(J);ZZ(Z,Y>>>X,oZ>>>X)}execSWR(J,q,Q){const Z=this.addrU32(q,Q),X=8*(3-(Z&3)),Y=this.getRegU32Lo(J);ZZ(Z,Y<<X,oZ<<X)}execSDL(J,q,Q){const Z=this.addrU32(q,Q),X=BigInt(8*(Z&7)),Y=this.getRegU64(J);XZ(Z,Y>>X,S6>>X)}execSDR(J,q,Q){const Z=this.addrU32(q,Q),X=this.getRegU64(J),Y=BigInt(8*(7-(Z&7)));XZ(Z,X<<Y&S6,S6<<Y&S6)}execSWC1(J,q,Q){if(!this.checkCopXUsable(1))return;z9(this.addrS32(q,Q),t.loadU32(t.copRegIdx32(J)))}execSWC2(J,q,Q){if(!this.checkCopXUsable(2))return;this.unimplemented(this.pc,"SWC2")}execSWC3(J,q,Q){if(!this.checkCopXUsable(3))return;this.unimplemented(this.pc,"SWC3")}execSDC1(J,q,Q){if(!this.checkCopXUsable(1))return;K9(this.addrS32(q,Q),t.loadU64(t.copRegIdx64(J)))}execSDC2(J,q,Q){if(!this.checkCopXUsable(2))return;this.unimplemented(this.pc,"SDC2")}execLL(J,q,Q){const Z=this.addrS32(q,Q);this.setControlU32(a9,O$(Z)),this.setRegS32Extend(J,Y9(Z)),this.llBit=1}execLLD(J,q,Q){const Z=this.addrS32(q,Q);this.setControlU32(a9,O$(Z)),this.setRegU64(J,ZJ(Z)),this.llBit=1}execSC(J,q,Q){let Z=0;if(this.llBit)z9(this.addrS32(q,Q),this.getRegS32Lo(J)),this.llBit=0,Z=1;this.setRegU32Extend(J,Z)}execSCD(J,q,Q){let Z=0;if(this.llBit)K9(this.addrS32(q,Q),this.getRegU64(J)),this.llBit=0,Z=1;this.setRegU32Extend(J,Z)}execCACHE(J,q,Q){if(!this.ignoreCacheOp(J))b$.invalidateEntry(this.addrU32(q,Q))}ignoreCacheOp(J){const q=J&3,Q=J>>>2&7;return q!==0||Q!==0&&Q!==4}execTGE(J,q){this.maybeRaiseTRAPException(this.getRegS64(q)>=this.getRegS64(J))}execTGEU(J,q){this.maybeRaiseTRAPException(this.getRegU64(q)>=this.getRegU64(J))}execTLT(J,q){this.maybeRaiseTRAPException(this.getRegS64(q)<this.getRegS64(J))}execTLTU(J,q){this.maybeRaiseTRAPException(this.getRegU64(q)<this.getRegU64(J))}execTEQ(J,q){this.maybeRaiseTRAPException(this.getRegS64(q)==this.getRegS64(J))}execTNE(J,q){this.maybeRaiseTRAPException(this.getRegS64(q)!=this.getRegS64(J))}execTGEI(J,q){this.maybeRaiseTRAPException(this.getRegS64(J)>=BigInt(q))}execTGEIU(J,q){this.maybeRaiseTRAPException(this.getRegU64(J)>=BigInt.asUintN(64,BigInt(q)))}execTLTI(J,q){this.maybeRaiseTRAPException(this.getRegS64(J)<BigInt(q))}execTLTIU(J,q){this.maybeRaiseTRAPException(this.getRegU64(J)<BigInt.asUintN(64,BigInt(q)))}execTEQI(J,q){this.maybeRaiseTRAPException(this.getRegS64(J)==BigInt(q))}execTNEI(J,q){this.maybeRaiseTRAPException(this.getRegS64(J)!=BigInt(q))}execJ(J){this.jump(J)}execJR(J){this.jump(this.getRegU32Lo(J))}execJAL(J){this.setRegS32Extend(g6,this.nextPC+4),this.jump(J)}execJALR(J,q){const Q=this.getRegU32Lo(q);this.setRegS32Extend(J,this.nextPC+4),this.jump(Q)}execBEQ(J,q,Q){const Z=this.getRegU64(q)===this.getRegU64(J);if(this.conditionalBranch(Z,Q),eJ&&Z&&Q===-1)this.speedHack()}execBNE(J,q,Q){this.conditionalBranch(this.getRegU64(q)!==this.getRegU64(J),Q)}execBEQL(J,q,Q){this.conditionalBranchLikely(this.getRegU64(q)===this.getRegU64(J),Q)}execBNEL(J,q,Q){this.conditionalBranchLikely(this.getRegU64(q)!==this.getRegU64(J),Q)}execBGEZ(J,q){this.conditionalBranch(this.getRegS64(J)>=0n,q)}execBGTZ(J,q){this.conditionalBranch(this.getRegS64(J)>0n,q)}execBLEZ(J,q){this.conditionalBranch(this.getRegS64(J)<=0n,q)}execBLTZ(J,q){this.conditionalBranch(this.getRegS64(J)<0n,q)}execBGEZL(J,q){this.conditionalBranchLikely(this.getRegS64(J)>=0n,q)}execBGTZL(J,q){this.conditionalBranchLikely(this.getRegS64(J)>0n,q)}execBLEZL(J,q){this.conditionalBranchLikely(this.getRegS64(J)<=0n,q)}execBLTZL(J,q){this.conditionalBranchLikely(this.getRegS64(J)<0n,q)}execBLTZAL(J,q){const Q=this.getRegS64(J)<0n;this.setRegS32Extend(g6,this.nextPC+4),this.conditionalBranch(Q,q)}execBGEZAL(J,q){const Q=this.getRegS64(J)>=0n;this.setRegS32Extend(g6,this.nextPC+4),this.conditionalBranch(Q,q)}execBLTZALL(J,q){const Q=this.getRegS64(J)<0n;this.setRegS32Extend(g6,this.nextPC+4),this.conditionalBranchLikely(Q,q)}execBGEZALL(J,q){const Q=this.getRegS64(J)>=0n;this.setRegS32Extend(g6,this.nextPC+4),this.conditionalBranchLikely(Q,q)}execMFC0(J,q){this.setRegS32Extend(J,Number(this.moveFromControl(q)&0xffff_ffffn))}execDMFC0(J,q){this.setRegU64(J,this.moveFromControl(q))}execMTC0(J,q){this.moveToControl(q,BigInt(this.getRegS32Lo(J)))}execDMTC0(J,q){this.moveToControl(q,this.getRegU64(J))}execTLB(J){switch(J){case 1:this.tlbRead();return;case 2:this.tlbWriteIndex();return;case 6:this.tlbWriteRandom();return;case 8:this.tlbProbe();return;case 24:this.execERET();return}n64js.warn(`CPU: unknown TLB op, pc: ${N(this.pc)}, op: ${N(J)}`)}execERET(){if(this.getControlU32(S0)&G9)this.nextPC=this.getControlU32(uq),this.clearControlBits32(S0,G9),h(`ERET from error trap - ${N(this.nextPC)}`);else this.nextPC=this.getControlU32(t6),this.clearControlBits32(S0,H9);this.llBit=0}execMFC1(J,q){this.setRegS32Extend(J,t.loadS32(t.copRegIdx32(q)))}execDMFC1(J,q){this.setRegU64(J,t.loadU64(t.copRegIdx64(q)))}execMTC1(J,q){t.store32(t.copRegIdx32(q),this.getRegS32Lo(J))}execDMTC1(J,q){t.store64(t.copRegIdx64(q),this.getRegS64(J))}execCFC1(J,q){switch(q){case 0:case 31:this.setRegS32Extend(J,t.control[q]);break}}execCTC1(J,q){if(q===31)t.setStatus(this.getRegU32Lo(J))}execDCFC1(J,q){t.DCFC1(J,q)}execDCTC1(J,q){t.DCTC1(q,J)}execMFC2(J){if(!this.checkCopXUsable(2))return;this.setRegS32Extend(J,HJ.getReg32())}execDMFC2(J){if(!this.checkCopXUsable(2))return;this.setRegU64(J,HJ.getReg64())}execCFC2(J){if(!this.checkCopXUsable(2))return;this.setRegS32Extend(J,HJ.getReg32())}execDCFC2(J){if(!this.checkCopXUsable(2))return;this.raiseRESERVEDException(2)}execMTC2(J){if(!this.checkCopXUsable(2))return;HJ.setReg64(this.getRegU64(J))}execDMTC2(J){if(!this.checkCopXUsable(2))return;HJ.setReg64(this.getRegU64(J))}execCTC2(J){if(!this.checkCopXUsable(2))return;HJ.setReg64(this.getRegU64(J))}execDCTC2(J){if(!this.checkCopXUsable(2))return;this.raiseRESERVEDException(2)}unimplemented(J,q){n64js.warn(`${J}: ${q} is unimplemented`)}}class RY{constructor(J){this.hardware=J;const q=new ArrayBuffer(8);this.regU32=new Uint32Array(q),this.regU64=new BigUint64Array(q)}reset(){this.regU64[0]=0n}setReg32(J){this.regU32[0]=J,this.regU32[1]=J>>31}setReg64(J){this.regU64[0]=J}getReg32(){return this.regU32[0]}getReg64(){return this.regU64[0]}}class W8{}var Th=Eh([(J)=>P.execSLL(u(J),I(J),J6(J)),B,(J)=>P.execSRL(u(J),I(J),J6(J)),(J)=>P.execSRA(u(J),I(J),J6(J)),(J)=>P.execSLLV(u(J),I(J),y(J)),B,(J)=>P.execSRLV(u(J),I(J),y(J)),(J)=>P.execSRAV(u(J),I(J),y(J)),(J)=>P.execJR(y(J)),(J)=>P.execJALR(u(J),y(J)),B,B,(J)=>P.execSYSCALL(),(J)=>P.execBREAK(),B,(J)=>P.execSYNC(),(J)=>P.execMFHI(u(J)),(J)=>P.execMTHI(y(J)),(J)=>P.execMFLO(u(J)),(J)=>P.execMTLO(y(J)),(J)=>P.execDSLLV(u(J),I(J),y(J)),B,(J)=>P.execDSRLV(u(J),I(J),y(J)),(J)=>P.execDSRAV(u(J),I(J),y(J)),(J)=>P.execMULT(I(J),y(J)),(J)=>P.execMULTU(I(J),y(J)),(J)=>P.execDIV(I(J),y(J)),(J)=>P.execDIVU(I(J),y(J)),(J)=>P.execDMULT(I(J),y(J)),(J)=>P.execDMULTU(I(J),y(J)),(J)=>P.execDDIV(I(J),y(J)),(J)=>P.execDDIVU(I(J),y(J)),(J)=>P.execADD(u(J),I(J),y(J)),(J)=>P.execADDU(u(J),I(J),y(J)),(J)=>P.execSUB(u(J),I(J),y(J)),(J)=>P.execSUBU(u(J),I(J),y(J)),(J)=>P.execAND(u(J),I(J),y(J)),(J)=>P.execOR(u(J),I(J),y(J)),(J)=>P.execXOR(u(J),I(J),y(J)),(J)=>P.execNOR(u(J),I(J),y(J)),B,B,(J)=>P.execSLT(u(J),I(J),y(J)),(J)=>P.execSLTU(u(J),I(J),y(J)),(J)=>P.execDADD(u(J),I(J),y(J)),(J)=>P.execDADDU(u(J),I(J),y(J)),(J)=>P.execDSUB(u(J),I(J),y(J)),(J)=>P.execDSUBU(u(J),I(J),y(J)),(J)=>P.execTGE(I(J),y(J)),(J)=>P.execTGEU(I(J),y(J)),(J)=>P.execTLT(I(J),y(J)),(J)=>P.execTLTU(I(J),y(J)),(J)=>P.execTEQ(I(J),y(J)),B,(J)=>P.execTNE(I(J),y(J)),B,(J)=>P.execDSLL(u(J),I(J),J6(J)),B,(J)=>P.execDSRL(u(J),I(J),J6(J)),(J)=>P.execDSRA(u(J),I(J),J6(J)),(J)=>P.execDSLL32(u(J),I(J),J6(J)),B,(J)=>P.execDSRL32(u(J),I(J),J6(J)),(J)=>P.execDSRA32(u(J),I(J),J6(J))]);n64js.executeUnknown=B;var bh=yY([(J)=>P.execMFC0(I(J),W0(J)),(J)=>P.execDMFC0(I(J),W0(J)),B,B,(J)=>P.execMTC0(I(J),W0(J)),(J)=>P.execDMTC0(I(J),W0(J)),B,B,B,B,B,B,B,B,B,B,(J)=>P.execTLB(TJ(J)),B,B,B,B,B,B,B,B,B,B,B,B,B,B,B]),vh=yY([(J)=>P.execMFC1(I(J),W0(J)),(J)=>P.execDMFC1(I(J),W0(J)),(J)=>P.execCFC1(I(J),W0(J)),(J)=>P.execDCFC1(I(J),W0(J)),(J)=>P.execMTC1(I(J),W0(J)),(J)=>P.execDMTC1(I(J),W0(J)),(J)=>P.execCTC1(I(J),W0(J)),(J)=>P.execDCTC1(I(J),W0(J)),yh,B,B,B,B,B,B,B,(J)=>t.execSInstr(G6(J),J8(J),W0(J),f6(J)),(J)=>t.execDInstr(G6(J),J8(J),W0(J),f6(J)),B,B,(J)=>t.execWInstr(G6(J),J8(J),W0(J),f6(J)),(J)=>t.execLInstr(G6(J),J8(J),W0(J),f6(J)),B,B,B,B,B,B,B,B,B,B]),uh=yY([(J)=>P.execMFC2(I(J)),(J)=>P.execDMFC2(I(J)),(J)=>P.execCFC2(I(J)),(J)=>P.execDCFC2(I(J)),(J)=>P.execMTC2(I(J)),(J)=>P.execDMTC2(I(J)),(J)=>P.execCTC2(I(J)),(J)=>P.execDCTC2(I(J)),B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B]);n64js.executeCop1_disabled=EY;var mh=ph([(J)=>P.execBLTZ(y(J),G0(J)),(J)=>P.execBGEZ(y(J),G0(J)),(J)=>P.execBLTZL(y(J),G0(J)),(J)=>P.execBGEZL(y(J),G0(J)),B,B,B,B,(J)=>P.execTGEI(y(J),g(J)),(J)=>P.execTGEIU(y(J),g(J)),(J)=>P.execTLTI(y(J),g(J)),(J)=>P.execTLTIU(y(J),g(J)),(J)=>P.execTEQI(y(J),g(J)),B,(J)=>P.execTNEI(y(J),g(J)),B,(J)=>P.execBLTZAL(y(J),G0(J)),(J)=>P.execBGEZAL(y(J),G0(J)),(J)=>P.execBLTZALL(y(J),G0(J)),(J)=>P.execBGEZALL(y(J),G0(J)),B,B,B,B,B,B,B,B,B,B,B,B]),T$=oh([_h,ch,(J)=>P.execJ(h8(P.pc,J)),(J)=>P.execJAL(h8(P.pc,J)),(J)=>P.execBEQ(I(J),y(J),G0(J)),(J)=>P.execBNE(I(J),y(J),G0(J)),(J)=>P.execBLEZ(y(J),G0(J)),(J)=>P.execBGTZ(y(J),G0(J)),(J)=>P.execADDI(I(J),y(J),g(J)),(J)=>P.execADDIU(I(J),y(J),g(J)),(J)=>P.execSLTI(I(J),y(J),g(J)),(J)=>P.execSLTIU(I(J),y(J),g(J)),(J)=>P.execANDI(I(J),y(J),q8(J)),(J)=>P.execORI(I(J),y(J),q8(J)),(J)=>P.execXORI(I(J),y(J),q8(J)),(J)=>P.execLUI(I(J),q8(J)),Sh,EY,gh,fh,(J)=>P.execBEQL(I(J),y(J),G0(J)),(J)=>P.execBNEL(I(J),y(J),G0(J)),(J)=>P.execBLEZL(y(J),G0(J)),(J)=>P.execBGTZL(y(J),G0(J)),(J)=>P.execDADDI(I(J),y(J),g(J)),(J)=>P.execDADDIU(I(J),y(J),g(J)),(J)=>P.execLDL(I(J),d(J),g(J)),(J)=>P.execLDR(I(J),d(J),g(J)),(J)=>P.execBreakpoint(),B,B,(J)=>P.execRESERVED(0),(J)=>P.execLB(I(J),d(J),g(J)),(J)=>P.execLH(I(J),d(J),g(J)),(J)=>P.execLWL(I(J),d(J),g(J)),(J)=>P.execLW(I(J),d(J),g(J)),(J)=>P.execLBU(I(J),d(J),g(J)),(J)=>P.execLHU(I(J),d(J),g(J)),(J)=>P.execLWR(I(J),d(J),g(J)),(J)=>P.execLWU(I(J),d(J),g(J)),(J)=>P.execSB(I(J),d(J),g(J)),(J)=>P.execSH(I(J),d(J),g(J)),(J)=>P.execSWL(I(J),d(J),g(J)),(J)=>P.execSW(I(J),d(J),g(J)),(J)=>P.execSDL(I(J),d(J),g(J)),(J)=>P.execSDR(I(J),d(J),g(J)),(J)=>P.execSWR(I(J),d(J),g(J)),(J)=>P.execCACHE(I(J),d(J),g(J)),(J)=>P.execLL(I(J),d(J),g(J)),(J)=>P.execLWC1(I(J),d(J),g(J)),(J)=>P.execLWC2(I(J),d(J),g(J)),(J)=>P.execLWC3(I(J),d(J),g(J)),(J)=>P.execLLD(I(J),d(J),g(J)),(J)=>P.execLDC1(I(J),d(J),g(J)),(J)=>P.execLDC2(I(J),d(J),g(J)),(J)=>P.execLD(I(J),d(J),g(J)),(J)=>P.execSC(I(J),d(J),g(J)),(J)=>P.execSWC1(I(J),d(J),g(J)),(J)=>P.execSWC2(I(J),d(J),g(J)),(J)=>P.execSWC3(I(J),d(J),g(J)),(J)=>P.execSCD(I(J),d(J),g(J)),(J)=>P.execSDC1(I(J),d(J),g(J)),(J)=>P.execSDC2(I(J),d(J),g(J)),(J)=>P.execSD(I(J),d(J),g(J))]);n64js.singleStep=function(){const J=n64js.breakpoints();let q=0;if(J.isBreakpoint(P.pc))q=P.pc,J.toggle(q);if(P.run(1),q)J.toggle(q)};class _${constructor(){this.kNumEntries=16384,this.entries=[];for(let J=0;J<this.kNumEntries;++J)this.entries.push(new Set)}addressToCacheLine(J){return Math.floor(J>>>5)}addressToCacheLineRoundUp(J){return Math.floor(J+31>>>5)}lookupEntry(J){const Q=this.addressToCacheLine(J)%this.entries.length;return this.entries[Q]}addInstructionToFragment(J,q){J.updateMinMax(q),this.lookupEntry(q).add(J)}invalidateEntry(J){const q=this.lookupEntry(J),Q=this.addressToCacheLine(J);for(let[Z,X]of q.entries())if(this.addressToCacheLine(Z.minPC)<=Q&&this.addressToCacheLineRoundUp(Z.maxPC)>=Q)Z.invalidate(),q.delete(Z)}}var b$=new _$,Zq=new $Y;n64js.checkSyncState=lh;n64js.executeOp=E$;class r{constructor(J,q,Q,Z,X){this.name=J,this.hardware=q,this.mem=Q,this.u8=Q?Q.u8:null,this.rangeStart=Z,this.rangeEnd=X,this.quiet=!0}setMem(J){this.mem=J,this.u8=J.u8}reset(){}calcEA(J){return J-this.rangeStart}calcInternalEA(J){return this.calcEA(J)}calcReadEA(J){return this.calcEA(J)}calcWriteEA(J){return this.calcEA(J)}readInternal32(J){const q=this.calcInternalEA(J);if(q+4<=this.u8.length)return this.mem.getU32(q);return 3722304989}writeInternal32(J,q){const Q=this.calcInternalEA(J);if(Q+4<=this.u8.length)this.mem.set32(Q,q)}logRead(J){}logWrite(J,q,Q){}readU64(J){const q=this.calcReadEA(J);if(q+8>this.u8.length)return 0;return this.mem.getU64(q)}readU32(J){const q=this.calcReadEA(J);if(q+4>this.u8.length)return 0;return this.mem.getU32(q)}readU16(J){const q=this.calcReadEA(J);if(q+2>this.u8.length)return 0;return this.mem.getU16(q)}readU8(J){const q=this.calcReadEA(J);if(q+1>this.u8.length)return 0;return this.mem.getU8(q)}readS32(J){const q=this.calcReadEA(J);if(q+4>this.u8.length)return 0;return this.mem.getS32(q)}readS16(J){const q=this.calcReadEA(J);if(q+2>this.u8.length)return 0;return this.mem.getS16(q)}readS8(J){const q=this.calcReadEA(J);if(q+1>this.u8.length)return 0;return this.mem.getS8(q)}write64masked(J,q,Q){const Z=this.calcWriteEA(J)&~7;if(Z+8>this.u8.length)return;this.mem.set64masked(Z,q,Q)}write32masked(J,q,Q){const Z=this.calcWriteEA(J)&~3;if(Z+4>this.u8.length)return;this.mem.set32masked(Z,q,Q)}write64(J,q){const Q=this.calcWriteEA(J);if(Q+8>this.u8.length)return;this.mem.set64(Q,q)}write32(J,q){const Q=this.calcWriteEA(J);if(Q+4>this.u8.length)return;this.mem.set32(Q,q)}write16(J,q){const Q=this.calcWriteEA(J);if(Q+2>this.u8.length)return;this.mem.set16(Q,q)}write8(J,q){const Q=this.calcWriteEA(J);if(Q+1>this.u8.length)return;this.mem.set8(Q,q)}}var TY=0,S$=4,F0=8,N9=12,ih=128,th=256,eh=512,Jk=1024,qk=2048,Qk=4096,Zk=8192,v$=128,x$=256,u$=512,Xk=1,Yk=2,zk=4,Kk=8,Wk=16,Fk=32,$k=64,Hk=128,Gk=256,jk=512,Nk=1024,Lk=2048;var Yq=1,F8=2,L9=4,V9=8,U9=16,Xq=32;class _Y extends r{constructor(J,q,Q){super("MIReg",J,J.mi_reg,q,Q)}reset(){this.mem.set32(S$,33685762)}interruptsUnmasked(){return(this.mem.getU32(N9)&this.mem.getU32(F0))!==0}intrReg(){return this.mem.getU32(F0)}intrMaskReg(){return this.mem.getU32(N9)}setInterruptBit(J){this.mem.setBits32(F0,J),n64js.cpu0.updateCause3()}interruptSP(){this.setInterruptBit(Yq)}interruptDP(){this.setInterruptBit(Xq)}write32(J,q){const Q=this.calcWriteEA(J);if(Q+4>this.u8.length)throw"Write is out of range";switch(Q){case TY:if(!this.quiet)h(`Wrote to MI mode register: ${N(q)}`);this.writeModeReg(q);break;case N9:if(!this.quiet)h(`Wrote to MI interrupt mask register: ${N(q)}`);this.writeIntrMaskReg(q);break;case S$:case F0:break;default:h(`Unhandled write to MIReg: ${N(q)} -> [${N(J)}]`),this.mem.set32(Q,q);break}}writeModeReg(J){let q=this.mem.getU32(TY);if(J&Zk)q|=u$;if(J&Qk)q&=~u$;if(J&th)q|=v$;if(J&ih)q&=~v$;if(J&Jk)q|=x$;if(J&eh)q&=~x$;if(this.mem.set32(TY,q),J&qk)this.mem.clearBits32(F0,Xq),n64js.cpu0.updateCause3()}writeIntrMaskReg(J){let q=0,Q=0;q|=(J&Xk)>>>0,q|=(J&zk)>>>1,q|=(J&Wk)>>>2,q|=(J&$k)>>>3,q|=(J&Gk)>>>4,q|=(J&Nk)>>>5,Q|=(J&Yk)>>>1,Q|=(J&Kk)>>>2,Q|=(J&Fk)>>>3,Q|=(J&Hk)>>>4,Q|=(J&jk)>>>5,Q|=(J&Lk)>>>6;let Z=this.mem.getU32(N9);Z&=~q,Z|=Q,this.mem.set32(N9,Z),n64js.cpu0.updateCause3()}}var g$=function(J,q){return J&~(q-1)},x0=function(J,q){const Q=document.querySelector(J);if(Q)Q.textContent=q};window.n64js=window.n64js||{};class bY{constructor(){this.active=!1,this.$cpuContent=$("#cpu-content"),this.cpuTabs=[$("#cpu0-content"),$("#cpu1-content")],this.$cpu0Disassembly=$("#cpu-disasm"),this.$rspContent=$("#rsp-content"),this.rspTabs=[$("#rsp-scalar-content"),$("#rsp-vector-content"),$("#rsp-task-content")],this.$rspDisassembly=$("#rsp-disasm"),this.$dynarecContent=$("#dynarec-content"),this.$memoryContent=$("#memory-content"),this.$timelineContent=$("#timeline-content"),this.cpu0State=new f$,this.rspState=new p$,this.lastOpExecuted=0,this.recentMemoryAccesses=[],this.lastMemoryAccessAddress=0,this.lastStore=null,this.labelMap=new Map,this.debugCycles=Math.pow(10,0),D5($(".output"),()=>{return N(P.pc)}),n64js.addResetCallback(this.onReset.bind(this)),$("#output").find("#clear").click(function(){O5()});const J=this;$("#cpu-speed").change(function(){J.debugCycles=Math.pow(10,$(this).val()|0),h("Speed is now "+J.debugCycles)}),$("#cpu").find("#address").change(function(){J.disasmAddress=parseInt($(this).val(),16),J.updateCPU()}),this.refreshLabelSelect(),this.$memoryContent.find("input").change(function(){J.lastMemoryAccessAddress=parseInt($(this).val(),16),J.updateMemoryView()}),this.updateMemoryView(),$("body").keydown(function(q){let Q=!1;switch(q.key){case"ArrowDown":Q=!0,J.disassemblerDown();break;case"ArrowUp":Q=!0,J.disassemblerUp();break;case"PageDown":Q=!0,J.disassemblerPageDown();break;case"PageUp":Q=!0,J.disassemblerPageUp();break;case"F8":Q=!0,n64js.toggleRun();break;case"F9":Q=!0,SF();break;case"F10":Q=!0,n64js.step();break}if(Q)q.preventDefault()}),document.querySelector("#cpu-tab").addEventListener("click",()=>{this.updateCPU()}),document.querySelector("#rsp-tab").addEventListener("click",()=>{this.updateRSP()}),document.querySelector("#memory-tab").addEventListener("click",()=>{this.updateMemoryView()}),document.querySelector("#dynarec-tab").addEventListener("click",()=>{this.updateDynarec()}),document.querySelector("#timeline-tab").addEventListener("click",()=>{this.updateTimeline()})}visible(){return this.active}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}toggle(){this.setVisible(!this.active)}setVisible(J){this.active=J,document.querySelectorAll(".debug").forEach((q)=>{q.classList.toggle("hidden",!J)}),MW(J)}showTimeline(){this.updateTimeline(),this.show(),$("#timeline-tab").tab("show")}updateMemoryView(){const J=this.lastMemoryAccessAddress||2147483648;this.$memoryContent.find("pre").empty().append(this.makeMemoryAccessRow(J,1024))}refreshLabelSelect(){const J=$("#cpu").find("#labels"),q=Array.from(this.labelMap.keys()),Q=this;q.sort((Z,X)=>{const Y=Q.labelMap.get(Z),z=Q.labelMap.get(X);return Y.localeCompare(z)}),J.html("");for(let Z of q){const X=this.labelMap.get(Z),Y=$(`<option value="${X}">${X}</option>`);Y.data("address",Z),J.append(Y)}J.change(()=>{let Z=J.find("option:selected").data("address");Q.cpu0State.disasmAddress=Z>>>0,Q.updateCPU()})}onReset(){this.restoreLabelMap(),this.updateCPU(),this.updateRSP()}restoreLabelMap(){this.labelMap=n64js.getLocalStorageItem("debugLabelMap")||new Map,this.refreshLabelSelect()}storeLabelMap(){n64js.setLocalStorageItem("debugLabelMap",this.labelMap)}makeMemoryAccessRow(J,q,Q=64,Z=null){let X=g$(J,Q)-g$(q/2,Q),Y=X+q,z="";for(let K=X;K<Y;K+=Q){let W=v(K,32)+":";for(let G=0;G<Q;G+=4){let H=K+G>>>0,j=n64js.hardware().memMap.readMemoryInternal32(H),L="";if(Z&&Z.has(H))L=` style="background-color: ${Z.get(H)}"`;W+=` <span id="mem-${v(H,32)}"${L}>${v(j,32)}</span>`}W+="\n",z+=W}return $(`<span>${z}</span>`)}makeRecentMemoryAccessRow(J,q){let Q=q==="store"?"#faa":"#ffa";if(q==="update")Q="#afa";let Z=new Map,X=(J&~3)>>>0;return Z.set(X,Q),this.makeMemoryAccessRow(J,32,32,Z)}makeLabelColor(J){let q=J>>>2,Q=q>>>16^(q&65535)*2803,Z=Q&31,X=Q>>>5&31,Y=Q>>>10&31,z=Q>>>15&3;switch(Z*=4,X*=4,Y*=4,z){case 0:Z*=2,X*=2;break;case 1:X*=2,Y*=2;break;case 2:Y*=2,Z*=2;break;default:Z*=2,X*=2,Y*=2;break}return"#"+v(Z,8)+v(X,8)+v(Y,8)}setLabelText(J,q){if(this.labelMap.has(q))J.append(` (${this.labelMap.get(q)})`)}setLabelColor(J,q){J.css("color",this.makeLabelColor(q))}makeLabelText(J){let q=this.labelMap.get(J)||"";while(q.length<20)q+=" ";return q}onLabelClicked(J){let q=$(J.delegateTarget),Q=q.data("address")>>>0,Z=this.labelMap.get(Q)||"",X=$(`<input class="input-mini" value="${Z}" />`);const Y=this;X.keypress((z)=>{if(z.which==13){const K=X.val();if(K)Y.labelMap.set(Q,K.toString());else Y.labelMap.delete(Q);Y.storeLabelMap(),Y.refreshLabelSelect(),this.updateCPU()}}),X.blur(()=>{q.html(Y.makeLabelText(Q))}),q.empty().append(X),X.focus()}onFragmentClicked(J){let Q=$(J.delegateTarget).data("fragment");h(`<pre>${Q.func.toString()}</pre>`)}onClickBreakpoint(J){let Q=$(J.delegateTarget).data("address")>>>0;n64js.breakpoints().toggle(Q),this.updateCPU()}updateCPU(){this.cpu0State.setPC(P.pc);let J=P.getOpsExecuted(),q=this.lastOpExecuted===J-1;this.lastOpExecuted=J;let Q=tX(),Z=this.cpu0State.disassembleRange(),X=$("<pre/>"),Y=$("<pre/>"),z;for(let W=0;W<Z.length;++W){let G=Z[W],H=G.instruction.address,j=G.isJumpTarget||this.labelMap.has(H),L=(j?'<span class="dis-address-target">':'<span class="dis-address">')+v(H,32)+":</span>",V=`<span class="dis-label">${this.makeLabelText(H)}</span>`,U=`${L}  ${v(G.instruction.opcode,32)}  ${V}${G.disassembly}`,M=Q.get(H);if(M){const S=`<span class="dis-fragment-link"> frag - ops=${M.opsCompiled} hit=${M.executionCount}</span>`;U+=S}let k=$(`<span class="dis-line">${U}</span>`);if(k.find(".dis-label").data("address",H).css("color",this.makeLabelColor(H)).click(this.onLabelClicked.bind(this)),M)k.find(".dis-fragment-link").data("fragment",M).click(this.onFragmentClicked.bind(this));if(H===P.pc)z=G.instruction,k.addClass("dis-line-cur");if(j)k.addClass("dis-line-target"),this.setLabelColor(k.find(".dis-address-target"),H);Y.append(k),Y.append("<br>");let O="&nbsp;";if(n64js.breakpoints().isBreakpoint(H))O="&bull;";let R=$(`<span>${O}</span>`).data("address",H).click(this.onClickBreakpoint.bind(this));X.append(R),X.append("<br>")}Y.find(".dis-address-jump").each(function(){let W=parseInt($(this).text(),16);this.setLabelText($(this),W),this.setLabelColor($(this),W),$(this).click(function(){this.cpu0state.disasmAddress=W,this.redraw()})}.bind(this));let K=this.makeRegisterColours(z);for(let[W,G]of K)Y.find(".dis-reg-"+W).css("background-color",G);this.$cpu0Disassembly.find(".dis-recent-memory").html(this.makeRecentMemoryAccesses(q,z,P.calcDebuggerAddress.bind(P))),this.$cpu0Disassembly.find(".dis-gutter").empty().append(X),this.$cpu0Disassembly.find(".dis-view").empty().append(Y),this.cpu0State.updateStatusTable(),this.cpuTabs[0].empty().append(this.cpu0State.makeCop0RegistersTable(K)),this.cpuTabs[1].empty().append(this.cpu0State.makeCop1RegistersTable(K))}updateRSP(){this.rspState.setPC(F.pc);const J=!0;let q=this.rspState.disassembleRange(),Q=$("<pre/>"),Z=$("<pre/>");for(let K=0;K<q.length;++K){let W=q[K],G=W.instruction.address,H=W.isJumpTarget||this.labelMap.has(G),j=(H?'<span class="dis-address-target">':'<span class="dis-address">')+v(G,32)+":</span>",L=`<span class="dis-label">${this.makeLabelText(G)}</span>`,V=`${j}  ${v(W.instruction.opcode,32)}  ${L}${W.disassembly}`,U=$(`<span class="dis-line">${V}</span>`);if(U.find(".dis-label").data("address",G).css("color",this.makeLabelColor(G)).click(this.onLabelClicked.bind(this)),G===F.pc)U.addClass("dis-line-cur");if(H)U.addClass("dis-line-target"),this.setLabelColor(U.find(".dis-address-target"),G);Z.append(U),Z.append("<br>");let M="&nbsp;";if(n64js.breakpoints().isBreakpoint(G))M="&bull;";let k=$(`<span>${M}</span>`).data("address",G).click(this.onClickBreakpoint.bind(this));Q.append(k),Q.append("<br>")}Z.find(".dis-address-jump").each(function(){let K=parseInt($(this).text(),16);this.setLabelText($(this),K),this.setLabelColor($(this),K),$(this).click(function(){this.rspstate.disasmAddress=K,this.redraw()})}.bind(this));const Y=lq(F.pc,F.imem.getU32(F.pc)).instruction;let z=this.makeRegisterColours(Y);for(let[K,W]of z)Z.find(".dis-reg-"+K).css("background-color",W);this.$rspDisassembly.find(".dis-recent-memory").html(this.makeRecentMemoryAccesses(J,Y,F.calcDebuggerAddress.bind(F))),this.$rspDisassembly.find(".dis-gutter").empty().append(Q),this.$rspDisassembly.find(".dis-view").empty().append(Z),this.rspState.updateStatusTable(),this.rspTabs[0].empty().append(this.rspState.makeScalarRegistersTable(z)),this.rspTabs[1].empty().append(this.rspState.makeVectorRegistersTable(z)),this.rspTabs[2].empty().append(this.rspState.makeTaskTable())}makeRegisterColours(J){const q=["#fd7e14","#198754","#0d6efd"];let Q=new Map;if(J){let Z=0;for(let X in J.srcRegs)if(!Object.prototype.hasOwnProperty.call(Q,X))Q.set(X,q[Z++]);for(let X in J.dstRegs)if(!Object.prototype.hasOwnProperty.call(Q,X))Q.set(X,q[Z++])}return Q}makeRecentMemoryAccesses(J,q,Q){const Z=P.opsExecuted;if(J){if(this.lastStore){if(this.lastStore.cycle+1===Z){let z=this.makeRecentMemoryAccessRow(this.lastStore.address,"update");this.lastStore.element.append(z)}this.lastStore=null}const Y=q.memory;if(Y){const z=Q(q.opcode);let K=this.makeRecentMemoryAccessRow(z,Y.mode);if(Y.mode==="store")this.lastStore={address:z,cycle:Z,element:K};if(this.recentMemoryAccesses.push({element:K}),this.recentMemoryAccesses.length>4)this.recentMemoryAccesses.splice(0,1);this.lastMemoryAccessAddress=z}}else this.recentMemoryAccesses=[],this.lastStore=null;let X=$("<pre />");if(this.recentMemoryAccesses.length>0){const Y=["#bbb","#999","#666","#333"];for(let z=0;z<this.recentMemoryAccesses.length;++z){let K=this.recentMemoryAccesses[z].element;K.css("color",Y[z]),X.append(K)}}return X}updateDynarec(){let J=new Map,q=0,Q=[];tX().forEach((z)=>{let K=z.executionCount>0?Math.floor(Math.log10(z.executionCount)):0;J.set(K,(J.get(K)||0)+1),Q.push(z),q=Math.max(q,K)}),Q.sort((z,K)=>{return K.opsCompiled*K.executionCount-z.opsCompiled*z.executionCount});let Z=$('<div class="container-fluid" />'),X="";X+='<div class="row">',X+='<table class="table table-condensed table-nonfluid"><tr><th>Execution Count</th><th>Frequency</th></tr>';for(let z=0;z<=q;z++){let K=J.get(z)||0,W=`< ${Math.pow(10,z+1)}`;X+=`<tr><td>${W}</td><td>${K}</td></tr>`}X+="</table>",X+="</div>",Z.append(X),X="",X+='<div class="row">',X+='  <div class="col-lg-6" id="fragments" />',X+='  <div class="col-lg-6" id="fragment-code" />',X+="</div>";let Y=$(X);this.createHotFragmentsTable(Y,Q),Z.append(Y),this.$dynarecContent.empty().append(Z)}createHotFragmentsTable(J,q){let Q=J.find("#fragment-code"),Z=$('<table class="table table-condensed" />'),X=["Address","Execution Count","Length","ExecCount * Length"];Z.append(`<tr><th>${X.join("</th><th>")}</th></tr>`);for(let Y=0;Y<q.length&&Y<20;++Y){let z=q[Y],K=[N(z.entryPC),z.executionCount,z.opsCompiled,z.executionCount*z.opsCompiled],W=$(`<tr><td>${K.join("</td><td>")}</td></tr>`);this.initFragmentRow(W,z,Q),Z.append(W)}if(J.find("#fragments").append(Z),q.length>0)Q.append(`<pre>${q[0].func.toString()}</pre>`)}initFragmentRow(J,q,Q){J.click(()=>{Q.html(`<pre>${q.func.toString()}</pre>`)})}updateTimeline(){const J=n64js.hardware().timeline,q=this.$timelineContent.find(".timeline-panel");q.empty();let Q=Number.MAX_VALUE,Z=0;J.tracks.forEach((W)=>{W.events.forEach((G)=>{if(G.start<Q)Q=G.start;if(G.end>Z)Z=G.end})});const X=Z-Q;if(X<=0)return;const Y=4000,z=30;let K=0;J.tracks.forEach((W)=>{let G=0;W.events.forEach((H)=>{const j=Y*(H.start-Q)/X,L=Y*(H.end-H.start)/X,V=L<1?1:L,U=(K+H.depth)*z,M=z,k=H.name;let O="";if(O+=`<div class="timeline-block" style="left: ${j.toFixed(0)}px; top: ${U.toFixed(0)}px; width: ${V.toFixed(0)}px; height: ${M.toFixed(0)}px">`,O+=`<div class="timeline-name">${k}</div>`,O+="</div>",q.append(O),H.depth>G)G=H.depth}),K+=G+1})}disassemblerDown(){this.scrollActiveDisassemblyWindow(1),this.redraw()}disassemblerUp(){this.scrollActiveDisassemblyWindow(-1),this.redraw()}disassemblerPageDown(){this.scrollActiveDisassemblyWindow(16),this.redraw()}disassemblerPageUp(){this.scrollActiveDisassemblyWindow(-16),this.redraw()}scrollActiveDisassemblyWindow(J){const q=this.activeDisassemblyWindow();if(q)q.scroll(J)}activeDisassemblyWindow(){if(this.$cpuContent.hasClass("active"))return this.cpu0State;if(this.$rspContent.hasClass("active"))return this.rspState;return null}redraw(){if(!this.active)return;if(this.$cpuContent.hasClass("active"))this.updateCPU();if(this.$rspContent.hasClass("active"))this.updateRSP();if(this.$memoryContent.hasClass("active"))this.updateMemoryView();if(this.$dynarecContent.hasClass("active"))this.updateDynarec()}}class SY{constructor(){this.disasmAddress=0,this.lastPC=-1}setPC(J){if(J!==this.lastPC)this.disasmAddress=J,this.lastPC=J}scroll(J){this.disasmAddress+=J*4}}class f$ extends SY{disassembleRange(){return JW(this.disasmAddress-64,this.disasmAddress+64,!0)}updateStatusTable(){x0("#cpu0-status-opsexecuted",P.opsExecuted),x0("#cpu0-status-pc",N(P.pc)),x0("#cpu0-status-delaypc",N(P.delayPC)),x0("#cpu0-status-epc",N(P.getControlU32(t6))),x0("#cpu0-status-cause",N(Number(P.moveFromControl(d0)&0xffff_ffffn))),x0("#cpu0-status-count",N(Number(P.moveFromControl(i8)&0xffff_ffffn))),x0("#cpu0-status-compare",N(P.getControlU32(AJ))),x0("#cpu0-status-multhi",M8(P.getMultHiU64())),x0("#cpu0-status-multlo",M8(P.getMultLoU64())),this.updateStatusRegisterRow(),this.updateMipsInterruptsRow();let J=$("#cpu0-status-events").find("tbody");J.empty(),J.append("<tr><td>&nbsp;</td></tr>"),J.append("<tr><td>Events</td></tr>");const q=P.eventQueue;let Q=q.cyclesToFirstEvent;for(let Z=q.firstEvent;Z;Z=Z.next)J.append(`<tr><td>${Z.getName()}</td><td class="fixed">${Q}</td></tr>`),Q+=Z.cyclesToNextEvent}updateStatusRegisterRow(){const J=P.getControlU32(S0);x0("#cpu0-status-sr",N(J));const q={"#cpu0-status-sr-ie":lZ,"#cpu0-status-sr-exl":H9,"#cpu0-status-sr-erl":G9};for(let[Q,Z]of Object.entries(q)){const X=document.querySelector(Q);if(!X)continue;const Y=(J&Z)!==0;X.classList.toggle("cpu0-status-bit-set",Y)}}updateMipsInterruptsRow(){const J=n64js.hardware().miRegDevice,q=J.intrReg(),Q=J.intrMaskReg(),Z={"#cpu0-status-mi-sp":Yq,"#cpu0-status-mi-si":F8,"#cpu0-status-mi-ai":L9,"#cpu0-status-mi-vi":V9,"#cpu0-status-mi-pi":U9,"#cpu0-status-mi-dp":Xq};for(let[X,Y]of Object.entries(Z)){const z=document.querySelector(X);if(!z)continue;const K=(q&Y)!==0,W=(Q&Y)!==0;z.classList.toggle("cpu0-status-bit-enabled",W),z.classList.toggle("cpu0-status-bit-set",K)}}makeCop0RegistersTable(J){let q=$('<table class="register-table"><tbody></tbody></table>'),Q=q.find("tbody");const Z=2;for(let X=0;X<32;X+=Z){let Y=$("<tr />");for(let z=0;z<Z;++z){let K=cX[X+z],W=$(`<td>${K}</td><td class="fixed">${M8(P.getRegU64(X+z))}</td>`);if(J.has(K))W.attr("bgcolor",J.get(K));Y.append(W)}Q.append(Y)}return q}makeCop1RegistersTable(J){let q=$('<table class="register-table"><tbody></tbody></table>'),Q=q.find("tbody");for(let Z=0;Z<32;++Z){let X=oX[Z],Y;if((Z&1)===0)Y=$(`<td>${X}</td>
                 <td class="fixed fp-w">${N(t.regU32[Z])}</td>
                 <td class="fixed fp-s">${t.regF32[Z]}</td>
                 <td class="fixed fp-d">${t.regF64[Z/2]}</td>`);else Y=$(`<td>${X}</td>
                 <td class="fixed fp-w">${N(t.regU32[Z])}</td>
                 <td class="fixed fp-s">${t.regF32[Z]}</td>
                 <td></td>`);let z=$("<tr />");if(z.append(Y),J.has(X))z.attr("bgcolor",J.get(X));else if(J.has(X+"-w"))z.find(".fp-w").attr("bgcolor",J.get(X+"-w"));else if(J.has(X+"-s"))z.find(".fp-s").attr("bgcolor",J.get(X+"-s"));else if(J.has(X+"-d"))z.find(".fp-d").attr("bgcolor",J.get(X+"-d"));Q.append(z)}return q}}class p$ extends SY{disassembleRange(){return t9(F.imem,this.disasmAddress-64,this.disasmAddress+64,!0)}updateStatusTable(){x0("#rsp-status-halted",F.halted),x0("#rsp-status-pc",N(F.pc)),x0("#rsp-status-delaypc",N(F.delayPC)),x0("#rsp-status-nextpc",N(F.nextPC)),x0("#rsp-status-branchtarget",N(F.branchTarget)),x0("#rsp-status-vco",Q0(F.VCO)),x0("#rsp-status-vcc",Q0(F.VCC)),x0("#rsp-status-vce",v0(F.VCE))}makeScalarRegistersTable(J){let q=$('<table class="register-table"><tbody></tbody></table>'),Q=q.find("tbody");const Z=2;for(let X=0;X<32;X+=Z){let Y=$("<tr />");for(let z=0;z<Z;++z){let K=nX[X+z],W=$(`<td>${K}</td><td class="fixed">${N(F.getRegU32(X+z))}</td>`);if(J.has(K))W.attr("bgcolor",J.get(K));Y.append(W)}Q.append(Y)}return q}makeVectorRegistersTable(J){let q=$('<table class="register-table"><tbody></tbody></table>'),Q=q.find("tbody");for(let Z=0;Z<32;Z++){let X=$("<tr />");const Y=`V${Z}`;X.append($(`<td>${Y}</td>`));for(let z=0;z<8;++z){let K=$(`<td class="fixed">${v(F.getVecU16(Z,z),16)}</td>`);if(J.has(Y))K.attr("bgcolor",J.get(Y));X.append(K)}Q.append(X)}return q}makeTaskTable(){const Q=n64js.hardware().sp_mem.subRegion(4032,64);let Z=$('<table class="register-table"><tbody></tbody></table>'),X=Z.find("tbody");for(let Y=0;Y<64;Y+=4){const z=$(`<tr><td>${y8.nameOf(Y)}</td><td class="fixed">${v(Q.getU32(Y),32)}</td></tr>`);X.append(z)}return Z}}function m$(J){const q=new DataView(J);switch(q.getUint32(0)){case 2151092800:break;case 1074935680:vY(J,3,2,1,0);break;case 306217015:vY(J,2,3,0,1);break;case 931151890:vY(J,1,0,3,2);break;default:throw"Unhandled byteswapping: "+q.getUint32(0).toString(16)}}var vY=function(J,q,Q,Z,X){const Y=new Uint8Array(J);for(let z=0;z<Y.length;z+=4){const K=Y[z+q],W=Y[z+Q],G=Y[z+Z],H=Y[z+X];Y[z+0]=K,Y[z+1]=W,Y[z+2]=G,Y[z+3]=H}};function c$(J){const q=String.fromCodePoint(...J);return btoa(q)}function xY(J){const q=atob(J);return Uint8Array.from(q,(Q)=>Q.codePointAt(0))}var o$=0;class gY{constructor(J){this.getOpsExecuted=J,this.recording=!1,this.tracks=[new uY(this,"Default"),new uY(this,"Audio")],this.eventCount=0,this.curFrameEvent=0,this.frameCount=0}startRecording(){this.recording=!0;for(let J=0;J<this.tracks.length;J++)this.tracks[J].reset();this.eventCount=0,this.frameCount=0}newFrame(){if(!this.recording)return null;if(this.curFrameEvent)this.curFrameEvent.stop();if(this.tracks[1].curEvent=null,this.curFrameEvent=this.startEventInternal(`Frame ${this.frameCount}`,1),this.frameCount++,this.eventCount>=1e4||this.frameCount>=10)this.recording=!1,this.curFrameEvent=null,n64js.debugger().showTimeline()}addEvent(J,q){if(!this.curFrameEvent)return null;const Q=this.startEventInternal(J,q);if(Q)Q.stop()}startEvent(J,q){if(!this.curFrameEvent)return null;return this.startEventInternal(J,q)}startEventInternal(J,q){const Q=q==void 0?1:q,Z=this.tracks[Q];return this.eventCount++,Z.startEvent(J)}}class uY{constructor(J,q){this.timeline=J,this.name=q,this.events=[],this.curEvent=null}reset(){this.events=[],this.curEvent=null}startEvent(J){const q=this.timeline.getOpsExecuted(),Q=new d$(this,this.curEvent,J,q);return this.events.push(Q),this.curEvent=Q,Q}stopEvent(J){if(J.end=this.timeline.getOpsExecuted(),this.curEvent==J)this.curEvent=J.parent}}class d${constructor(J,q,Q,Z){this.track=J,this.parent=q,this.depth=q?q.depth+1:0,this.name=Q,this.start=Z,this.end=Z}stop(){this.track.stopEvent(this)}}var yk=function(J){if(J<r$)return r$;if(J>s$)return s$;return J},Uk=0,Pk=4,Mk=8,l$=12,hk=16,kk=20,Dk=1,Ok=17825792,Ik=33554432,wk=1073741824,Bk=2147483648,Ak=16777208,Ck=262136,n$="AI DMA",a$=0.005,r$=3000,s$=96000,Rk=0.1,i$=5;class fY extends r{constructor(J,q,Q){super("AIReg",J,J.ai_reg,q,Q);this.audioContext=new window.AudioContext,this.pendingAddress=0,this.dmaAddresses=new Uint32Array(2),this.dmaLengths=new Uint32Array(2),this.dmaDurations=new Uint32Array(2),this.dmaCount=0,this.dmaEnable=!1,this.dacRate=0,this.bitRate=15,this.precision=16,this.frequency=32000,this.time=0,this.dynamicRate=1,this.lastLogTime=0}readU32(J){return this.readS32(J)>>>0}readS32(J){const q=this.calcWriteEA(J);if(q+4>this.u8.length)throw"Write is out of range";if(!this.quiet)h(`Read from ${N(q)}`);if(q==l$){let Q=Ok;return Q|=this.dmaEnable?Ik:0,Q|=this.dmaCount>0?wk:0,Q|=this.dmaCount>1?Bk:0,Q|=this.dmaCount>1?Dk:0,Q}return this.dmaLengthRemaining()}write32(J,q){const Q=this.calcWriteEA(J);if(Q+4>this.u8.length)throw"Write is out of range";switch(Q){case Uk:if(!this.quiet)h(`Wrote to AI_DRAM_ADDR_REG: ${N(q)}`);this.pendingAddress=q&Ak;break;case Pk:if(!this.quiet)h(`Wrote to AI_LEN_REG: ${N(q)}`);this.pushDMA(q&Ck);break;case Mk:if(!this.quiet)h(`Wrote to AI_CONTROL_REG: ${N(q)}`);this.dmaEnable=(q&1)!=0;break;case l$:this.clearAI();break;case hk:if(this.dacRate=q&16383,this.frequency=Math.max(1,this.viClock/(this.dacRate+1))>>0,!this.quiet)h(`AI dacrate changed to ${this.dacRate}, vi clock is ${this.viClock}, freq ${this.frequency}`);break;case kk:if(!this.quiet)h(`Wrote to AI_BITRATE_REG: ${N(q)}`);this.bitRate=q&15,this.precision=this.bitRate+1;break;default:h(`Unhandled write to AIReg: ${N(q)} -> [${N(J)}]`);break}}get viClock(){return this.hardware.viRegDevice.videoClock}pushDMA(J){if(!J){n64js.warn("AI received zero length write");return}if(this.dmaCount>=2){n64js.warn("AI DMA FIFO is full");return}if(this.dmaAddresses[this.dmaCount]=this.pendingAddress,this.dmaLengths[this.dmaCount]=J,this.dmaDurations[this.dmaCount]=this.estimateDMACyclesFromLength(J),this.dmaCount++,this.dmaCount==1)this.startPlayback()}popDMA(){if(this.dmaCount<=0){n64js.warn("AI DMA underflow");return}if(this.dmaCount==2)this.dmaAddresses[0]=this.dmaAddresses[1],this.dmaLengths[0]=this.dmaLengths[1],this.dmaDurations[0]=this.dmaDurations[1];if(this.dmaCount--,this.dmaCount==1)this.startPlayback()}estimateDMACyclesFromLength(J){const Q=(this.bitRate+1<<1)/8*this.frequency;return J*this.viClock/Q>>>0}startPlayback(){const J=this.dmaAddresses[0],q=this.dmaLengths[0],Q=this.dmaDurations[0],Z=q/4,X=new Float32Array(Z),Y=new Float32Array(Z),z=this.hardware.cachedMemDevice.u8,K=new DataView(z.buffer,J,q);for(let V=0;V<Z;V++)X[V]=K.getInt16(V*4+0)/32768,Y[V]=K.getInt16(V*4+2)/32768;const W=this.audioContext.currentTime,G=this.time-W;this.dynamicRate=G>0?+a$:-a$;const H=yk(this.frequency*(1+this.dynamicRate));if(i$>0&&W-this.lastLogTime>i$){const V=G>0?"leading":"lagging";console.log(`AI sync: timeDelta ${G}, ${V}, dynamic ${this.dynamicRate}, ${this.frequency} -> ${H}`),this.lastLogTime=W}const j=new AudioBuffer({length:Z,sampleRate:H,numberOfChannels:2});j.copyToChannel(X,0),j.copyToChannel(Y,1);const L=new AudioBufferSourceNode(this.audioContext,{buffer:j});if(L.connect(this.audioContext.destination),L.start(this.time),G<0)this.time=W;this.time+=j.duration,this.raiseAI(),this.addAIDMAEvent(Q)}shouldSkipFrame(){return this.time-this.audioContext.currentTime>Rk}dmaLengthRemaining(){if(this.dmaCount==0||this.dmaDurations[0]==0)return 0;const J=n64js.cpu0.getCyclesUntilEvent(n$);if(J<=0)return 0;return J*this.dmaLengths[0]/this.dmaDurations[0]&~7}addAIDMAEvent(J){const q=n64js.hardware().timeline.startEvent("AI DMA",o$),Q=this;n64js.cpu0.addEvent(n$,J,()=>{if(Q.dmaComplete(),q)q.stop()})}dmaComplete(){this.popDMA()}raiseAI(){this.hardware.mi_reg.setBits32(F0,L9),n64js.cpu0.updateCause3()}clearAI(){this.hardware.mi_reg.clearBits32(F0,L9),n64js.cpu0.updateCause3()}}var pY=0,mY=4,cY=8,zq=12,Ek=16,Tk=20,_k=24,bk=28,Sk=1,vk=2,xk=4,uk=8,gk=16,fk=32;var oY=1,t$=2,e$=4,JH=8;var qH=32;var pk=128;var QH=1024,dY=16777208,mk=2047;class lY extends r{constructor(J,q,Q){super("DPC",J,J.dpc_mem,q,Q)}get startReg(){return this.mem.getU32(pY)}get endReg(){return this.mem.getU32(mY)}get currentReg(){return this.mem.getU32(cY)}get statusReg(){return this.mem.getU32(zq)}set startReg(J){this.mem.set32(pY,J&dY)}set endReg(J){this.mem.set32(mY,J&dY)}set currentReg(J){this.mem.set32(cY,J&dY)}set statusReg(J){this.mem.set32(zq,J&mk)}setStatusBits(J,q){this.mem.set32masked(zq,q?J:0,J)}get xbusDmemDMA(){return(this.statusReg&oY)!=0}get startValid(){return(this.statusReg&QH)!=0}set startValid(J){this.setStatusBits(QH,J)}write32(J,q){this.writeReg32(this.calcWriteEA(J),q)}writeReg32(J,q){if(J+4>this.u8.length)throw"Write is out of range";switch(J){case pY:if(!this.quiet)h(`DPC start set to: ${N(q)}`);if(this.startValid);else this.startReg=q,this.startValid=!0;break;case mY:if(!this.quiet)h(`DPC end set to: ${N(q)}`);if(this.currentReg=this.startReg,this.endReg=q,this.startValid);this.startValid=!1,this.setStatusBits(pk|qH|JH,!0),this.processBuffer();break;case zq:this.updateStatus(q);break;case cY:case Ek:case Tk:case _k:case bk:h("Wrote to read only DPC reg");break;default:this.mem.set32(J,q);break}}readU32(J){return this.logRead(J),this.readRegU32(this.calcReadEA(J))}readS32(J){return this.logRead(J),this.readRegU32(this.calcReadEA(J))>>0}readRegU32(J){if(J+4>this.u8.length)throw"Read is out of range";return this.mem.getU32(J)}updateStatus(J){let q=this.mem.getU32(zq);if(J&Sk)q&=~oY;if(J&vk)q|=oY;if(J&xk)q&=~t$;if(J&uk)q|=t$;if(J&gk)q&=~e$;if(J&fk)q|=e$;this.mem.set32(zq,q)}processBuffer(){let J;if(this.xbusDmemDMA){const q=this.hardware.sp_mem.subRegion(0,4096).dataView;J=new QJ(q,this.currentReg,this.endReg,4095)}else{const q=this.hardware.cachedMemDevice.mem.dataView;J=new QJ(q,this.currentReg,this.endReg)}if(m0.dumpRDP)console.log(`Processing RDP buffer: start ${N(this.startReg)}, current ${N(this.currentReg)}, end ${N(this.endReg)}, xbus ${this.xbusDmemDMA}`),sW(J).forEach((Q)=>{console.log(`${v(Q.address,24)}: ${Q.disassembly}`)}),m0.dumpRDP=!1;this.hardware.rdp.run(J),this.currentReg=J.curAddr}syncFull(){this.setStatusBits(qH|JH,!1),this.hardware.mi_reg.setBits32(F0,Xq),n64js.cpu0.updateCause3()}}class nY extends r{constructor(J,q,Q){super("DPS",J,J.dps_mem,q,Q)}write32(J,q){if(this.calcWriteEA(J)+4>this.u8.length)throw"Write is out of range";throw"DPS writes are unhandled"}readS32(J){if(this.logRead(J),this.calcReadEA(J)+4>this.u8.length)throw"Read is out of range";throw"DPS reads are unhandled"}readU32(J){return this.readS32(J)>>>0}}function XD(J){return J>=JD&&J<sY}function YD(J){return J>=sY&&J<P9}function XH(J){return J>=P9&&J<iY}function zD(J){return J>=iY&&J<=QD}function KD(J){return J>=KH&&J<=ZD}var YH=function(J){return J>=P9&&J<=qD},Kq=0,Wq=4,aY=8,rY=12,a6=16,ck=20,ok=24,dk=28,lk=32,nk=36,ak=40,rk=44,sk=48,nZ=1;var ik=4,ZH=8,tk=1,ek=2,JD=83886080,sY=100663296,P9=134217728,qD=134348799,iY=268435456,QD=532676607,KH=533725184,ZD=2147483647,zH="PI Interrupt";class tY extends r{constructor(J,q,Q){super("PIReg",J,J.pi_reg,q,Q);this.haveSetMemorySize=!1}reset(){this.haveSetMemorySize=!1}setMemorySize(){if(!this.haveSetMemorySize){const J=this.hardware.rominfo.cic==="6105"?2147484656:2147484440;this.hardware.ram.set32(J-2147483648,8388608),h("Setting memory size"),this.haveSetMemorySize=!0}}readS32(J){const q=this.calcReadEA(J);if(q+4>this.u8.length)throw"Read is out of range";let Q=this.mem.getS32(q);switch(q){case Kq:Q&=16777214;break;case Wq:Q&=4294967294;break;case aY:case rY:Q=127;break}if(!this.quiet)h(`Reading from PIReg: [${N(J)}] -> ${N(Q)}`);return Q}readU32(J){return this.readS32(J)>>>0}write32(J,q){const Q=this.calcWriteEA(J);if(Q+4>this.u8.length)throw"Write is out of range";if(!this.quiet)h(`Writing to PIReg: ${N(q)} -> [${N(J)}]`);if(this.busy()&&Q!=a6){n64js.warn("Write to PI registers while DMA or IO busy"),this.mem.setBits32(a6,ik);return}switch(Q){case Kq:case Wq:this.mem.set32(Q,q);break;case aY:this.mem.set32(Q,q),this.copyFromRDRAM();break;case rY:this.mem.set32(Q,q),this.copyToRDRAM();break;case a6:if(q&tk){if(!this.quiet)h("PI_STATUS_REG reset");this.mem.set32(a6,0),this.removePIInterrupt()}if(q&ek){if(!this.quiet)h("PI interrupt cleared");this.mem.clearBits32(a6,ZH),this.hardware.mi_reg.clearBits32(F0,U9),n64js.cpu0.updateCause3()}break;case ck:case ok:case dk:case lk:case nk:case ak:case rk:case sk:this.mem.set32(Q,q);break;default:h(`Unhandled write to PIReg: ${N(q)} -> [${N(J)}]`),this.mem.set32(Q,q);break}}busy(){return this.mem.getBits32(a6,nZ)!=0}copyFromRDRAM(){const J=this.mem.getU32(Kq)&16777214,q=this.mem.getU32(Wq)&4294967294;let Q=(this.mem.getU32(aY)&16777215)+1,Z,X=0,Y=4096;if(Q>=127&&Q&1)Q++;if(XH(q))if(YH(q))switch(this.hardware.saveType){case"SRAM":Z=this.hardware.saveMem,X=q-P9,this.hardware.saveDirty=!0;break;case"FlashRam":if(Z=this.hardware.romD2A2Device.flashBuffer,X=0,Q>Z.length)n64js.warn(`PI DMA to FlashRam exceeds buffer length (${Q} > ${Z.length})`),Q=Z.length;break}else n64js.halt(`PI: unknown dom2addr2 address for ram->cart DMA: ${N(q)}`);else n64js.halt(`PI: unknown cart address for ram->cart DMA: ${N(q)}`);if(Z)Z.copy(X,this.hardware.ram,J,Q);this.mem.setBits32(a6,nZ),this.addPIInterrupt(Y)}copyToRDRAM(){const J=this.mem.getU32(Kq)&16777214,q=this.mem.getU32(Wq)&4294967294;let Q=(this.mem.getU32(rY)&16777215)+1;if(!this.quiet)h(`PI: copying ${Q} bytes of data from ${N(q)} to ${N(J)}`);if(Q>=127&&Q&1)Q++;if(Q<=128)Q-=J&7;let Z,X=0,Y=this.estimateDMACyclesFromLength(Q);if(YD(q))Z=this.hardware.rom,X=q-sY;else if(zD(q))Z=this.hardware.rom,X=q-iY;else if(KD(q))Z=this.hardware.rom,X=q-KH;else if(XD(q))n64js.halt("PI: dom2addr1 transfer is unhandled (save)");else if(XH(q))if(YH(q)){switch(X=q-P9,this.hardware.saveType){case"SRAM":Z=this.hardware.saveMem;break;case"FlashRam":Z=this.hardware.romD2A2Device.flashDMASource();break}Y=4096}else n64js.halt(`PI: unknown dom2addr2 address for cart->ram DMA: ${N(q)}`);else n64js.halt(`PI: unknown cart address for cart->ram DMA: ${N(q)}`);if(Z)this.hardware.ram.copy(J,Z,X,Q);this.setMemorySize(),this.mem.setBits32(a6,nZ),this.mem.set32(Kq,this.mem.getU32(Kq)+Q+7&~7),this.mem.set32(Wq,this.mem.getU32(Wq)+Q+1&~1),this.addPIInterrupt(Y)}estimateDMACyclesFromLength(J){const q=J>>>3;if(q)return q;return 16}removePIInterrupt(){n64js.cpu0.removeEvent(zH)}addPIInterrupt(J){const q=n64js.hardware().timeline.startEvent("PI DMA"),Q=this;n64js.cpu0.addEvent(zH,J,()=>{if(Q.dmaComplete(),q)q.stop()})}dmaComplete(){this.mem.clearBits32(a6,nZ),this.mem.setBits32(a6,ZH),this.hardware.mi_reg.setBits32(F0,U9),n64js.cpu0.updateCause3()}}var eY=0,WD=4,FD=16,v8=24;var Fq=4096;class Jz extends r{constructor(J,q,Q){super("SIReg",J,J.si_reg,q,Q)}readS32(J){this.logRead(J);const q=this.calcReadEA(J);if(q+4>this.u8.length)throw"Read is out of range";if(q===v8)this.checkStatusConsistent();return this.mem.getS32(q)}readU32(J){return this.readS32(J)>>>0}write32(J,q){const Q=this.calcWriteEA(J);if(Q+4>this.u8.length)throw"Write is out of range";switch(Q){case eY:if(!this.quiet)h(`Writing to SI dram address reigster: ${N(q)}`);this.mem.set32(Q,q);break;case WD:this.mem.set32(Q,q),this.copyToRDRAM();break;case FD:this.mem.set32(Q,q),this.copyFromRDRAM();break;case v8:if(!this.quiet)h("SI interrupt cleared");this.mem.clearBits32(v8,Fq),this.hardware.mi_reg.clearBits32(F0,F8),n64js.cpu0.updateCause3();break;default:h(`Unhandled write to SIReg: ${N(q)} -> [${N(J)}]`),this.mem.set32(Q,q);break}}checkStatusConsistent(){const J=this.hardware.mi_reg.getBits32(F0,F8)!==0,q=this.mem.getBits32(v8,Fq)!==0;if(J!==q)n64js.halt("SI_STATUS register is in an inconsistent state")}copyFromRDRAM(){const J=this.mem.getU32(eY)&536870911;if(!this.quiet)h(`SI: copying from ${N(J)} to PIF RAM`);n64js.joybus().dmaWrite(this.hardware.ram,J),this.mem.setBits32(v8,Fq),this.hardware.mi_reg.setBits32(F0,F8),n64js.cpu0.updateCause3()}copyToRDRAM(){const J=this.mem.getU32(eY)&536870911;if(!this.quiet)h(`SI: copying from PIF RAM to ${N(J)}`);n64js.joybus().dmaRead(this.hardware.ram,J),this.mem.setBits32(v8,Fq),this.hardware.mi_reg.setBits32(F0,F8),n64js.cpu0.updateCause3()}}class qz extends r{constructor(J,q,Q){super("PIFMEM",J,J.pif_mem,q,Q)}readS32(J){const q=this.calcReadEA(J);if(q+4>this.u8.length)throw"Read is out of range";const Q=this.mem.getS32(q);if(q<1984)h(`Reading from PIF rom (${N(J)}). Got ${N(Q)}`);else{const Z=q-1984;switch(Z){case 36:h(`Reading PIF CIC values: ${N(Q)}`);break;case 60:h(`Reading PIF Control byte: ${N(Q)}`);break;default:h(`Reading from PIF ram [${N(J)}]. Got ${N(Q)}`);break}n64js.joybus().cpuRead(Z)}return Q}readU32(J){return this.readS32(J)>>>0}readS8(J){const q=this.calcReadEA(J),Q=this.mem.getU8(q);if(q<1984)h(`Reading from PIF rom (${N(J)}). Got ${v0(Q)}`);else{const Z=q-1984;switch(Z){case 36:h(`Reading PIF CIC values: ${v0(Q)}`);break;case 60:h(`Reading PIF Control byte: ${v0(Q)}`);break;default:h(`Reading from PIF ram [${N(J)}]. Got ${v0(Q)}`);break}n64js.joybus().cpuRead(Z)}return Q}readU8(J){return this.readS8(J)>>>0}write32(J,q){const Q=this.calcWriteEA(J);if(Q<1984){h("Attempting to write to PIF ROM");return}this.mem.set32(Q,q);const Z=Q-1984;switch(Z){case 36:h(`Writing PIF CIC values: ${N(q)}`);break;case 60:h(`Writing PIF Control byte: ${N(q)}`),this.updateControl();break;default:h(`Writing directly to PIF ram [${N(J)}] <-- ${N(q)}`);break}n64js.joybus().cpuWrite(Z)}write16(J,q){const Q=this.calcWriteEA(J);if(Q<1984){h("Attempting to write to PIF ROM");return}const Z=Q&~3,X=8*(2-(Q&2));this.mem.set32(Z,q<<X)}write8(J,q){const Q=this.calcWriteEA(J);if(Q<1984){h("Attempting to write to PIF ROM");return}const Z=Q&~3,X=8*(3-(Q&3));this.mem.set32(Z,q<<X)}updateControl(){const J=this.mem.subRegion(0,1984),q=this.mem.subRegion(1984,64),Q=q.getU8(63);switch(Q){case 1:h("PIF: execute block");break;case 8:h("PIF: interrupt control"),q.set8(63,0),this.hardware.si_reg.setBits32(v8,Fq),this.hardware.mi_reg.setBits32(F0,F8),n64js.cpu0.updateCause3();break;case 16:h("PIF: clear rom"),J.clear();break;case 48:h("PIF: set 0x80 control "),q.set8(63,128);break;case 192:h("PIF: clear ram"),q.clear();break;default:n64js.halt(`Unknown PIF control value: ${v0(Q)}`);break}}}class M9 extends r{constructor(J,q,Q){super("VMEM",J,J.ram,q,Q)}calcInternalEA(J){return n64js.cpu0.translateReadInternal(J)&8388607}calcReadEA(J){return n64js.cpu0.translateRead(J)&8388607}calcWriteEA(J){return n64js.cpu0.translateWrite(J)&8388607}}class Qz extends r{constructor(J,q,Q){super("RAM",J,J.ram,q,Q);this.dataView=this.mem.dataView,this.s32=this.mem.s32Array()}readU32(J){const q=J-2147483648;return this.dataView.getUint32(q,!1)}readS32(J){const q=J-2147483648;return this.dataView.getInt32(q,!1)}write32(J,q){const Q=J-2147483648;this.dataView.setUint32(Q,q,!1)}}class Zz extends r{constructor(J,q,Q){super("RAM",J,J.ram,q,Q)}}class aZ extends r{constructor(J,q,Q){super("Invalid",J,null,q,Q)}read(J){return h(`Reading from invalid address ${N(J)}`),0}write(J){h(`Writing to invalid address ${N(J)}`)}readU32(J){return this.read(J)>>>0}readU16(J){return this.read(J)&65535}readU8(J){return this.read(J)&255}readS32(J){return this.read(J)>>0}readS16(J){return this.read(J)&65535}readS8(J){return this.read(J)&255}write32(J,q){this.write(J,q)}write16(J,q){this.write(J,q)}write8(J,q){this.write(J,q)}}class Xz extends r{constructor(J,q,Q){super("RDRAMReg",J,J.rdram_reg,q,Q)}calcEA(J){return J&255}}var HD=12;class Yz extends r{constructor(J,q,Q){super("RIReg",J,J.ri_reg,q,Q)}reset(){this.mem.set32(HD,1)}}class $8{constructor(J,q,Q){if(q===void 0)q=0;if(Q===void 0)Q=J.byteLength-q;this.arrayBuffer=J,this.offset=q,this.length=Q,this.u8=new Uint8Array(J,q,Q),this.dataView=new DataView(J,q,Q)}clear(){for(let J=0;J<this.u8.length;++J)this.u8[J]=0}set(J,q,Q){for(let Z=0;Z<q;++Z)this.u8[J+Z]=Q}subRegion(J,q){if(J+q>this.length)throw"end is out of bounds";return new $8(this.arrayBuffer,this.offset+J,q)}s32Array(){return new Int32Array(this.arrayBuffer,this.offset,this.length/4)}copy(J,q,Q,Z){if(J+Z>this.u8.length)throw"overflow dst";if(Q+Z>q.u8.length)throw"overflow src";for(let X=0;X<Z;++X)this.u8[J+X]=q.u8[Q+X]}getU64(J){return this.dataView.getBigUint64(J,!1)}getU32(J){return this.dataView.getUint32(J,!1)}getU16(J){return this.dataView.getUint16(J,!1)}getU8(J){return this.dataView.getUint8(J,!1)}getS64(J){return this.dataView.getBigInt64(J,!1)}getS32(J){return this.dataView.getInt32(J,!1)}getS16(J){return this.dataView.getInt16(J,!1)}getS8(J){return this.dataView.getInt8(J,!1)}set64masked(J,q,Q){const X=this.getU64(J,!1)&~Q|q&Q;this.set64(J,X,!1)}set32masked(J,q,Q){const X=this.getU32(J,!1)&~Q|q&Q;this.set32(J,X)}set64(J,q){this.dataView.setBigUint64(J,q,!1)}set32(J,q){this.dataView.setUint32(J,q,!1)}set16(J,q){this.dataView.setUint16(J,q,!1)}set8(J,q){this.dataView.setUint8(J,q,!1)}clearBits32(J,q){const Q=this.getU32(J)&~q;return this.set32(J,Q),Q}setBits32(J,q){const Q=this.getU32(J)|q;return this.set32(J,Q),Q}getBits32(J,q){return this.getU32(J)&q}}var kD=function(J){return(J<<16|J&65535)>>>0},GD=3019833364,zz=3019833376,rZ=512,jD=zz+rZ,ND=75,LD=120,VD=165,UD=180,PD=210,MD=225,hD=240,WH=0,FH=1,$H=2,HH=3,GH=4;class Kz extends r{constructor(J,q,Q){super("ROMd1a1",J,J.rom,q,Q)}write32(J,q){throw`Writing to rom d1a1 ${N(q)} -> [${N(J)}]`}write16(J,q){throw`Writing to rom d1a1 ${Q0(q)} -> [${N(J)}]`}write8(J,q){throw`Writing to rom d1a1 ${v0(q)} -> [${N(J)}]`}}class Wz extends r{constructor(J,q,Q){super("ROMd1a2",J,J.rom,q,Q);this.lastWrite=0,this.hasLastWrite=!1,this.debugBuffer=new ArrayBuffer(rZ),this.debugBufferU32=new Uint32Array(this.debugBuffer),this.debugBufferU8=new Uint8Array(this.debugBuffer),this.output=""}calcEA(J){return J-this.rangeStart+2&~2}write64(J,q){this.cacheLastWrite(Number(q>>32n))}write32(J,q){if(J==GD)return this.writeDebugBufferLen(q);if(J>=zz&&J<jD)return this.writeDebugBuffer32(J-zz,q);this.cacheLastWrite(q>>>0)}write16(J,q){const Q=8*(2-(J&2));this.cacheLastWrite(q<<Q&4294967295)}write8(J,q){const Q=8*(3-(J&3));this.cacheLastWrite(q<<Q&4294967295)}readU32(J){if(this.hasLastWrite)return this.consumeLastWrite()>>>0;return super.readU32(J)}readS32(J){if(this.hasLastWrite)return this.consumeLastWrite()>>0;return super.readS32(J)}readU16(J){if(this.hasLastWrite)return this.consumeLastWrite()>>>16;return super.readU16(J)}readS16(J){if(this.hasLastWrite)return this.consumeLastWrite()>>16;return super.readS16(J)}readU8(J){if(this.hasLastWrite)return this.consumeLastWrite()>>>24;return super.readU8(J)}readS8(J){if(this.hasLastWrite)return this.consumeLastWrite()>>24;return super.readS8(J)}cacheLastWrite(J){if(!this.hasLastWrite)this.lastWrite=J,this.hasLastWrite=!0}consumeLastWrite(){return this.hasLastWrite=!1,this.lastWrite}writeDebugBufferLen(J){if(J>rZ)console.log(`debug buffer value too long (${J}), truncating`),J=rZ;for(let q=0;q<J;q++)this.output+=String.fromCharCode(this.debugBufferU8[q^3]);this.flushDebugOutput()}writeDebugBuffer32(J,q){const Q=J>>>2;this.debugBufferU32[Q]=q}flushDebugOutput(){const J=this.output.lastIndexOf("\n");if(J>=0)console.log(this.output.substring(0,J+1)),this.output=this.output.substring(J+1)}}class Fz extends r{constructor(J,q,Q){super("ROMd1a3",J,J.rom,q,Q)}write32(J,q){throw`Writing to rom d1a3 ${N(q)} -> [${N(J)}]`}write16(J,q){throw`Writing to rom d1a3 ${Q0(q)} -> [${N(J)}]`}write8(J,q){throw`Writing to rom d1a3 ${v0(q)} -> [${N(J)}]`}}class $z extends r{constructor(J,q,Q){super("ROMd2a1",J,null,q,Q)}read(J){if(J==2768241928)return h("Reading from ROMd2a1 0xa5000508 - spoofing ~0 value"),~0;return h(`Reading from invalid ROMd2a1 address ${N(J)}`),0}readU32(J){return this.read(J)>>>0}readU16(J){return this.read(J)&65535}readU8(J){return this.read(J)&255}readS32(J){return this.read(J)>>0}readS16(J){return this.read(J)&65535}readS8(J){return this.read(J)&255}write32(J,q){throw`Writing to rom ${N(q)} -> [${N(J)}]`}write16(J,q){throw`Writing to rom ${Q0(q)} -> [${N(J)}]`}write8(J,q){throw`Writing to rom ${v0(q)} -> [${N(J)}]`}}class Hz extends r{constructor(J,q,Q){super("ROMd2a2",J,null,q,Q);this.flashMode=WH,this.flashStatus=new $8(new ArrayBuffer(8)),this.flashBuffer=new $8(new ArrayBuffer(128)),this.flashOffset=0}hasFlashRam(){return this.hardware.saveType=="FlashRam"}readU32(J){return this.readS32(J)>>>0}readU16(J){return this.readS16(J)>>>0}readU8(J){return this.readS8(J)>>>0}readS32(J){const q=this.calcWriteEA(J);if(q>=557056)return kD(J);if(this.hasFlashRam()){const Q=q&4;return this.flashStatus.getS32(Q)}throw`Reading s32 from rom d2a2 [${N(J)}]`}readS16(J){throw`Reading s16 from rom d2a2 [${N(J)}]`}readS8(J){throw`Reading s8 from rom d2a2 [${N(J)}]`}write32(J,q){const Q=this.calcWriteEA(J);if(this.hasFlashRam()){if(Q!=0)this.flashCommand(q);return}throw`Writing s32 to rom ${N(q)} -> [${N(J)}]`}write16(J,q){throw`Writing s16 to rom ${Q0(q)} -> [${N(J)}]`}write8(J,q){throw`Writing s8 to rom ${v0(q)} -> [${N(J)}]`}flashDMASource(){switch(this.flashMode){case HH:return this.hardware.saveMem;case GH:return this.flashStatus}return n64js.warn(`Unexpected mode for flash DMA: ${this.flashMode}`),null}flashCommand(J){const q=J>>>24&255;switch(q){case ND:if(this.flashOffset=(J&65535)*128,!this.quiet)h(`set erase offset: ${N(this.flashOffset)}`);break;case LD:if(!this.quiet)h("set mode ERASE");this.flashMode=FH,this.flashStatus.set64(0,0x1111_8008_00c2_001dn);break;case VD:if(this.flashOffset=(J&65535)*128,!this.quiet)h(`set write offset: ${N(this.flashOffset)}`);this.flashStatus.set64(0,0x1111_8004_00c2_001dn);break;case UD:if(!this.quiet)h("setting mode WRITE");this.flashMode=$H;break;case PD:switch(this.flashMode){case WH:if(!this.quiet)h("execute IDLE (ignored)");break;case FH:if(!this.quiet)h(`execute ERASE flash @ ${N(this.flashOffset)} (set saveMem to 0xff)`);this.hardware.saveMem.set(this.flashOffset,128,255),this.hardware.saveDirty=!0;break;case $H:if(!this.quiet)h(`execute WRITE flash @ ${N(this.flashOffset)} (copy flashBuffer to saveMem)`);this.hardware.saveMem.copy(this.flashOffset,this.flashBuffer,0,128),this.hardware.saveDirty=!0;break;default:h(`execute (${N(J)}) with unhandled mode: ${this.flashMode}`);break}break;case MD:if(!this.quiet)h("setting mode STATUS");this.flashMode=GH,this.flashStatus.set64(0,0x1111_8001_00c2_001dn);break;case hD:if(!this.quiet)h("setting mode READ");this.flashMode=HH,this.flashStatus.set64(0,0x1111_8004_f000_001dn);break;default:if(!this.quiet)h(`execute with unknown command ${N(q)}`)}}}var DD=!0,Gz=0,jz=4,Nz=8,Lz=12,h9=16,jH=20,NH=24,LH=28,OD=4294967288,ID=4294967288,VH=4287627256,UH=4287627256,PH=4096,MH=4293918720,hH=20,$q=1044480,kH=12,Hq=4095,Gq=0,Vz=1,Uz=2,DH=4,Pz=8,Mz=16,OH=32,IH=64,wH=128,BH=256,AH=512,CH=1024,RH=2048,yH=4096,EH=8192,TH=16384,_H=32768,bH=65536,SH=131072,vH=262144,xH=524288,uH=1048576,gH=2097152,fH=4194304,pH=8388608,mH=16777216,hz=1,cH=2,oH=4,dH=8;var wD=32,lH=64,BD=128,AD=256,aH=512,CD=1024,RD=2048,yD=4096,ED=8192,TD=16384;var _D=aH,bD=0,SD=4092,vD="SP DMA",nH=1,xD=2;class rH{constructor(J,q,Q,Z){this.isRead=J,this.spMemAddr=q,this.rdRamAddr=Q,this.len=Z}}class kz extends r{constructor(J,q,Q){super("SPMem",J,J.sp_mem,q,Q);this.pendingSPMemAddr=0,this.pendingDRAMAddr=0}calcEA(J){return(J-this.rangeStart)%8192}write64(J,q){const Q=this.calcWriteEA(J);this.mem.set32(Q,Number(q>>32n))}write16(J,q){const Q=this.calcWriteEA(J),Z=Q&~3,X=8*(2-(Q&2));this.mem.set32(Z,q<<X)}write8(J,q){const Q=this.calcWriteEA(J),Z=Q&~3,X=8*(3-(Q&3));this.mem.set32(Z,q<<X)}}class Dz extends r{constructor(J,q,Q){super("SPIBIST",J,J.sp_ibist_mem,q,Q)}write32(J,q){const Q=this.calcWriteEA(J);switch(Q){case bD:this.mem.set32(Q,q&SD);break;default:h(`Unhandled write to SPIBISTReg: ${N(q)} -> [${N(J)}]`)}}}class Oz extends r{constructor(J,q,Q){super("SPReg",J,J.sp_reg,q,Q);this.dmaQueue=[]}write32(J,q){this.writeReg32(this.calcWriteEA(J),q)}writeReg32(J,q){if(J+4>this.u8.length)throw"Write is out of range";switch(J){case Gz:this.pendingSPMemAddr=q&OD;break;case jz:this.pendingDRAMAddr=q&ID;break;case Nz:this.mem.set32(J,q&VH),this.pushDMA(nH,q&VH);break;case Lz:this.mem.set32(J,q&UH),this.pushDMA(xD,q&UH);break;case h9:this.spUpdateStatus(q);break;case jH:case NH:break;case LH:this.mem.set32(J,0);break;default:h(`Unhandled write to SPReg: ${N(q)} -> [${N(J)}]`),this.mem.set32(J,q)}}readU32(J){return this.logRead(J),this.readRegU32(this.calcReadEA(J))}readS32(J){return this.logRead(J),this.readRegU32(this.calcReadEA(J))>>0}readRegU32(J){if(J+4>this.u8.length)throw"Read is out of range";const q=this.mem.getU32(J);if(J==LH)this.mem.set32(J,1);return q}setStatusBits(J){if(this.mem.setBits32(h9,J)&lH)this.hardware.miRegDevice.interruptSP()}spUpdateStatus(J){if(!this.quiet){if(J&Vz)h("SP: Clearing Halt");if(J&Uz)h("SP: Setting Halt");if(J&DH)h("SP: Clearing Broke");if(J&Pz)h("SP: Clearing Interrupt");if(J&Mz)h("SP: Setting Interrupt");if(J&OH)h("SP: Clearing Single Step");if(J&IH)h("SP: Setting Single Step");if(J&wH)h("SP: Clearing Interrupt on break");if(J&BH)h("SP: Setting Interrupt on break");if(J&AH)h("SP: Clearing Sig0 (Yield)");if(J&CH)h("SP: Setting Sig0 (Yield)");if(J&RH)h("SP: Clearing Sig1 (Yielded)");if(J&yH)h("SP: Setting Sig1 (Yielded)");if(J&EH)h("SP: Clearing Sig2 (TaskDone)");if(J&TH)h("SP: Setting Sig2 (TaskDone)");if(J&_H)h("SP: Clearing Sig3");if(J&bH)h("SP: Setting Sig3");if(J&SH)h("SP: Clearing Sig4");if(J&vH)h("SP: Setting Sig4");if(J&xH)h("SP: Clearing Sig5");if(J&uH)h("SP: Setting Sig5");if(J&gH)h("SP: Clearing Sig6");if(J&fH)h("SP: Setting Sig6");if(J&pH)h("SP: Clearing Sig7");if(J&mH)h("SP: Setting Sig7")}function q(Y,z,K,W,G){const H=z&W,j=z&K;if(H&&!j)return Y|G;else if(j&&!H)return Y&~G;return Y}let Q=this.mem.getU32(h9),Z=!1,X=!1;if(J&Uz&&J&Vz);else if(J&Uz)Q|=hz,X=!0;else if(J&Vz)Q&=~hz,Z=!0;if(J&Mz&&J&Pz);else if(J&Mz)this.hardware.mi_reg.setBits32(F0,Yq),n64js.cpu0.updateCause3();else if(J&Pz)this.hardware.mi_reg.clearBits32(F0,Yq),n64js.cpu0.updateCause3();if(Q=q(Q,J,DH,0,cH),Q=q(Q,J,OH,IH,wD),Q=q(Q,J,wH,BH,lH),Q=q(Q,J,AH,CH,BD),Q=q(Q,J,RH,yH,AD),Q=q(Q,J,EH,TH,aH),Q=q(Q,J,_H,bH,CD),Q=q(Q,J,SH,vH,RD),Q=q(Q,J,xH,uH,yD),Q=q(Q,J,gH,fH,ED),Q=q(Q,J,pH,mH,TD),this.mem.set32(h9,Q),Z)if(mF()||!DD)this.hardware.spRegDevice.setStatusBits(_D|cH|hz);else F.unhalt();else if(X)F.halt(0)}pushDMA(J,q){if(this.dmaQueue.length>=2){n64js.warn("RSP DMA FIFO is full");return}const Q=J==nH,Z=new rH(Q,this.pendingSPMemAddr,this.pendingDRAMAddr,q);if(this.dmaQueue.push(Z),this.setDMAStatus(),this.dmaQueue.length==1)this.startDMA(Z)}startDMA(J){if(J.isRead)this.spCopyFromRDRAM(J.spMemAddr,J.rdRamAddr,J.len);else this.spCopyToRDRAM(J.spMemAddr,J.rdRamAddr,J.len)}dmaComplete(){if(this.dmaQueue.shift(),this.dmaQueue.length>0)this.startDMA(this.dmaQueue[0]);this.setDMAStatus()}setDMAStatus(){const J=this.dmaQueue.length>=2?dH:0,q=this.dmaQueue.length>=1?oH:0;this.mem.set32(jH,J?1:0),this.mem.set32(NH,q?1:0),this.mem.set32masked(h9,J|q,dH|oH)}spCopyFromRDRAM(J,q,Q){const Z=J&8191,X=q&16777215,Y=((Q&Hq)>>>Gq|7)+1,z=((Q&$q)>>>kH)+1,K=(Q&MH)>>>hH,W=Z&PH;if(!this.quiet)h(`SP: copying ${Y} bytes from ram ${N(X)} to sp ${Q0(Z)}, count ${z}, skip ${K}`);let G=Z,H=X;for(let L=0;L<z;L++){for(let V=0;V<Y;++V)this.hardware.sp_mem.u8[W|G&4095]=this.hardware.ram.u8[H],G++,H++;H+=K}this.mem.set32(Gz,W|G&4095),this.mem.set32(jz,H),this.mem.set32masked(Nz,4088<<Gq,$q|Hq),this.mem.set32masked(Lz,4088<<Gq,$q|Hq);const j=this.estimateDMACyclesFromLength(z,Y);this.addSPDMAEvent(j)}spCopyToRDRAM(J,q,Q){const Z=J&8191,X=q&16777215,Y=((Q&Hq)>>>Gq|7)+1,z=((Q&$q)>>>kH)+1,K=(Q&MH)>>>hH,W=Z&PH;if(!this.quiet)h(`SP: copying ${Y} bytes from sp ${Q0(Z)} to ram ${N(X)}, count ${z}, skip ${K}`);let G=X,H=Z;for(let L=0;L<z;L++){for(let V=0;V<Y;++V)this.hardware.ram.u8[G]=this.hardware.sp_mem.u8[W|H&4095],G++,H++;G+=K}this.mem.set32(Gz,W|H&4095),this.mem.set32(jz,G),this.mem.set32masked(Nz,4088<<Gq,$q|Hq),this.mem.set32masked(Lz,4088<<Gq,$q|Hq);const j=this.estimateDMACyclesFromLength(z,Y);this.addSPDMAEvent(j)}estimateDMACyclesFromLength(J,q){const Z=J*q>>>3;if(Z)return Z;return 16}addSPDMAEvent(J){const q=this;n64js.cpu0.addEvent(vD,J,()=>{q.dmaComplete()})}}var sD=function(J){switch(J){case CJ:return aD;case fq:return qG;case eK:return rD}return qG},iD=function(J){return J==CJ?50:60},sH=0,iH=4,tH=8,Iz=12,wz=16,uD=20,sZ=24,gD=28,fD=32,pD=36,mD=40,cD=44,oD=48,dD=52,eH=2,JG=3;var lD=64;var nD=3,aD=49656530,qG=48681812,rD=48628316,Bz="VI Interrupt";class Az extends r{constructor(J,q,Q){super("VIReg",J,J.vi_reg,q,Q);this.field=0,this.videoClock=0,this.refreshRate=0,this.countPerScanline=0,this.countPerVbl=0,this.reset()}reset(){const J=this.hardware.rominfo.tvType==fq;this.videoClock=sD(J),this.refreshRate=iD(J),this.countPerScanline=0,this.countPerVbl=0,this.screenWidth=640,this.screenHeight=J?480:576,this.hScanMin=J?108:128,this.hScanMax=this.hScanMin+this.screenWidth,this.vScanMin=J?34:44,this.vScanMax=this.vScanMin+this.screenHeight,this.dims=new QG(this.screenWidth,this.screenHeight)}get controlReg(){return this.mem.getU32(sH)}get dramAddrReg(){return this.mem.getU32(iH)}get hWidthReg(){return this.mem.getU32(tH)}get vIntrReg(){return this.mem.getU32(Iz)}get vCurrentLineReg(){return this.mem.getU32(wz)}get timingReg(){return this.mem.getU32(uD)}get vSyncReg(){return this.mem.getU32(sZ)}get hSyncReg(){return this.mem.getU32(gD)}get hSyncLeapReg(){return this.mem.getU32(fD)}get hVideoReg(){return this.mem.getU32(pD)}get vVideoReg(){return this.mem.getU32(mD)}get vBurstReg(){return this.mem.getU32(cD)}get xScaleReg(){return this.mem.getU32(oD)}get yScaleReg(){return this.mem.getU32(dD)}get interlaced(){return(this.controlReg&lD)!=0}get modeType(){return this.controlReg&nD}get is32BitMode(){return this.modeType==JG}get is16BitMode(){return this.modeType==eH}get xScale(){return(this.xScaleReg&4095)/1024}get yScale(){return(this.yScaleReg&4095)/1024}get bitDepth(){switch(this.modeType){case JG:return 32;case eH:return 16}return 0}dump(){console.log(`VI_CONTROL = ${N(this.controlReg)}`),console.log(`VI_DRAM_ADDR = ${N(this.dramAddrReg)}`),console.log(`VI_H_WIDTH = ${N(this.hWidthReg)}`),console.log(`VI_V_INTR = ${N(this.vIntrReg)}`),console.log(`VI_V_CURRENT_LINE = ${N(this.vCurrentLineReg)}`),console.log(`VI_TIMING = ${N(this.timingReg)}`),console.log(`VI_V_SYNC = ${N(this.vSyncReg)}`),console.log(`VI_H_SYNC = ${N(this.hSyncReg)}`),console.log(`VI_H_SYNC_LEAP = ${N(this.hSyncLeapReg)}`),console.log(`VI_H_VIDEO = ${N(this.hVideoReg)}`),console.log(`VI_V_VIDEO = ${N(this.vVideoReg)}`),console.log(`VI_V_BURST = ${N(this.vBurstReg)}`),console.log(`VI_X_SCALE = ${N(this.xScaleReg)} = ${this.xScale}`),console.log(`VI_Y_SCALE = ${N(this.yScaleReg)} = ${this.yScale}`)}verticalBlank(){this.hardware.verticalBlank(),this.field^=this.interlaced?1:0,this.addInterruptEvent(),this.hardware.mi_reg.setBits32(F0,V9),n64js.cpu0.updateCause3(),QZ(),n64js.returnControlToSystem()}initInterrupt(){if(n64js.cpu0.hasEvent(Bz))return;const J=this.mem.getU32(Iz),q=this.mem.getU32(sZ);if(J>=q){h(`not setting VI interrupt - intr ${J} >= sync ${q}`);return}this.addInterruptEvent()}addInterruptEvent(){n64js.cpu0.addEvent(Bz,this.countPerVbl,()=>{this.verticalBlank()})}getVblCount(){const J=n64js.cpu0.getCyclesUntilEvent(Bz);return J>=0?J:0}write32(J,q){const Q=this.calcWriteEA(J);if(Q+4>this.u8.length)throw"Write is out of range";switch(Q){case iH:this.mem.set32(Q,q);break;case sH:if(!this.quiet)h(`VI control set to: ${N(q)}`);this.mem.set32(Q,q);break;case tH:if(!this.quiet)h(`VI width set to: ${q}`);this.mem.set32(Q,q);break;case Iz:if(!this.quiet)h(`VI intr set to: ${q}`);this.mem.set32(Q,q),this.initInterrupt();break;case wz:if(!this.quiet)h(`VI current set to: ${N(q)}`);if(!this.quiet)h("VI interrupt cleared");this.hardware.mi_reg.clearBits32(F0,V9),n64js.cpu0.updateCause3();break;case sZ:if(this.mem.getU32(Q)!=q){const X=q+1;this.countPerScanline=this.hardware.systemFrequency/this.refreshRate/X>>0,this.countPerVbl=X*this.countPerScanline,h(`VI_V_SYNC_REG set to ${q}, cycles per scanline = ${this.countPerScanline}, cycles per vbl = ${this.countPerVbl}`),this.mem.set32(Q,q),this.initInterrupt()}break;default:this.mem.set32(Q,q);break}}readS32(J){this.logRead(J);const q=this.calcReadEA(J);if(q+4>this.u8.length)throw"Read is out of range";if(q===wz){const Q=this.getVblCount(),X=(this.countPerVbl-Q)/this.countPerScanline>>0,Y=this.mem.getU32(sZ);let z=X;if(z>=Y)z-=Y;z=z&~1|this.field,this.mem.set32(q,z)}return this.mem.getS32(q)}readU32(J){return this.readS32(J)>>>0}computeDimensions(){if(this.modeType==0)return h("mode type is 0 - not rendering"),null;const J=this.hVideoReg,q=J>>16&1023,Q=J&1023;let Z=Math.max(q,this.hScanMin),X=Math.min(Q,this.hScanMax);const Y=this.vVideoReg,z=Y>>16&1023,K=Y&1023;let W=Math.max(z,this.vScanMin),G=K<z?this.vScanMax:Math.min(K,this.vScanMax);if(Z>=this.hScanMin)Z+=8;if(X<this.hScanMax)X-=7;const H=this.dims;H.interlaced=this.interlaced,H.field=this.field,H.xSubpixel=this.xScaleReg>>16&4095,H.ySubpixel=this.yScaleReg>>16&4095,H.xScale=this.xScaleReg&4095,H.yScale=this.yScaleReg&4095,H.sx0=Z-q,H.sy0=W-z,H.dx0=Z-this.hScanMin,H.dy0=W-this.vScanMin,H.dstWidth=X-Z,H.dstHeight=G-W,H.srcPitch=this.hWidthReg;const j=(H.sx0+H.dstWidth)*H.xScale>>10,L=(H.sy0+H.dstHeight)*H.yScale>>11,V=H.srcPitch>768||H.srcPitch>=j*2?2:1;return H.srcWidth=j,H.srcHeight=L*V,H}renderBackBuffer(){const J=this.computeDimensions();if(!J)return null;const q=this.dramAddrReg&16777214;if(!q)return null;const Q=this.hardware.cachedMemDevice.mem.dataView;if(this.is32BitMode)return J.renderBackBuffer32(Q,q);if(this.is16BitMode)return J.renderBackBuffer16(Q,q);return null}}class QG{constructor(J,q){this.screenWidth=640,this.screenHeight=480,this.pixels32bpp=new Uint8Array(J*q*4),this.pixels16bpp=new Uint16Array(J*q),this.interlaced=!1,this.field=0,this.dstWidth=640,this.dstHeight=480,this.srcPitch=320,this.srcWidth=320,this.srcHeight=240,this.xSubpixel=0,this.ySubpixel=0,this.xScale=512,this.yScale=1024,this.sx0=0,this.sy0=0,this.dx0=0,this.dy0=0}renderBackBuffer32(J,q){const Q=this.pixels32bpp,Z=-this.screenWidth;let X=(this.screenHeight-1-this.dy0)*this.screenWidth;const Y=255;let z=this.sy0*this.yScale+this.ySubpixel;for(let K=0;K<this.dstHeight;K++){if(!this.interlaced||(this.dy0+K&1)!=this.field){const W=q+(z>>>11)*this.srcPitch*4;let G=X+this.dx0,H=this.sx0*this.xScale+this.xSubpixel;for(let j=0;j<this.dstWidth;j++){const L=J.getInt32(W+(H>>>10)*4,!1);Q[G*4+0]=L>>>24,Q[G*4+1]=L>>>16,Q[G*4+2]=L>>>8,Q[G*4+3]=Y,G++,H+=this.xScale}}z+=this.yScale,X+=Z}return Q}renderBackBuffer16(J,q){const Q=this.pixels16bpp,Z=-this.screenWidth;let X=(this.screenHeight-1-this.dy0)*this.screenWidth;const Y=1;let z=this.sy0*this.yScale+this.ySubpixel;for(let K=0;K<this.dstHeight;K++){if(!this.interlaced||(this.dy0+K&1)!=this.field){const W=q+(z>>>11)*this.srcPitch*2;let G=X+this.dx0,H=this.sx0*this.xScale+this.xSubpixel;for(let j=0;j<this.dstWidth;j++)Q[G++]=J.getInt16(W+(H>>>10)*2,!1)|Y,H+=this.xScale}z+=this.yScale,X+=Z}return Q}}class Cz{constructor(J){this.map=this.createMemMap(J)}createMemMap(J){const q=[];for(let Q=0;Q<16384;++Q)q.push(void 0);if(J.map((Q)=>{const Z=Q.rangeStart>>>18,X=Q.rangeEnd-1>>>18;for(let Y=Z;Y<=X;++Y)q[Y]=Q}),q.length!==16384)throw"initialisation error";return q}getMemoryHandler(J){const q=this.map[J>>>18];if(q)return q;throw h(`accessing unhandled location ${N(J)}`),`unhandled access ${N(J)}`}readMemoryInternal32(J){const q=this.map[J>>>18];if(q)return q.readInternal32(J);return 3722304989}writeMemoryInternal32(J,q){const Q=this.map[J>>>18];if(Q)Q.writeInternal32(J,q)}}var Y6=function(J){return new $8(new ArrayBuffer(J))},Rz=64,tD=4096,eD=93750000;class k9{constructor(){this.data=new Uint8Array(32768),this.dirty=!1}init(J){this.dirty=!1;for(let q=0;q<this.data.length;q++)this.data[q]=0;if(J&&J.data){const q=xY(J.data);for(let Q=0;Q<q.length&&Q<this.data.length;Q++)this.data[Q]=q[Q]}}}class yz{constructor(J){this.rominfo=J,this.timeline=new gY(this.getOpsExecuted.bind(this)),this.systemFrequency=eD,this.rom=null,this.pif_mem=Y6(2048),this.ram=Y6(8388608),this.sp_mem=Y6(8192),this.sp_reg=Y6(32),this.sp_ibist_mem=Y6(8),this.dpc_mem=Y6(32),this.dps_mem=Y6(16),this.rdram_reg=Y6(48),this.mi_reg=Y6(16),this.vi_reg=Y6(56),this.ai_reg=Y6(24),this.pi_reg=Y6(52),this.ri_reg=Y6(32),this.si_reg=Y6(28),this.saveMem=null,this.saveDirty=!1,this.mempacks=[new k9,new k9,new k9,new k9],this.mappedMemDevice=new M9(this,0,2147483648),this.invalidCachedMemDevice=new aZ(this,2147483648,2684354560),this.cachedMemDevice=new Qz(this,2147483648,2155872256),this.invalidUnachedMemDevice=new aZ(this,2684354560,3221225472),this.uncachedMemDevice=new Zz(this,2684354560,2692743168),this.rdRamRegDevice=new Xz(this,2750414848,2751463424),this.spMemDevice=new kz(this,2751463424,2751725568),this.spRegDevice=new Oz(this,2751725568,2751725600),this.spIbistDevice=new Dz(this,2751987712,2751987720),this.dpcDevice=new lY(this,2752512000,2752512032),this.dpsDevice=new nY(this,2753560576,2753560592),this.miRegDevice=new _Y(this,2754609152,2754609168),this.viRegDevice=new Az(this,2755657728,2755657784),this.aiRegDevice=new fY(this,2756706304,2756706328),this.piRegDevice=new tY(this,2757754880,2757754932),this.riRegDevice=new Yz(this,2758803456,2758803488),this.siRegDevice=new Jz(this,2759852032,2759852060),this.romD2A1Device=new $z(this,2768240640,2785017856),this.romD1A1Device=new Kz(this,2785017856,2818572288),this.romD2A2Device=new Hz(this,2818572288,2952790016),this.romD1A2Device=new Wz(this,2952790016,3217031168),this.pifMemDevice=new qz(this,3217031168,3217033216),this.romD1A3Device=new Fz(this,3218079744,3221225472),this.mappedMem2Device=new M9(this,3221225472,3758096384),this.mappedMem3Device=new M9(this,3758096384,4294967296),this.devices=[this.mappedMemDevice,this.invalidCachedMemDevice,this.cachedMemDevice,this.invalidUnachedMemDevice,this.uncachedMemDevice,this.rdRamRegDevice,this.spMemDevice,this.spRegDevice,this.spIbistDevice,this.dpcDevice,this.dpsDevice,this.miRegDevice,this.viRegDevice,this.aiRegDevice,this.piRegDevice,this.riRegDevice,this.siRegDevice,this.romD2A1Device,this.romD1A1Device,this.romD2A2Device,this.romD1A2Device,this.pifMemDevice,this.romD1A3Device,this.mappedMem2Device,this.mappedMem3Device],this.memMap=new Cz(this.devices),this.cpu0=new CY(this),this.cpu1=new FY(this),this.cpu2=new RY(this),this.rdp=new M7(this)}reset(){this.cpu0.reset(),this.cpu1.reset(),this.cpu2.reset(),this.pif_mem.clear(),this.ram.clear(),this.sp_mem.clear(),this.sp_reg.clear(),this.sp_ibist_mem.clear(),this.rdram_reg.clear(),this.dpc_mem.clear(),this.dps_mem.clear(),this.mi_reg.clear(),this.vi_reg.clear(),this.ai_reg.clear(),this.pi_reg.clear(),this.ri_reg.clear(),this.si_reg.clear(),this.initSaveGame();for(let J of this.devices)J.reset()}getOpsExecuted(){return this.cpu0.getOpsExecuted()}createROM(J){if(Math.max(J.byteLength<8388608))J=J.transfer(8388608);const Q=new $8(J);return this.rom=Q,this.romD1A1Device.setMem(Q),this.romD1A2Device.setMem(Q),this.romD1A3Device.setMem(Q),Q}loadROM(){if(this.rom)this.sp_mem.copy(Rz,this.rom,Rz,tD-Rz)}verticalBlank(){this.flushSaveData(),this.timeline.newFrame()}initSaveGame(){for(let[q,Q]of this.mempacks.entries()){const Z=n64js.getLocalStorageItem(`mempack${q}`);Q.init(Z)}const J=this.saveSizeBytes();if(J){const q=new $8(new ArrayBuffer(J)),Q=n64js.getLocalStorageItem("save");if(Q&&Q.data){const Z=xY(Q.data);for(let X=0;X<Z.length&&X<q.u8.length;X++)q.u8[X]=Z[X]}this.saveMem=q}else this.saveMem=null;this.saveDirty=!1}saveSizeBytes(){switch(this.saveType){case"Eeprom4k":return 512;case"Eeprom16k":return 2048;case"SRAM":return 32768;case"FlashRam":return 131072}if(this.saveType)n64js.ui().displayWarning(`Unhandled savegame type: ${this.saveType}.`);return 0}get saveType(){return this.rominfo.save}flushSaveData(){if(this.saveMem&&this.saveDirty)this.saveU8Array("save",this.saveMem.u8),this.saveDirty=!1;for(let[J,q]of this.mempacks.entries())if(q.dirty)this.saveU8Array(`mempack${J}`,q.data),q.dirty=!1}saveU8Array(J,q){const Q={name:this.rominfo.name,id:this.rominfo.id,data:c$(q)};n64js.setLocalStorageItem(J,Q)}checkSIStatusConsistent(){this.siRegDevice.checkStatusConsistent()}}var JO=function(J,q){if(typeof q==="object"&&q!==null){if(q instanceof Map)return{_meta:{type:"map"},value:Array.from(q.entries())};else if(q instanceof Set)return{_meta:{type:"set"},value:Array.from(q.values())};else if("_meta"in q)return{...q,_meta:{type:"escaped-meta",value:q._meta}}}return q},qO=function(J,q){if(typeof q==="object"&&q!==null){if("_meta"in q)if(q._meta.type==="map")return new Map(q.value);else if(q._meta.type==="set")return new Set(q.value);else if(q._meta.type==="escaped-meta")return{...q,_meta:q._meta.value};else console.warn("Unexpected meta",q._meta)}return q},Ez=(J)=>JSON.stringify(J,JO),ZG=(J)=>JSON.parse(J,qO);var XG=function(J){return J>>24&255|J>>8&65280|J<<8&16711680|J<<24&4278190080};function YG(J,q){return v(XG(J),32)+v(XG(q),32)}function zG(J){let q=0;for(let Q=0;Q<4032;Q++)q=q+J[64+Q];switch(q){case 211495:return"6101";case 213534:return"6101";case 213060:return"6102";case 219088:return"6103";case 293505:return"6105";case 225740:return"6106";case 213961:return"6106";default:return h("Unknown CIC Code "+N(q)),"6102"}}function KG(J,q,Q){let Z="";for(let X=0;X<Q;++X){const Y=J[q+X];if(Y===0)break;Z+=String.fromCharCode(Y)}return Z}var WG={"134c3f03a7e79e31":{name:"007 - The World is Not Enough",save:"Eeprom4k"},"9516943beb5e0af9":{name:"007 - The World is Not Enough",save:"Eeprom4k"},"61f1ba1ff1541c2c":{name:"1080 Snowboarding",save:"SRAM"},"253ffd588daa2ed9":{name:"1080 Snowboarding",save:"SRAM"},"091da5abd9ba68c6":{name:"40 Winks",save:"Eeprom4k"},d927f2df69814d0d:{name:"A Bug's Life"},fd04dc82f4822dcf:{name:"A Bug's Life"},c0ae382b10b85063:{name:"A Bug's Life"},"96c0128fe117dc45":{name:"A Bug's Life"},f18b591b459ba2ec:{name:"Aero Fighters Assault",save:"Eeprom4k"},"95bef662d6d602f1":{name:"Aero Fighters Assault",save:"Eeprom4k"},"3e46beae4b4671cc":{name:"AeroGauge",save:"Eeprom4k"},"3111f480f6454638":{name:"AeroGauge",save:"Eeprom4k"},c84530d8363a9df2:{name:"AeroGauge",save:"Eeprom4k"},a682c18cb0cad0c2:{name:"AI Shogi 3"},ccffc42d215affc8:{name:"Aidyn Chronicles - The First Mage",save:"SRAM"},"4f5aa9e623ead2ba":{name:"Aidyn Chronicles - The First Mage",save:"SRAM"},"0cb6456c300ee5dc":{name:"Airboarder 64",save:"Eeprom4k"},d025c427c1992d8c:{name:"Airboarder 64",save:"Eeprom4k"},"941a95b6af49c863":{name:"Akumajou Dracula Mokushiroku"},"063153a55b5ef2b9":{name:"Akumajou Dracula Mokushiroku Gaiden"},fc81607a787a8fff:{name:"Alice no Wakuwaku Trump World",save:"Eeprom4k"},ad84d7df036642ae:{name:"All Star Tennis '99",save:"Eeprom4k"},"91e285e16d76504e":{name:"All Star Tennis '99",save:"Eeprom4k"},"2907d2674c7796f6":{name:"All Star! Dairantou Smash Brothers"},"4d7a545e9507e690":{name:"All-Star Baseball 2000"},efc64654bb478ee1:{name:"All-Star Baseball 2001"},a7233ec41a68b140:{name:"All-Star Baseball 99"},"4dd5edd974e2b86b":{name:"All-Star Baseball 99"},"0290aeb967a3b6c1":{name:"Animal Forest",save:"Eeprom4k"},"17dbf6c032d5e080":{name:"Armorines - Project S.W.A.R.M."},"32d9b51f1b48a93b":{name:"Armorines - Project S.W.A.R.M."},"5071c73c87b9cd21":{name:"Armorines - Project S.W.A.R.M."},b2bb524c6b0fabce:{name:"Army Men - Air Combat"},"57062c866d89fd8d":{name:"Army Men - Sarge's Heroes"},"19df10b21a8db598":{name:"Army Men - Sarge's Heroes"},b6730fb234fc7529:{name:"Army Men - Sarge's Heroes 2"},abd8f7d146043b29:{name:"Asteroids Hyper 64"},c45db2418667721b:{name:"Automobili Lamborghini",save:"Eeprom4k"},bf9777fc3ce8954a:{name:"Automobili Lamborghini",save:"Eeprom4k"},"9ca440e3418d3174":{name:"Baku Bomberman",save:"Eeprom4k"},"4f7c3ce738b893af":{name:"Baku Bomberman 2",save:"Eeprom4k"},"5db998df78098458":{name:"Bakuretsu Muteki Bangaioh",save:"Eeprom4k"},"0a98cf88b52ed58e":{name:"Bakushou Jinsei 64 - Mezase! Resort Ou"},"20d568510dcd5fca":{name:"Banjo to Kazooie no Dai Bouken",save:"Eeprom4k"},"00694b518198b1b4":{name:"Banjo to Kazooie no Dai Bouken 2",save:"Eeprom16k"},ac5975cdaef56cb2:{name:"Banjo-Kazooie",save:"Eeprom4k"},"0693bfa4d1df0cbf":{name:"Banjo-Kazooie",save:"Eeprom4k"},b1cc3f73f9924844:{name:"Banjo-Kazooie",save:"Eeprom4k"},"9aaae9c2aa705d47":{name:"Banjo-Tooie",save:"Eeprom16k"},"396d17c9d17947ea":{name:"Banjo-Tooie",save:"Eeprom16k"},df7c5b152573daf0:{name:"Banjo-Tooie",save:"Eeprom16k"},b4fb88b01d4b1e44:{name:"Bass Hunter 64",save:"Eeprom4k"},caa237d15350b662:{name:"Bass Tsuri No. 1 (Shigesato Itoi's Bass Fishing)"},aaccfabcefd814b8:{name:"Bassmasters 2000"},c18944202bcf8612:{name:"Batman Beyond - Return of the Joker"},"847f9f2526ed9e7c":{name:"Batman Beyond - Return of the Joker"},e7dda46ae7f4e2e3:{name:"BattleTanx"},"47e2a4753d960860":{name:"BattleTanx - Global Assault"},e617ad0c97b7a571:{name:"BattleTanx - Global Assault"},cec4d4558ac75377:{name:"Battlezone - Rise of the Black Dogs"},"3d1c69914d5bacf4":{name:"Beast Wars Metals"},"16d3794d331b50e8":{name:"Beast Wars Transmetal"},a819f4edcc0419bf:{name:"Beetle Adventure Racing!"},d218739cc10dae24:{name:"Beetle Adventure Racing!"},"614ab6a10b9414d0":{name:"Beetle Adventure Racing!"},b7a4ff08b653f401:{name:"Big Mountain 2000",save:"Eeprom4k"},"95351208def11005":{name:"Bio F.R.E.A.K.S."},"1d107cabb0c858ec":{name:"Bio F.R.E.A.K.S."},"8824ae7e5aa3409d":{name:"Bio Hazard 2",save:"SRAM"},dbe6647cdb24b955:{name:"Blast Corps",save:"Eeprom4k"},"257c647ce601d9d9":{name:"Blast Corps (v1.0)",save:"Eeprom4k"},"657e647c05d34819":{name:"Blast Corps (v1.1)",save:"Eeprom4k"},"514423656f34d3eb":{name:"Blast Dozer",save:"Eeprom16k"},"128bd07c89ff5311":{name:"Blues Brothers 2000",save:"SRAM"},"83c871d5cf3f2d82":{name:"Blues Brothers 2000",save:"SRAM"},"6f692653c3999afe":{name:"Body Harvest",save:"Eeprom4k"},cdb8580bd291b2b7:{name:"Body Harvest",save:"Eeprom4k"},c651d4b3e258cbe1:{name:"Bokujo Monogatari 2"},f4f06fdf3842d129:{name:"Bomberman 64",save:"Eeprom4k"},"1ed568f51eba497e":{name:"Bomberman 64",save:"Eeprom4k"},"3603165ab0377bbc":{name:"Bomberman 64",save:"Eeprom4k"},b4737e23376b3bd6:{name:"Bomberman 64 - The Second Attack!",save:"Eeprom4k"},d6fd4644088278e3:{name:"Bomberman Hero",save:"Eeprom4k"},cc12ff671202bf76:{name:"Bomberman Hero",save:"Eeprom4k"},"294e5cd8af76e288":{name:"Bomberman Hero",save:"Eeprom4k"},"4dd12fd7c432ed1f":{name:"Bottom of the 9th"},"2ecf221e13c8aa42":{name:"Brunswick Circuit Pro Bowling"},"1a78ae855df056c7":{name:"Buck Bumble"},b662c7d742963df8:{name:"Buck Bumble"},"9c33b2d5edcabcca":{name:"Buck Bumble"},"73f0868a4be545cd":{name:"Bust-A-Move 2 - Arcade Edition"},"1ededcce02053a51":{name:"Bust-A-Move 2 - Arcade Edition"},fab428e3e1284a00:{name:"Bust-A-Move 3 DX"},"9fd8224237b6e0af":{name:"Bust-A-Move '99"},"0e4016ac1a075dcf":{name:"California Speed"},"4e2d0ff0f4aa0f34":{name:"Carmageddon 64"},ec620158f18b10e3:{name:"Carmageddon 64 (censored)"},f5018ee49b1fe5e6:{name:"Carmageddon 64 (uncensored)"},"47ffcd4b8fafa3aa":{name:"Castlevania v1.2"},"955f5df3693dfe8a":{name:"Castlevania"},cab7f1645537a271:{name:"Castlevania"},"3863c01c26893887":{name:"Castlevania - Legacy of Darkness"},e74bc5a2b2cb1967:{name:"Castlevania - Legacy of Darkness"},"3421cfdc7835d69d":{name:"Centre Court Tennis"},"5a53206462800250":{name:"Chameleon Twist",save:"Eeprom4k"},"21f5f2a48e16ebf0":{name:"Chameleon Twist",save:"Eeprom4k"},c68cafb99ff1c9de:{name:"Chameleon Twist",save:"Eeprom4k"},e48c53cdf9fc8a61:{name:"Chameleon Twist 2"},"5a76490542d0b993":{name:"Chameleon Twist 2"},"019da607a1417d9a":{name:"Chameleon Twist 2"},e8960e1e6b82284e:{name:"Charlie Blast's Territory"},d0483cfb9ff6288d:{name:"Charlie Blast's Territory"},"94ad4c21243b1abe":{name:"Chopper Attack",save:"Eeprom4k"},"3993352ea6eda53f":{name:"Chopper Attack",save:"Eeprom4k"},c4f9cc2b6f9f3d40:{name:"Choro Q 64",save:"Eeprom4k"},"540fcd26e0efeb53":{name:"Choro Q 64 II",save:"Eeprom4k"},"281594a79d19f161":{name:"Chou Snobow Kids"},f40f183af78a8e5c:{name:"Chou Kuukan Night Pro Yakyuu King 2",save:"Eeprom4k"},b09d00f82318296b:{name:"City-Tour GP - All Japan Grand Touring Car Champion"},ff3d5afab9cdc9b4:{name:"Clay Fighter - Sculptor's Cut"},ca243cf0cc7b23c5:{name:"Clay Fighter 63 1/3"},b392968e2abb6442:{name:"Clay Fighter 63 1/3"},c0a76f2b2512a709:{name:"Clay Fighter 63 1/3 (beta)"},ad5b02b5fd7526d3:{name:"Command & Conquer",save:"FlashRam"},b46e28958fd56ab7:{name:"Command & Conquer",save:"FlashRam"},"65945bae76654dc5":{name:"Command & Conquer",save:"FlashRam"},"50acc7302d070477":{name:"Conker's Bad Fur Day",save:"Eeprom16k"},"89583f370aa86c9a":{name:"Conker's Bad Fur Day",save:"Eeprom16k"},aff7a346d091750f:{name:"Cruis'n Exotica",save:"Eeprom4k"},"542540b304c04073":{name:"Cruis'n USA",save:"Eeprom4k"},"60a73e50960e30e1":{name:"Cruis'n USA",save:"Eeprom4k"},b42f2fff9a1461d1:{name:"Cruis'n USA (v1.0)",save:"Eeprom4k"},"45cf06535092c4cb":{name:"Cruis'n USA (v1.1)",save:"Eeprom4k"},"5311e6dfe61861d7":{name:"Cruis'n World",save:"Eeprom16k"},"1e93f3833d2272cb":{name:"Cruis'n World",save:"Eeprom16k"},"870bcb835754327e":{name:"Custom Robo",save:"Eeprom4k"},b9019507ab3202ab:{name:"Custom Robo V2",save:"Eeprom16k"},a18efce89183739f:{name:"CyberTiger"},"078aa7d13edda352":{name:"CyberTiger"},"45f48871680a4184":{name:"Dance Dance Revolution - Disney Dancing Museum"},"582ba5a441987523":{name:"Dark Rift"},d47cd67e6d5e41b4:{name:"Dark Rift"},"493336f51bd2f9db":{name:"Deadly Arts"},d9a9663f005bcb9b:{name:"Defi au Tetris Magique"},e167f6a51fbd1fda:{name:"Derby Stallion 64",save:"FlashRam"},"614ac517e7f2834a":{name:"Densha de GO! 64",save:"SRAM"},a284e5de8711160f:{name:"Destruction Derby 64"},"7da30a63dbd76b89":{name:"Destruction Derby 64"},"9c167989a0f689f1":{name:"Dezaemon 3D",save:"SRAM"},"725629d51570b59c":{name:"Diddy Kong CRACKED",save:"Eeprom4k"},"5aa389f362557817":{name:"Diddy Kong Racing",save:"Eeprom4k"},e740d45311b01975:{name:"Diddy Kong Racing (v1.0)",save:"Eeprom4k"},"75f773fd5a752497":{name:"Diddy Kong Racing (v1.0)",save:"Eeprom4k"},"0d4302e49dfcfcd2":{name:"Diddy Kong Racing (v1.1)",save:"Eeprom4k"},"5b146e599f87d9f7":{name:"Diddy Kong Racing (v1.1)",save:"Eeprom4k"},"1b426cc1f78015a2":{name:"Disney's Donald Duck - Goin' Quackers",save:"Eeprom4k"},"2313264c1a5e294f":{name:"Disney's Tarzan"},c769fecb2aabc0f2:{name:"Disney's Tarzan",save:"Eeprom4k"},d03b1a001adeb3af:{name:"Disney's Tarzan"},bfe514d6c1bc6da7:{name:"Disney's Tarzan",save:"Eeprom4k"},"6d208ebd1c5ec398":{name:"Doubutsu No Mori",save:"Eeprom4k"},"8074f13d5aed3d19":{name:"Donald Duck - Quack Attack"},bfea58ec69717cad:{name:"Donkey Kong 64",save:"Eeprom16k"},a7893c05024306a5:{name:"Donkey Kong 64",save:"Eeprom16k"},"8c6d9311434b2c6f":{name:"Donkey Kong 64",save:"Eeprom16k"},ababd40d1ea9a2b5:{name:"Donkey Kong 64 - Kiosk",save:"Eeprom16k"},"1a103ea89db637e9":{name:"Doom 64"},f4963e425bf088ce:{name:"Doom 64"},"365ba67aade5cefd":{name:"Doom 64"},ac9e732c2677f79e:{name:"Doom 64"},c2b1f7bf8e14bfae:{name:"Doraemon - Mittsu no Seireiseki",save:"Eeprom4k"},"996e30b6b2d23eb6":{name:"Doraemon 2 - Hikari no Shinden",save:"Eeprom16k"},"405127a8e856b0b9":{name:"Doraemon 3 - Nobi Dai No Machi SOS!",save:"Eeprom16k"},"134d9d76fe3f23da":{name:"Dr. Mario 64",save:"Eeprom4k"},a0ecde3fb29b9f39:{name:"Dragon Sword 64"},c33022a6884483f0:{name:"Dual Heroes"},"63ab6e05d5fc15c2":{name:"Dual Heroes"},"614452b6b1046ded":{name:"Dual Heroes"},faf1b9fb8986f86b:{name:"Duck Dodgers Starring Daffy Duck",save:"Eeprom4k"},"7ff0da0488e6180d":{name:"Duke Nukem - ZER0 H0UR"},"4b97ca32509cc2b2":{name:"Duke Nukem - ZER0 H0UR"},"6a6236dccb70373f":{name:"Duke Nukem - ZER0 H0UR"},"56ab73a29adb33da":{name:"Duke Nukem 64"},"3d88121e1827b9d3":{name:"Duke Nukem 64"},"4df7bf57437774de":{name:"Duke Nukem 64"},cfb6db349d7806ea:{name:"Earthworm Jim 3D Ru",save:"Eeprom4k"},"914157df3d12b59e":{name:"Earthworm Jim 3D",save:"Eeprom4k"},e89d2b491cc8ccc6:{name:"Earthworm Jim 3D",save:"Eeprom4k"},"6d76f9bd708d06bd":{name:"ECW Hardcore Revolution"},dbe5388cd7277cb3:{name:"ECW Hardcore Revolution"},cb53a6f23b3b6360:{name:"Elmo's Letter Adventure"},"8f53b102d0884bc9":{name:"Elmo's Number Journey"},dce23ae1e85cb64f:{name:"Eltale Monsters"},"421886079fbc2ea1":{name:"Excitebike 64",save:"Eeprom16k"},"19351c86e51c09f6":{name:"Excitebike 64",save:"Eeprom16k"},e48e2a20898bf883:{name:"Excitebike 64",save:"Eeprom16k"},"7b4f75af8173d11d":{name:"Excitebike 64 - Kiosk",save:"Eeprom16k"},d245a2fd473d4aa7:{name:"Extreme-G"},c42d80ee7dd50b69:{name:"Extreme-G"},"4e839d8ea9298b1e":{name:"Extreme-G"},"0b15d45cf1c20c47":{name:"Extreme-G XG2"},"819b9b3911ad33d5":{name:"Extreme-G XG2"},"85ec851131775a4b":{name:"Extreme-G XG2"},"7a6882ae8d383f9a":{name:"F-1 Pole Position 64"},b248d2fd0e029a56:{name:"F-1 Pole Position 64"},b8bcec3c07bf2661:{name:"F1 Racing Championship"},"3426443860f0b366":{name:"F-1 World Grand Prix",save:"Eeprom4k"},b3c83ccca405c40e:{name:"F-1 World Grand Prix",save:"Eeprom4k"},e5ae0bb7a805503a:{name:"F-1 World Grand Prix",save:"Eeprom4k"},c447bf64ba22bdf4:{name:"F-1 World Grand Prix",save:"Eeprom4k"},"6e86c107decc7557":{name:"F-1 World Grand Prix II",save:"Eeprom16k"},"374cff6dfd63b7b1":{name:"Famista 64"},"4f47294f7a70cb30":{name:"F-Cup Maniax"},decd1acbf21d29cf:{name:"FIFA - Road to World Cup 98"},"673c73f53a97a317":{name:"FIFA - Road to World Cup 98"},f0ed310ed54972c3:{name:"FIFA - Road to World Cup 98"},"30a61376f396d63e":{name:"FIFA 99"},"51a69801849d21fc":{name:"FIFA 99"},"5991f1c35abcd265":{name:"FIFA Soccer 64"},"70e594fe9c3a87e4":{name:"Fighter's Destiny",save:"Eeprom4k"},"0588f752b7ca8f8b":{name:"Fighter's Destiny",save:"Eeprom4k"},c2f9410c0d7a7101:{name:"Fighter's Destiny",save:"Eeprom4k"},"4bc7f136399902f2":{name:"Fighter's Destiny",save:"Eeprom4k"},"452fefaef1307ef9":{name:"Fighter's Destiny 2",save:"Eeprom4k"},"2d6ce4490c111a7b":{name:"Fighting Cup"},cbc7ef32203feac3:{name:"Fighting Force 64"},fe0fcf669c7f69ad:{name:"Fighting Force 64"},"2d56d52850aed5e4":{name:"Fire Electric Pen",save:"Eeprom4k"},e5522da955b6261d:{name:"Flying Dragon"},"3f62e922ad520eb6":{name:"Flying Dragon"},"1a8fff35bee3796e":{name:"Flying Dragon Fighters (Hiro no Ken Twin)"},"79b1e5e8e830aa44":{name:"Frogger 2 (Alpha)"},ff76cdc3decb9d9b:{name:"Forsaken"},"010c339eba14038c":{name:"Forsaken"},aa172a14968d0213:{name:"Forsaken"},"79d4613225bc0ded":{name:"Fox Sports College Hoops '99"},eeea74f73eb1d8f0:{name:"Fushigi no Dungeon - Furai no Shiren 2",save:"FlashRam"},a9d183398c150420:{name:"F-Zero DXP",save:"SRAM"},"78d90eb3f9c90330":{name:"F-Zero X",save:"SRAM"},"2e623e4d4e8b829b":{name:"F-Zero X",save:"SRAM"},f64666772bacb906:{name:"F-Zero X",save:"SRAM"},b67986afbf11105e:{name:"G.A.S.P! Fighter's NEXTream",save:"Eeprom16k"},"26f7fc68bc8c6549":{name:"G.A.S.P! Fighter's NEXTream",save:"Eeprom16k"},"8b162c83aecda256":{name:"Ganbare Goemon"},d99c7b455253c509:{name:"Ganbare Goemon 2 - Deoru Dero Douchuu Obake Tenko"},"0afdff21981d0dfa":{name:"Ganbare Nippon Olympics 2000"},"325e9b7280d928b7":{name:"Gauntlet Legends"},"0e26b0704cd01667":{name:"Gauntlet Legends"},d6bc43d556e2a52b:{name:"Gauntlet Legends"},e6849c48f9496e4c:{name:"Getter Love!! Cho Renai Party Game"},"127edc3ec91c6ce2":{name:"Gex 3 - Deep Cover Gecko"},"59931799c3ebe72f":{name:"Gex 3 - Deep Cover Gecko"},a43347875a7423a8:{name:"Gex 3 - Deep Cover Gecko"},"74d7fe891be2afca":{name:"Gex 64 - Enter the Gecko"},"0e008ae6dd669163":{name:"Gex 64 - Enter the Gecko"},ff016e8e48f9b4cc:{name:"Glover",save:"Eeprom4k"},"017323f593eee399":{name:"Glover",save:"Eeprom4k"},"7fd2c6b2fd8ca42d":{name:"Goemon Mononoke Sugoroku"},ada552424ebf6fae:{name:"Goemon's Great Adventure"},"1cfb9046446dd54c":{name:"Golden Nugget 64"},d150bcdca31afd09:{name:"GoldenEye 007",save:"Eeprom4k"},f14c4fa2ba2723a8:{name:"GoldenEye 007",save:"Eeprom4k"},"61ca1404aab8572e":{name:"GoldenEye 007",save:"Eeprom4k"},a2dc9ac4621b50f1:{name:"GT 64 Championship Edition",save:"Eeprom4k"},"330e4aeec988d58f":{name:"GT 64 Championship Edition",save:"Eeprom4k"},"1401a8957f2ab7e0":{name:"Hamster Monogatari 64",save:"Eeprom4k"},bf2ff236f2128931:{name:"Hanafuda 64 - Tenshi no Yakusoku"},b157ae0937562a18:{name:"Harukanaru Augusta Masters 98",save:"Eeprom4k"},fc9ddf9889c10666:{name:"Harvest Moon 64",save:"SRAM"},"66e8703ee8ba3844":{name:"Heiwa Pachinko World",save:"Eeprom4k"},"77eb3c7f0a038189":{name:"Hercules - The Legendary Journeys"},ebdb90ae2391b879:{name:"Hercules - The Legendary Journeys"},"0ab5b39a056166bc":{name:"Hexen"},bd5f1b5c3416967e:{name:"Hexen"},ea6aab9c001cc687:{name:"Hexen"},"571a75666e9da254":{name:"Hexen"},"0bb3b295c115642b":{name:"Hexen"},"5d0ef1d379a52e05":{name:"Hey You, Pikachu!",save:"Eeprom4k"},"140efa7505d1b3c9":{name:"Holy Magic Century"},b0eb5fb304b22774:{name:"Holy Magic Century"},"9d127b27ff7938dd":{name:"Holy Magic Century"},bd02d7c14765416d:{name:"Hoshi no Kirby 64",save:"Eeprom4k"},"8e8fc9c7de5d1442":{name:"Hot Wheels Turbo Racing"},"9301d2e7938e15c1":{name:"Hot Wheels Turbo Racing"},"7d1d6172d2bd1999":{name:"HSV Adventure Racing"},"2e97355595328ebd":{name:"Human Grand Prix"},"6ac9dbe8eee2c9da":{name:"Hybrid Heaven"},bf882810ca884843:{name:"Hybrid Heaven"},"36cee20de6291dd4":{name:"Hybrid Heaven"},"7f3a1d6466048286":{name:"Hybrid Heaven"},eb65dcc804898c3d:{name:"Hydro Thunder"},e98889b5e84bfcb1:{name:"Hydro Thunder"},"9e8b456936f995fc":{name:"Iggy-kun no Bura Bura Poyon"},bcb516e6888b65c9:{name:"Iggy's Reckin' Balls"},"5ecc92d672d058ec":{name:"Iggy's Reckin' Balls"},"15cc9daf883d721a":{name:"Indiana Jones and the Infernal Machine",save:"Eeprom4k"},"7a4636e49b8fde82":{name:"Indy Racing 2000",save:"Eeprom4k"},e08b138c460e7095:{name:"In-Fisherman Bass Hunter 64",save:"Eeprom4k"},"3754838eb44857cd":{name:"International Superstar Soccer 2000"},a0646333bfd5c806:{name:"International Superstar Soccer 2000"},"71e8e8ba4e94ff35":{name:"International Superstar Soccer 2000"},c463275fe52a4162:{name:"International Superstar Soccer 64"},f07cd3e2ae4e7ef5:{name:"International Superstar Soccer 64"},"43631bf4e66106c1":{name:"International Superstar Soccer 98"},"09da0f7f0bce6160":{name:"International Superstar Soccer '98"},c73b072011013b5e:{name:"International Track and Field 2000"},"79c712671d78723b":{name:"International Track and Field Summer Games"},"476776876571c291":{name:"J. League Dynamite Soccer"},aa0acec619f017d1:{name:"J. League Tactics Soccer (1.1)"},"29a4bf4f15bb2069":{name:"J. League Eleven Beat 1997"},"424a5554fb5f98e4":{name:"J. League Live 64"},a09dd2e8941de615:{name:"J. League Tactics Soccer"},"16d03ac77d53c548":{name:"Jangou Simulation Mahjong Do 64"},"6064256986f5a3b9":{name:"Jeopardy!"},a5b130bbce12f7fc:{name:"Jeremy McGrath Supercross 2000"},fbabf721e8a78a6a:{name:"Jeremy McGrath Supercross 2000"},b609608a50e1ac94:{name:"Jet Force Gemini",save:"FlashRam"},dea1d7684a837900:{name:"Jet Force Gemini",save:"FlashRam"},"47abd8df89ebdb3c":{name:"Jet Force Gemini - Kiosk",save:"FlashRam"},f5d919afcc2302b7:{name:"Jikkyou G1 Stable"},"532a11638fa89fa2":{name:"Jikkyou J. League 1999 - Perfect Striker 2"},"66436c14b3dea672":{name:"Jikkyou J. League Perfect Striker"},"1c1f89d78837e4c3":{name:"Jikkyou Pawafuru Puroyakyu 4 (1.1)"},d144c20a05c60e1f:{name:"Jikkyou Pawapuro Puroyakyu 2000"},"23df6442f7bd28be":{name:"Jikkyou Pawapuro Puroyakyu 2000"},"2056ea3f40db5674":{name:"Jikkyou World Cup France '98"},"8cb354c9b3be626f":{name:"Jikkyou World Cup France '98"},d6abc7e1287f704e:{name:"Jikkyou World Cup France '98"},"8c9fa7e0fa97cc32":{name:"Jikkyou World Soccer 3"},edf6aa4aad286437:{name:"Jinsei Game 64"},b01a15d04ba15cfe:{name:"John Romero's Daikatana"},"4b3c7e9d6c4a0fe6":{name:"John Romero's Daikatana"},"9531740f95dba6d8":{name:"John Romero's Daikatana"},"231f2836cf569700":{name:"Ken Griffey Jr.'s Slugfest",save:"FlashRam"},"3e269b97040047f8":{name:"Killer Instinct Gold",save:"Eeprom4k"},bae28f9e7007278b:{name:"Killer Instinct Gold (v1.0)",save:"Eeprom4k"},facd8f9e2b65f549:{name:"Killer Instinct Gold (v1.0)",save:"Eeprom4k"},"4cca08f927434636":{name:"Killer Instinct Gold (v1.2)",save:"Eeprom4k"},e1a49e51e88475eb:{name:"King Hill 64 - Extreme Snowboarding"},d66abc75c92b5578:{name:"Kiratto Kaiketsu! 64 Tanteidan"},b49f03462c823703:{name:"Kirby 64 - The Crystal Shards",save:"Eeprom4k"},"11ba930da6683868":{name:"Kirby 64 - The Crystal Shards",save:"Eeprom4k"},"6fb81bcac5a5cc41":{name:"Kirby 64 - The Crystal Shards (1.1)",save:"Eeprom4k"},"7a1c580ce4206e3d":{name:"Kirby 64 - The Crystal Shards (1.2)",save:"Eeprom4k"},"9ff8b1bca2520706":{name:"Kirby 64 - The Crystal Shards (1.3)",save:"Eeprom4k"},"99d7e0fc546c3165":{name:"Knife Edge - Nose Gunner"},"3fef1a93906b19ef":{name:"Knife Edge - Nose Gunner"},"747c994a997f08e2":{name:"Knife Edge - Nose Gunner"},"9c9094082dd8d4da":{name:"Knockout Kings 2000"},"95a7d6e33c5d1c2a":{name:"Knockout Kings 2000"},"94846b611092508a":{name:"Kobe Bryant's NBA Courtside",save:"Eeprom16k"},baef3917683ab4d0:{name:"Kobe Bryant's NBA Courtside",save:"Eeprom16k"},e8603e5e95d4b54a:{name:"Kuiki Uhabi Suigo"},"9940307f7652cf52":{name:"Last Legion UX",save:"Eeprom4k"},ea406a09100abe8a:{name:"LEGO Racers"},b3d878f46ddd1697:{name:"LEGO Racers"},"2bc6673d5031d031":{name:"Let's Smash Tennis"},df1850253aaed657:{name:"Lode Runner 3-D",save:"Eeprom4k"},"0bdd4a96db1392b2":{name:"Lode Runner 3-D",save:"Eeprom4k"},"80064660720e5f30":{name:"Lode Runner 3-D",save:"Eeprom4k"},"5b05a00a65df3776":{name:"Looney Tunes - Duck Dodgers",save:"Eeprom4k"},"2ce9cbf412ed92b3":{name:"Lylat Wars",save:"Eeprom4k"},"2bf283245e026e13":{name:"Lylat Wars",save:"Eeprom4k"},"5007706bfe21d629":{name:"Mace - The Dark Age"},"3d444511db0e6111":{name:"Mace - The Dark Age"},"8616b80c815ad85f":{name:"Madden 2000"},"89638313763c5b26":{name:"Madden Football 64"},"52cb97a10ede2075":{name:"Madden Football 64"},"8d4f13d7b5001ac1":{name:"Madden NFL 2002",save:"Eeprom16k"},"92f738eb46a20e19":{name:"Madden NFL 2001"},ba8bb7de9dbdf652:{name:"Madden NFL 99"},"25d625395ec7838c":{name:"Madden NFL 99"},f793efe10b8b9014:{name:"Magical Tetris Challenge"},"4716b67578bfda7a":{name:"Magical Tetris Challenge"},"4a56c880ab659c92":{name:"Magical Tetris Challenge"},"796690e4053f249f":{name:"Magical Tetris Challenge"},"41dc3ec55993e1ec":{name:"Mahjong 64"},"1e82cccc838ae896":{name:"Mahjong Hourouki Classic"},"702cc40fcdf15487":{name:"Mahjong Master"},"5cc0c180f45e06ea":{name:"Major League Baseball Featuring Ken Griffey Jr.",save:"SRAM"},be98b9cdc8a52410:{name:"Major League Baseball Featuring Ken Griffey Jr.",save:"SRAM"},d4a34b66b7808a67:{name:"Mario Golf 64",save:"SRAM"},d14489d40e3ad9b0:{name:"Mario Golf 64",save:"SRAM"},d057e9625d5ac17f:{name:"Mario Golf 64",save:"SRAM"},b655503e52da922e:{name:"Mario Kart 64",save:"Eeprom4k"},"5847ff6b5e5dffe5":{name:"Mario Kart 64 (v1.0)",save:"Eeprom4k"},"9ddeb6c376ded265":{name:"Mario Kart 64 (v1.0)",save:"Eeprom4k"},"87a9c3c94c341058":{name:"Mario Kart 64 (v1.1)",save:"Eeprom4k"},d4c77725aeaa8fd1:{name:"Mario Kart 64 (v1.1)",save:"Eeprom4k"},ac90989adf13c3f0:{name:"Mario No Photopie"},"7e652928771862a0":{name:"Mario Party",save:"Eeprom4k"},be15a8ad2f622860:{name:"Mario Party",save:"Eeprom4k"},"6930669c804af280":{name:"Mario Party",save:"Eeprom4k"},"5858a99e18b672af":{name:"Mario Party 2",save:"Eeprom4k"},"0f7d56ed1589b038":{name:"Mario Party 2",save:"Eeprom4k"},"87033882d944c7df":{name:"Mario Party 2",save:"Eeprom4k"},d929387cce47826e:{name:"Mario Party 3",save:"Eeprom16k"},cdb40a0b3789157b:{name:"Mario Party 3",save:"Eeprom16k"},"604167c53c455f0f":{name:"Mario Party 3",save:"Eeprom16k"},dccda73ba0524e46:{name:"Mario Story",save:"FlashRam"},"4fcf0150bdb30cf3":{name:"Mario Tennis",save:"Eeprom16k"},b5426c3a1bdaca1a:{name:"Mario Tennis",save:"Eeprom16k"},d53a9f83fa156d40:{name:"Mario Tennis",save:"Eeprom16k"},f558c10e96683efb:{name:"Mega Man 64",save:"FlashRam"},"0cf10110c1d8513d":{name:"Mia Hamm Soccer 64"},c26661e3e5a21386:{name:"Michael Owens WLS 2000"},"71458cfac0f9e7bb":{name:"Mickey's Speedway USA",save:"Eeprom4k"},"9addd0dea72582e7":{name:"Mickey's Speedway USA",save:"Eeprom4k"},afe66a73c7e91741:{name:"Mickey no Racing Challenge USA",save:"Eeprom4k"},"350c85f11279e0ac":{name:"Micro Machines 64 Turbo"},"8d01492a024a03d0":{name:"Micro Machines 64 Turbo"},"4c5eb3e4c95cc41a":{name:"Midway's Greatest Arcade Hits Volume 1"},"163ed509b968b23a":{name:"Mike Piazza's Strike Zone"},cd5e952e840800f3:{name:"Milo's Astro Lanes"},"9d0d499adc3a018f":{name:"Milo's Astro Lanes"},"1b05930bf9813d60":{name:"Mischief Makers",save:"Eeprom4k"},"98da8b41580f8a24":{name:"Mischief Makers",save:"Eeprom4k"},"7e3feb93445e6781":{name:"Mission Impossible",save:"Eeprom4k"},f85c032635912b80:{name:"Mission Impossible",save:"Eeprom4k"},"345b0920879e3d34":{name:"Mission Impossible",save:"Eeprom4k"},dc49a9ebbdecba39:{name:"Mission Impossible",save:"Eeprom4k"},daec56229c1bab71:{name:"Mission Impossible",save:"Eeprom4k"},e2046a5f0d07fad4:{name:"Mission Impossible",save:"Eeprom4k"},"6d8d76286c9779b3":{name:"Monaco Grand Prix",save:"Eeprom4k"},e183c35a87e312d7:{name:"Monopoly",save:"Eeprom4k"},"99d99ab11851587e":{name:"Monster Truck Madness 64"},fc06d8d3a8a23ab4:{name:"Monster Truck Madness 64"},"70dde8e898d15d41":{name:"Morita Shogi 64",save:"Eeprom4k"},f4d47d41e22f481b:{name:"Mortal Kombat 4",save:"Eeprom4k"},"3b6f0373e9690dce":{name:"Mortal Kombat 4",save:"Eeprom4k"},ac0443c321c0792d:{name:"Mortal Kombat Mythologies - Sub-Zero"},c4ed44ff1392ae1a:{name:"Mortal Kombat Mythologies - Sub-Zero"},"125cf7d9599b85a8":{name:"Mortal Kombat Trilogy"},"92113d8ce172f1be":{name:"Mortal Kombat Trilogy"},a93af3830dd401a9:{name:"Mortal Kombat Trilogy (v1.2)"},"5cb6f92ad7a2e285":{name:"MRC - Multi Racing Championship",save:"Eeprom4k"},"13b4b6a6cc13d115":{name:"MRC - Multi Racing Championship",save:"Eeprom4k"},"03bdf0b89e187944":{name:"MRC - Multi Racing Championship",save:"Eeprom4k"},"5c52381956966e58":{name:"Ms. Pac-Man Maze Madness"},"21cbbcfc6b3c9072":{name:"Mystical Ninja - Starring Goemon"},be0f36f51d69f12b:{name:"Mystical Ninja - Starring Goemon"},d345937fdeca1e84:{name:"Mystical Ninja 2 - Starring Goemon"},"8725c27e23e31aef":{name:"Nagano Olympic Hockey '98"},"3730f490f570535c":{name:"Nagano Olympic Hockey '98"},"353a2dae1ad4f024":{name:"Nagano Olympic Hockey '98"},"98ae2b8dbf2537d7":{name:"Nagano Winter Olympics '98"},"4cc3c52f9dcc057a":{name:"Nagano Winter Olympics '98"},"1620456dee093c71":{name:"Nagano Winter Olympics '98"},dab629518c3cef9d:{name:"Namco Museum 64"},"181a33df44e0d45f":{name:"NASCAR 2000"},"78957423fd58dc80":{name:"NASCAR 99"},"49140000c99249ae":{name:"NASCAR 99"},c99249ae53b25392:{name:"NASCAR 99"},"57ebf724f4f9b374":{name:"NBA Courtside 2 - Featuring Kobe Bryant",save:"FlashRam"},d8526891efeadb73:{name:"NBA Courtside 2 - Featuring Kobe Bryant",save:"FlashRam"},"87b4694e90e218fe":{name:"NBA Hangtime"},aedc88c70a0003bd:{name:"NBA Hangtime"},"011fe1aa45a02526":{name:"NBA In the Zone 2000"},"185bf98d7b49daec":{name:"NBA In the Zone 2000"},"9f4f05b3b59eb696":{name:"NBA In the Zone 2000"},"3019126a74c25c66":{name:"NBA In the Zone '98"},"9bbaac36944d8df2":{name:"NBA In the Zone '98"},"4f5292a2492a6c3d":{name:"NBA In the Zone '99"},dba8eeeb3cb2ecf2:{name:"NBA Jam 2000"},a0cad0b6c893f4e3:{name:"NBA Jam 2000"},f6290781c1cf3fe0:{name:"NBA Jam 99"},"1e8300e6a822f459":{name:"NBA Jam 99"},eeb0255fdbc12762:{name:"NBA Live 2000"},"8f9c49ebb66745cd":{name:"NBA Live 2000"},"9b1cf85735fa3311":{name:"NBA Live 99"},"5ff484cfebf6e400":{name:"NBA Live 99"},"2f96deac7ff8cbb2":{name:"NBA Pro 98"},b680178d76b9b357:{name:"NBA Pro 99"},f480fe3f7e5fc1a7:{name:"NBA Showtime - NBA on NBC"},db0e7e142cb1c536:{name:"Neon Genesis Evangelion",save:"Eeprom16k"},"4fd5ea30f60b6231":{name:"NFL Blitz - Special Edition"},"70b194d0ccb5c4d7":{name:"NFL Blitz"},"6909a01585a2e534":{name:"NFL Blitz 2000"},eb35fa36362e5ee8:{name:"NFL Blitz 2001"},d04eabe3d20d0483:{name:"NFL Quarterback Club 2000"},"9e5abd88bfdf1fe8":{name:"NFL Quarterback Club 2000"},"224678288529b2ff":{name:"NFL Quarterback Club 2001"},f8e29bd8df7ac999:{name:"NFL Quarterback Club 98"},f49e624b9b1db299:{name:"NFL Quarterback Club 98"},ffed76be092d4520:{name:"NFL Quarterback Club 99"},"47cfa352fc3bc14e":{name:"NFL Quarterback Club 99"},"6e801a591d92e6a5":{name:"NHL 99"},"1e607d28aef8f4ab":{name:"NHL 99"},"30dcef8261246a80":{name:"NHL Blades of Steel '99"},c3cdfd6dc801e74d:{name:"NHL Breakaway 98"},"9276ce297985c571":{name:"NHL Breakaway 98"},d06817444ff2737d:{name:"NHL Breakaway 99"},cb21468727c13100:{name:"NHL Breakaway 99"},d95c89a96c012070:{name:"NHL Pro 99"},"4d675728da3743cc":{name:"Nightmare Creatures"},df3c3ccdfa937731:{name:"Nintama Rantarou 64"},"45b8508f2fd229d7":{name:"Nuclear Strike 64"},bbdd9849bcaeb7f7:{name:"Nuclear Strike 64"},"97a1978ac1f62d27":{name:"Nuclear Strike 64"},"20b93bd8166440cc":{name:"Nushi Zuri 64"},"18169b5b49c6431b":{name:"Nushi Tsuri 64 - Shiokaze ni Notte"},ec939031ef09c20f:{name:"Off Road Challenge"},d08922819632e5c2:{name:"Off Road Challenge"},c59b41e6e31d0169:{name:"Ogre Battle 64 - Person of Lordly Caliber",save:"SRAM"},"67cf7503aa3fa956":{name:"Ogre Battle 64 - Person of Lordly Caliber (v1.1)",save:"SRAM"},"6910969c8d48eaf5":{name:"Ohzumou 64",save:"Eeprom4k"},"168bc185af2296df":{name:"Ohzumou 64 2",save:"Eeprom4k"},"669464dcd9f02f57":{name:"Onegai Monsters"},"3b4b5574b5bcaef4":{name:"Pachinko 365 Nichi"},"3ae5ee653c737ded":{name:"Paper Mario",save:"FlashRam"},af29ab1928cd1bc7:{name:"Paper Mario",save:"FlashRam"},"129b52893bed5308":{name:"Paperboy"},"9e8d193e7e26e1f2":{name:"Paperboy"},"386b97ac7ac9a9c3":{name:"Paperboy"},"31cbe2cf1d1e6b4d":{name:"Parlor! Pro 64 Pachinko Jikki Simulation Game"},"6647dd6ea89b3ea9":{name:"Pawapuro Puroyakyu 2001"},ad5b4934269d2e50:{name:"Pawapuro Puroyakyu 4"},da4329d2c0772bac:{name:"Pawapuro Puroyakyu 5"},b7205eb7fdfdfeb3:{name:"Pawapuro Puroyakyu 6"},"8c1168f44ee42ee3":{name:"PD Ultraman Battle Collection 64",save:"Eeprom16k"},fbb1ab739360ca9c:{name:"Penny Racers",save:"Eeprom4k"},"83eb3cc81962c5fd":{name:"Penny Racers",save:"Eeprom4k"},b47e749643b24b10:{name:"Perfect Dark",save:"Eeprom16k"},"0780b0e433ff02a6":{name:"Perfect Dark",save:"Eeprom16k"},cc60f4ddc034a63c:{name:"Perfect Dark (v1.0)",save:"Eeprom16k"},"8fb9f24166b458b4":{name:"Perfect Dark (v1.1)",save:"Eeprom16k"},"81e84cb52661cbbc":{name:"PGA European Tour",save:"Eeprom4k"},"02c608eea6d5c26b":{name:"PGA European Tour",save:"Eeprom4k"},"0553243faa740bfc":{name:"Pikachu Genki Dechu"},"1c9651c8faaafc78":{name:"Pilot Wings 64",save:"Eeprom4k"},"0148cc0991e42ee4":{name:"Pilot Wings 64",save:"Eeprom4k"},d55aa01a802df546:{name:"Pilot Wings 64",save:"Eeprom4k"},"0d690fec8c43a732":{name:"Pocket Monsters Snap",save:"FlashRam"},"59825e661dbd98d0":{name:"Pocket Monsters Stadium",save:"FlashRam"},"865877637b0eb85f":{name:"Pocket Monsters Stadium 2",save:"FlashRam"},ac47477a23ecee44:{name:"Pokemon Puzzle League",save:"FlashRam"},a753c519524b0fa7:{name:"Pokemon Puzzle League",save:"FlashRam"},f3e6b23efe9e2f06:{name:"Pokemon Puzzle League",save:"FlashRam"},"53d11c4af8ae30d8":{name:"Pokemon Puzzle League",save:"FlashRam"},"6f97f54fd859f5ac":{name:"Pokemon Snap",save:"FlashRam"},"6a287d81167441ef":{name:"Pokemon Snap",save:"FlashRam"},"0d7253574d888a2a":{name:"Pokemon Snap",save:"FlashRam"},"47b512cae44efa71":{name:"Pokemon Snap",save:"FlashRam"},"3a296cba38a3af9f":{name:"Pokemon Snap",save:"FlashRam"},"4650c8c0051b0561":{name:"Pokemon Snap",save:"FlashRam"},"408db17b59851383":{name:"Pokemon Snap",save:"FlashRam"},"729811399f2e7207":{name:"Pokemon Snap Station",save:"FlashRam"},"432d121a0faf7dc1":{name:"Pokemon Stadium - Kiosk",save:"FlashRam"},"2da83fa55dc1e2da":{name:"Pokemon Stadium",save:"FlashRam"},"5de0c991b9af3aad":{name:"Pokemon Stadium",save:"FlashRam"},"1b1e0142b52d55e3":{name:"Pokemon Stadium",save:"FlashRam"},b3d9f590f0dc0e9d:{name:"Pokemon Stadium",save:"FlashRam"},a35335a2392dbf42:{name:"Pokemon Stadium",save:"FlashRam"},"757207849c5b3157":{name:"Pokemon Stadium",save:"FlashRam"},ce49e5b6c03481dc:{name:"Pokemon Stadium",save:"FlashRam"},"821157036dd02f89":{name:"Pokemon Stadium 2",save:"FlashRam"},c7a55aacc3cdb0a9:{name:"Pokemon Stadium 2",save:"FlashRam"},"727e9b435d49a1c1":{name:"Pokemon Stadium 2",save:"FlashRam"},"0bfca1d04b07b82f":{name:"Pokemon Stadium 2",save:"FlashRam"},"00afceef48480922":{name:"Pokemon Stadium 2",save:"FlashRam"},"5bfca1d04b07b82f":{name:"Pokemon Stadium 2",save:"FlashRam"},"9c365229a8c3e4b6":{name:"Pokemon Stadium 2",save:"FlashRam"},c2d74fee38d9f19c:{name:"Pokemon Stadium GS",save:"FlashRam"},"9207384145e067a1":{name:"Polaris Sno Cross"},fadca6d7b7b6fecc:{name:"Power League Baseball 64"},ad5789cfa97ed596:{name:"Power Rangers - Lightspeed Rescue"},"110cf6397dba2eab":{name:"Power Rangers - Lightspeed Rescue"},"75d474fcab78029a":{name:"Powerpuff Girls - Chemical X-Traction",save:"Eeprom4k"},"547fd2f3f9ac11c1":{name:"Premier Manager 64"},"4e0ca19bd3ab0804":{name:"Pro Mahjong Kiwame 64"},"0fb3dc1b76d832a1":{name:"Pro Mahjong Tsuwamono 64"},"8366ce8a6e42ba3f":{name:"Pro Yak Yu King Baseball"},b972464be75dbe2d:{name:"Puyo Puyo 4 - Puyo Puyo Party",save:"Eeprom4k"},"6b7e8094e462cc60":{name:"Puyo Puyo Sun 64",save:"Eeprom4k"},"4707dec0d372dfa2":{name:"Puzzle Bobble 64"},"9cf75b9fa008fed2":{name:"Quake 64"},"741d9316346ddc65":{name:"Quake 64"},"43f1a8bd622dafb1":{name:"Quake II"},d7d93374d022432c:{name:"Quake II"},d94dbbc80b435fcc:{name:"Quest 64"},a55f70280e6909b5:{name:"Racing Simulation - Monaco Grand Prix",save:"Eeprom4k"},"2dac77289a13dcc3":{name:"Racing Simulation 2"},f0ca1e9f0e8ac4ee:{name:"Rakuga Kids"},"6818d267614042c5":{name:"Rakuga Kids"},"0cbad935865548df":{name:"Rally '99"},"3d8ea87371c5c53a":{name:"Rally Challenge 2000",save:"Eeprom4k"},e4f99fc27dfe4b26:{name:"Rampage - World Tour"},"4844d484b019ca67":{name:"Rampage - World Tour"},"9b093d67de08c8a4":{name:"Rampage 2 - Universal Tour"},"4942fc5d079c5299":{name:"Rampage 2 - Universal Tour"},"8ec40403b80140ac":{name:"Rat Attack"},f10bfd20871dcff5:{name:"Rat Attack"},"9bbfc5f3e2330f16":{name:"Rayman 2 - The Great Escape"},"0be1d56046eded8b":{name:"Rayman 2 - The Great Escape"},"4a831839290cb515":{name:"Razor Freestyle Scooter"},"29b4b7ea572cc9ba":{name:"Ready 2 Rumble Boxing"},"34a3d48b058b131e":{name:"Ready 2 Rumble Boxing"},"339521e9bdaffb13":{name:"Ready 2 Rumble Boxing Round 2"},a5b118aaeb6adb07:{name:"Resident Evil 2",save:"SRAM"},"8e0e509bb35005e9":{name:"Resident Evil 2",save:"SRAM"},"87a91f0fa6afc1bf":{name:"Re-Volt"},"9ee2e7c3cc51725d":{name:"Re-Volt"},"6c7450f00b827b24":{name:"Road Rash 64"},"6a36d8029cefab6c":{name:"Road Rash 64"},db4d6b0b82e67196:{name:"Roadsters"},"707ae874d4ae9362":{name:"Roadsters"},d3a5bc747e5f944a:{name:"Roadsters Trophy"},"0f692b27777a0aad":{name:"Robot Ponkottsu 64 - Caramel of the 7 Seas",save:"Eeprom4k"},"93b8a075b521a34c":{name:"Robotech - Crystal Dreams"},"324b8eac2673b4e7":{name:"Robotron 64"},"4f9df69f59005f19":{name:"Robotron 64"},f875d39fc82df345:{name:"Rocket - Robot on Wheels",save:"Eeprom4k"},"85e05e0c3edd67a1":{name:"Rocket - Robot on Wheels",save:"Eeprom4k"},"3b5966d6075ca2d7":{name:"Rockman Dash",save:"FlashRam"},"7e260025cec37e2a":{name:"RR64 - Ridge Racer 64",save:"Eeprom16k"},"1070e9fea0a9944e":{name:"RR64 - Ridge Racer 64",save:"Eeprom16k"},"378f8f658dd21318":{name:"RTL World League Soccer 2000"},c5b3020cb811259e:{name:"Rugrats - Scavenger Hunt"},dadf3a4daefc9875:{name:"Rugrats - Treasure Hunt"},"0fca1a458abc6378":{name:"Rugrats - Treasure Hunt"},b46c692bd8dc937b:{name:"Rugrats - Treasure Hunt"},"3215c21fd466640b":{name:"Rugrats in Paris - The Movie"},"391dc60aa603faab":{name:"Rugrats in Paris - The Movie"},"31e0d6ed13601368":{name:"Rush 2 - Extreme Racing USA"},"3621cfb715a70afa":{name:"Rush 2 - Extreme Racing USA"},f34791760ec13320:{name:"S.C.A.R.S."},"602d8e913e6865f8":{name:"S.C.A.R.S."},"20186b2a66f4bc6a":{name:"San Francisco Rush - Extreme Racing"},b016d1610cd624fa:{name:"San Francisco Rush - Extreme Racing"},a2eca9b98ee4aa17:{name:"San Francisco Rush 2049"},"1894d251e36ab4d5":{name:"San Francisco Rush 2049"},c44e810ca85cfe58:{name:"Scooby-Doo - Classic Creep Capers"},"1d22bde3d334083c":{name:"Scooby-Doo - Classic Creep Capers"},b7f6f5eb39d756c9:{name:"SD Hiryuu no Ken Densetsu"},"75fdd584df3cfdbb":{name:"Shadow Man"},b560473a10d4742d:{name:"Shadow Man"},c3f806eaeddec207:{name:"Shadow Man"},e537c460e31e25a2:{name:"Shadow Man"},ce97680354fad4e0:{name:"Shadowgate 64 - Trials of the Four Towers"},"556fb4020b8d7761":{name:"Shadowgate 64 - Trials of the Four Towers"},"84ea4ed8b4f1b245":{name:"Shadowgate 64 - Trials of the Four Towers"},f2fcc12bf40d9a7b:{name:"Shadowgate 64 - Trials of the Four Towers"},"0c28d5b12abca74b":{name:"Sim City 2000"},b00fbcb6982181e3:{name:"Sin and Punishment - Tsumi To Batsu",save:"Eeprom4k"},"19d5f42e5e0c4ac6":{name:"Snow Speeder"},"9deaf4dbc0823e33":{name:"Snowboard Kids"},ff04fc84e93c25b1:{name:"Snowboard Kids"},a0cdd75fad51bbd9:{name:"Snowboard Kids"},ea290c93bf459293:{name:"Snowboard Kids 2",save:"Eeprom4k"},"1a1d75c2ff9bc1f8":{name:"Snowboard Kids 2",save:"Eeprom4k"},"512321224b594640":{name:"Sonic Wings Assault",save:"Eeprom4k"},"39e9cb7e9517333c":{name:"South Park"},"6236b5209f89617b":{name:"South Park"},"48a90cc04bd3608e":{name:"South Park - Chef's Luv Shack"},"76b2f307393d8fec":{name:"South Park Rally"},"3afc8a4ff22d91f7":{name:"South Park Rally"},"123446378d38c5ea":{name:"Space Dynamites",save:"Eeprom4k"},"9723feeb34da74ff":{name:"Space Invaders"},"8438e2bfafea48ef":{name:"Spacestation Silicon Valley",save:"Eeprom4k"},"72e270fcaae7ff08":{name:"Spacestation Silicon Valley",save:"Eeprom4k"},"71d10ea66ed0853d":{name:"Spider-Man"},"6805ed0d5e510215":{name:"St. Andrews Old Course"},f815d0a743aa8922:{name:"Star Fox 64",save:"Eeprom4k"},c1a7caff37858568:{name:"Star Fox 64",save:"Eeprom4k"},a00b78ba34db210f:{name:"Star Fox 64",save:"Eeprom4k"},"853cd9dde881e3da":{name:"Star Soldier Vanishing Earth",save:"Eeprom4k"},"23eb03b73ae5aa28":{name:"Star Soldier Vanishing Earth",save:"Eeprom4k"},"42a263f13b9b44f2":{name:"Star Twins"},"124aa266c26aaf22":{name:"Star Wars - Rogue Squadron",save:"Eeprom4k"},a2bd5c164622a605:{name:"Star Wars - Rogue Squadron",save:"Eeprom4k"},c1919121613c1833:{name:"Star Wars - Rogue Squadron",save:"Eeprom4k"},ec4ba2664fd9ad2e:{name:"Star Wars - Rogue Squadron",save:"Eeprom4k"},bbe8e07eaa11e449:{name:"Star Wars - Rogue Squadron",save:"Eeprom4k"},"63ac24fe17aa411b":{name:"Star Wars - Shadows of the Empire",save:"Eeprom4k"},"8166484d45927dab":{name:"Star Wars - Shadows of the Empire",save:"Eeprom4k"},"5c7e4d2622468718":{name:"Star Wars - Shadows of the Empire (v1.0)",save:"Eeprom4k"},"91b0474160102563":{name:"Star Wars - Shadows of the Empire (v1.1)",save:"Eeprom4k"},"54edd74d7d28f974":{name:"Star Wars - Shadows of the Empire (v1.2)",save:"Eeprom4k"},"90487e82dc688495":{name:"Star Wars - Shuggeki Rogue Chitai",save:"Eeprom4k"},"9b98023de281a3d4":{name:"Star Wars Episode I - Battle for Naboo",save:"Eeprom4k"},e2ace6ea84430b02:{name:"Star Wars Episode I - Battle for Naboo",save:"Eeprom4k"},"9803f7728ba95665":{name:"Star Wars Episode I - Racer",save:"Eeprom16k"},"52b1f561ab226104":{name:"Star Wars Episode I - Racer",save:"Eeprom16k"},c42ded5302802506:{name:"Star Wars Episode I - Racer",save:"Eeprom16k"},fbfb8406a5a83e5d:{name:"StarCraft 64",save:"FlashRam"},a35ecf42df34139a:{name:"StarCraft 64",save:"FlashRam"},c32c9bbca54dd04e:{name:"StarCraft 64 (beta)",save:"FlashRam"},b8a5ed9403e97386:{name:"Starshot - Space Circus Fever",save:"Eeprom4k"},"550e9ed89aa97ab1":{name:"Starshot - Space Circus Fever",save:"Eeprom4k"},d7d81095d20d1035:{name:"Stunt Racer 64"},"696b64f4951075c5":{name:"Super B-Daman - Battle Phoenix 64"},"5a211daa9abecb91":{name:"Super Bowling 64"},"85f3f2f37f0c496e":{name:"Super Bowling 64"},f08cbca5f651bad8:{name:"Super Mario 64 - Star Road",save:"Eeprom4k"},"76d1fe61f9bb05ea":{name:"Super Mario 64 - The Missing Stars v2",save:"Eeprom4k"},"88aefe21241410a4":{name:"Super Mario 64 - The Missing Stars",save:"Eeprom4k"},d5ba7f26dcfa9375:{name:"Super Mario 64 Ru",save:"Eeprom4k"},c5425a63dc8ec5bd:{name:"Super Mario 64 Extended",save:"Eeprom4k"},ff2b5a632623028b:{name:"Super Mario 64",save:"Eeprom4k"},"0e3daa4e247c7574":{name:"Super Mario 64",save:"Eeprom4k"},"36f03ca0d2c5c1bc":{name:"Super Mario 64",save:"Eeprom4k"},a8a4fbd62caa2663:{name:"Super Mario 64 Shindou Edition",save:"Eeprom4k"},"80205766e148e328":{name:"Super Robot Spirits"},"10d84916d2d63af7":{name:"Super Robot Taisen 64"},"5b8b6b91a4850b78":{name:"Super Smash Brothers",save:"SRAM"},"485f9493302e0f5c":{name:"Super Smash Brothers",save:"SRAM"},a1fd26dde36b4acb:{name:"Super Smash Brothers",save:"SRAM"},"222ee09cb0f16e20":{name:"Super Speed Race 64"},"532545c1d9247b5d":{name:"Supercross 2000"},"7f12bb2cd8bfc209":{name:"Supercross 2000"},"5bf3e8a2d987dcc9":{name:"Superman - The Animated Series"},"74ab4cb4299a0207":{name:"Superman - The Animated Series"},f311e83524277999:{name:"Susume! Taisen Puzzle Dama Toukon! Marumata Chou"},"56a48bb9af762b5b":{name:"Tamagotchi World 64",save:"Eeprom4k"},"54ddbcae4a83ff15":{name:"Taz Express",save:"Eeprom4k"},bb2f04d97c99fffc:{name:"Telefoot Soccer 2000"},a6db3a969bc8d5f7:{name:"Tetris 64"},beda1f3cbae0a402:{name:"Tetrisphere",save:"Eeprom4k"},a984e60fc47ab78b:{name:"Tetrisphere",save:"Eeprom4k"},"161b7d91e19b1f83":{name:"The Legend of Zelda - OoT Nightmare Mod",save:"SRAM"},c7c7b1f831a4fc1e:{name:"The Legend of Zelda - Ocarina of Time Ru",save:"SRAM"},"4fecec6a144892f0":{name:"The Legend of Zelda - Majora's Mask ",save:"FlashRam"},E585C39FC705CC3E:{name:"The Legend of Zelda - Majora's Mask Debug",save:"FlashRam"},b71170ec2bd71676:{name:"The Legend of Zelda - Ocarina of Time (v1.0)",save:"SRAM"},"1a0034f006ed47ae":{name:"The Legend of Zelda - Ocarina of Time Master Quest (GC)",save:"SRAM"},"69b544b085193c37":{name:"The Legend of Zelda - Ocarina of Time (v1.0)",save:"SRAM"},"1fa83dd4191e1e02":{name:"The Legend of Zelda - Ocarina of Time (v1.1)",save:"SRAM"},bd5f05b20c4eab0b:{name:"The Legend of Zelda - Ocarina of Time (v1.1)",save:"SRAM"},aea23b699f4ef1b7:{name:"The Legend of Zelda - Ocarina of Time (v1.2)",save:"SRAM"},c35a46091b50cbf8:{name:"The Legend of Zelda - Ocarina of Time (GC)",save:"SRAM"},f6187d915354bc69:{name:"The Legend of Zelda - Zelda's Birthday",save:"SRAM"},"08eb43b49311b34d":{name:"The Legend of Zelda - Majora's Mask (GC)",save:"FlashRam"},"459379bf027aff39":{name:"The Legend of Zelda - Majora's Mask (Demo)",save:"FlashRam"},"1c635453f0dea203":{name:"The Legend of Zelda - Majora's Mask",save:"FlashRam"},c65579e9388d33bc:{name:"The Legend of Zelda - Majora's Mask",save:"FlashRam"},ba35ddf375e05241:{name:"The Legend of Zelda - Ocarina of Time (GC)",save:"SRAM"},f336411da9ee63af:{name:"The Legend of Zelda - OOT (Master Quest)",save:"SRAM"},"3f14532151632d99":{name:"The New Tetris",save:"SRAM"},"0aff1ce6710d1cce":{name:"The New Tetris",save:"SRAM"},"33ddbf4e849d4c66":{name:"Tigger's Honey Hunt",save:"FlashRam"},"2ff7c4e006159e76":{name:"Tigger's Honey Hunt",save:"FlashRam"},"1c39e76333eacce6":{name:"Tom and Jerry in Fists of Furry",save:"Eeprom4k"},fb4e4f2bfe11c543:{name:"Tom and Jerry in Fists of Furry",save:"Eeprom4k"},"3329418ddb648f58":{name:"Tom Clancy's Rainbow Six"},"35f36b4881cc4d03":{name:"Tom Clancy's Rainbow Six"},"420c2a397de790b7":{name:"Tom Clancy's Rainbow Six"},"3daf7548a2d3669a":{name:"Tom Clancy's Rainbow Six"},"14979eef7d2c3bc0":{name:"Tonic Trouble"},"6e913f0998b60844":{name:"Tonic Trouble"},"22c04e2085d119b1":{name:"Tony Hawk's Pro Skater (v1.0)"},"804114e0c9780b65":{name:"Tony Hawk's Pro Skater (v1.1)"},a526899f09b48705:{name:"Tony Hawk's Pro Skater"},"57b5ea840f198ac8":{name:"Tony Hawk's Pro Skater 2"},"180e1599a5e66612":{name:"Tony Hawk's Pro Skater 2"},"99150E181266E6A5":{name:"Tony Hawk's Pro Skater 2"},b5707f1afdb9b700:{name:"Tony Hawk's Pro Skater 3"},bf6e749a99ea0228:{name:"Toon Panic (Proto)"},f002cc8e81de8b7f:{name:"Top Gear Hyper-Bike",save:"Eeprom4k"},c6493f5fb014c70d:{name:"Top Gear Hyper-Bike",save:"Eeprom4k"},"80cd41d712b9a9ac":{name:"Top Gear Overdrive",save:"Eeprom4k"},"4ff2780517bf7591":{name:"Top Gear Overdrive",save:"Eeprom4k"},"38a59bd089541a1c":{name:"Top Gear Overdrive",save:"Eeprom4k"},"3d9b2662e8b111fe":{name:"Top Gear Rally",save:"Eeprom4k"},"4762590e8b4b3d75":{name:"Top Gear Rally",save:"Eeprom4k"},"01e7437fd1286353":{name:"Top Gear Rally",save:"Eeprom4k"},e07359beb8edb089:{name:"Top Gear Rally 2"},d62cefcfe673e9c9:{name:"Top Gear Rally 2"},"77b6babee4b5b051":{name:"Top Gear Rally 2"},"77d32df847b33f8c":{name:"Top Gear Rally 2"},a43c70efc99a4a4d:{name:"Toukon Road - Brave Spirits"},"437f1c551c834991":{name:"Toukon Road 2 - The Next Generation"},"75902a781d6352e5":{name:"Toy Story 2"},"3e7450a1cd2225cf":{name:"Toy Story 2"},"97db93cbd5635c7f":{name:"Toy Story 2"},"5838ebcc972d9526":{name:"Toy Story 2"},"436b4bfea7291d08":{name:"Triple Play 2000"},"0ffae466d0c788de":{name:"Turok - Legenden des Verlorenen Landes"},"8b49b9ad558ff2da":{name:"Turok - Rage Wars"},"1462a21e0f9090e7":{name:"Turok - Rage Wars"},dd09702f53ac3bfc:{name:"Turok - The Dinosaur Hunter"},"63d95f661266ccb5":{name:"Turok - The Dinosaur Hunter"},b8e66a9122ab1788:{name:"Turok - The Dinosaur Hunter"},"0df1702fff87415c":{name:"Turok - The Dinosaur Hunter (v1.0)"},dd095f6653ac3bfc:{name:"Turok - The Dinosaur Hunter (v1.0)"},cd0d702fc9c56c17:{name:"Turok - The Dinosaur Hunter (v1.1/v1.2)"},"49770e2e599db4b8":{name:"Turok 2 - Seeds of Evil"},"942bb9e025e0a7b9":{name:"Turok 2 - Seeds of Evil"},"0b8405fe0c329393":{name:"Turok 2 - Seeds of Evil"},"118a08497e959464":{name:"Turok 2 - Seeds of Evil"},"942bb9e0bd7ce880":{name:"Turok 2 - Seeds of Evil"},fc5ac9e8da21d135:{name:"Turok 2 - Seeds of Evil - Kiosk"},f179a589ef977e66:{name:"Turok 3 - Shadow of Oblivion"},f22f166a4c709320:{name:"Turok 3 - Shadow of Oblivion"},"329dc9bb80aa7d11":{name:"Twisted Edge Extreme Snowboarding"},b8a588e6183f4bb1:{name:"Twisted Edge Extreme Snowboarding"},"7851da6ec1fe96d3":{name:"Vigilante 8"},"6a0571ea474821e4":{name:"Vigilante 8"},a282bce294d61c59:{name:"Vigilante 8"},f4791f15e5c8ed8e:{name:"Vigilante 8"},"6d86c5f5d9132705":{name:"Vigilante 8 - 2nd Offense"},"7ebc10dd51b300f9":{name:"Vigilante 8 - 2nd Offense"},"986c006081a30526":{name:"Violence Killer - Turok New Generation"},"8b24b3824d243ee7":{name:"Virtual Chess 64"},"21a2da2fcea788a5":{name:"Virtual Chess 64"},"43764a4ed73974a3":{name:"Virtual Pool 64"},d0f2f9989cf0d903:{name:"Virtual Pool 64"},c4085c048b79fd4a:{name:"Virtual Pro Wrestling",save:"Eeprom4k"},"354209cd624b0788":{name:"Virtual Pro Wrestling 2",save:"SRAM"},"3890053c8221bfc8":{name:"V-Rally Edition 99",save:"Eeprom4k"},a524024d9457eb1b:{name:"V-Rally Edition 99",save:"Eeprom4k"},"196b6e635fdc7de5":{name:"V-Rally Edition 99",save:"Eeprom4k"},"8ad56680c1cadec3":{name:"Waialae Country Club - True Golf Classics",save:"Eeprom4k"},"75300593430f1e26":{name:"Waialae Country Club - True Golf Classics",save:"Eeprom4k"},ad57500c6e126e04:{name:"Waialae Country Club - True Golf Classics (1.1)",save:"Eeprom4k"},e28c31ddba9837b7:{name:"Waialae Country Club - True Golf Classics (1.1)",save:"Eeprom4k"},f628fef7c3acf2c3:{name:"War Gods"},"70cc15d7d6f51c27":{name:"War Gods"},d691915c06c30ab3:{name:"Wave Race 64",save:"Eeprom4k"},"96fa0e65a7f9dd30":{name:"Wave Race 64",save:"Eeprom4k"},"531fe17d9d2f8774":{name:"Wave Race 64 (v1.0)",save:"Eeprom4k"},"614b2f496a14e504":{name:"Wave Race 64 (v1.1)",save:"Eeprom4k"},e2f35d53f1899760:{name:"Wave Race 64 Shindou Edition",save:"Eeprom4k"},"59aa3bdc6a45bb0a":{name:"Wayne Gretzky's 3D Hockey v1.1"},"3f22456b565c0ef0":{name:"Wayne Gretzky's 3D Hockey"},"431030f11a5480fd":{name:"Wayne Gretzky's 3D Hockey"},"4b090922af59952c":{name:"Wayne Gretzky's 3D Hockey"},"59389d5a10e7aa97":{name:"Wayne Gretzky's 3D Hockey '98"},f3451b666d26d69e:{name:"Wayne Gretzky's 3D Hockey '98"},dd5a6f39a7ec9366:{name:"WCW Backstage Assault"},d68cbe33126918ec:{name:"WCW Mayhem"},"58067baa7b93969c":{name:"WCW Mayhem"},"1a5ac4d45eb225f4":{name:"WCW Nitro"},"68afdb8b364b5b34":{name:"WCW vs. NWO - World Tour"},bd193e2c5eee1351:{name:"WCW vs. NWO - World Tour (v1.0)"},b960be713cfbdb1d:{name:"WCW vs. NWO - World Tour (v1.2)"},ab96e5dee77a3baf:{name:"WCW-NWO Revenge",save:"SRAM"},"75a8e86886a4e70c":{name:"WCW-NWO Revenge",save:"SRAM"},"4fb5a8ce03d5217f":{name:"Wetrix"},faeab6dca3cfbbc6:{name:"Wetrix"},"2b0996e84e4d24dc":{name:"Wheel of Fortune"},c7c4eb0c32e99c0c:{name:"Wild Choppers",save:"Eeprom4k"},"7e9598edacdc4282":{name:"WinBack - Covert Operations"},e056a01f6a94b9a4:{name:"WinBack - Covert Operations"},af8c89d55bb60760:{name:"WinBack - Covert Operations"},"32272d1318910ec7":{name:"Wipeout 64"},"7d0e3154d830546b":{name:"Wipeout 64"},"65973ce4bec1b105":{name:"Wonder Project J2"},"38594b3a9d986fa2":{name:"Wonder Project J2 (English)"},f7881e4f963f5a4a:{name:"Wonder Project J2 (English)"},"6a6d63bdba541f5d":{name:"World Cup 98"},"9030fcf9c24e01ff":{name:"World Cup 98"},c8fe8d30f6b52ece:{name:"World Driver Championship"},"782706acb8fcaddf":{name:"World Driver Championship"},a059e913b0ca930e:{name:"Worms - Armageddon",save:"Eeprom4k"},"7bc5212d8cc5e48f":{name:"Worms - Armageddon",save:"Eeprom4k"},"0fec5bcd0810fd86":{name:"WWF - War Zone"},a475a233594450b8:{name:"WWF - War Zone"},c851318f45f53a4f:{name:"WWF Attitude"},"142fbed288374538":{name:"WWF Attitude"},"7b5bf45be8ee6b59":{name:"WWF Attitude"},"40064b4efbbc491b":{name:"WWF No Mercy",save:"FlashRam"},"8ef08d6dcfc308d0":{name:"WWF No Mercy (v1.0)",save:"FlashRam"},c294db8cf0c646cb:{name:"WWF No Mercy (v1.1)",save:"FlashRam"},"0390a59064980831":{name:"WWF WrestleMania 2000",save:"SRAM"},a57d731259919623:{name:"WWF Wrestlemania 2000",save:"SRAM"},be5313c7eea609aa:{name:"WWF WrestleMania 2000",save:"SRAM"},"9dae5305c1e0d8ea":{name:"Xena Warrior Princess - Talisman of Fate"},c767160aa6463329:{name:"Xena Warrior Princess - Talisman of Fate"},c3968b9fdc9411a0:{name:"Yakouchuu II - Satsujun Kouru"},e8d83723ec7c8e6b:{name:"Yoshi's Story",save:"Eeprom16k"},"60cacf2d47b15483":{name:"Yoshi's Story",save:"Eeprom16k"},"497df9d35b132469":{name:"Yoshi's Story",save:"Eeprom16k"},"8d3bda777c0d2b16":{name:"Yosuke no Mahjong Juku",save:"Eeprom4k"},"2d16e69f37407ee9":{name:"Yuke Yuke!! Trouble Makers"},c1d0738466061223:{name:"Zelda no Densetsu 2 - Mujura no Kamen",save:"FlashRam"},b82df5f736e69521:{name:"Zelda no Densetsu - Toki no Ocarina Collectors Ed.",save:"SRAM"},baf411f65c1384c5:{name:"Zelda no Densetsu - Toki no Ocarina (GC)",save:"SRAM"},ba453bf46f9b0e2f:{name:"Zelda no Densetsu - Toki no Ocarina (GC)",save:"SRAM"},"127341ec5fde31eb":{name:"Zelda no Densetsu 2 - Mujura no Kamen",save:"FlashRam"},"3804ae69f3f3632c":{name:"Zelda no Densetsu 2 - Mujura no Kamen (1.1)",save:"FlashRam"},cd0c011cfab7d322:{name:"Zool - Majou Tsukai Densetsu"},"54a43977662af5a2":{name:"A HORiZON64 RELEASE"},"91d8ab5ccef62962":{name:"Fishy by NaN v0.3141"},bc069a1355006b41:{name:"Mind Present-Readme"},b1cb11c87c61b78f:{name:"Mind Present / DNX"},"54f53fcb0bcd7387":{name:"Tron Demo"},"4549049c0c0b1ed3":{name:"POM99 - README"},"7a7d3b994df0542e":{name:"POM99 - MADEIRAGAMES"},"575aa9a37dc2e69f":{name:"POM99 - WET DREAMS"},"95c03bca0a864996":{name:"POM99 - CAN-BETA"},d44a7da4f981fa8b:{name:"Manic Miner 64"},"2d369c9d086be65b":{name:"Shag-a-delic/CAMELOT"},c479518fdc263580:{name:"Space Rotator"},"70bb552625997d66":{name:"O.D.T.",save:"Controller"},a61564e8535b3998:{name:"O.D.T.",save:"Controller"}};var qX={};pj(qX,{write:()=>{{return VG}},viewport:()=>{{return O9}},variationPlacements:()=>{{return iZ}},top:()=>{{return M0}},start:()=>{{return r6}},right:()=>{{return w0}},reference:()=>{{return _z}},read:()=>{{return $G}},preventOverflow:()=>{{return dz}},popperOffsets:()=>{{return b9}},popperGenerator:()=>{{return Uq}},popper:()=>{{return GJ}},placements:()=>{{return I9}},offset:()=>{{return cz}},modifierPhases:()=>{{return bz}},main:()=>{{return jG}},left:()=>{{return D0}},hide:()=>{{return mz}},flip:()=>{{return pz}},eventListeners:()=>{{return T9}},end:()=>{{return x8}},detectOverflow:()=>{{return z6}},createPopperLite:()=>{{return CO}},createPopperBase:()=>{{return BO}},createPopper:()=>{{return S9}},computeStyles:()=>{{return E9}},clippingParents:()=>{{return Tz}},bottom:()=>{{return C0}},beforeWrite:()=>{{return LG}},beforeRead:()=>{{return FG}},beforeMain:()=>{{return GG}},basePlacements:()=>{{return H8}},auto:()=>{{return D9}},arrow:()=>{{return vz}},applyStyles:()=>{{return w9}},afterWrite:()=>{{return UG}},afterRead:()=>{{return HG}},afterMain:()=>{{return NG}}});var M0="top",C0="bottom",w0="right",D0="left",D9="auto",H8=[M0,C0,w0,D0],r6="start",x8="end",Tz="clippingParents",O9="viewport",GJ="popper",_z="reference",iZ=H8.reduce(function(J,q){return J.concat([q+"-"+r6,q+"-"+x8])},[]),I9=[].concat(H8,[D9]).reduce(function(J,q){return J.concat([q,q+"-"+r6,q+"-"+x8])},[]),FG="beforeRead",$G="read",HG="afterRead",GG="beforeMain",jG="main",NG="afterMain",LG="beforeWrite",VG="write",UG="afterWrite",bz=[FG,$G,HG,GG,jG,NG,LG,VG,UG];function u0(J){return J?(J.nodeName||"").toLowerCase():null}function V0(J){if(J==null)return window;if(J.toString()!=="[object Window]"){var q=J.ownerDocument;return q?q.defaultView||window:window}return J}var h6=function(J){var q=V0(J).Element;return J instanceof q||J instanceof Element},b0=function(J){var q=V0(J).HTMLElement;return J instanceof q||J instanceof HTMLElement},jq=function(J){if(typeof ShadowRoot==="undefined")return!1;var q=V0(J).ShadowRoot;return J instanceof q||J instanceof ShadowRoot};var ZO=function(J){var q=J.state;Object.keys(q.elements).forEach(function(Q){var Z=q.styles[Q]||{},X=q.attributes[Q]||{},Y=q.elements[Q];if(!b0(Y)||!u0(Y))return;Object.assign(Y.style,Z),Object.keys(X).forEach(function(z){var K=X[z];if(K===!1)Y.removeAttribute(z);else Y.setAttribute(z,K===!0?"":K)})})},XO=function(J){var q=J.state,Q={popper:{position:q.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};if(Object.assign(q.elements.popper.style,Q.popper),q.styles=Q,q.elements.arrow)Object.assign(q.elements.arrow.style,Q.arrow);return function(){Object.keys(q.elements).forEach(function(Z){var X=q.elements[Z],Y=q.attributes[Z]||{},z=Object.keys(q.styles.hasOwnProperty(Z)?q.styles[Z]:Q[Z]),K=z.reduce(function(W,G){return W[G]="",W},{});if(!b0(X)||!u0(X))return;Object.assign(X.style,K),Object.keys(Y).forEach(function(W){X.removeAttribute(W)})})}},w9={name:"applyStyles",enabled:!0,phase:"write",fn:ZO,effect:XO,requires:["computeStyles"]};function g0(J){return J.split("-")[0]}var{max:v6,min:jJ,round:G8}=Math;function Nq(){var J=navigator.userAgentData;if(J!=null&&J.brands&&Array.isArray(J.brands))return J.brands.map(function(q){return q.brand+"/"+q.version}).join(" ");return navigator.userAgent}function B9(){return!/^((?!chrome|android).)*safari/i.test(Nq())}function k6(J,q,Q){if(q===void 0)q=!1;if(Q===void 0)Q=!1;var Z=J.getBoundingClientRect(),X=1,Y=1;if(q&&b0(J))X=J.offsetWidth>0?G8(Z.width)/J.offsetWidth||1:1,Y=J.offsetHeight>0?G8(Z.height)/J.offsetHeight||1:1;var z=h6(J)?V0(J):window,K=z.visualViewport,W=!B9()&&Q,G=(Z.left+(W&&K?K.offsetLeft:0))/X,H=(Z.top+(W&&K?K.offsetTop:0))/Y,j=Z.width/X,L=Z.height/Y;return{width:j,height:L,top:H,right:G+j,bottom:H+L,left:G,x:G,y:H}}function NJ(J){var q=k6(J),Q=J.offsetWidth,Z=J.offsetHeight;if(Math.abs(q.width-Q)<=1)Q=q.width;if(Math.abs(q.height-Z)<=1)Z=q.height;return{x:J.offsetLeft,y:J.offsetTop,width:Q,height:Z}}function A9(J,q){var Q=q.getRootNode&&q.getRootNode();if(J.contains(q))return!0;else if(Q&&jq(Q)){var Z=q;do{if(Z&&J.isSameNode(Z))return!0;Z=Z.parentNode||Z.host}while(Z)}return!1}function e0(J){return V0(J).getComputedStyle(J)}function Sz(J){return["table","td","th"].indexOf(u0(J))>=0}function o0(J){return((h6(J)?J.ownerDocument:J.document)||window.document).documentElement}function j8(J){if(u0(J)==="html")return J;return J.assignedSlot||J.parentNode||(jq(J)?J.host:null)||o0(J)}var PG=function(J){if(!b0(J)||e0(J).position==="fixed")return null;return J.offsetParent},YO=function(J){var q=/firefox/i.test(Nq()),Q=/Trident/i.test(Nq());if(Q&&b0(J)){var Z=e0(J);if(Z.position==="fixed")return null}var X=j8(J);if(jq(X))X=X.host;while(b0(X)&&["html","body"].indexOf(u0(X))<0){var Y=e0(X);if(Y.transform!=="none"||Y.perspective!=="none"||Y.contain==="paint"||["transform","perspective"].indexOf(Y.willChange)!==-1||q&&Y.willChange==="filter"||q&&Y.filter&&Y.filter!=="none")return X;else X=X.parentNode}return null};function x6(J){var q=V0(J),Q=PG(J);while(Q&&Sz(Q)&&e0(Q).position==="static")Q=PG(Q);if(Q&&(u0(Q)==="html"||u0(Q)==="body"&&e0(Q).position==="static"))return q;return Q||YO(J)||q}function LJ(J){return["top","bottom"].indexOf(J)>=0?"x":"y"}function VJ(J,q,Q){return v6(J,jJ(q,Q))}function MG(J,q,Q){var Z=VJ(J,q,Q);return Z>Q?Q:Z}function C9(){return{top:0,right:0,bottom:0,left:0}}function R9(J){return Object.assign({},C9(),J)}function y9(J,q){return q.reduce(function(Q,Z){return Q[Z]=J,Q},{})}var KO=function(J){var q,Q=J.state,Z=J.name,X=J.options,Y=Q.elements.arrow,z=Q.modifiersData.popperOffsets,K=g0(Q.placement),W=LJ(K),G=[D0,w0].indexOf(K)>=0,H=G?"height":"width";if(!Y||!z)return;var j=zO(X.padding,Q),L=NJ(Y),V=W==="y"?M0:D0,U=W==="y"?C0:w0,M=Q.rects.reference[H]+Q.rects.reference[W]-z[W]-Q.rects.popper[H],k=z[W]-Q.rects.reference[W],O=x6(Y),R=O?W==="y"?O.clientHeight||0:O.clientWidth||0:0,S=M/2-k/2,T=j[V],b=R-L[H]-j[U],m=R/2-L[H]/2+S,l=VJ(T,m,b),U0=W;Q.modifiersData[Z]=(q={},q[U0]=l,q.centerOffset=l-m,q)},WO=function(J){var{state:q,options:Q}=J,Z=Q.element,X=Z===void 0?"[data-popper-arrow]":Z;if(X==null)return;if(typeof X==="string"){if(X=q.elements.popper.querySelector(X),!X)return}if(!A9(q.elements.popper,X))return;q.elements.arrow=X},zO=function J(q,Q){return q=typeof q==="function"?q(Object.assign({},Q.rects,{placement:Q.placement})):q,R9(typeof q!=="number"?q:y9(q,H8))},vz={name:"arrow",enabled:!0,phase:"main",fn:KO,effect:WO,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function D6(J){return J.split("-")[1]}var $O=function(J,q){var{x:Q,y:Z}=J,X=q.devicePixelRatio||1;return{x:G8(Q*X)/X||0,y:G8(Z*X)/X||0}};function hG(J){var q,Q=J.popper,Z=J.popperRect,X=J.placement,Y=J.variation,z=J.offsets,K=J.position,W=J.gpuAcceleration,G=J.adaptive,H=J.roundOffsets,j=J.isFixed,L=z.x,V=L===void 0?0:L,U=z.y,M=U===void 0?0:U,k=typeof H==="function"?H({x:V,y:M}):{x:V,y:M};V=k.x,M=k.y;var O=z.hasOwnProperty("x"),R=z.hasOwnProperty("y"),S=D0,T=M0,b=window;if(G){var m=x6(Q),l="clientHeight",U0="clientWidth";if(m===V0(Q)){if(m=o0(Q),e0(m).position!=="static"&&K==="absolute")l="scrollHeight",U0="scrollWidth"}if(m=m,X===M0||(X===D0||X===w0)&&Y===x8){T=C0;var O0=j&&m===b&&b.visualViewport?b.visualViewport.height:m[l];M-=O0-Z.height,M*=W?1:-1}if(X===D0||(X===M0||X===C0)&&Y===x8){S=w0;var $0=j&&m===b&&b.visualViewport?b.visualViewport.width:m[U0];V-=$0-Z.width,V*=W?1:-1}}var H0=Object.assign({position:K},G&&FO),W6=H===!0?$O({x:V,y:M},V0(Q)):{x:V,y:M};if(V=W6.x,M=W6.y,W){var a0;return Object.assign({},H0,(a0={},a0[T]=R?"0":"",a0[S]=O?"0":"",a0.transform=(b.devicePixelRatio||1)<=1?"translate("+V+"px, "+M+"px)":"translate3d("+V+"px, "+M+"px, 0)",a0))}return Object.assign({},H0,(q={},q[T]=R?M+"px":"",q[S]=O?V+"px":"",q.transform="",q))}var HO=function(J){var{state:q,options:Q}=J,Z=Q.gpuAcceleration,X=Z===void 0?!0:Z,Y=Q.adaptive,z=Y===void 0?!0:Y,K=Q.roundOffsets,W=K===void 0?!0:K,G={placement:g0(q.placement),variation:D6(q.placement),popper:q.elements.popper,popperRect:q.rects.popper,gpuAcceleration:X,isFixed:q.options.strategy==="fixed"};if(q.modifiersData.popperOffsets!=null)q.styles.popper=Object.assign({},q.styles.popper,hG(Object.assign({},G,{offsets:q.modifiersData.popperOffsets,position:q.options.strategy,adaptive:z,roundOffsets:W})));if(q.modifiersData.arrow!=null)q.styles.arrow=Object.assign({},q.styles.arrow,hG(Object.assign({},G,{offsets:q.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:W})));q.attributes.popper=Object.assign({},q.attributes.popper,{"data-popper-placement":q.placement})},FO={top:"auto",right:"auto",bottom:"auto",left:"auto"},E9={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:HO,data:{}};var GO=function(J){var{state:q,instance:Q,options:Z}=J,X=Z.scroll,Y=X===void 0?!0:X,z=Z.resize,K=z===void 0?!0:z,W=V0(q.elements.popper),G=[].concat(q.scrollParents.reference,q.scrollParents.popper);if(Y)G.forEach(function(H){H.addEventListener("scroll",Q.update,tZ)});if(K)W.addEventListener("resize",Q.update,tZ);return function(){if(Y)G.forEach(function(H){H.removeEventListener("scroll",Q.update,tZ)});if(K)W.removeEventListener("resize",Q.update,tZ)}},tZ={passive:!0},T9={name:"eventListeners",enabled:!0,phase:"write",fn:function J(){},effect:GO,data:{}};var jO={left:"right",right:"left",bottom:"top",top:"bottom"};function Lq(J){return J.replace(/left|right|bottom|top/g,function(q){return jO[q]})}var NO={start:"end",end:"start"};function eZ(J){return J.replace(/start|end/g,function(q){return NO[q]})}function UJ(J){var q=V0(J),Q=q.pageXOffset,Z=q.pageYOffset;return{scrollLeft:Q,scrollTop:Z}}function PJ(J){return k6(o0(J)).left+UJ(J).scrollLeft}function xz(J,q){var Q=V0(J),Z=o0(J),X=Q.visualViewport,Y=Z.clientWidth,z=Z.clientHeight,K=0,W=0;if(X){Y=X.width,z=X.height;var G=B9();if(G||!G&&q==="fixed")K=X.offsetLeft,W=X.offsetTop}return{width:Y,height:z,x:K+PJ(J),y:W}}function uz(J){var q,Q=o0(J),Z=UJ(J),X=(q=J.ownerDocument)==null?void 0:q.body,Y=v6(Q.scrollWidth,Q.clientWidth,X?X.scrollWidth:0,X?X.clientWidth:0),z=v6(Q.scrollHeight,Q.clientHeight,X?X.scrollHeight:0,X?X.clientHeight:0),K=-Z.scrollLeft+PJ(J),W=-Z.scrollTop;if(e0(X||Q).direction==="rtl")K+=v6(Q.clientWidth,X?X.clientWidth:0)-Y;return{width:Y,height:z,x:K,y:W}}function MJ(J){var q=e0(J),Q=q.overflow,Z=q.overflowX,X=q.overflowY;return/auto|scroll|overlay|hidden/.test(Q+X+Z)}function JX(J){if(["html","body","#document"].indexOf(u0(J))>=0)return J.ownerDocument.body;if(b0(J)&&MJ(J))return J;return JX(j8(J))}function u8(J,q){var Q;if(q===void 0)q=[];var Z=JX(J),X=Z===((Q=J.ownerDocument)==null?void 0:Q.body),Y=V0(Z),z=X?[Y].concat(Y.visualViewport||[],MJ(Z)?Z:[]):Z,K=q.concat(z);return X?K:K.concat(u8(j8(z)))}function Vq(J){return Object.assign({},J,{left:J.x,top:J.y,right:J.x+J.width,bottom:J.y+J.height})}var LO=function(J,q){var Q=k6(J,!1,q==="fixed");return Q.top=Q.top+J.clientTop,Q.left=Q.left+J.clientLeft,Q.bottom=Q.top+J.clientHeight,Q.right=Q.left+J.clientWidth,Q.width=J.clientWidth,Q.height=J.clientHeight,Q.x=Q.left,Q.y=Q.top,Q},kG=function(J,q,Q){return q===O9?Vq(xz(J,Q)):h6(q)?LO(q,Q):Vq(uz(o0(J)))},VO=function(J){var q=u8(j8(J)),Q=["absolute","fixed"].indexOf(e0(J).position)>=0,Z=Q&&b0(J)?x6(J):J;if(!h6(Z))return[];return q.filter(function(X){return h6(X)&&A9(X,Z)&&u0(X)!=="body"})};function gz(J,q,Q,Z){var X=q==="clippingParents"?VO(J):[].concat(q),Y=[].concat(X,[Q]),z=Y[0],K=Y.reduce(function(W,G){var H=kG(J,G,Z);return W.top=v6(H.top,W.top),W.right=jJ(H.right,W.right),W.bottom=jJ(H.bottom,W.bottom),W.left=v6(H.left,W.left),W},kG(J,z,Z));return K.width=K.right-K.left,K.height=K.bottom-K.top,K.x=K.left,K.y=K.top,K}function _9(J){var{reference:q,element:Q,placement:Z}=J,X=Z?g0(Z):null,Y=Z?D6(Z):null,z=q.x+q.width/2-Q.width/2,K=q.y+q.height/2-Q.height/2,W;switch(X){case M0:W={x:z,y:q.y-Q.height};break;case C0:W={x:z,y:q.y+q.height};break;case w0:W={x:q.x+q.width,y:K};break;case D0:W={x:q.x-Q.width,y:K};break;default:W={x:q.x,y:q.y}}var G=X?LJ(X):null;if(G!=null){var H=G==="y"?"height":"width";switch(Y){case r6:W[G]=W[G]-(q[H]/2-Q[H]/2);break;case x8:W[G]=W[G]+(q[H]/2-Q[H]/2);break;default:}}return W}function z6(J,q){if(q===void 0)q={};var Q=q,Z=Q.placement,X=Z===void 0?J.placement:Z,Y=Q.strategy,z=Y===void 0?J.strategy:Y,K=Q.boundary,W=K===void 0?Tz:K,G=Q.rootBoundary,H=G===void 0?O9:G,j=Q.elementContext,L=j===void 0?GJ:j,V=Q.altBoundary,U=V===void 0?!1:V,M=Q.padding,k=M===void 0?0:M,O=R9(typeof k!=="number"?k:y9(k,H8)),R=L===GJ?_z:GJ,S=J.rects.popper,T=J.elements[U?R:L],b=gz(h6(T)?T:T.contextElement||o0(J.elements.popper),W,H,z),m=k6(J.elements.reference),l=_9({reference:m,element:S,strategy:"absolute",placement:X}),U0=Vq(Object.assign({},S,l)),O0=L===GJ?U0:m,$0={top:b.top-O0.top+O.top,bottom:O0.bottom-b.bottom+O.bottom,left:b.left-O0.left+O.left,right:O0.right-b.right+O.right},H0=J.modifiersData.offset;if(L===GJ&&H0){var W6=H0[X];Object.keys($0).forEach(function(a0){var l8=[w0,C0].indexOf(a0)>=0?1:-1,n8=[M0,C0].indexOf(a0)>=0?"y":"x";$0[a0]+=W6[n8]*l8})}return $0}function fz(J,q){if(q===void 0)q={};var Q=q,Z=Q.placement,X=Q.boundary,Y=Q.rootBoundary,z=Q.padding,K=Q.flipVariations,W=Q.allowedAutoPlacements,G=W===void 0?I9:W,H=D6(Z),j=H?K?iZ:iZ.filter(function(U){return D6(U)===H}):H8,L=j.filter(function(U){return G.indexOf(U)>=0});if(L.length===0)L=j;var V=L.reduce(function(U,M){return U[M]=z6(J,{placement:M,boundary:X,rootBoundary:Y,padding:z})[g0(M)],U},{});return Object.keys(V).sort(function(U,M){return V[U]-V[M]})}var UO=function(J){if(g0(J)===D9)return[];var q=Lq(J);return[eZ(J),q,eZ(q)]},PO=function(J){var{state:q,options:Q,name:Z}=J;if(q.modifiersData[Z]._skip)return;var X=Q.mainAxis,Y=X===void 0?!0:X,z=Q.altAxis,K=z===void 0?!0:z,W=Q.fallbackPlacements,G=Q.padding,H=Q.boundary,j=Q.rootBoundary,L=Q.altBoundary,V=Q.flipVariations,U=V===void 0?!0:V,M=Q.allowedAutoPlacements,k=q.options.placement,O=g0(k),R=O===k,S=W||(R||!U?[Lq(k)]:UO(k)),T=[k].concat(S).reduce(function(wJ,U8){return wJ.concat(g0(U8)===D9?fz(q,{placement:U8,boundary:H,rootBoundary:j,padding:G,flipVariations:U,allowedAutoPlacements:M}):U8)},[]),b=q.rects.reference,m=q.rects.popper,l=new Map,U0=!0,O0=T[0];for(var $0=0;$0<T.length;$0++){var H0=T[$0],W6=g0(H0),a0=D6(H0)===r6,l8=[M0,C0].indexOf(W6)>=0,n8=l8?"width":"height",F6=z6(q,{placement:H0,boundary:H,rootBoundary:j,altBoundary:L,padding:G}),A6=l8?a0?w0:D0:a0?C0:M0;if(b[n8]>m[n8])A6=Lq(A6);var m9=Lq(A6),a8=[];if(Y)a8.push(F6[W6]<=0);if(K)a8.push(F6[A6]<=0,F6[m9]<=0);if(a8.every(function(wJ){return wJ})){O0=H0,U0=!1;break}l.set(H0,a8)}if(U0){var c9=U?3:1,hX=function wJ(U8){var yq=T.find(function(d9){var r8=l.get(d9);if(r8)return r8.slice(0,U8).every(function(kX){return kX})});if(yq)return O0=yq,"break"};for(var Rq=c9;Rq>0;Rq--){var o9=hX(Rq);if(o9==="break")break}}if(q.placement!==O0)q.modifiersData[Z]._skip=!0,q.placement=O0,q.reset=!0},pz={name:"flip",enabled:!0,phase:"main",fn:PO,requiresIfExists:["offset"],data:{_skip:!1}};var DG=function(J,q,Q){if(Q===void 0)Q={x:0,y:0};return{top:J.top-q.height-Q.y,right:J.right-q.width+Q.x,bottom:J.bottom-q.height+Q.y,left:J.left-q.width-Q.x}},OG=function(J){return[M0,w0,C0,D0].some(function(q){return J[q]>=0})},MO=function(J){var{state:q,name:Q}=J,Z=q.rects.reference,X=q.rects.popper,Y=q.modifiersData.preventOverflow,z=z6(q,{elementContext:"reference"}),K=z6(q,{altBoundary:!0}),W=DG(z,Z),G=DG(K,X,Y),H=OG(W),j=OG(G);q.modifiersData[Q]={referenceClippingOffsets:W,popperEscapeOffsets:G,isReferenceHidden:H,hasPopperEscaped:j},q.attributes.popper=Object.assign({},q.attributes.popper,{"data-popper-reference-hidden":H,"data-popper-escaped":j})},mz={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:MO};function hO(J,q,Q){var Z=g0(J),X=[D0,M0].indexOf(Z)>=0?-1:1,Y=typeof Q==="function"?Q(Object.assign({},q,{placement:J})):Q,z=Y[0],K=Y[1];return z=z||0,K=(K||0)*X,[D0,w0].indexOf(Z)>=0?{x:K,y:z}:{x:z,y:K}}var kO=function(J){var{state:q,options:Q,name:Z}=J,X=Q.offset,Y=X===void 0?[0,0]:X,z=I9.reduce(function(H,j){return H[j]=hO(j,q.rects,Y),H},{}),K=z[q.placement],W=K.x,G=K.y;if(q.modifiersData.popperOffsets!=null)q.modifiersData.popperOffsets.x+=W,q.modifiersData.popperOffsets.y+=G;q.modifiersData[Z]=z},cz={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:kO};var DO=function(J){var{state:q,name:Q}=J;q.modifiersData[Q]=_9({reference:q.rects.reference,element:q.rects.popper,strategy:"absolute",placement:q.placement})},b9={name:"popperOffsets",enabled:!0,phase:"read",fn:DO,data:{}};function oz(J){return J==="x"?"y":"x"}var OO=function(J){var{state:q,options:Q,name:Z}=J,X=Q.mainAxis,Y=X===void 0?!0:X,z=Q.altAxis,K=z===void 0?!1:z,W=Q.boundary,G=Q.rootBoundary,H=Q.altBoundary,j=Q.padding,L=Q.tether,V=L===void 0?!0:L,U=Q.tetherOffset,M=U===void 0?0:U,k=z6(q,{boundary:W,rootBoundary:G,padding:j,altBoundary:H}),O=g0(q.placement),R=D6(q.placement),S=!R,T=LJ(O),b=oz(T),m=q.modifiersData.popperOffsets,l=q.rects.reference,U0=q.rects.popper,O0=typeof M==="function"?M(Object.assign({},q.rects,{placement:q.placement})):M,$0=typeof O0==="number"?{mainAxis:O0,altAxis:O0}:Object.assign({mainAxis:0,altAxis:0},O0),H0=q.modifiersData.offset?q.modifiersData.offset[q.placement]:null,W6={x:0,y:0};if(!m)return;if(Y){var a0,l8=T==="y"?M0:D0,n8=T==="y"?C0:w0,F6=T==="y"?"height":"width",A6=m[T],m9=A6+k[l8],a8=A6-k[n8],c9=V?-U0[F6]/2:0,hX=R===r6?l[F6]:U0[F6],Rq=R===r6?-U0[F6]:-l[F6],o9=q.elements.arrow,wJ=V&&o9?NJ(o9):{width:0,height:0},U8=q.modifiersData["arrow#persistent"]?q.modifiersData["arrow#persistent"].padding:C9(),yq=U8[l8],d9=U8[n8],r8=VJ(0,l[F6],wJ[F6]),kX=S?l[F6]/2-c9-r8-yq-$0.mainAxis:hX-r8-yq-$0.mainAxis,bj=S?-l[F6]/2+c9+r8+d9+$0.mainAxis:Rq+r8+d9+$0.mainAxis,DX=q.elements.arrow&&x6(q.elements.arrow),Sj=DX?T==="y"?DX.clientTop||0:DX.clientLeft||0:0,RK=(a0=H0==null?void 0:H0[T])!=null?a0:0,vj=A6+kX-RK-Sj,xj=A6+bj-RK,yK=VJ(V?jJ(m9,vj):m9,A6,V?v6(a8,xj):a8);m[T]=yK,W6[T]=yK-A6}if(K){var EK,uj=T==="x"?M0:D0,gj=T==="x"?C0:w0,s8=m[b],l9=b==="y"?"height":"width",TK=s8+k[uj],_K=s8-k[gj],OX=[M0,D0].indexOf(O)!==-1,bK=(EK=H0==null?void 0:H0[b])!=null?EK:0,SK=OX?TK:s8-l[l9]-U0[l9]-bK+$0.altAxis,vK=OX?s8+l[l9]+U0[l9]-bK-$0.altAxis:_K,xK=V&&OX?MG(SK,s8,vK):VJ(V?SK:TK,s8,V?vK:_K);m[b]=xK,W6[b]=xK-s8}q.modifiersData[Z]=W6},dz={name:"preventOverflow",enabled:!0,phase:"main",fn:OO,requiresIfExists:["offset"]};function lz(J){return{scrollLeft:J.scrollLeft,scrollTop:J.scrollTop}}function nz(J){if(J===V0(J)||!b0(J))return UJ(J);else return lz(J)}var IO=function(J){var q=J.getBoundingClientRect(),Q=G8(q.width)/J.offsetWidth||1,Z=G8(q.height)/J.offsetHeight||1;return Q!==1||Z!==1};function az(J,q,Q){if(Q===void 0)Q=!1;var Z=b0(q),X=b0(q)&&IO(q),Y=o0(q),z=k6(J,X,Q),K={scrollLeft:0,scrollTop:0},W={x:0,y:0};if(Z||!Z&&!Q){if(u0(q)!=="body"||MJ(Y))K=nz(q);if(b0(q))W=k6(q,!0),W.x+=q.clientLeft,W.y+=q.clientTop;else if(Y)W.x=PJ(Y)}return{x:z.left+K.scrollLeft-W.x,y:z.top+K.scrollTop-W.y,width:z.width,height:z.height}}var wO=function(J){var q=new Map,Q=new Set,Z=[];J.forEach(function(Y){q.set(Y.name,Y)});function X(Y){Q.add(Y.name);var z=[].concat(Y.requires||[],Y.requiresIfExists||[]);z.forEach(function(K){if(!Q.has(K)){var W=q.get(K);if(W)X(W)}}),Z.push(Y)}return J.forEach(function(Y){if(!Q.has(Y.name))X(Y)}),Z};function rz(J){var q=wO(J);return bz.reduce(function(Q,Z){return Q.concat(q.filter(function(X){return X.phase===Z}))},[])}function sz(J){var q;return function(){if(!q)q=new Promise(function(Q){Promise.resolve().then(function(){q=void 0,Q(J())})});return q}}function iz(J){var q=J.reduce(function(Q,Z){var X=Q[Z.name];return Q[Z.name]=X?Object.assign({},X,Z,{options:Object.assign({},X.options,Z.options),data:Object.assign({},X.data,Z.data)}):Z,Q},{});return Object.keys(q).map(function(Q){return q[Q]})}var wG=function(){for(var J=arguments.length,q=new Array(J),Q=0;Q<J;Q++)q[Q]=arguments[Q];return!q.some(function(Z){return!(Z&&typeof Z.getBoundingClientRect==="function")})};function Uq(J){if(J===void 0)J={};var q=J,Q=q.defaultModifiers,Z=Q===void 0?[]:Q,X=q.defaultOptions,Y=X===void 0?IG:X;return function z(K,W,G){if(G===void 0)G=Y;var H={placement:"bottom",orderedModifiers:[],options:Object.assign({},IG,Y),modifiersData:{},elements:{reference:K,popper:W},attributes:{},styles:{}},j=[],L=!1,V={state:H,setOptions:function k(O){var R=typeof O==="function"?O(H.options):O;M(),H.options=Object.assign({},Y,H.options,R),H.scrollParents={reference:h6(K)?u8(K):K.contextElement?u8(K.contextElement):[],popper:u8(W)};var S=rz(iz([].concat(Z,H.options.modifiers)));return H.orderedModifiers=S.filter(function(T){return T.enabled}),U(),V.update()},forceUpdate:function k(){if(L)return;var O=H.elements,R=O.reference,S=O.popper;if(!wG(R,S))return;H.rects={reference:az(R,x6(S),H.options.strategy==="fixed"),popper:NJ(S)},H.reset=!1,H.placement=H.options.placement,H.orderedModifiers.forEach(function($0){return H.modifiersData[$0.name]=Object.assign({},$0.data)});for(var T=0;T<H.orderedModifiers.length;T++){if(H.reset===!0){H.reset=!1,T=-1;continue}var b=H.orderedModifiers[T],m=b.fn,l=b.options,U0=l===void 0?{}:l,O0=b.name;if(typeof m==="function")H=m({state:H,options:U0,name:O0,instance:V})||H}},update:sz(function(){return new Promise(function(k){V.forceUpdate(),k(H)})}),destroy:function k(){M(),L=!0}};if(!wG(K,W))return V;V.setOptions(G).then(function(k){if(!L&&G.onFirstUpdate)G.onFirstUpdate(k)});function U(){H.orderedModifiers.forEach(function(k){var{name:O,options:R}=k,S=R===void 0?{}:R,T=k.effect;if(typeof T==="function"){var b=T({state:H,name:O,instance:V,options:S}),m=function l(){};j.push(b||m)}})}function M(){j.forEach(function(k){return k()}),j=[]}return V}}var IG={placement:"bottom",modifiers:[],strategy:"absolute"},BO=Uq();var AO=[T9,b9,E9,w9],CO=Uq({defaultModifiers:AO});var RO=[T9,b9,E9,w9,cz,pz,dz,vz,mz],S9=Uq({defaultModifiers:RO});var zj=function(J,q){return q&&`${q}::${BG++}`||J.uidEvent||BG++},Kj=function(J){const q=zj(J);return J.uidEvent=q,JK[q]=JK[q]||{},JK[q]},fO=function(J,q){return function Q(Z){if(UK(Z,{delegateTarget:J}),Q.oneOff)C.off(J,Z.type,q);return q.apply(J,[Z])}},pO=function(J,q,Q){return function Z(X){const Y=J.querySelectorAll(q);for(let{target:z}=X;z&&z!==this;z=z.parentNode)for(let K of Y){if(K!==z)continue;if(UK(X,{delegateTarget:z}),Z.oneOff)C.off(J,X.type,q,Q);return Q.apply(z,[X])}}},Wj=function(J,q,Q=null){return Object.values(J).find((Z)=>Z.callable===q&&Z.delegationSelector===Q)},Fj=function(J,q,Q){const Z=typeof q==="string",X=Z?Q:q||Q;let Y=$j(J);if(!gO.has(Y))Y=J;return[Z,X,Y]},AG=function(J,q,Q,Z,X){if(typeof q!=="string"||!J)return;let[Y,z,K]=Fj(q,Q,Z);if(q in Yj)z=((U)=>{return function(M){if(!M.relatedTarget||M.relatedTarget!==M.delegateTarget&&!M.delegateTarget.contains(M.relatedTarget))return U.call(this,M)}})(z);const W=Kj(J),G=W[K]||(W[K]={}),H=Wj(G,z,Y?Q:null);if(H){H.oneOff=H.oneOff&&X;return}const j=zj(z,q.replace(vO,"")),L=Y?pO(J,Q,z):fO(J,z);L.delegationSelector=Y?Q:null,L.callable=z,L.oneOff=X,L.uidEvent=j,G[j]=L,J.addEventListener(K,L,Y)},NK=function(J,q,Q,Z,X){const Y=Wj(q[Q],Z,X);if(!Y)return;J.removeEventListener(Q,Y,Boolean(X)),delete q[Q][Y.uidEvent]},mO=function(J,q,Q,Z){const X=q[Q]||{};for(let[Y,z]of Object.entries(X))if(Y.includes(Z))NK(J,q,Q,z.callable,z.delegationSelector)},$j=function(J){return J=J.replace(xO,""),Yj[J]||J},UK=function(J,q={}){for(let[Q,Z]of Object.entries(q))try{J[Q]=Z}catch(X){Object.defineProperty(J,Q,{configurable:!0,get(){return Z}})}return J},CG=function(J){if(J==="true")return!0;if(J==="false")return!1;if(J===Number(J).toString())return Number(J);if(J===""||J==="null")return null;if(typeof J!=="string")return J;try{return JSON.parse(decodeURIComponent(J))}catch(q){return J}},qK=function(J){return J.replace(/[A-Z]/g,(q)=>`-${q.toLowerCase()}`)},OB=function(J,q,Q){if(!J.length)return J;if(Q&&typeof Q==="function")return Q(J);const X=new window.DOMParser().parseFromString(J,"text/html"),Y=[].concat(...X.body.querySelectorAll("*"));for(let z of Y){const K=z.nodeName.toLowerCase();if(!Object.keys(q).includes(K)){z.remove();continue}const W=[].concat(...z.attributes),G=[].concat(q["*"]||[],q[K]||[]);for(let H of W)if(!DB(H,G))z.removeAttribute(H.nodeName)}return X.body.innerHTML};/*!
  * Bootstrap v5.3.2 (https://getbootstrap.com/)
  * Copyright 2011-2023 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */var g8=new Map,tz={set(J,q,Q){if(!g8.has(J))g8.set(J,new Map);const Z=g8.get(J);if(!Z.has(q)&&Z.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(Z.keys())[0]}.`);return}Z.set(q,Q)},get(J,q){if(g8.has(J))return g8.get(J).get(q)||null;return null},remove(J,q){if(!g8.has(J))return;const Q=g8.get(J);if(Q.delete(q),Q.size===0)g8.delete(J)}},yO=1e6,EO=1000,jK="transitionend",Jj=(J)=>{if(J&&window.CSS&&window.CSS.escape)J=J.replace(/#([^\s"#']+)/g,(q,Q)=>`#${CSS.escape(Q)}`);return J},TO=(J)=>{if(J===null||J===void 0)return`${J}`;return Object.prototype.toString.call(J).match(/\s([a-z]+)/i)[1].toLowerCase()},_O=(J)=>{do J+=Math.floor(Math.random()*yO);while(document.getElementById(J));return J},bO=(J)=>{if(!J)return 0;let{transitionDuration:q,transitionDelay:Q}=window.getComputedStyle(J);const Z=Number.parseFloat(q),X=Number.parseFloat(Q);if(!Z&&!X)return 0;return q=q.split(",")[0],Q=Q.split(",")[0],(Number.parseFloat(q)+Number.parseFloat(Q))*EO},qj=(J)=>{J.dispatchEvent(new Event(jK))},N8=(J)=>{if(!J||typeof J!=="object")return!1;if(typeof J.jquery!=="undefined")J=J[0];return typeof J.nodeType!=="undefined"},f8=(J)=>{if(N8(J))return J.jquery?J[0]:J;if(typeof J==="string"&&J.length>0)return document.querySelector(Jj(J));return null},Iq=(J)=>{if(!N8(J)||J.getClientRects().length===0)return!1;const q=getComputedStyle(J).getPropertyValue("visibility")==="visible",Q=J.closest("details:not([open])");if(!Q)return q;if(Q!==J){const Z=J.closest("summary");if(Z&&Z.parentNode!==Q)return!1;if(Z===null)return!1}return q},p8=(J)=>{if(!J||J.nodeType!==Node.ELEMENT_NODE)return!0;if(J.classList.contains("disabled"))return!0;if(typeof J.disabled!=="undefined")return J.disabled;return J.hasAttribute("disabled")&&J.getAttribute("disabled")!=="false"},Qj=(J)=>{if(!document.documentElement.attachShadow)return null;if(typeof J.getRootNode==="function"){const q=J.getRootNode();return q instanceof ShadowRoot?q:null}if(J instanceof ShadowRoot)return J;if(!J.parentNode)return null;return Qj(J.parentNode)},$X=()=>{},g9=(J)=>{J.offsetHeight},Zj=()=>{if(window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery"))return window.jQuery;return null},ez=[],SO=(J)=>{if(document.readyState==="loading"){if(!ez.length)document.addEventListener("DOMContentLoaded",()=>{for(let q of ez)q()});ez.push(J)}else J()},O6=()=>document.documentElement.dir==="rtl",w6=(J)=>{SO(()=>{const q=Zj();if(q){const Q=J.NAME,Z=q.fn[Q];q.fn[Q]=J.jQueryInterface,q.fn[Q].Constructor=J,q.fn[Q].noConflict=()=>{return q.fn[Q]=Z,J.jQueryInterface}}})},K6=(J,q=[],Q=J)=>{return typeof J==="function"?J(...q):Q},Xj=(J,q,Q=!0)=>{if(!Q){K6(J);return}const Z=5,X=bO(q)+Z;let Y=!1;const z=({target:K})=>{if(K!==q)return;Y=!0,q.removeEventListener(jK,z),K6(J)};q.addEventListener(jK,z),setTimeout(()=>{if(!Y)qj(q)},X)},VK=(J,q,Q,Z)=>{const X=J.length;let Y=J.indexOf(q);if(Y===-1)return!Q&&Z?J[X-1]:J[0];if(Y+=Q?1:-1,Z)Y=(Y+X)%X;return J[Math.max(0,Math.min(Y,X-1))]},vO=/[^.]*(?=\..*)\.|.*/,xO=/\..*/,uO=/::\d+$/,JK={},BG=1,Yj={mouseenter:"mouseover",mouseleave:"mouseout"},gO=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]),C={on(J,q,Q,Z){AG(J,q,Q,Z,!1)},one(J,q,Q,Z){AG(J,q,Q,Z,!0)},off(J,q,Q,Z){if(typeof q!=="string"||!J)return;const[X,Y,z]=Fj(q,Q,Z),K=z!==q,W=Kj(J),G=W[z]||{},H=q.startsWith(".");if(typeof Y!=="undefined"){if(!Object.keys(G).length)return;NK(J,W,z,Y,X?Q:null);return}if(H)for(let j of Object.keys(W))mO(J,W,j,q.slice(1));for(let[j,L]of Object.entries(G)){const V=j.replace(uO,"");if(!K||q.includes(V))NK(J,W,z,L.callable,L.delegationSelector)}},trigger(J,q,Q){if(typeof q!=="string"||!J)return null;const Z=Zj(),X=$j(q),Y=q!==X;let z=null,K=!0,W=!0,G=!1;if(Y&&Z)z=Z.Event(q,Q),Z(J).trigger(z),K=!z.isPropagationStopped(),W=!z.isImmediatePropagationStopped(),G=z.isDefaultPrevented();const H=UK(new Event(q,{bubbles:K,cancelable:!0}),Q);if(G)H.preventDefault();if(W)J.dispatchEvent(H);if(H.defaultPrevented&&z)z.preventDefault();return H}},L8={setDataAttribute(J,q,Q){J.setAttribute(`data-bs-${qK(q)}`,Q)},removeDataAttribute(J,q){J.removeAttribute(`data-bs-${qK(q)}`)},getDataAttributes(J){if(!J)return{};const q={},Q=Object.keys(J.dataset).filter((Z)=>Z.startsWith("bs")&&!Z.startsWith("bsConfig"));for(let Z of Q){let X=Z.replace(/^bs/,"");X=X.charAt(0).toLowerCase()+X.slice(1,X.length),q[X]=CG(J.dataset[Z])}return q},getDataAttribute(J,q){return CG(J.getAttribute(`data-bs-${qK(q)}`))}};class wq{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(J){return J=this._mergeConfigObj(J),J=this._configAfterMerge(J),this._typeCheckConfig(J),J}_configAfterMerge(J){return J}_mergeConfigObj(J,q){const Q=N8(q)?L8.getDataAttribute(q,"config"):{};return{...this.constructor.Default,...typeof Q==="object"?Q:{},...N8(q)?L8.getDataAttributes(q):{},...typeof J==="object"?J:{}}}_typeCheckConfig(J,q=this.constructor.DefaultType){for(let[Q,Z]of Object.entries(q)){const X=J[Q],Y=N8(X)?"element":TO(X);if(!new RegExp(Z).test(Y))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${Q}" provided type "${Y}" but expected type "${Z}".`)}}}var cO="5.3.2";class B6 extends wq{constructor(J,q){super();if(J=f8(J),!J)return;this._element=J,this._config=this._getConfig(q),tz.set(this._element,this.constructor.DATA_KEY,this)}dispose(){tz.remove(this._element,this.constructor.DATA_KEY),C.off(this._element,this.constructor.EVENT_KEY);for(let J of Object.getOwnPropertyNames(this))this[J]=null}_queueCallback(J,q,Q=!0){Xj(J,q,Q)}_getConfig(J){return J=this._mergeConfigObj(J,this._element),J=this._configAfterMerge(J),this._typeCheckConfig(J),J}static getInstance(J){return tz.get(f8(J),this.DATA_KEY)}static getOrCreateInstance(J,q={}){return this.getInstance(J)||new this(J,typeof q==="object"?q:null)}static get VERSION(){return cO}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(J){return`${J}${this.EVENT_KEY}`}}var QK=(J)=>{let q=J.getAttribute("data-bs-target");if(!q||q==="#"){let Q=J.getAttribute("href");if(!Q||!Q.includes("#")&&!Q.startsWith("."))return null;if(Q.includes("#")&&!Q.startsWith("#"))Q=`#${Q.split("#")[1]}`;q=Q&&Q!=="#"?Jj(Q.trim()):null}return q},x={find(J,q=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(q,J))},findOne(J,q=document.documentElement){return Element.prototype.querySelector.call(q,J)},children(J,q){return[].concat(...J.children).filter((Q)=>Q.matches(q))},parents(J,q){const Q=[];let Z=J.parentNode.closest(q);while(Z)Q.push(Z),Z=Z.parentNode.closest(q);return Q},prev(J,q){let Q=J.previousElementSibling;while(Q){if(Q.matches(q))return[Q];Q=Q.previousElementSibling}return[]},next(J,q){let Q=J.nextElementSibling;while(Q){if(Q.matches(q))return[Q];Q=Q.nextElementSibling}return[]},focusableChildren(J){const q=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map((Q)=>`${Q}:not([tabindex^="-"])`).join(",");return this.find(q,J).filter((Q)=>!p8(Q)&&Iq(Q))},getSelectorFromElement(J){const q=QK(J);if(q)return x.findOne(q)?q:null;return null},getElementFromSelector(J){const q=QK(J);return q?x.findOne(q):null},getMultipleElementsFromSelector(J){const q=QK(J);return q?x.find(q):[]}},NX=(J,q="hide")=>{const Q=`click.dismiss${J.EVENT_KEY}`,Z=J.NAME;C.on(document,Q,`[data-bs-dismiss="${Z}"]`,function(X){if(["A","AREA"].includes(this.tagName))X.preventDefault();if(p8(this))return;const Y=x.getElementFromSelector(this)||this.closest(`.${Z}`);J.getOrCreateInstance(Y)[q]()})},oO="alert",dO="bs.alert",Hj=`.${dO}`,lO=`close${Hj}`,nO=`closed${Hj}`,aO="fade",rO="show";class LX extends B6{static get NAME(){return oO}close(){if(C.trigger(this._element,lO).defaultPrevented)return;this._element.classList.remove(rO);const q=this._element.classList.contains(aO);this._queueCallback(()=>this._destroyElement(),this._element,q)}_destroyElement(){this._element.remove(),C.trigger(this._element,nO),this.dispose()}static jQueryInterface(J){return this.each(function(){const q=LX.getOrCreateInstance(this);if(typeof J!=="string")return;if(q[J]===void 0||J.startsWith("_")||J==="constructor")throw new TypeError(`No method named "${J}"`);q[J](this)})}}NX(LX,"close");w6(LX);var sO="button",iO="bs.button",tO=`.${iO}`,eO=".data-api",JI="active",RG='[data-bs-toggle="button"]',qI=`click${tO}${eO}`;class VX extends B6{static get NAME(){return sO}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(JI))}static jQueryInterface(J){return this.each(function(){const q=VX.getOrCreateInstance(this);if(J==="toggle")q[J]()})}}C.on(document,qI,RG,(J)=>{J.preventDefault();const q=J.target.closest(RG);VX.getOrCreateInstance(q).toggle()});w6(VX);var QI="swipe",Bq=".bs.swipe",ZI=`touchstart${Bq}`,XI=`touchmove${Bq}`,YI=`touchend${Bq}`,zI=`pointerdown${Bq}`,KI=`pointerup${Bq}`,WI="touch",FI="pen",$I="pointer-event",HI=40,GI={endCallback:null,leftCallback:null,rightCallback:null},jI={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class HX extends wq{constructor(J,q){super();if(this._element=J,!J||!HX.isSupported())return;this._config=this._getConfig(q),this._deltaX=0,this._supportPointerEvents=Boolean(window.PointerEvent),this._initEvents()}static get Default(){return GI}static get DefaultType(){return jI}static get NAME(){return QI}dispose(){C.off(this._element,Bq)}_start(J){if(!this._supportPointerEvents){this._deltaX=J.touches[0].clientX;return}if(this._eventIsPointerPenTouch(J))this._deltaX=J.clientX}_end(J){if(this._eventIsPointerPenTouch(J))this._deltaX=J.clientX-this._deltaX;this._handleSwipe(),K6(this._config.endCallback)}_move(J){this._deltaX=J.touches&&J.touches.length>1?0:J.touches[0].clientX-this._deltaX}_handleSwipe(){const J=Math.abs(this._deltaX);if(J<=HI)return;const q=J/this._deltaX;if(this._deltaX=0,!q)return;K6(q>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){if(this._supportPointerEvents)C.on(this._element,zI,(J)=>this._start(J)),C.on(this._element,KI,(J)=>this._end(J)),this._element.classList.add($I);else C.on(this._element,ZI,(J)=>this._start(J)),C.on(this._element,XI,(J)=>this._move(J)),C.on(this._element,YI,(J)=>this._end(J))}_eventIsPointerPenTouch(J){return this._supportPointerEvents&&(J.pointerType===FI||J.pointerType===WI)}static isSupported(){return("ontouchstart"in document.documentElement)||navigator.maxTouchPoints>0}}var NI="carousel",LI="bs.carousel",o8=`.${LI}`,Gj=".data-api",VI="ArrowLeft",UI="ArrowRight",PI=500,v9="next",Pq="prev",hq="left",WX="right",MI=`slide${o8}`,ZK=`slid${o8}`,hI=`keydown${o8}`,kI=`mouseenter${o8}`,DI=`mouseleave${o8}`,OI=`dragstart${o8}`,II=`load${o8}${Gj}`,wI=`click${o8}${Gj}`,jj="carousel",QX="active",BI="slide",AI="carousel-item-end",CI="carousel-item-start",RI="carousel-item-next",yI="carousel-item-prev",Nj=".active",Lj=".carousel-item",EI=Nj+Lj,TI=".carousel-item img",_I=".carousel-indicators",bI="[data-bs-slide], [data-bs-slide-to]",SI='[data-bs-ride="carousel"]',vI={[VI]:WX,[UI]:hq},xI={interval:5000,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},uI={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class f9 extends B6{constructor(J,q){super(J,q);if(this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=x.findOne(_I,this._element),this._addEventListeners(),this._config.ride===jj)this.cycle()}static get Default(){return xI}static get DefaultType(){return uI}static get NAME(){return NI}next(){this._slide(v9)}nextWhenVisible(){if(!document.hidden&&Iq(this._element))this.next()}prev(){this._slide(Pq)}pause(){if(this._isSliding)qj(this._element);this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(!this._config.ride)return;if(this._isSliding){C.one(this._element,ZK,()=>this.cycle());return}this.cycle()}to(J){const q=this._getItems();if(J>q.length-1||J<0)return;if(this._isSliding){C.one(this._element,ZK,()=>this.to(J));return}const Q=this._getItemIndex(this._getActive());if(Q===J)return;const Z=J>Q?v9:Pq;this._slide(Z,q[J])}dispose(){if(this._swipeHelper)this._swipeHelper.dispose();super.dispose()}_configAfterMerge(J){return J.defaultInterval=J.interval,J}_addEventListeners(){if(this._config.keyboard)C.on(this._element,hI,(J)=>this._keydown(J));if(this._config.pause==="hover")C.on(this._element,kI,()=>this.pause()),C.on(this._element,DI,()=>this._maybeEnableCycle());if(this._config.touch&&HX.isSupported())this._addTouchEventListeners()}_addTouchEventListeners(){for(let Q of x.find(TI,this._element))C.on(Q,OI,(Z)=>Z.preventDefault());const q={leftCallback:()=>this._slide(this._directionToOrder(hq)),rightCallback:()=>this._slide(this._directionToOrder(WX)),endCallback:()=>{if(this._config.pause!=="hover")return;if(this.pause(),this.touchTimeout)clearTimeout(this.touchTimeout);this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),PI+this._config.interval)}};this._swipeHelper=new HX(this._element,q)}_keydown(J){if(/input|textarea/i.test(J.target.tagName))return;const q=vI[J.key];if(q)J.preventDefault(),this._slide(this._directionToOrder(q))}_getItemIndex(J){return this._getItems().indexOf(J)}_setActiveIndicatorElement(J){if(!this._indicatorsElement)return;const q=x.findOne(Nj,this._indicatorsElement);q.classList.remove(QX),q.removeAttribute("aria-current");const Q=x.findOne(`[data-bs-slide-to="${J}"]`,this._indicatorsElement);if(Q)Q.classList.add(QX),Q.setAttribute("aria-current","true")}_updateInterval(){const J=this._activeElement||this._getActive();if(!J)return;const q=Number.parseInt(J.getAttribute("data-bs-interval"),10);this._config.interval=q||this._config.defaultInterval}_slide(J,q=null){if(this._isSliding)return;const Q=this._getActive(),Z=J===v9,X=q||VK(this._getItems(),Q,Z,this._config.wrap);if(X===Q)return;const Y=this._getItemIndex(X),z=(L)=>{return C.trigger(this._element,L,{relatedTarget:X,direction:this._orderToDirection(J),from:this._getItemIndex(Q),to:Y})};if(z(MI).defaultPrevented)return;if(!Q||!X)return;const W=Boolean(this._interval);this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(Y),this._activeElement=X;const G=Z?CI:AI,H=Z?RI:yI;X.classList.add(H),g9(X),Q.classList.add(G),X.classList.add(G);const j=()=>{X.classList.remove(G,H),X.classList.add(QX),Q.classList.remove(QX,H,G),this._isSliding=!1,z(ZK)};if(this._queueCallback(j,Q,this._isAnimated()),W)this.cycle()}_isAnimated(){return this._element.classList.contains(BI)}_getActive(){return x.findOne(EI,this._element)}_getItems(){return x.find(Lj,this._element)}_clearInterval(){if(this._interval)clearInterval(this._interval),this._interval=null}_directionToOrder(J){if(O6())return J===hq?Pq:v9;return J===hq?v9:Pq}_orderToDirection(J){if(O6())return J===Pq?hq:WX;return J===Pq?WX:hq}static jQueryInterface(J){return this.each(function(){const q=f9.getOrCreateInstance(this,J);if(typeof J==="number"){q.to(J);return}if(typeof J==="string"){if(q[J]===void 0||J.startsWith("_")||J==="constructor")throw new TypeError(`No method named "${J}"`);q[J]()}})}}C.on(document,wI,bI,function(J){const q=x.getElementFromSelector(this);if(!q||!q.classList.contains(jj))return;J.preventDefault();const Q=f9.getOrCreateInstance(q),Z=this.getAttribute("data-bs-slide-to");if(Z){Q.to(Z),Q._maybeEnableCycle();return}if(L8.getDataAttribute(this,"slide")==="next"){Q.next(),Q._maybeEnableCycle();return}Q.prev(),Q._maybeEnableCycle()});C.on(window,II,()=>{const J=x.find(SI);for(let q of J)f9.getOrCreateInstance(q)});w6(f9);var gI="collapse",fI="bs.collapse",p9=`.${fI}`,pI=".data-api",mI=`show${p9}`,cI=`shown${p9}`,oI=`hide${p9}`,dI=`hidden${p9}`,lI=`click${p9}${pI}`,XK="show",Dq="collapse",ZX="collapsing",nI="collapsed",aI=`:scope .${Dq} .${Dq}`,rI="collapse-horizontal",sI="width",iI="height",tI=".collapse.show, .collapse.collapsing",LK='[data-bs-toggle="collapse"]',eI={parent:null,toggle:!0},Jw={parent:"(null|element)",toggle:"boolean"};class u9 extends B6{constructor(J,q){super(J,q);this._isTransitioning=!1,this._triggerArray=[];const Q=x.find(LK);for(let Z of Q){const X=x.getSelectorFromElement(Z),Y=x.find(X).filter((z)=>z===this._element);if(X!==null&&Y.length)this._triggerArray.push(Z)}if(this._initializeChildren(),!this._config.parent)this._addAriaAndCollapsedClass(this._triggerArray,this._isShown());if(this._config.toggle)this.toggle()}static get Default(){return eI}static get DefaultType(){return Jw}static get NAME(){return gI}toggle(){if(this._isShown())this.hide();else this.show()}show(){if(this._isTransitioning||this._isShown())return;let J=[];if(this._config.parent)J=this._getFirstLevelChildren(tI).filter((z)=>z!==this._element).map((z)=>u9.getOrCreateInstance(z,{toggle:!1}));if(J.length&&J[0]._isTransitioning)return;if(C.trigger(this._element,mI).defaultPrevented)return;for(let z of J)z.hide();const Q=this._getDimension();this._element.classList.remove(Dq),this._element.classList.add(ZX),this._element.style[Q]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const Z=()=>{this._isTransitioning=!1,this._element.classList.remove(ZX),this._element.classList.add(Dq,XK),this._element.style[Q]="",C.trigger(this._element,cI)},Y=`scroll${Q[0].toUpperCase()+Q.slice(1)}`;this._queueCallback(Z,this._element,!0),this._element.style[Q]=`${this._element[Y]}px`}hide(){if(this._isTransitioning||!this._isShown())return;if(C.trigger(this._element,oI).defaultPrevented)return;const q=this._getDimension();this._element.style[q]=`${this._element.getBoundingClientRect()[q]}px`,g9(this._element),this._element.classList.add(ZX),this._element.classList.remove(Dq,XK);for(let Z of this._triggerArray){const X=x.getElementFromSelector(Z);if(X&&!this._isShown(X))this._addAriaAndCollapsedClass([Z],!1)}this._isTransitioning=!0;const Q=()=>{this._isTransitioning=!1,this._element.classList.remove(ZX),this._element.classList.add(Dq),C.trigger(this._element,dI)};this._element.style[q]="",this._queueCallback(Q,this._element,!0)}_isShown(J=this._element){return J.classList.contains(XK)}_configAfterMerge(J){return J.toggle=Boolean(J.toggle),J.parent=f8(J.parent),J}_getDimension(){return this._element.classList.contains(rI)?sI:iI}_initializeChildren(){if(!this._config.parent)return;const J=this._getFirstLevelChildren(LK);for(let q of J){const Q=x.getElementFromSelector(q);if(Q)this._addAriaAndCollapsedClass([q],this._isShown(Q))}}_getFirstLevelChildren(J){const q=x.find(aI,this._config.parent);return x.find(J,this._config.parent).filter((Q)=>!q.includes(Q))}_addAriaAndCollapsedClass(J,q){if(!J.length)return;for(let Q of J)Q.classList.toggle(nI,!q),Q.setAttribute("aria-expanded",q)}static jQueryInterface(J){const q={};if(typeof J==="string"&&/show|hide/.test(J))q.toggle=!1;return this.each(function(){const Q=u9.getOrCreateInstance(this,q);if(typeof J==="string"){if(typeof Q[J]==="undefined")throw new TypeError(`No method named "${J}"`);Q[J]()}})}}C.on(document,lI,LK,function(J){if(J.target.tagName==="A"||J.delegateTarget&&J.delegateTarget.tagName==="A")J.preventDefault();for(let q of x.getMultipleElementsFromSelector(this))u9.getOrCreateInstance(q,{toggle:!1}).toggle()});w6(u9);var yG="dropdown",qw="bs.dropdown",DJ=`.${qw}`,PK=".data-api",Qw="Escape",EG="Tab",Zw="ArrowUp",TG="ArrowDown",Xw=2,Yw=`hide${DJ}`,zw=`hidden${DJ}`,Kw=`show${DJ}`,Ww=`shown${DJ}`,Vj=`click${DJ}${PK}`,Uj=`keydown${DJ}${PK}`,Fw=`keyup${DJ}${PK}`,kq="show",$w="dropup",Hw="dropend",Gw="dropstart",jw="dropup-center",Nw="dropdown-center",hJ='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',Lw=`${hJ}.${kq}`,FX=".dropdown-menu",Vw=".navbar",Uw=".navbar-nav",Pw=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",Mw=O6()?"top-end":"top-start",hw=O6()?"top-start":"top-end",kw=O6()?"bottom-end":"bottom-start",Dw=O6()?"bottom-start":"bottom-end",Ow=O6()?"left-start":"right-start",Iw=O6()?"right-start":"left-start",ww="top",Bw="bottom",Aw={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Cw={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class s6 extends B6{constructor(J,q){super(J,q);this._popper=null,this._parent=this._element.parentNode,this._menu=x.next(this._element,FX)[0]||x.prev(this._element,FX)[0]||x.findOne(FX,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Aw}static get DefaultType(){return Cw}static get NAME(){return yG}toggle(){return this._isShown()?this.hide():this.show()}show(){if(p8(this._element)||this._isShown())return;const J={relatedTarget:this._element};if(C.trigger(this._element,Kw,J).defaultPrevented)return;if(this._createPopper(),("ontouchstart"in document.documentElement)&&!this._parent.closest(Uw))for(let Q of[].concat(...document.body.children))C.on(Q,"mouseover",$X);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(kq),this._element.classList.add(kq),C.trigger(this._element,Ww,J)}hide(){if(p8(this._element)||!this._isShown())return;const J={relatedTarget:this._element};this._completeHide(J)}dispose(){if(this._popper)this._popper.destroy();super.dispose()}update(){if(this._inNavbar=this._detectNavbar(),this._popper)this._popper.update()}_completeHide(J){if(C.trigger(this._element,Yw,J).defaultPrevented)return;if("ontouchstart"in document.documentElement)for(let Q of[].concat(...document.body.children))C.off(Q,"mouseover",$X);if(this._popper)this._popper.destroy();this._menu.classList.remove(kq),this._element.classList.remove(kq),this._element.setAttribute("aria-expanded","false"),L8.removeDataAttribute(this._menu,"popper"),C.trigger(this._element,zw,J)}_getConfig(J){if(J=super._getConfig(J),typeof J.reference==="object"&&!N8(J.reference)&&typeof J.reference.getBoundingClientRect!=="function")throw new TypeError(`${yG.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return J}_createPopper(){if(typeof qX==="undefined")throw new TypeError("Bootstrap\'s dropdowns require Popper (https://popper.js.org)");let J=this._element;if(this._config.reference==="parent")J=this._parent;else if(N8(this._config.reference))J=f8(this._config.reference);else if(typeof this._config.reference==="object")J=this._config.reference;const q=this._getPopperConfig();this._popper=S9(J,this._menu,q)}_isShown(){return this._menu.classList.contains(kq)}_getPlacement(){const J=this._parent;if(J.classList.contains(Hw))return Ow;if(J.classList.contains(Gw))return Iw;if(J.classList.contains(jw))return ww;if(J.classList.contains(Nw))return Bw;const q=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";if(J.classList.contains($w))return q?hw:Mw;return q?Dw:kw}_detectNavbar(){return this._element.closest(Vw)!==null}_getOffset(){const{offset:J}=this._config;if(typeof J==="string")return J.split(",").map((q)=>Number.parseInt(q,10));if(typeof J==="function")return(q)=>J(q,this._element);return J}_getPopperConfig(){const J={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};if(this._inNavbar||this._config.display==="static")L8.setDataAttribute(this._menu,"popper","static"),J.modifiers=[{name:"applyStyles",enabled:!1}];return{...J,...K6(this._config.popperConfig,[J])}}_selectMenuItem({key:J,target:q}){const Q=x.find(Pw,this._menu).filter((Z)=>Iq(Z));if(!Q.length)return;VK(Q,q,J===TG,!Q.includes(q)).focus()}static jQueryInterface(J){return this.each(function(){const q=s6.getOrCreateInstance(this,J);if(typeof J!=="string")return;if(typeof q[J]==="undefined")throw new TypeError(`No method named "${J}"`);q[J]()})}static clearMenus(J){if(J.button===Xw||J.type==="keyup"&&J.key!==EG)return;const q=x.find(Lw);for(let Q of q){const Z=s6.getInstance(Q);if(!Z||Z._config.autoClose===!1)continue;const X=J.composedPath(),Y=X.includes(Z._menu);if(X.includes(Z._element)||Z._config.autoClose==="inside"&&!Y||Z._config.autoClose==="outside"&&Y)continue;if(Z._menu.contains(J.target)&&(J.type==="keyup"&&J.key===EG||/input|select|option|textarea|form/i.test(J.target.tagName)))continue;const z={relatedTarget:Z._element};if(J.type==="click")z.clickEvent=J;Z._completeHide(z)}}static dataApiKeydownHandler(J){const q=/input|textarea/i.test(J.target.tagName),Q=J.key===Qw,Z=[Zw,TG].includes(J.key);if(!Z&&!Q)return;if(q&&!Q)return;J.preventDefault();const X=this.matches(hJ)?this:x.prev(this,hJ)[0]||x.next(this,hJ)[0]||x.findOne(hJ,J.delegateTarget.parentNode),Y=s6.getOrCreateInstance(X);if(Z){J.stopPropagation(),Y.show(),Y._selectMenuItem(J);return}if(Y._isShown())J.stopPropagation(),Y.hide(),X.focus()}}C.on(document,Uj,hJ,s6.dataApiKeydownHandler);C.on(document,Uj,FX,s6.dataApiKeydownHandler);C.on(document,Vj,s6.clearMenus);C.on(document,Fw,s6.clearMenus);C.on(document,Vj,hJ,function(J){J.preventDefault(),s6.getOrCreateInstance(this).toggle()});w6(s6);var Pj="backdrop",Rw="fade",_G="show",bG=`mousedown.bs.${Pj}`,yw={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Ew={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class MK extends wq{constructor(J){super();this._config=this._getConfig(J),this._isAppended=!1,this._element=null}static get Default(){return yw}static get DefaultType(){return Ew}static get NAME(){return Pj}show(J){if(!this._config.isVisible){K6(J);return}this._append();const q=this._getElement();if(this._config.isAnimated)g9(q);q.classList.add(_G),this._emulateAnimation(()=>{K6(J)})}hide(J){if(!this._config.isVisible){K6(J);return}this._getElement().classList.remove(_G),this._emulateAnimation(()=>{this.dispose(),K6(J)})}dispose(){if(!this._isAppended)return;C.off(this._element,bG),this._element.remove(),this._isAppended=!1}_getElement(){if(!this._element){const J=document.createElement("div");if(J.className=this._config.className,this._config.isAnimated)J.classList.add(Rw);this._element=J}return this._element}_configAfterMerge(J){return J.rootElement=f8(J.rootElement),J}_append(){if(this._isAppended)return;const J=this._getElement();this._config.rootElement.append(J),C.on(J,bG,()=>{K6(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(J){Xj(J,this._getElement(),this._config.isAnimated)}}var Tw="focustrap",_w="bs.focustrap",GX=`.${_w}`,bw=`focusin${GX}`,Sw=`keydown.tab${GX}`,vw="Tab",xw="forward",SG="backward",uw={autofocus:!0,trapElement:null},gw={autofocus:"boolean",trapElement:"element"};class hK extends wq{constructor(J){super();this._config=this._getConfig(J),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return uw}static get DefaultType(){return gw}static get NAME(){return Tw}activate(){if(this._isActive)return;if(this._config.autofocus)this._config.trapElement.focus();C.off(document,GX),C.on(document,bw,(J)=>this._handleFocusin(J)),C.on(document,Sw,(J)=>this._handleKeydown(J)),this._isActive=!0}deactivate(){if(!this._isActive)return;this._isActive=!1,C.off(document,GX)}_handleFocusin(J){const{trapElement:q}=this._config;if(J.target===document||J.target===q||q.contains(J.target))return;const Q=x.focusableChildren(q);if(Q.length===0)q.focus();else if(this._lastTabNavDirection===SG)Q[Q.length-1].focus();else Q[0].focus()}_handleKeydown(J){if(J.key!==vw)return;this._lastTabNavDirection=J.shiftKey?SG:xw}}var vG=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",xG=".sticky-top",XX="padding-right",uG="margin-right";class jX{constructor(){this._element=document.body}getWidth(){const J=document.documentElement.clientWidth;return Math.abs(window.innerWidth-J)}hide(){const J=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,XX,(q)=>q+J),this._setElementAttributes(vG,XX,(q)=>q+J),this._setElementAttributes(xG,uG,(q)=>q-J)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,XX),this._resetElementAttributes(vG,XX),this._resetElementAttributes(xG,uG)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(J,q,Q){const Z=this.getWidth(),X=(Y)=>{if(Y!==this._element&&window.innerWidth>Y.clientWidth+Z)return;this._saveInitialAttribute(Y,q);const z=window.getComputedStyle(Y).getPropertyValue(q);Y.style.setProperty(q,`${Q(Number.parseFloat(z))}px`)};this._applyManipulationCallback(J,X)}_saveInitialAttribute(J,q){const Q=J.style.getPropertyValue(q);if(Q)L8.setDataAttribute(J,q,Q)}_resetElementAttributes(J,q){const Q=(Z)=>{const X=L8.getDataAttribute(Z,q);if(X===null){Z.style.removeProperty(q);return}L8.removeDataAttribute(Z,q),Z.style.setProperty(q,X)};this._applyManipulationCallback(J,Q)}_applyManipulationCallback(J,q){if(N8(J)){q(J);return}for(let Q of x.find(J,this._element))q(Q)}}var fw="modal",pw="bs.modal",I6=`.${pw}`,mw=".data-api",cw="Escape",ow=`hide${I6}`,dw=`hidePrevented${I6}`,Mj=`hidden${I6}`,hj=`show${I6}`,lw=`shown${I6}`,nw=`resize${I6}`,aw=`click.dismiss${I6}`,rw=`mousedown.dismiss${I6}`,sw=`keydown.dismiss${I6}`,iw=`click${I6}${mw}`,gG="modal-open",tw="fade",fG="show",YK="modal-static",ew=".modal.show",JB=".modal-dialog",qB=".modal-body",QB='[data-bs-toggle="modal"]',ZB={backdrop:!0,focus:!0,keyboard:!0},XB={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class m8 extends B6{constructor(J,q){super(J,q);this._dialog=x.findOne(JB,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new jX,this._addEventListeners()}static get Default(){return ZB}static get DefaultType(){return XB}static get NAME(){return fw}toggle(J){return this._isShown?this.hide():this.show(J)}show(J){if(this._isShown||this._isTransitioning)return;if(C.trigger(this._element,hj,{relatedTarget:J}).defaultPrevented)return;this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(gG),this._adjustDialog(),this._backdrop.show(()=>this._showElement(J))}hide(){if(!this._isShown||this._isTransitioning)return;if(C.trigger(this._element,ow).defaultPrevented)return;this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(fG),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())}dispose(){C.off(window,I6),C.off(this._dialog,I6),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new MK({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new hK({trapElement:this._element})}_showElement(J){if(!document.body.contains(this._element))document.body.append(this._element);this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const q=x.findOne(qB,this._dialog);if(q)q.scrollTop=0;g9(this._element),this._element.classList.add(fG);const Q=()=>{if(this._config.focus)this._focustrap.activate();this._isTransitioning=!1,C.trigger(this._element,lw,{relatedTarget:J})};this._queueCallback(Q,this._dialog,this._isAnimated())}_addEventListeners(){C.on(this._element,sw,(J)=>{if(J.key!==cw)return;if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}),C.on(window,nw,()=>{if(this._isShown&&!this._isTransitioning)this._adjustDialog()}),C.on(this._element,rw,(J)=>{C.one(this._element,aw,(q)=>{if(this._element!==J.target||this._element!==q.target)return;if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}if(this._config.backdrop)this.hide()})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(gG),this._resetAdjustments(),this._scrollBar.reset(),C.trigger(this._element,Mj)})}_isAnimated(){return this._element.classList.contains(tw)}_triggerBackdropTransition(){if(C.trigger(this._element,dw).defaultPrevented)return;const q=this._element.scrollHeight>document.documentElement.clientHeight,Q=this._element.style.overflowY;if(Q==="hidden"||this._element.classList.contains(YK))return;if(!q)this._element.style.overflowY="hidden";this._element.classList.add(YK),this._queueCallback(()=>{this._element.classList.remove(YK),this._queueCallback(()=>{this._element.style.overflowY=Q},this._dialog)},this._dialog),this._element.focus()}_adjustDialog(){const J=this._element.scrollHeight>document.documentElement.clientHeight,q=this._scrollBar.getWidth(),Q=q>0;if(Q&&!J){const Z=O6()?"paddingLeft":"paddingRight";this._element.style[Z]=`${q}px`}if(!Q&&J){const Z=O6()?"paddingRight":"paddingLeft";this._element.style[Z]=`${q}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(J,q){return this.each(function(){const Q=m8.getOrCreateInstance(this,J);if(typeof J!=="string")return;if(typeof Q[J]==="undefined")throw new TypeError(`No method named "${J}"`);Q[J](q)})}}C.on(document,iw,QB,function(J){const q=x.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName))J.preventDefault();C.one(q,hj,(X)=>{if(X.defaultPrevented)return;C.one(q,Mj,()=>{if(Iq(this))this.focus()})});const Q=x.findOne(ew);if(Q)m8.getInstance(Q).hide();m8.getOrCreateInstance(q).toggle(this)});NX(m8);w6(m8);var YB="offcanvas",zB="bs.offcanvas",V8=`.${zB}`,kj=".data-api",KB=`load${V8}${kj}`,WB="Escape",pG="show",mG="showing",cG="hiding",FB="offcanvas-backdrop",Dj=".offcanvas.show",$B=`show${V8}`,HB=`shown${V8}`,GB=`hide${V8}`,oG=`hidePrevented${V8}`,Oj=`hidden${V8}`,jB=`resize${V8}`,NB=`click${V8}${kj}`,LB=`keydown.dismiss${V8}`,VB='[data-bs-toggle="offcanvas"]',UB={backdrop:!0,keyboard:!0,scroll:!1},PB={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class c8 extends B6{constructor(J,q){super(J,q);this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return UB}static get DefaultType(){return PB}static get NAME(){return YB}toggle(J){return this._isShown?this.hide():this.show(J)}show(J){if(this._isShown)return;if(C.trigger(this._element,$B,{relatedTarget:J}).defaultPrevented)return;if(this._isShown=!0,this._backdrop.show(),!this._config.scroll)new jX().hide();this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(mG);const Q=()=>{if(!this._config.scroll||this._config.backdrop)this._focustrap.activate();this._element.classList.add(pG),this._element.classList.remove(mG),C.trigger(this._element,HB,{relatedTarget:J})};this._queueCallback(Q,this._element,!0)}hide(){if(!this._isShown)return;if(C.trigger(this._element,GB).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(cG),this._backdrop.hide();const q=()=>{if(this._element.classList.remove(pG,cG),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),!this._config.scroll)new jX().reset();C.trigger(this._element,Oj)};this._queueCallback(q,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const J=()=>{if(this._config.backdrop==="static"){C.trigger(this._element,oG);return}this.hide()},q=Boolean(this._config.backdrop);return new MK({className:FB,isVisible:q,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:q?J:null})}_initializeFocusTrap(){return new hK({trapElement:this._element})}_addEventListeners(){C.on(this._element,LB,(J)=>{if(J.key!==WB)return;if(this._config.keyboard){this.hide();return}C.trigger(this._element,oG)})}static jQueryInterface(J){return this.each(function(){const q=c8.getOrCreateInstance(this,J);if(typeof J!=="string")return;if(q[J]===void 0||J.startsWith("_")||J==="constructor")throw new TypeError(`No method named "${J}"`);q[J](this)})}}C.on(document,NB,VB,function(J){const q=x.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName))J.preventDefault();if(p8(this))return;C.one(q,Oj,()=>{if(Iq(this))this.focus()});const Q=x.findOne(Dj);if(Q&&Q!==q)c8.getInstance(Q).hide();c8.getOrCreateInstance(q).toggle(this)});C.on(window,KB,()=>{for(let J of x.find(Dj))c8.getOrCreateInstance(J).show()});C.on(window,jB,()=>{for(let J of x.find("[aria-modal][class*=show][class*=offcanvas-]"))if(getComputedStyle(J).position!=="fixed")c8.getOrCreateInstance(J).hide()});NX(c8);w6(c8);var MB=/^aria-[\w-]*$/i,Ij={"*":["class","dir","id","lang","role",MB],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},hB=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),kB=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,DB=(J,q)=>{const Q=J.nodeName.toLowerCase();if(q.includes(Q)){if(hB.has(Q))return Boolean(kB.test(J.nodeValue));return!0}return q.filter((Z)=>Z instanceof RegExp).some((Z)=>Z.test(Q))},IB="TemplateFactory",wB={allowList:Ij,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},BB={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},AB={entry:"(string|element|function|null)",selector:"(string|element)"};class wj extends wq{constructor(J){super();this._config=this._getConfig(J)}static get Default(){return wB}static get DefaultType(){return BB}static get NAME(){return IB}getContent(){return Object.values(this._config.content).map((J)=>this._resolvePossibleFunction(J)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(J){return this._checkContent(J),this._config.content={...this._config.content,...J},this}toHtml(){const J=document.createElement("div");J.innerHTML=this._maybeSanitize(this._config.template);for(let[Z,X]of Object.entries(this._config.content))this._setContent(J,X,Z);const q=J.children[0],Q=this._resolvePossibleFunction(this._config.extraClass);if(Q)q.classList.add(...Q.split(" "));return q}_typeCheckConfig(J){super._typeCheckConfig(J),this._checkContent(J.content)}_checkContent(J){for(let[q,Q]of Object.entries(J))super._typeCheckConfig({selector:q,entry:Q},AB)}_setContent(J,q,Q){const Z=x.findOne(Q,J);if(!Z)return;if(q=this._resolvePossibleFunction(q),!q){Z.remove();return}if(N8(q)){this._putElementInTemplate(f8(q),Z);return}if(this._config.html){Z.innerHTML=this._maybeSanitize(q);return}Z.textContent=q}_maybeSanitize(J){return this._config.sanitize?OB(J,this._config.allowList,this._config.sanitizeFn):J}_resolvePossibleFunction(J){return K6(J,[this])}_putElementInTemplate(J,q){if(this._config.html){q.innerHTML="",q.append(J);return}q.textContent=J.textContent}}var CB="tooltip",RB=new Set(["sanitize","allowList","sanitizeFn"]),zK="fade",yB="modal",YX="show",EB=".tooltip-inner",dG=`.${yB}`,lG="hide.bs.modal",x9="hover",KK="focus",TB="click",_B="manual",bB="hide",SB="hidden",vB="show",xB="shown",uB="inserted",gB="click",fB="focusin",pB="focusout",mB="mouseenter",cB="mouseleave",oB={AUTO:"auto",TOP:"top",RIGHT:O6()?"left":"right",BOTTOM:"bottom",LEFT:O6()?"right":"left"},dB={allowList:Ij,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},lB={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Aq extends B6{constructor(J,q){if(typeof qX==="undefined")throw new TypeError("Bootstrap\'s tooltips require Popper (https://popper.js.org)");super(J,q);if(this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),!this._config.selector)this._fixTitle()}static get Default(){return dB}static get DefaultType(){return lB}static get NAME(){return CB}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(!this._isEnabled)return;if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}dispose(){if(clearTimeout(this._timeout),C.off(this._element.closest(dG),lG,this._hideModalHandler),this._element.getAttribute("data-bs-original-title"))this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title"));this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const J=C.trigger(this._element,this.constructor.eventName(vB)),Q=(Qj(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(J.defaultPrevented||!Q)return;this._disposePopper();const Z=this._getTipElement();this._element.setAttribute("aria-describedby",Z.getAttribute("id"));const{container:X}=this._config;if(!this._element.ownerDocument.documentElement.contains(this.tip))X.append(Z),C.trigger(this._element,this.constructor.eventName(uB));if(this._popper=this._createPopper(Z),Z.classList.add(YX),("ontouchstart"in document.documentElement))for(let z of[].concat(...document.body.children))C.on(z,"mouseover",$X);const Y=()=>{if(C.trigger(this._element,this.constructor.eventName(xB)),this._isHovered===!1)this._leave();this._isHovered=!1};this._queueCallback(Y,this.tip,this._isAnimated())}hide(){if(!this._isShown())return;if(C.trigger(this._element,this.constructor.eventName(bB)).defaultPrevented)return;if(this._getTipElement().classList.remove(YX),("ontouchstart"in document.documentElement))for(let Z of[].concat(...document.body.children))C.off(Z,"mouseover",$X);this._activeTrigger[TB]=!1,this._activeTrigger[KK]=!1,this._activeTrigger[x9]=!1,this._isHovered=null;const Q=()=>{if(this._isWithActiveTrigger())return;if(!this._isHovered)this._disposePopper();this._element.removeAttribute("aria-describedby"),C.trigger(this._element,this.constructor.eventName(SB))};this._queueCallback(Q,this.tip,this._isAnimated())}update(){if(this._popper)this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){if(!this.tip)this.tip=this._createTipElement(this._newContent||this._getContentForTemplate());return this.tip}_createTipElement(J){const q=this._getTemplateFactory(J).toHtml();if(!q)return null;q.classList.remove(zK,YX),q.classList.add(`bs-${this.constructor.NAME}-auto`);const Q=_O(this.constructor.NAME).toString();if(q.setAttribute("id",Q),this._isAnimated())q.classList.add(zK);return q}setContent(J){if(this._newContent=J,this._isShown())this._disposePopper(),this.show()}_getTemplateFactory(J){if(this._templateFactory)this._templateFactory.changeContent(J);else this._templateFactory=new wj({...this._config,content:J,extraClass:this._resolvePossibleFunction(this._config.customClass)});return this._templateFactory}_getContentForTemplate(){return{[EB]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(J){return this.constructor.getOrCreateInstance(J.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(zK)}_isShown(){return this.tip&&this.tip.classList.contains(YX)}_createPopper(J){const q=K6(this._config.placement,[this,J,this._element]),Q=oB[q.toUpperCase()];return S9(this._element,J,this._getPopperConfig(Q))}_getOffset(){const{offset:J}=this._config;if(typeof J==="string")return J.split(",").map((q)=>Number.parseInt(q,10));if(typeof J==="function")return(q)=>J(q,this._element);return J}_resolvePossibleFunction(J){return K6(J,[this._element])}_getPopperConfig(J){const q={placement:J,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:(Q)=>{this._getTipElement().setAttribute("data-popper-placement",Q.state.placement)}}]};return{...q,...K6(this._config.popperConfig,[q])}}_setListeners(){const J=this._config.trigger.split(" ");for(let q of J)if(q==="click")C.on(this._element,this.constructor.eventName(gB),this._config.selector,(Q)=>{this._initializeOnDelegatedTarget(Q).toggle()});else if(q!==_B){const Q=q===x9?this.constructor.eventName(mB):this.constructor.eventName(fB),Z=q===x9?this.constructor.eventName(cB):this.constructor.eventName(pB);C.on(this._element,Q,this._config.selector,(X)=>{const Y=this._initializeOnDelegatedTarget(X);Y._activeTrigger[X.type==="focusin"?KK:x9]=!0,Y._enter()}),C.on(this._element,Z,this._config.selector,(X)=>{const Y=this._initializeOnDelegatedTarget(X);Y._activeTrigger[X.type==="focusout"?KK:x9]=Y._element.contains(X.relatedTarget),Y._leave()})}this._hideModalHandler=()=>{if(this._element)this.hide()},C.on(this._element.closest(dG),lG,this._hideModalHandler)}_fixTitle(){const J=this._element.getAttribute("title");if(!J)return;if(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim())this._element.setAttribute("aria-label",J);this._element.setAttribute("data-bs-original-title",J),this._element.removeAttribute("title")}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{if(this._isHovered)this.show()},this._config.delay.show)}_leave(){if(this._isWithActiveTrigger())return;this._isHovered=!1,this._setTimeout(()=>{if(!this._isHovered)this.hide()},this._config.delay.hide)}_setTimeout(J,q){clearTimeout(this._timeout),this._timeout=setTimeout(J,q)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(J){const q=L8.getDataAttributes(this._element);for(let Q of Object.keys(q))if(RB.has(Q))delete q[Q];return J={...q,...typeof J==="object"&&J?J:{}},J=this._mergeConfigObj(J),J=this._configAfterMerge(J),this._typeCheckConfig(J),J}_configAfterMerge(J){if(J.container=J.container===!1?document.body:f8(J.container),typeof J.delay==="number")J.delay={show:J.delay,hide:J.delay};if(typeof J.title==="number")J.title=J.title.toString();if(typeof J.content==="number")J.content=J.content.toString();return J}_getDelegateConfig(){const J={};for(let[q,Q]of Object.entries(this._config))if(this.constructor.Default[q]!==Q)J[q]=Q;return J.selector=!1,J.trigger="manual",J}_disposePopper(){if(this._popper)this._popper.destroy(),this._popper=null;if(this.tip)this.tip.remove(),this.tip=null}static jQueryInterface(J){return this.each(function(){const q=Aq.getOrCreateInstance(this,J);if(typeof J!=="string")return;if(typeof q[J]==="undefined")throw new TypeError(`No method named "${J}"`);q[J]()})}}w6(Aq);var nB="popover",aB=".popover-header",rB=".popover-body",sB={...Aq.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},iB={...Aq.DefaultType,content:"(null|string|element|function)"};class kK extends Aq{static get Default(){return sB}static get DefaultType(){return iB}static get NAME(){return nB}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[aB]:this._getTitle(),[rB]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(J){return this.each(function(){const q=kK.getOrCreateInstance(this,J);if(typeof J!=="string")return;if(typeof q[J]==="undefined")throw new TypeError(`No method named "${J}"`);q[J]()})}}w6(kK);var tB="scrollspy",eB="bs.scrollspy",DK=`.${eB}`,JA=".data-api",qA=`activate${DK}`,nG=`click${DK}`,QA=`load${DK}${JA}`,ZA="dropdown-item",Mq="active",XA='[data-bs-spy="scroll"]',WK="[href]",YA=".nav, .list-group",aG=".nav-link",zA=".nav-item",KA=".list-group-item",WA=`${aG}, ${zA} > ${aG}, ${KA}`,FA=".dropdown",$A=".dropdown-toggle",HA={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[0.1,0.5,1]},GA={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class UX extends B6{constructor(J,q){super(J,q);this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return HA}static get DefaultType(){return GA}static get NAME(){return tB}refresh(){if(this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer)this._observer.disconnect();else this._observer=this._getNewObserver();for(let J of this._observableSections.values())this._observer.observe(J)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(J){if(J.target=f8(J.target)||document.body,J.rootMargin=J.offset?`${J.offset}px 0px -30%`:J.rootMargin,typeof J.threshold==="string")J.threshold=J.threshold.split(",").map((q)=>Number.parseFloat(q));return J}_maybeEnableSmoothScroll(){if(!this._config.smoothScroll)return;C.off(this._config.target,nG),C.on(this._config.target,nG,WK,(J)=>{const q=this._observableSections.get(J.target.hash);if(q){J.preventDefault();const Q=this._rootElement||window,Z=q.offsetTop-this._element.offsetTop;if(Q.scrollTo){Q.scrollTo({top:Z,behavior:"smooth"});return}Q.scrollTop=Z}})}_getNewObserver(){const J={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver((q)=>this._observerCallback(q),J)}_observerCallback(J){const q=(Y)=>this._targetLinks.get(`#${Y.target.id}`),Q=(Y)=>{this._previousScrollData.visibleEntryTop=Y.target.offsetTop,this._process(q(Y))},Z=(this._rootElement||document.documentElement).scrollTop,X=Z>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=Z;for(let Y of J){if(!Y.isIntersecting){this._activeTarget=null,this._clearActiveClass(q(Y));continue}const z=Y.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(X&&z){if(Q(Y),!Z)return;continue}if(!X&&!z)Q(Y)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const J=x.find(WK,this._config.target);for(let q of J){if(!q.hash||p8(q))continue;const Q=x.findOne(decodeURI(q.hash),this._element);if(Iq(Q))this._targetLinks.set(decodeURI(q.hash),q),this._observableSections.set(q.hash,Q)}}_process(J){if(this._activeTarget===J)return;this._clearActiveClass(this._config.target),this._activeTarget=J,J.classList.add(Mq),this._activateParents(J),C.trigger(this._element,qA,{relatedTarget:J})}_activateParents(J){if(J.classList.contains(ZA)){x.findOne($A,J.closest(FA)).classList.add(Mq);return}for(let q of x.parents(J,YA))for(let Q of x.prev(q,WA))Q.classList.add(Mq)}_clearActiveClass(J){J.classList.remove(Mq);const q=x.find(`${WK}.${Mq}`,J);for(let Q of q)Q.classList.remove(Mq)}static jQueryInterface(J){return this.each(function(){const q=UX.getOrCreateInstance(this,J);if(typeof J!=="string")return;if(q[J]===void 0||J.startsWith("_")||J==="constructor")throw new TypeError(`No method named "${J}"`);q[J]()})}}C.on(window,QA,()=>{for(let J of x.find(XA))UX.getOrCreateInstance(J)});w6(UX);var jA="tab",NA="bs.tab",OJ=`.${NA}`,LA=`hide${OJ}`,VA=`hidden${OJ}`,UA=`show${OJ}`,PA=`shown${OJ}`,MA=`click${OJ}`,hA=`keydown${OJ}`,kA=`load${OJ}`,DA="ArrowLeft",rG="ArrowRight",OA="ArrowUp",sG="ArrowDown",FK="Home",iG="End",kJ="active",tG="fade",$K="show",IA="dropdown",Bj=".dropdown-toggle",wA=".dropdown-menu",HK=`:not(${Bj})`,BA='.list-group, .nav, [role="tablist"]',AA=".nav-item, .list-group-item",CA=`.nav-link${HK}, .list-group-item${HK}, [role="tab"]${HK}`,Aj='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',GK=`${CA}, ${Aj}`,RA=`.${kJ}[data-bs-toggle="tab"], .${kJ}[data-bs-toggle="pill"], .${kJ}[data-bs-toggle="list"]`;class Oq extends B6{constructor(J){super(J);if(this._parent=this._element.closest(BA),!this._parent)return;this._setInitialAttributes(this._parent,this._getChildren()),C.on(this._element,hA,(q)=>this._keydown(q))}static get NAME(){return jA}show(){const J=this._element;if(this._elemIsActive(J))return;const q=this._getActiveElem(),Q=q?C.trigger(q,LA,{relatedTarget:J}):null;if(C.trigger(J,UA,{relatedTarget:q}).defaultPrevented||Q&&Q.defaultPrevented)return;this._deactivate(q,J),this._activate(J,q)}_activate(J,q){if(!J)return;J.classList.add(kJ),this._activate(x.getElementFromSelector(J));const Q=()=>{if(J.getAttribute("role")!=="tab"){J.classList.add($K);return}J.removeAttribute("tabindex"),J.setAttribute("aria-selected",!0),this._toggleDropDown(J,!0),C.trigger(J,PA,{relatedTarget:q})};this._queueCallback(Q,J,J.classList.contains(tG))}_deactivate(J,q){if(!J)return;J.classList.remove(kJ),J.blur(),this._deactivate(x.getElementFromSelector(J));const Q=()=>{if(J.getAttribute("role")!=="tab"){J.classList.remove($K);return}J.setAttribute("aria-selected",!1),J.setAttribute("tabindex","-1"),this._toggleDropDown(J,!1),C.trigger(J,VA,{relatedTarget:q})};this._queueCallback(Q,J,J.classList.contains(tG))}_keydown(J){if(![DA,rG,OA,sG,FK,iG].includes(J.key))return;J.stopPropagation(),J.preventDefault();const q=this._getChildren().filter((Z)=>!p8(Z));let Q;if([FK,iG].includes(J.key))Q=q[J.key===FK?0:q.length-1];else{const Z=[rG,sG].includes(J.key);Q=VK(q,J.target,Z,!0)}if(Q)Q.focus({preventScroll:!0}),Oq.getOrCreateInstance(Q).show()}_getChildren(){return x.find(GK,this._parent)}_getActiveElem(){return this._getChildren().find((J)=>this._elemIsActive(J))||null}_setInitialAttributes(J,q){this._setAttributeIfNotExists(J,"role","tablist");for(let Q of q)this._setInitialAttributesOnChild(Q)}_setInitialAttributesOnChild(J){J=this._getInnerElement(J);const q=this._elemIsActive(J),Q=this._getOuterElement(J);if(J.setAttribute("aria-selected",q),Q!==J)this._setAttributeIfNotExists(Q,"role","presentation");if(!q)J.setAttribute("tabindex","-1");this._setAttributeIfNotExists(J,"role","tab"),this._setInitialAttributesOnTargetPanel(J)}_setInitialAttributesOnTargetPanel(J){const q=x.getElementFromSelector(J);if(!q)return;if(this._setAttributeIfNotExists(q,"role","tabpanel"),J.id)this._setAttributeIfNotExists(q,"aria-labelledby",`${J.id}`)}_toggleDropDown(J,q){const Q=this._getOuterElement(J);if(!Q.classList.contains(IA))return;const Z=(X,Y)=>{const z=x.findOne(X,Q);if(z)z.classList.toggle(Y,q)};Z(Bj,kJ),Z(wA,$K),Q.setAttribute("aria-expanded",q)}_setAttributeIfNotExists(J,q,Q){if(!J.hasAttribute(q))J.setAttribute(q,Q)}_elemIsActive(J){return J.classList.contains(kJ)}_getInnerElement(J){return J.matches(GK)?J:x.findOne(GK,J)}_getOuterElement(J){return J.closest(AA)||J}static jQueryInterface(J){return this.each(function(){const q=Oq.getOrCreateInstance(this);if(typeof J!=="string")return;if(q[J]===void 0||J.startsWith("_")||J==="constructor")throw new TypeError(`No method named "${J}"`);q[J]()})}}C.on(document,MA,Aj,function(J){if(["A","AREA"].includes(this.tagName))J.preventDefault();if(p8(this))return;Oq.getOrCreateInstance(this).show()});C.on(window,kA,()=>{for(let J of x.find(RA))Oq.getOrCreateInstance(J)});w6(Oq);var yA="toast",EA="bs.toast",d8=`.${EA}`,TA=`mouseover${d8}`,_A=`mouseout${d8}`,bA=`focusin${d8}`,SA=`focusout${d8}`,vA=`hide${d8}`,xA=`hidden${d8}`,uA=`show${d8}`,gA=`shown${d8}`,fA="fade",eG="hide",zX="show",KX="showing",pA={animation:"boolean",autohide:"boolean",delay:"number"},mA={animation:!0,autohide:!0,delay:5000};class PX extends B6{constructor(J,q){super(J,q);this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return mA}static get DefaultType(){return pA}static get NAME(){return yA}show(){if(C.trigger(this._element,uA).defaultPrevented)return;if(this._clearTimeout(),this._config.animation)this._element.classList.add(fA);const q=()=>{this._element.classList.remove(KX),C.trigger(this._element,gA),this._maybeScheduleHide()};this._element.classList.remove(eG),g9(this._element),this._element.classList.add(zX,KX),this._queueCallback(q,this._element,this._config.animation)}hide(){if(!this.isShown())return;if(C.trigger(this._element,vA).defaultPrevented)return;const q=()=>{this._element.classList.add(eG),this._element.classList.remove(KX,zX),C.trigger(this._element,xA)};this._element.classList.add(KX),this._queueCallback(q,this._element,this._config.animation)}dispose(){if(this._clearTimeout(),this.isShown())this._element.classList.remove(zX);super.dispose()}isShown(){return this._element.classList.contains(zX)}_maybeScheduleHide(){if(!this._config.autohide)return;if(this._hasMouseInteraction||this._hasKeyboardInteraction)return;this._timeout=setTimeout(()=>{this.hide()},this._config.delay)}_onInteraction(J,q){switch(J.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=q;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=q;break}}if(q){this._clearTimeout();return}const Q=J.relatedTarget;if(this._element===Q||this._element.contains(Q))return;this._maybeScheduleHide()}_setListeners(){C.on(this._element,TA,(J)=>this._onInteraction(J,!0)),C.on(this._element,_A,(J)=>this._onInteraction(J,!1)),C.on(this._element,bA,(J)=>this._onInteraction(J,!0)),C.on(this._element,SA,(J)=>this._onInteraction(J,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(J){return this.each(function(){const q=PX.getOrCreateInstance(this,J);if(typeof J==="string"){if(typeof q[J]==="undefined")throw new TypeError(`No method named "${J}"`);q[J](this)}})}}NX(PX);w6(PX);class OK{constructor(){this.modal=new m8("#controller",{}),this.initKeyInputs()}show(){this.modal.show()}initKeyInputs(){document.querySelectorAll(".control-input").forEach((q)=>{q.addEventListener("keydown",(Q)=>{if(this.handleKeyDown(q,Q))return Q.preventDefault(),!1}),q.addEventListener("input",()=>{})})}handleKeyDown(J,q){if(q.key.length==1&&!q.metaKey&&!q.ctrlKey)return J.value=q.key.toLowerCase(),!0}}class IK{constructor(){this.controllerConfig=null}domLoaded(){this.controllerConfig=new OK;const J=n64js.debugger();$(".tabbable a").on("shown.bs.tab",()=>{J.redraw()}),J.redraw()}toggleControllerConfig(){this.controllerConfig.show()}triggerLoad(){const J=document.getElementById("fileInput");J.value="",J.click()}loadFile(){const J=document.getElementById("fileInput");if(J&&J.files.length>0){const q=J.files[0],Q=new FileReader;Q.onerror=()=>{this.displayError("loading file")},Q.onload=(Z)=>{n64js.loadRomAndStartRunning(Z.target.result)},Q.readAsArrayBuffer(q)}}displayWarning(J){this.displayAlert("Warning",J)}displayError(J){this.displayAlert("Error",J)}displayAlert(J,q){const Z=document.getElementById("alert").content.cloneNode(!0),X=Z.querySelector(".alert-type"),Y=Z.querySelector(".alert-message");X.textContent=J+"!",Y.textContent=q,$("#alerts").append(Z)}setRunning(J){const q=J?'<i class="bi-pause"></i> Pause':'<i class="bi-play"></i> Run';$("#runbutton").html(q)}}var AK=function(J){Cq=J,BK.setRunning(J)},lA=function(J){const q=md5(J);h(`hash is ${q}`)},nA=function(J){m$(J),lA(J);const q=i6.createROM(J),Q={header:q.getU32(0),clock:q.getU32(4),bootAddress:q.getU32(8),release:q.getU32(12),crclo:q.getU32(16),crchi:q.getU32(20),unk0:q.getU32(24),unk1:q.getU32(28),name:KG(q.u8,32,20),unk2:q.getU32(52),unk3:q.getU16(56),unk4:q.getU8(58),categoryCode:Q5(q.getU8(59)),cartId:q.getU16(60),countryId:q.getU8(62),romVersion:q.getU8(63)};console.log(Q);const Z=$('<table class="register-table"><tbody></tbody></table>'),X=Z.find("tbody");for(let z in Q){const K=typeof Q[z]==="string"?Q[z]:N(Q[z]);X.append(`<tr><td>${z}</td><td>${K}</td></tr>`)}w5(Z),f0.cic=zG(q.u8),f0.id=YG(Q.crclo,Q.crchi),f0.country=Q.countryId,f0.tvType=q5(Q.countryId);const Y=WG[f0.id];if(Y)h(`Loaded info for ${f0.id} from db`),f0.name=Y.name,f0.save=Y.save;else h(`No info for ${f0.id} in db`),f0.name=Q.name,f0.save="Eeprom4k";h(`rominfo is ${Ez(f0)}`),$("#title").text(`n64js - ${f0.name}`)},aA=function(){const J=[],q=new XMLHttpRequest;if(q.open("GET","roms/n64-systemtest-all.z64",!0),q.responseType="arraybuffer",q.onload=()=>{const Q=q.response;if(Q)n64js.loadRomAndStartRunning(Q)},q.send(null),q.status!=200)return;for(let Q=0;Q<q.responseText.length;++Q)J.push(q.responseText.charCodeAt(Q)&255)},rA=function(){i6.timeline.startRecording()},wK=function(){if(u6)u6.begin();if(Cq){if(requestAnimationFrame(wK),n64js.hardware().aiRegDevice.shouldSkipFrame())return;Ej.updateInput();let J=oA;if(IJ.active&&!bF())J=IJ.debugCycles;if(A5())J=C5(J);if(J>0)n64js.cpu0.run(J),IJ.redraw()}else if(_F())requestAnimationFrame(wK),vF(),QZ();if(u6)u6.end()},Tj=function(J){return J+"-"+f0.id},sA=function(J){const q=f0.name?`n64js - ${f0.name} - ${J}mspf`:`n64js - ${J}mspf`;$("#title").text(q)},_j=function(J,q){if(AK(!1),CK(),h('<span style="color:red">'+J+"</span>"),q)n64js.ui().displayError(J)},CK=function(){n64js.cpu0.breakExecution()};window.n64js=window.n64js||{};var oA=1e8,u6=null,Cq=!1,Cj=[],Rj={runTest:aA,recordTimeline:rA};q6.add(Rj,"runTest").name("Run n64-systemtest");q6.add(Rj,"recordTimeline").name("Record Timeline");var f0={id:"",name:"",cic:"6101",country:J5,tvType:fq,save:"Eeprom4k"},i6=new yz(f0),yj=new xX(i6),Ej=new gX,dA=new pX(i6,Ej.inputs),BK=new IK,IJ=null;n64js.hardware=()=>i6;n64js.joybus=()=>dA;n64js.ui=()=>BK;n64js.debugger=()=>IJ;n64js.loadRomAndStartRunning=(J)=>{nA(J),n64js.reset(),IJ.hide(),AK(!1),n64js.toggleRun()};n64js.toggleRun=()=>{if(AK(!Cq),Cq)wK()};n64js.toggleFullscreen=()=>{document.getElementById("display").requestFullscreen().catch((q)=>{console.log(`Error attempting to enable fullscreen mode: ${q.message} (${q.name})`)})};n64js.breakEmulationForDisplayListDebug=()=>{if(Cq)n64js.toggleRun(),CK()};n64js.step=()=>{if(!Cq)n64js.singleStep(),IJ.redraw()};n64js.breakpoints=()=>{return yj};n64js.getLocalStorageItem=(J)=>{const q=Tj(J),Q=localStorage.getItem(q);return Q?ZG(Q):void 0};n64js.setLocalStorageItem=(J,q)=>{const Q=Tj(J),Z=Ez(q);localStorage.setItem(Q,Z)};var MX;n64js.onPresent=()=>{const J=new Date;if(MX){const q=J.getTime()-MX.getTime();sA(q)}MX=J};n64js.addResetCallback=(J)=>{Cj.push(J)};n64js.reset=()=>{yj.reset(),B5(),i6.reset(),I$(i6),Z$(i6),TF(),i6.loadROM(),Z5(n64js.cpu0,i6,f0),MX=void 0;for(let J of Cj)J()};n64js.check=(J,q)=>{if(!J)h(q)};n64js.warn=(J)=>{I5(J)};n64js.stopForBreakpoint=()=>{_j("Breakpoint",!1)};n64js.halt=(J)=>{_j(J,!0)};n64js.returnControlToSystem=()=>{CK()};n64js.init=()=>{n64js.reset(),IJ=new bY,EF($("#display")),BK.domLoaded()};n64js.togglePerformance=()=>{const J=document.getElementById("performance");if(u6)J.removeChild(u6.dom),u6=null;else u6=new Stats,u6.showPanel(1),u6.dom.style.position="relative",J.appendChild(u6.dom)};
