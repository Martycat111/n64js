var Q6=31,Y8=0,c8=1,l8=2,d8=3,a8=4,r8=5,fQ=6,uQ=7,s8=8,m6=9,y6=10,Z8=11,U0=12,w0=13,N6=14,TJ=15,i8=16,_J=17;var gQ=20,xQ=21,pQ=22,mQ=23,nQ=24,oQ=25,xZ=26,pZ=27,mZ=28,nZ=29,t8=30,cQ=31,lQ=2,oZ=0,cZ=1,dQ=2,aQ=3,lZ=4,dZ=5;var aZ=8,rZ=9,sZ=10,iZ=11,tZ=12,eZ=13;var JK=15;function YK(J){switch(J){case 67:case 68:case 70:case 72:case 73:case 76:case 80:case 83:case 85:case 87:case 88:case 89:case 96:return 0;case 66:return 2;case 55:case 65:case 69:case 71:case 74:case 75:case 78:return 1}return 1}function ZK(J){const Q=String.fromCharCode(J),q=e7.get(Q);if(q)return q;return`unknown code ${Q}`}var K8=0,JJ=1,QK=2;var qK=69;var e7=new Map([["N","Game Pak"],["D","64DD Disk"],["C","Expandable Game: Game Pak Part"],["E","Expandable Game: 64DD Disk Part"],["Z","Aleck64 Game Pak"]]);function KK(J,Q,q){const Y=Q.sp_mem.subRegion(4096,4096);J.setControlU64(U0,0x00000000_34000000n),J.setControlU64(i8,0x00000000_7006e463n),J.setControlU64(m6,0x00000000_00005000n),J.setControlU64(w0,0x00000000_0000005cn),J.setControlU64(TJ,0x00000000_00000b22n),J.setControlU64(a8,0x00000000_007ffff0n),J.setControlU64(N6,0xffffffff_ffffffffn),J.setControlU64(s8,0xffffffff_ffffffffn),J.setControlU64(t8,0xffffffff_ffffffffn),n64js.cop1ControlChanged();const Z=0x00000000_00000000n;if(J.setRegU64(0,Z),J.setRegU64(1,Z),J.setRegU64(2,0xffffffff_d1731be9n),J.setRegU64(3,0xffffffff_d1731be9n),J.setRegU64(4,0x00000000_00001be9n),J.setRegU64(5,0xffffffff_f45231e5n),J.setRegU64(6,0xffffffff_a4001f0cn),J.setRegU64(7,0xffffffff_a4001f08n),J.setRegU64(8,0x00000000_000000c0n),J.setRegU64(9,Z),J.setRegU64(10,0x00000000_00000040n),J.setRegU64(11,0xffffffff_a4000040n),J.setRegU64(16,Z),J.setRegU64(17,Z),J.setRegU64(18,Z),J.setRegU64(19,Z),J.setRegU64(20,BigInt(q.tvType)),J.setRegU64(21,Z),J.setRegU64(23,0x00000000_00000006n),J.setRegU64(24,Z),J.setRegU64(25,0xffffffff_d73f2993n),J.setRegU64(26,Z),J.setRegU64(27,Z),J.setRegU64(28,Z),J.setRegU64(29,0xffffffff_a4001ff0n),J.setRegU64(30,Z),J.setRegU64(31,0xffffffff_a4001554n),q.tvType==K8){switch(q.cic){case"6102":J.setRegU64(5,0xffffffff_c0f1d859n),J.setRegU64(14,0x00000000_2de108ean),J.setRegU64(24,Z);break;case"6103":J.setRegU64(5,0xffffffff_d4646273n),J.setRegU64(14,0x00000000_1af99984n),J.setRegU64(24,Z);break;case"6105":J.setRegU64(5,0xffffffff_decaaad1n),J.setRegU64(14,0x00000000_0cf85c13n),J.setRegU64(24,0x00000000_00000002n);break;case"6106":J.setRegU64(5,0xffffffff_b04dc903n),J.setRegU64(14,0x00000000_1af99984n),J.setRegU64(24,0x00000000_00000002n);break;default:break}J.setRegU64(20,Z),J.setRegU64(23,0x00000000_00000006n),J.setRegU64(31,0xffffffff_a4001554n)}else{switch(q.cic){case"6102":J.setRegU64(5,0xffffffff_c95973d5n),J.setRegU64(14,0x00000000_2449a366n);break;case"6103":J.setRegU64(5,0xffffffff_95315a28n),J.setRegU64(14,0x00000000_5baca1dfn);break;case"6105":J.setRegU64(5,0x00000000_5493fb9an),J.setRegU64(14,0xffffffff_c2c20384n);break;case"6106":J.setRegU64(5,0xffffffff_e067221fn),J.setRegU64(14,0x00000000_5cd2b70fn);break;default:break}J.setRegU64(20,0x00000000_00000001n),J.setRegU64(23,Z),J.setRegU64(24,0x00000000_00000003n),J.setRegU64(31,0xffffffff_a4001550n)}switch(q.cic){case"6101":J.setRegU64(22,0x00000000_0000003fn);break;case"6102":J.setRegU64(1,0x00000000_00000001n),J.setRegU64(2,0x00000000_0ebda536n),J.setRegU64(3,0x00000000_0ebda536n),J.setRegU64(4,0x00000000_0000a536n),J.setRegU64(12,0xffffffff_ed10d0b3n),J.setRegU64(13,0x00000000_1402a4ccn),J.setRegU64(15,0x00000000_3103e121n),J.setRegU64(22,0x00000000_0000003fn),J.setRegU64(25,0xffffffff_9debb54fn);break;case"6103":J.setRegU64(1,0x00000000_00000001n),J.setRegU64(2,0x00000000_49a5ee96n),J.setRegU64(3,0x00000000_49a5ee96n),J.setRegU64(4,0x00000000_0000ee96n),J.setRegU64(12,0xffffffff_ce9dfbf7n),J.setRegU64(13,0xffffffff_ce9dfbf7n),J.setRegU64(15,0x00000000_18b63d28n),J.setRegU64(22,0x00000000_00000078n),J.setRegU64(25,0xffffffff_825b21c9n);break;case"6105":Y.set32(0,1007534016),Y.set32(4,q.tvType==K8?3181905916:2376599548),Y.set32(8,632096704),Y.set32(12,822608000),Y.set32(16,1426128892),Y.set32(20,1007534016),Y.set32(24,2376597540),Y.set32(28,1007398912),J.setRegU64(1,Z),J.setRegU64(2,0xffffffff_f58b0fbfn),J.setRegU64(3,0xffffffff_f58b0fbfn),J.setRegU64(4,0x00000000_00000fbfn),J.setRegU64(12,0xffffffff_9651f81en),J.setRegU64(13,0x00000000_2d42aac5n),J.setRegU64(15,0x00000000_56584d60n),J.setRegU64(22,0x00000000_00000091n),J.setRegU64(25,0xffffffff_cdce565fn);break;case"6106":J.setRegU64(1,Z),J.setRegU64(2,0xffffffff_a95930a4n),J.setRegU64(3,0xffffffff_a95930a4n),J.setRegU64(4,0x00000000_000030a4n),J.setRegU64(12,0xffffffff_bcb59510n),J.setRegU64(13,0xffffffff_bcb59510n),J.setRegU64(15,0x00000000_7a3c07f4n),J.setRegU64(22,0x00000000_00000085n),J.setRegU64(25,0x00000000_465e3f72n);break;default:break}J.pc=2751463488}class X8{constructor(){this.buttons=0,this.stick_x=0,this.stick_y=0}}class rQ{constructor(){this.inputs=[new X8,new X8,new X8,new X8]}handleKey(J,Q,q){switch(Q){case"a":this.setButton(J,4096,q);break;case"s":this.setButton(J,32768,q);break;case"x":this.setButton(J,16384,q);break;case"z":this.setButton(J,8192,q);break;case"y":this.setButton(J,8192,q);break;case"c":this.setButton(J,32,q);break;case"v":this.setButton(J,16,q);break;case"t":this.setButton(J,2048,q);break;case"g":this.setButton(J,1024,q);break;case"f":this.setButton(J,512,q);break;case"h":this.setButton(J,256,q);break;case"i":this.setButton(J,8,q);break;case"k":this.setButton(J,4,q);break;case"j":this.setButton(J,2,q);break;case"l":this.setButton(J,1,q);break;case"ArrowLeft":this.setStickX(J,q?-80:0);break;case"ArrowRight":this.setStickX(J,q?80:0);break;case"ArrowDown":this.setStickY(J,q?-80:0);break;case"ArrowUp":this.setStickY(J,q?80:0);break}}setStickX(J,Q){this.inputs[J].stick_x=Q}setStickY(J,Q){this.inputs[J].stick_y=Q}setButton(J,Q,q){let Y=this.inputs[J].buttons;if(q)Y|=Q;else Y&=~Q;this.inputs[J].buttons=Y}}function XK(J,Q){v0=J,QJ=Q}function WK(){if(v0)v0.html("")}function M(J){if(QJ)J=`${QJ()}: ${J}`;if(console.log(J),v0)v0.append(`${J}<br>`),v0.scrollTop(v0[0].scrollHeight)}function $K(J){if(QJ)J=`${QJ()}: ${J}`;if(console.warn(J),v0)v0.append(`<font color="yellow">${J}</font><br>`),v0.scrollTop(v0[0].scrollHeight)}function zK(J){if(v0)v0.append(J)}var v0,QJ;function HK(J,Q){var q=J.toString();while(q.length<Q)q="0"+q;return q}function B(J,Q){let q;if(typeof J=="bigint"){const Z=Q?(1n<<BigInt(Q))-1n:0xffff_ffff_ffff_ffffn;q=J&Z}else{const Z=Q&&Q<32?(1<<Q)-1:4294967295;q=(Number(J)&Z)>>>0}let Y=q.toString(16);if(Q){const Z=Q>>2;while(Y.length<Z)Y="0"+Y}return Y}function M0(J){return"0x"+B(J,8)}function x(J){return"0x"+B(J,16)}function j(J){return"0x"+B(J,32)}function D6(J){return"0x"+B(J,64)}function FK(){n6=void 0,q6=void 0}function jK(){return n6||q6?!0:!1}function NK(J){let q=J;for(let Y of[n6,q6]){if(!Y)continue;if(!Y.tick())q=0;let Z=Math.floor(Y.getAvailableBytes()/8);Z=Math.max(0,Z-100),q=Math.min(q,Z)}return q}var n6=null,q6=null;function PK(J,Q,q){let Y=11,Z=GK;for(let K=0;K<q;K++){Q[K]=Y+5*J[K]&15,Y=Z[Q[K]];const X=Q[K]>>3&1;let z=((X==1?~Q[K]:Q[K])&7)%3==1?X:1-X;if(Z==LK){if(Q[K]==1||Q[K]==9)z=1;if(Q[K]==11||Q[K]==14)z=0}Z=z==1?LK:GK}}var GK=[4,7,10,7,14,5,14,1,12,15,8,15,6,3,6,9],LK=[4,1,10,7,14,5,14,1,12,9,8,5,6,3,12,9];var AK=function(J,Q,q){let Y=0;for(let Z=0;Z<q;Z++){const K=J[Q+Z];for(let X=0;X<8;X++)Y=(Y<<1|K>>>7-X&1)^(Y&128?133:0)}for(let Z=8;Z!==0;Z--)Y=Y<<1^(Y&128?133:0);return Y&255},kK=function(J){let Q=0;for(let q=0;q<16;q++)Q=(Q<<1|J>>>15-q&1)^(Q&16?21:0);return Q&31};var Qz=5,qJ=64,VK=63,wK=0,qz=1,Yz=2,Zz=3,Kz=4,Xz=5,Wz=6,$z=7,zz=8,CK=255,Hz=0,Fz=253,UK=254,jz=255,MK=0,sQ=1,hK=2,OK=16,Nz=128,Gz=192,EK=1280;var Lz=64,Pz=128;class iQ{constructor(J,Q){this.hardware=J,this.pifRam=this.hardware.pif_mem.subRegion(1984,64);const q=new YJ(Q[0]);q.present=!0,q.attachControllerPack(J.mempacks[0]),this.channels=[q,new YJ(Q[1]),new YJ(Q[2]),new YJ(Q[3]),new yK(J)]}get controlByte(){return this.pifRam.getU8(VK)}set controlByte(J){this.pifRam.set8(VK,J)}cpuRead(J){}cpuWrite(J){}dmaWrite(J,Q){if(this.pifRam.copy(0,J,Q,qJ),this.controlByte&1)this.controlByte&=~1,this.configure()}dmaRead(J,Q){if(this.controlByte&2)this.processCICChallenge();else this.execute();J.copy(Q,this.pifRam,0,qJ)}processCICChallenge(){const J=new Uint8Array(30),Q=new Uint8Array(30);for(let q=0;q<15;++q)J[q*2+0]=this.pifRam.u8[48+q]>>>4&15,J[q*2+1]=this.pifRam.u8[48+q]>>>0&15;PK(J,Q,30);for(let q=0;q<15;++q)this.pifRam.u8[48+q]=(Q[q*2]<<4)+Q[q*2+1];this.pifRam.u8[46]=0,this.pifRam.u8[47]=0}configure(){for(let q of this.channels)q.init();let J=0,Q=0;while(J<qJ&&Q<Qz){const q=this.pifRam.u8.subarray(J),Y=q[0];if(J++,Y==UK)break;if(Y==jz)continue;if(Y==Hz){Q++;continue}if(Y==Fz){this.channels[Q].reset=!0,Q++;continue}if(J>=qJ)break;const Z=q[1];if(J++,Z==UK)break;const K=Y&63,X=J;J+=K;const W=Z&63,z=J;if(J+=W,J>=qJ)break;const F=this.pifRam.u8.subarray(X,X+K),N=this.pifRam.u8.subarray(z,z+W);this.channels[Q].joybusConfigure(q,K,W,F,N),Q++}}execute(){for(let J of this.channels){if(J.reset)continue;if(J.skip)continue;const Q=J.frame[0],q=J.frame[1];if(Q&128)continue;if(Q&64)continue;const Y=Q&63,Z=q&63,K=J.joybusCommand(Y,Z,J.txBuf,J.rxBuf);if(K<Z)J.frame[1]|=Pz;if(K>Z)J.frame[1]|=Lz}}}class tQ{constructor(){this.init()}expectTx(J,Q,q){if(Q!=q)M(`${J}: got tx ${Q} but expect ${q}`)}init(){this.frame=0,this.tx=0,this.rx=0,this.txBuf=null,this.rxBuf=null,this.skip=!0,this.reset=!1}joybusConfigure(J,Q,q,Y,Z){this.frame=J,this.tx=Q,this.rx=q,this.txBuf=Y,this.rxBuf=Z,this.skip=!1}}class YJ extends tQ{constructor(J){super();this.inputs=J,this.present=!1,this.attachment=MK,this.memory=null,this.rumbleActive=!1}attachControllerPack(J){this.attachment=sQ,this.memory=J}joybusCommand(J,Q,q,Y){if(!this.present)return 0;const Z=q[0];switch(Z){case CK:return this.getStatus(J,Q,q,Y);case wK:return this.getStatus(J,Q,q,Y);case qz:return this.readController(J,Q,q,Y);case Yz:return this.readAccessory(J,Q,q,Y);case Zz:return this.writeAccessory(J,Q,q,Y)}return n64js.halt("Unknown controller command "+Z),0}getStatus(J,Q,q,Y){return this.expectTx("kCmdGetStatus",J,1),Y[0]=EK>>>8,Y[1]=EK&255,Y[2]=this.attachment==MK?2:1,3}readController(J,Q,q,Y){this.expectTx("kCmdControllerRead",J,1);let Z=this.inputs.buttons,K=this.inputs.stick_x,X=this.inputs.stick_y;if(q6)q6.sync32(3203395597,"input"),Z=q6.reflect32(Z),K=q6.reflect32(K),X=q6.reflect32(X);return Y[0]=Z>>>8,Y[1]=Z&255,Y[2]=K,Y[3]=X,4}readAccessory(J,Q,q,Y){this.expectTx("kCmdControllerAccessoryRead",J,3);const Z=q[1]<<8|q[2]&224;if((q[2]&31)!=kK(Z))return 0;switch(this.attachment){case sQ:const X=this.memory.data;for(let W=0,z=Z;W<Q-1;W++,z++)Y[W]=z<X.length?X[z]:0;break;case hK:for(let W=0,z=Z;W<Q-1;W++,z++){let F;if(z<32768)F=0;else if(z<36864)F=128;else F=this.rumbleActive?255:0;Y[W]=F}break;default:return 0}return Y[Q-1]=AK(Y,0,Q-1),Q}writeAccessory(J,Q,q,Y){this.expectTx("kCmdControllerAccessoryWrite",J,35);const Z=q[1]<<8|q[2]&224;if((q[2]&31)!=kK(Z))return 0;switch(this.attachment){case sQ:const X=this.memory.data;this.memory.dirty=!0;for(let W=0,z=Z;W<J-3;W++,z++)if(z<X.length)X[z]=q[3+W];break;case hK:if(Z>=49152)this.rumbleActive=q[3]&1;break;default:return 0}return Y[Q-1]=AK(q,3,J-3),Q}}class yK extends tQ{constructor(J){super();this.hardware=J}joybusCommand(J,Q,q,Y){const Z=q[0];switch(Z){case CK:return this.getStatus(J,Q,q,Y);case wK:return this.getStatus(J,Q,q,Y);case Kz:return this.readEeprom(J,Q,q,Y);case Xz:return this.writeEeprom(J,Q,q,Y);case Wz:return this.rtcStatus(J,Q,q,Y);case $z:return this.rtcRead(J,Q,q,Y);case zz:return this.rtcWrite(J,Q,q,Y)}return n64js.halt(`Unknown cartridge command: ${Z}`),0}getEepromID(){switch(this.hardware.saveType){case"Eeprom4k":return Nz;case"Eeprom16k":return Gz}return 0}getEeprom(){switch(this.hardware.saveType){case"Eeprom4k":case"Eeprom16k":return this.hardware.saveMem}return null}getStatus(J,Q,q,Y){this.expectTx("kCmdGetStatus",J,1);const Z=this.getEepromID();if(!Z)return 0;return Y[0]=Z>>>8,Y[1]=Z&255,Y[2]=0,3}readEeprom(J,Q,q,Y){this.expectTx("kCmdEepromRead",J,2);const Z=this.getEeprom();if(!Z)return 0;const K=q[1]*8;for(let X=0;X<Q;++X)Y[X]=Z.u8[K+X];return Q}writeEeprom(J,Q,q,Y){this.expectTx("kCmdEepromWrite",J,10);const Z=this.getEeprom();if(!Z)return 0;const K=q[1]*8;for(let X=0;X<J-2;++X)Z.u8[K+X]=q[2+X];return this.hardware.saveDirty=!0,Y[0]=0,1}rtcStatus(J,Q,q,Y){return Y[0]=OK>>>8,Y[1]=OK&255,Y[2]=0,3}rtcRead(J,Q,q,Y){return n64js.warn("rtc read unhandled"),0}rtcWrite(J,Q,q,Y){return n64js.warn("rtc write unhandled"),0}}function r(J,Q){if(!J)throw new DK(Q)}class DK{constructor(J){this.message=J}toString(){return"AssertException: "+this.message}}function W8(J){return J>>>26&63}function $8(J){return J>>>16&31}function z8(J){return J&63}function f0(J){return J>>>21&31}function IK(J){return J>>>16&3}function u0(J){return J&63}function G6(J){return J>>>6&31}function J0(J){return J>>>11&31}function Y6(J){return J>>>16&31}function Q0(J){return(J&65535)<<16>>16}function B0(J){return J>>>6&31}function R(J){return J>>>11&31}function h(J){return J>>>16&31}function y(J){return J>>>21&31}function H8(J){return J&63}function Vz(J){return J&67108863}function L6(J){return J&65535}function b(J){return(J&65535)<<16>>16}function v(J){return J>>>21&31}function C0(J,Q){return J+4+Q0(Q)*4>>>0}function I6(J,Q){return(J&4026531840|Vz(Q)*4)>>>0}var Uz=function(J){return Q0(J)&65535},BK=function(J){return Q0(J)<<16>>16},hz=function(J){return bK[z8(J.opcode)](J)},Oz=function(J){return TK[f0(J.opcode)](J)},Ez=function(J){switch(r((J.opcode>>>18&7)===0,"cc bit is not 0"),IK(J.opcode)){case 0:return`BC1F      !c ? --> ${J.branchAddress}`;case 1:return`BC1T      c ? --> ${J.branchAddress}`;case 2:return`BC1FL     !c ? --> ${J.branchAddress}`;case 3:return`BC1TL     c ? --> ${J.branchAddress}`}return"???"},SJ=function(J,Q){var q=Q.toUpperCase();switch(u0(J.opcode)){case 0:return`ADD.${q}     ${J.fd(Q)} = ${J.fs(Q)} + ${J.ft(Q)}`;case 1:return`SUB.${q}     ${J.fd(Q)} = ${J.fs(Q)} - ${J.ft(Q)}`;case 2:return`MUL.${q}     ${J.fd(Q)} = ${J.fs(Q)} * ${J.ft(Q)}`;case 3:return`DIV.${q}     ${J.fd(Q)} = ${J.fs(Q)} / ${J.ft(Q)}`;case 4:return`SQRT.${q}    ${J.fd(Q)} = sqrt(${J.fs(Q)})`;case 5:return`ABS.${q}     ${J.fd(Q)} = abs(${J.fs(Q)})`;case 6:return`MOV.${q}     ${J.fd(Q)} = ${J.fs(Q)}`;case 7:return`NEG.${q}     ${J.fd(Q)} = -${J.fs(Q)}`;case 8:return`ROUND.L.${q} ${J.fd("l")} = round.l(${J.fs(Q)})`;case 9:return`TRUNC.L.${q} ${J.fd("l")} = trunc.l(${J.fs(Q)})`;case 10:return`CEIL.L.${q}  ${J.fd("l")} = ceil.l(${J.fs(Q)})`;case 11:return`FLOOR.L.${q} ${J.fd("l")} = floor.l(${J.fs(Q)})`;case 12:return`ROUND.W.${q} ${J.fd("w")} = round.w(${J.fs(Q)})`;case 13:return`TRUNC.W.${q} ${J.fd("w")} = trunc.w(${J.fs(Q)})`;case 14:return`CEIL.W.${q}  ${J.fd("w")} = ceil.w(${J.fs(Q)})`;case 15:return`FLOOR.W.${q} ${J.fd("w")} = floor.w(${J.fs(Q)})`;case 32:return`CVT.S.${q}   ${J.fd("s")} = (s)${J.fs(Q)}`;case 33:return`CVT.D.${q}   ${J.fd("d")} = (d)${J.fs(Q)}`;case 36:return`CVT.W.${q}   ${J.fd("w")} = (w)${J.fs(Q)}`;case 37:return`CVT.L.${q}   ${J.fd("l")} = (l)${J.fs(Q)}`;case 48:return`C.F.${q}     c = ${J.fs(Q)} cmp ${J.ft(Q)}`;case 49:return`C.UN.${q}    c = ${J.fs(Q)} cmp ${J.ft(Q)}`;case 50:return`C.EQ.${q}    c = ${J.fs(Q)} cmp ${J.ft(Q)}`;case 51:return`C.UEQ.${q}   c = ${J.fs(Q)} cmp ${J.ft(Q)}`;case 52:return`C.OLT.${q}   c = ${J.fs(Q)} cmp ${J.ft(Q)}`;case 53:return`C.ULT.${q}   c = ${J.fs(Q)} cmp ${J.ft(Q)}`;case 54:return`C.OLE.${q}   c = ${J.fs(Q)} cmp ${J.ft(Q)}`;case 55:return`C.ULE.${q}   c = ${J.fs(Q)} cmp ${J.ft(Q)}`;case 56:return`C.SF.${q}    c = ${J.fs(Q)} cmp ${J.ft(Q)}`;case 57:return`C.NGLE.${q}  c = ${J.fs(Q)} cmp ${J.ft(Q)}`;case 58:return`C.SEQ.${q}   c = ${J.fs(Q)} cmp ${J.ft(Q)}`;case 59:return`C.NGL.${q}   c = ${J.fs(Q)} cmp ${J.ft(Q)}`;case 60:return`C.LT.${q}    c = ${J.fs(Q)} cmp ${J.ft(Q)}`;case 61:return`C.NGE.${q}   c = ${J.fs(Q)} cmp ${J.ft(Q)}`;case 62:return`C.LE.${q}    c = ${J.fs(Q)} cmp ${J.ft(Q)}`;case 63:return`C.NGT.${q}   c = ${J.fs(Q)} cmp ${J.ft(Q)}`}return`Cop1.${Q}${B(u0(J.opcode),8)}?`},Az=function(J){return SJ(J,"s")},kz=function(J){return SJ(J,"d")},wz=function(J){return SJ(J,"w")},Cz=function(J){return SJ(J,"l")},yz=function(J){return _K[f0(J.opcode)](J)},Dz=function(J){return f,SK[f0(J.opcode)](J)},Iz=function(J){return vK[f0(J.opcode)](J)},Bz=function(J){switch(H8(J.opcode)){case 1:return"TLBR";case 2:return"TLBWI";case 6:return"TLBWR";case 8:return"TLBP";case 24:return"ERET"}return"Unk"},Rz=function(J){return fK[$8(J.opcode)](J)};function vJ(J,Q,q){const Y=new RK(J,Q,q),Z=uK[W8(Q)](Y);return{instruction:Y,disassembly:Z,isJumpTarget:!1}}function gK(J,Q,q){const Y=[],Z=new Set;for(let K=J;K<Q;K+=4){const X=n64js.getInstruction(K),W=vJ(K,X,q);if(W.instruction.target)Z.add(W.instruction.target);Y.push(W)}for(let K of Y)if(Z.has(K.instruction.address))K.isJumpTarget=!0;return Y}window.n64js=window.n64js||{};var eQ=["r0","at","v0","v1","a0","a1","a2","a3","t0","t1","t2","t3","t4","t5","t6","t7","s0","s1","s2","s3","s4","s5","s6","s7","t8","t9","k0","k1","gp","sp","s8","ra"],F8=["Index","Rand","EntryLo0","EntryLo1","Context","PageMask","Wired","?7","BadVAddr","Count","EntryHi","Compare","SR","Cause","EPC","PrID","Config","LLAddr","WatchLo","WatchHi","XContext","?21","?22","?23","?24","?25","ECC","CacheErr","TagLo","TagHi","ErrorEPC","?31"],Jq=["f00","f01","f02","f03","f04","f05","f06","f07","f08","f09","f10","f11","f12","f13","f14","f15","f16","f17","f18","f19","f20","f21","f22","f23","f24","f25","f26","f27","f28","f29","f30","f31"],Mz=["GR00","GR01","GR02","GR03","GR04","GR05","GR06","GR07","GR08","GR09","GR10","GR11","GR12","GR13","GR14","GR15","GR16","GR17","GR18","GR19","GR20","GR21","GR22","GR23","GR24","GR25","GR26","GR27","GR28","GR29","GR30","GR31"];class RK{constructor(J,Q,q){this.address=J,this.opcode=Q,this.srcRegs={},this.dstRegs={},this.target="",this.memory=null,this.outputHTML=q}get rt_d(){const J=this.cop0RegName(h);return this.dstRegs[J]=1,this.makeRegSpan(J)}get rd(){const J=this.cop0RegName(R);return this.dstRegs[J]=1,this.makeRegSpan(J)}get rt(){const J=this.cop0RegName(h);return this.srcRegs[J]=1,this.makeRegSpan(J)}get rs(){const J=this.cop0RegName(y);return this.srcRegs[J]=1,this.makeRegSpan(J)}get sa(){return B0(this.opcode)}cop0RegName(J){return eQ[J(this.opcode)]}writesRA(){return this.dstRegs[Q6]=1,""}ft_d(J){const Q=this.cop1RegName(Y6,J);return this.dstRegs[Q]=1,this.makeFPRegSpan(Q)}fs_d(J){const Q=this.cop1RegName(J0,J);return this.dstRegs[Q]=1,this.makeFPRegSpan(Q)}fd(J){const Q=this.cop1RegName(G6,J);return this.dstRegs[Q]=1,this.makeFPRegSpan(Q)}ft(J){const Q=this.cop1RegName(Y6,J);return this.srcRegs[Q]=1,this.makeFPRegSpan(Q)}fs(J){const Q=this.cop1RegName(J0,J);return this.srcRegs[Q]=1,this.makeFPRegSpan(Q)}cop1RegName(J,Q){const q=J(this.opcode),Y=Q?`-${Q}`:"";return Jq[q]+Y}get gt_d(){const J=this.cop2RegName(h);return this.dstRegs[J]=1,this.makeRegSpan(J)}get gd(){const J=this.cop2RegName(R);return this.dstRegs[J]=1,this.makeRegSpan(J)}get gt(){const J=this.cop2RegName(h);return this.srcRegs[J]=1,this.makeRegSpan(J)}get gs(){const J=this.cop2RegName(y);return this.srcRegs[J]=1,this.makeRegSpan(J)}cop2RegName(J){return Mz[J(this.opcode)]}get imm(){return`0x${B(L6(this.opcode),16)}`}get branchAddress(){return this.target=C0(this.address,this.opcode),this.makeLabelText(this.target)}get jumpAddress(){return this.target=I6(this.address,this.opcode),this.makeLabelText(this.target)}get base(){const J=this.cop0RegName(v);return this.srcRegs[J]=1,this.makeRegSpan(J)}get offsetU16(){return`0x${B(Uz(this.opcode),16)}`}get offsetS16(){return`0x${B(BK(this.opcode),16)}`}memaccess(J){return this.memory={reg:v(this.opcode),offset:BK(this.opcode),mode:J},`[${this.base}+${this.offsetU16}]`}memload(){return this.memaccess("load")}memstore(){return this.memaccess("store")}makeLabelText(J){if(this.outputHTML)return`<span class="dis-address-jump">${B(J,32)}</span>`;return B(J,32)}makeRegSpan(J){if(this.outputHTML)return`<span class="dis-reg-${J}">${J}</span>`;return J}makeFPRegSpan(J){const Q=J.replace("-",".");if(this.outputHTML)return`<span class="dis-reg-${J}">${Q}</span>`;return Q}}var bK=[(J)=>{if(J.opcode===0)return"NOP";return`SLL       ${J.rd} = ${J.rt} << ${J.sa}`},(J)=>"Unk",(J)=>`SRL       ${J.rd} = ${J.rt} >>> ${J.sa}`,(J)=>`SRA       ${J.rd} = ${J.rt} >> ${J.sa}`,(J)=>`SLLV      ${J.rd} = ${J.rt} << ${J.rs}`,(J)=>"Unk",(J)=>`SRLV      ${J.rd} = ${J.rt} >>> ${J.rs}`,(J)=>`SRAV      ${J.rd} = ${J.rt} >> ${J.rs}`,(J)=>`JR        ${J.rs}`,(J)=>`JALR      ${J.rd}, ${J.rs}`,(J)=>"Unk",(J)=>"Unk",(J)=>`SYSCALL   ${B(J.opcode>>6&1048575,20)}`,(J)=>`BREAK     ${B(J.opcode>>6&1048575,20)}`,(J)=>"Unk",(J)=>"SYNC",(J)=>`MFHI      ${J.rd} = MultHi`,(J)=>`MTHI      MultHi = ${J.rs}`,(J)=>`MFLO      ${J.rd} = MultLo`,(J)=>`MTLO      MultLo = ${J.rs}`,(J)=>`DSLLV     ${J.rd} = ${J.rt} << ${J.rs}`,(J)=>"Unk",(J)=>`DSRLV     ${J.rd} = ${J.rt} >>> ${J.rs}`,(J)=>`DSRAV     ${J.rd} = ${J.rt} >> ${J.rs}`,(J)=>`MULT      ${J.rs} * ${J.rt}`,(J)=>`MULTU     ${J.rs} * ${J.rt}`,(J)=>`DIV       ${J.rs} / ${J.rt}`,(J)=>`DIVU      ${J.rs} / ${J.rt}`,(J)=>`DMULT     ${J.rs} * ${J.rt}`,(J)=>`DMULTU    ${J.rs} * ${J.rt}`,(J)=>`DDIV      ${J.rs} / ${J.rt}`,(J)=>`DDIVU     ${J.rs} / ${J.rt}`,(J)=>`ADD       ${J.rd} = ${J.rs} + ${J.rt}`,(J)=>`ADDU      ${J.rd} = ${J.rs} + ${J.rt}`,(J)=>`SUB       ${J.rd} = ${J.rs} - ${J.rt}`,(J)=>`SUBU      ${J.rd} = ${J.rs} - ${J.rt}`,(J)=>`AND       ${J.rd} = ${J.rs} & ${J.rt}`,(J)=>{if(h(J.opcode)===0)if(y(J.opcode)===0)return`CLEAR     ${J.rd} = 0`;else return`MOV       ${J.rd} = ${J.rs}`;return`OR        ${J.rd} = ${J.rs} | ${J.rt}`},(J)=>`XOR       ${J.rd} = ${J.rs} ^ ${J.rt}`,(J)=>`NOR       ${J.rd} = ~( ${J.rs} | ${J.rt} )`,(J)=>"Unk",(J)=>"Unk",(J)=>`SLT       ${J.rd} = ${J.rs} < ${J.rt}`,(J)=>`SLTU      ${J.rd} = ${J.rs} < ${J.rt}`,(J)=>`DADD      ${J.rd} = ${J.rs} + ${J.rt}`,(J)=>`DADDU     ${J.rd} = ${J.rs} + ${J.rt}`,(J)=>`DSUB      ${J.rd} = ${J.rs} - ${J.rt}`,(J)=>`DSUBU     ${J.rd} = ${J.rs} - ${J.rt}`,(J)=>`TGE       trap( ${J.rs} >= ${J.rt} )`,(J)=>`TGEU      trap( ${J.rs} >= ${J.rt} )`,(J)=>`TLT       trap( ${J.rs} < ${J.rt} )`,(J)=>`TLTU      trap( ${J.rs} < ${J.rt} )`,(J)=>`TEQ       trap( ${J.rs} == ${J.rt} )`,(J)=>"Unk",(J)=>`TNE       trap( ${J.rs} != ${J.rt} )`,(J)=>"Unk",(J)=>`DSLL      ${J.rd} = ${J.rt} << ${J.sa}`,(J)=>"Unk",(J)=>`DSRL      ${J.rd} = ${J.rt} >>> ${J.sa}`,(J)=>`DSRA      ${J.rd} = ${J.rt} >> ${J.sa}`,(J)=>`DSLL32    ${J.rd} = ${J.rt} << (32+${J.sa})`,(J)=>"Unk",(J)=>`DSRL32    ${J.rd} = ${J.rt} >>> (32+${J.sa})`,(J)=>`DSRA32    ${J.rd} = ${J.rt} >> (32+${J.sa})`];if(bK.length!=64)throw"Oops, didn't build the special table correctly";var TK=[(J)=>`MFC0      ${J.rt} <- ${F8[J0(J.opcode)]}`,(J)=>`DMFC0     ${J.rt} <- ${F8[J0(J.opcode)]}`,(J)=>"Unk",(J)=>"Unk",(J)=>`MTC0      ${J.rt} -> ${F8[J0(J.opcode)]}`,(J)=>`DMTC0     ${J.rt} -> ${F8[J0(J.opcode)]}`,(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",Bz,(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk"];if(TK.length!=32)throw"Oops, didn't build the cop0 table correctly";var _K=[(J)=>`MFC1      ${J.rt_d} = ${J.fs()}`,(J)=>`DMFC1     ${J.rt_d} = ${J.fs()}`,(J)=>`CFC1      ${J.rt_d} = CCR${R(J.opcode)}`,(J)=>`DCFC1     ${J.rt_d} = CCR${R(J.opcode)}`,(J)=>`MTC1      ${J.fs_d()} = ${J.rt}`,(J)=>`DMTC1     ${J.fs_d()} = ${J.rt}`,(J)=>`CTC1      CCR${R(J.opcode)} = ${J.rt}`,(J)=>`DCTC1     CCR${R(J.opcode)} = ${J.rt}`,Ez,(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",Az,kz,(J)=>"Unk",(J)=>"Unk",wz,Cz,(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk"];if(_K.length!=32)throw"Oops, didn't build the cop1 table correctly";var SK=[(J)=>`MFC2      ${J.rt_d} = ${J.fs()}`,(J)=>`DMFC2     ${J.rt_d} = ${J.fs()}`,(J)=>`CFC2      ${J.rt_d} = CCR${R(J.opcode)}`,(J)=>`DCFC2     ${J.rt_d} = CCR${R(J.opcode)}`,(J)=>`MTC2      ${J.fs_d()} = ${J.rt}`,(J)=>`DMTC2     ${J.fs_d()} = ${J.rt}`,(J)=>`CTC2      CCR${R(J.opcode)} = ${J.rt}`,(J)=>`DCTC2     CCR${R(J.opcode)} = ${J.rt}`,(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk"];if(SK.length!=32)throw"Oops, didn't build the cop2 table correctly";var vK=[(J)=>`MFC3      ${J.rt_d} = ${J.fs()}`,(J)=>`DMFC3     ${J.rt_d} = ${J.fs()}`,(J)=>`CFC3      ${J.rt_d} = CCR${R(J.opcode)}`,(J)=>`DCFC3     ${J.rt_d} = CCR${R(J.opcode)}`,(J)=>`MTC3      ${J.fs_d()} = ${J.rt}`,(J)=>`DMTC3     ${J.fs_d()} = ${J.rt}`,(J)=>`CTC3      CCR${R(J.opcode)} = ${J.rt}`,(J)=>`DCTC3     CCR${R(J.opcode)} = ${J.rt}`,(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk"];if(vK.length!=32)throw"Oops, didn't build the cop3 table correctly";var fK=[(J)=>`BLTZ      ${J.rs} < 0 --> ${J.branchAddress}`,(J)=>`BGEZ      ${J.rs} >= 0 --> ${J.branchAddress}`,(J)=>`BLTZL     ${J.rs} < 0 --> ${J.branchAddress}`,(J)=>`BGEZL     ${J.rs} >= 0 --> ${J.branchAddress}`,(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>`TGEI      ${J.rs} >= ${J.rt} --> trap `,(J)=>`TGEIU     ${J.rs} >= ${J.rt} --> trap `,(J)=>`TLTI      ${J.rs} < ${J.rt} --> trap `,(J)=>`TLTIU     ${J.rs} < ${J.rt} --> trap `,(J)=>`TEQI      ${J.rs} == ${J.rt} --> trap `,(J)=>"Unk",(J)=>`TNEI      ${J.rs} != ${J.rt} --> trap `,(J)=>"Unk",(J)=>`BLTZAL    ${J.rs} < 0 --> ${J.branchAddress}${J.writesRA()}`,(J)=>`BGEZAL    ${J.rs} >= 0 --> ${J.branchAddress}${J.writesRA()}`,(J)=>`BLTZALL   ${J.rs} < 0 --> ${J.branchAddress}${J.writesRA()}`,(J)=>`BGEZALL   ${J.rs} >= 0 --> ${J.branchAddress}${J.writesRA()}`,(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk"];if(fK.length!=32)throw"Oops, didn't build the special table correctly";var uK=[hz,Rz,(J)=>`J         --> ${J.jumpAddress}`,(J)=>`JAL       --> ${J.jumpAddress}${J.writesRA()}`,(J)=>{if(y(J.opcode)==h(J.opcode))return`B         --> ${J.branchAddress}`;return`BEQ       ${J.rs} == ${J.rt} --> ${J.branchAddress}`},(J)=>`BNE       ${J.rs} != ${J.rt} --> ${J.branchAddress}`,(J)=>`BLEZ      ${J.rs} <= 0 --> ${J.branchAddress}`,(J)=>`BGTZ      ${J.rs} > 0 --> ${J.branchAddress}`,(J)=>`ADDI      ${J.rt_d} = ${J.rs} + ${J.imm}`,(J)=>`ADDIU     ${J.rt_d} = ${J.rs} + ${J.imm}`,(J)=>`SLTI      ${J.rt_d} = (${J.rs} < ${J.imm})`,(J)=>`SLTIU     ${J.rt_d} = (${J.rs} < ${J.imm})`,(J)=>`ANDI      ${J.rt_d} = ${J.rs} & ${J.imm}`,(J)=>`ORI       ${J.rt_d} = ${J.rs} | ${J.imm}`,(J)=>`XORI      ${J.rt_d} = ${J.rs} ^ ${J.imm}`,(J)=>`LUI       ${J.rt_d} = ${J.imm} << 16`,Oz,yz,Dz,Iz,(J)=>`BEQL      ${J.rs} == ${J.rt} --> ${J.branchAddress}`,(J)=>`BNEL      ${J.rs} != ${J.rt} --> ${J.branchAddress}`,(J)=>`BLEZL     ${J.rs} <= 0 --> ${J.branchAddress}`,(J)=>`BGTZL     ${J.rs} > 0 --> ${J.branchAddress}`,(J)=>`DADDI     ${J.rt_d} = ${J.rs} + ${J.imm}`,(J)=>`DADDIU    ${J.rt_d} = ${J.rs} + ${J.imm}`,(J)=>`LDL       ${J.rt_d} <- ${J.memload()}`,(J)=>`LDR       ${J.rt_d} <- ${J.memload()}`,(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>"Unk",(J)=>`LB        ${J.rt_d} <- ${J.memload()}`,(J)=>`LH        ${J.rt_d} <- ${J.memload()}`,(J)=>`LWL       ${J.rt_d} <- ${J.memload()}`,(J)=>`LW        ${J.rt_d} <- ${J.memload()}`,(J)=>`LBU       ${J.rt_d} <- ${J.memload()}`,(J)=>`LHU       ${J.rt_d} <- ${J.memload()}`,(J)=>`LWR       ${J.rt_d} <- ${J.memload()}`,(J)=>`LWU       ${J.rt_d} <- ${J.memload()}`,(J)=>`SB        ${J.rt} -> ${J.memstore()}`,(J)=>`SH        ${J.rt} -> ${J.memstore()}`,(J)=>`SWL       ${J.rt} -> ${J.memstore()}`,(J)=>`SW        ${J.rt} -> ${J.memstore()}`,(J)=>`SDL       ${J.rt} -> ${J.memstore()}`,(J)=>`SDR       ${J.rt} -> ${J.memstore()}`,(J)=>`SWR       ${J.rt} -> ${J.memstore()}`,(J)=>`CACHE     ${B(h(J.opcode),8)}, ${J.memaccess()}`,(J)=>`LL        ${J.rt_d} <- ${J.memload()}`,(J)=>`LWC1      ${J.ft_d()} <- ${J.memload()}`,(J)=>"Unk",(J)=>"Unk",(J)=>`LLD       ${J.rt_d} <- ${J.memload()}`,(J)=>`LDC1      ${J.ft_d()} <- ${J.memload()}`,(J)=>`LDC2      ${J.gt_d} <- ${J.memload()}`,(J)=>`LD        ${J.rt_d} <- ${J.memload()}`,(J)=>`SC        ${J.rt} -> ${J.memstore()}`,(J)=>`SWC1      ${J.ft()} -> ${J.memstore()}`,(J)=>"BREAKPOINT",(J)=>"Unk",(J)=>`SCD       ${J.rt} -> ${J.memstore()}`,(J)=>`SDC1      ${J.ft()} -> ${J.memstore()}`,(J)=>`SDC2      ${J.gt} -> ${J.memstore()}`,(J)=>`SD        ${J.rt} -> ${J.memstore()}`];if(uK.length!=64)throw"Oops, didn't build the simple table correctly";var dK=function(J){return J&63},bz=function(J){return J>>>6&31},o6=function(J){return J>>>11&31},uJ=function(J){return J>>>16&31},fJ=function(J){return J>>>21&31},Tz=function(J){return J>>>26&63},xK=function(J){return J>>>21&31},_z=function(J){return J>>>16&31},ZJ=function(J){return J>>>7&15},pK=function(J){return(J&127)<<25>>25},mK=function(J){return J>>>21&15},Sz=function(J){return J>>>11&31},vz=function(J){return J>>>16&31},fz=function(J){return J>>>11&31},uz=function(J){return J>>>6&31},gz=function(J){return J&67108863},Qq=function(J){return J&65535},xz=function(J){return Qq(J)<<16>>16},nK=function(J){return J>>>21&31},oK=function(J){return Qq(J)<<16>>16},pz=function(J){return J&65535},mz=function(J,Q){return J+4+xz(Q)*4},nz=function(J,Q){return J&4026531840|gz(Q)*4},cK=function(J){return B(J,16)},j8=function(J){return J},tz=function(J){return iz[dK(J.opcode)](J)},B6=function(J){return`unknown: ${j(J.opcode)}`};function KJ(J,Q){const q=new aK(J,Q),Y=QH[Tz(Q)](q);return{address:J,instruction:q,disassembly:Y,isJumpTarget:!1}}function gJ(J,Q,q){return Yq(J,Q,Q,q-Q)}function Yq(J,Q,q,Y){const Z=[],K=new Set,X=J.length-1;for(let W=0;W<Y;W+=4){const z=J.getU32(q+W&X),F=KJ(Q+W,z);if(F.instruction.target)K.add(F.instruction.target);Z.push(F)}for(let W of Z)if(K.has(W.instruction.address))W.isJumpTarget=!0;return Z}function rK(J,Q,q,Y){let Z="";for(let K=0;K<Y;K+=4)Z+=`${B(Q+K,16)}: ${B(J.getU32(q+K),32)}\n`;return Z}var qq=["r0","at","v0","v1","a0","a1","a2","a3","t0","t1","t2","t3","t4","t5","t6","t7","s0","s1","s2","s3","s4","s5","s6","s7","t8","t9","k0","k1","gp","sp","s8","ra"],oz=31,lK=["SP_MEM_ADDR_REG","SP_DRAM_ADDR_REG","SP_RD_LEN_REG","SP_WR_LEN_REG","SP_STATUS_REG","SP_DMA_FULL_REG","SP_DMA_BUSY_REG","SP_SEMAPHORE_REG","DPC_START_REG","DPC_END_REG","DPC_CURRENT_REG","DPC_STATUS_REG","DPC_CLOCK_REG","DPC_BUFBUSY_REG","DPC_PIPEBUSY_REG","DPC_TMEM_REG"],cz=["VCO","VCC","VCE","VCE"],lz=["All","All1","0q","1q","0h","1h","2h","3h","0","1","2","3","4","5","6","7"];class aK{constructor(J,Q){this.address=J,this.opcode=Q,this.srcRegs={},this.dstRegs={},this.target="",this.memory=null}get rd(){const J=this.gprName(o6);return this.dstRegs[J]=1,j8(J)}get rt(){const J=this.gprName(uJ);return this.srcRegs[J]=1,j8(J)}get rs(){const J=this.gprName(fJ);return this.srcRegs[J]=1,j8(J)}get rt_d(){const J=this.gprName(uJ);return this.dstRegs[J]=1,j8(J)}get c0reg(){const J=o6(this.opcode);if(J<lK.length)return lK[J];return`c0reg${J}`}get cop2E(){return`${mK(this.opcode)}`}get cop2DE(){return`${Sz(this.opcode)}`}get cop2VD(){return`V${uz(this.opcode)}`}get cop2VT(){return`V${vz(this.opcode)}`}get cop2VS(){return`V${fz(this.opcode)}`}get cop2VecSelect(){return lz[mK(this.opcode)]}get c2flag(){return cz[o6(this.opcode)&3]}get sa(){return bz(this.opcode)}gprName(J){return qq[J(this.opcode)]}writesRA(){return this.dstRegs[oz]=1,""}get imm(){return`0x${B(Qq(this.opcode),16)}`}get branchAddress(){return this.target=mz(this.address,this.opcode),cK(this.target)}get jumpAddress(){return this.target=nz(this.address,this.opcode),cK(this.target)}get base(){const J=this.gprName(nK);return this.srcRegs[J]=1,j8(J)}get offsetU16(){return`0x${B(pz(this.opcode),16)}`}get offsetS16(){return`0x${B(oK(this.opcode),16)}`}memload(){return this.memaccess("load")}memstore(){return this.memaccess("store")}memaccess(J){return this.memory={reg:nK(this.opcode),offset:oK(this.opcode),mode:J},`[${this.base}+${this.offsetU16}]`}get vmemEl(){return`E${ZJ(this.opcode)}`}vmemEls(J){return`[${ZJ(this.opcode)}..${ZJ(this.opcode)+J-1&15}]`}get vmemVT(){return`V${_z(this.opcode)}`}get vmemBase(){const J=this.gprName(xK);return this.srcRegs[J]=1,j8(J)}vmemload(J){return this.vmemaccess("load",J)}vmemstore(J){return this.vmemaccess("store",J)}vmemaccess(J,Q){return Q=Q||1,this.memory={reg:xK(this.opcode),offset:pK(this.opcode)*Q,mode:J},`[${this.vmemBase}${this.sprintVOffset(Q)}]`}sprintVOffset(J){const Q=pK(this.opcode)*J;return(Q>=0?"+":"")+Q.toString()}}var dz=(()=>{let J=[];for(let Q=0;Q<64;Q++)J[Q]=B6;return J[0]=(Q)=>{if(Q.opcode===0)return"NOP";return`SLL       ${Q.rd} = ${Q.rt} << ${Q.sa}`},J[2]=(Q)=>`SRL       ${Q.rd} = ${Q.rt} >>> ${Q.sa}`,J[3]=(Q)=>`SRA       ${Q.rd} = ${Q.rt} >> ${Q.sa}`,J[4]=(Q)=>`SLLV      ${Q.rd} = ${Q.rt} << ${Q.rs}`,J[6]=(Q)=>`SRLV      ${Q.rd} = ${Q.rt} >>> ${Q.rs}`,J[7]=(Q)=>`SRAV      ${Q.rd} = ${Q.rt} >> ${Q.rs}`,J[8]=(Q)=>`JR        ${Q.rs}`,J[9]=(Q)=>`JALR      ${Q.rd}, ${Q.rs}`,J[13]=(Q)=>`BREAK     ${B(Q.opcode>>6&1048575,20)}`,J[32]=(Q)=>`ADD       ${Q.rd} = ${Q.rs} + ${Q.rt}`,J[33]=(Q)=>`ADDU      ${Q.rd} = ${Q.rs} + ${Q.rt}`,J[34]=(Q)=>`SUB       ${Q.rd} = ${Q.rs} - ${Q.rt}`,J[35]=(Q)=>`SUBU      ${Q.rd} = ${Q.rs} - ${Q.rt}`,J[36]=(Q)=>`AND       ${Q.rd} = ${Q.rs} & ${Q.rt}`,J[37]=(Q)=>`OR        ${Q.rd} = ${Q.rs} | ${Q.rt}`,J[38]=(Q)=>`XOR       ${Q.rd} = ${Q.rs} ^ ${Q.rt}`,J[39]=(Q)=>`NOR       ${Q.rd} = ~( ${Q.rs} | ${Q.rt} )`,J[42]=(Q)=>`SLT       ${Q.rd} = ${Q.rs} < ${Q.rt}`,J[43]=(Q)=>`SLTU      ${Q.rd} = ${Q.rs} < ${Q.rt}`,J})(),az=(()=>{let J=[];for(let Q=0;Q<32;Q++)J.push(B6);return J[0]=(Q)=>`BLTZ      ${Q.rs} < 0 --> ${Q.branchAddress}`,J[1]=(Q)=>`BGEZ      ${Q.rs} >= 0 --> ${Q.branchAddress}`,J[16]=(Q)=>`BLTZAL    ${Q.rs} < 0 --> ${Q.branchAddress}${Q.writesRA()}`,J[17]=(Q)=>`BGEZAL    ${Q.rs} >= 0 --> ${Q.branchAddress}${Q.writesRA()}`,J})(),rz=(()=>{let J=[];for(let Q=0;Q<32;Q++)J.push(B6);return J[0]=(Q)=>`MFC0      ${Q.rt_d} <- ${Q.c0reg}`,J[4]=(Q)=>`MTC0      ${Q.rt} -> ${Q.c0reg}`,J})(),sz=(()=>{let J=[];for(let Q=0;Q<32;Q++)J.push(B6);J[0]=(Q)=>`MFC2      ${Q.rt_d} = ${o6(Q.opcode)}[${ZJ(Q.opcode)}]`,J[2]=(Q)=>`CFC2      ${Q.rt_d} = ${Q.c2flag}`,J[4]=(Q)=>`MTC2      V${o6(Q.opcode)}[${ZJ(Q.opcode)}] = ${Q.rt}`,J[6]=(Q)=>`CTC2      ${Q.c2flag} = ${Q.rt}`;for(let Q=16;Q<32;Q++)J[Q]=tz;return J})(),iz=(()=>{let J=[];for(let Q=0;Q<64;Q++)J.push(B6);return J[0]=(Q)=>`VMULF     ${Q.cop2VD} = ${Q.cop2VS} * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[1]=(Q)=>`VMULU     ${Q.cop2VD} = ${Q.cop2VS} * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[2]=(Q)=>`VRNDP     ${Q.cop2VD} = ${Q.cop2VS} * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[3]=(Q)=>`VMULQ     ${Q.cop2VD} = ${Q.cop2VS} * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[4]=(Q)=>`VMUDL     ${Q.cop2VD} = ${Q.cop2VS} * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[5]=(Q)=>`VMUDM     ${Q.cop2VD} = ${Q.cop2VS} * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[6]=(Q)=>`VMUDN     ${Q.cop2VD} = ${Q.cop2VS} * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[7]=(Q)=>`VMUDH     ${Q.cop2VD} = ${Q.cop2VS} * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[8]=(Q)=>`VMACF     ${Q.cop2VD} = ${Q.cop2VS} * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[9]=(Q)=>`VMACU     ${Q.cop2VD} = ${Q.cop2VS} * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[10]=(Q)=>`VRNDN     ${Q.cop2VD} = ${Q.cop2VS} * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[11]=(Q)=>`VMACQ     ${Q.cop2VD}, ACC = oddify(ACC)`,J[12]=(Q)=>`VMADL     ${Q.cop2VD} = ${Q.cop2VS} * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[13]=(Q)=>`VMADM     ${Q.cop2VD} = ${Q.cop2VS} * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[14]=(Q)=>`VMADN     ${Q.cop2VD} = ${Q.cop2VS} * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[15]=(Q)=>`VMADH     ${Q.cop2VD} = ${Q.cop2VS} * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[16]=(Q)=>`VADD      ${Q.cop2VD} = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[17]=(Q)=>`VSUB      ${Q.cop2VD} = ${Q.cop2VS} - ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[18]=(Q)=>`VSUT      ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[19]=(Q)=>`VABS      ${Q.cop2VD} = sign(${Q.cop2VS}) * ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[20]=(Q)=>`VADDC     ${Q.cop2VD} = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[21]=(Q)=>`VSUBC     ${Q.cop2VD} = ${Q.cop2VS} - ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[22]=(Q)=>`VADDB     ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[23]=(Q)=>`VSUBB     ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[24]=(Q)=>`VACCB     ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[25]=(Q)=>`VSUCB     ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[26]=(Q)=>`VSAD      ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[27]=(Q)=>`VSAC      ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[28]=(Q)=>`VSUM      ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[29]=(Q)=>`VSAR      ${Q.cop2VD}, ${Q.cop2VS}, ${Q.cop2VT}[${Q.cop2E}]`,J[30]=(Q)=>`V30       ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[31]=(Q)=>`V31       ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[32]=(Q)=>`VLT       ${Q.cop2VD}, CC = cmpLT(${Q.cop2VS}, ${Q.cop2VT}[${Q.cop2VecSelect}])`,J[33]=(Q)=>`VEQ       ${Q.cop2VD}, CC = cmpEQ(${Q.cop2VS}, ${Q.cop2VT}[${Q.cop2VecSelect}])`,J[34]=(Q)=>`VNE       ${Q.cop2VD}, CC = cmpNE(${Q.cop2VS}, ${Q.cop2VT}[${Q.cop2VecSelect}])`,J[35]=(Q)=>`VGE       ${Q.cop2VD}, CC = cmpGE(${Q.cop2VS}, ${Q.cop2VT}[${Q.cop2VecSelect}])`,J[36]=(Q)=>`VCL       ${Q.cop2VD}, ACC = ${Q.cop2VS} clip ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[37]=(Q)=>`VCH       ${Q.cop2VD}, ACC = ${Q.cop2VS} clip ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[38]=(Q)=>`VCR       ${Q.cop2VD}, ACC = ${Q.cop2VS} crimp ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[39]=(Q)=>`VMRG      ${Q.cop2VD} = VCC ? ${Q.cop2VS} : ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[40]=(Q)=>`VAND      ${Q.cop2VD} = ${Q.cop2VS} & ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[41]=(Q)=>`VNAND     ${Q.cop2VD} = ~(${Q.cop2VS} & ${Q.cop2VT}[${Q.cop2VecSelect}])`,J[42]=(Q)=>`VOR       ${Q.cop2VD} = ${Q.cop2VS} | ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[43]=(Q)=>`VNOR      ${Q.cop2VD} = ~(${Q.cop2VS} | ${Q.cop2VT}[${Q.cop2VecSelect}])`,J[44]=(Q)=>`VXOR      ${Q.cop2VD} = ${Q.cop2VS} ^ ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[45]=(Q)=>`VNXOR     ${Q.cop2VD} = ~(${Q.cop2VS} ^ ${Q.cop2VT}[${Q.cop2VecSelect}])`,J[46]=(Q)=>`V46       ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[47]=(Q)=>`V47       ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[48]=(Q)=>`VRCP      ${Q.cop2VD}[${Q.cop2DE}] = 1/${Q.cop2VT}[${Q.cop2VecSelect}]`,J[49]=(Q)=>`VRCPL     ${Q.cop2VD}[${Q.cop2DE}] = 1/${Q.cop2VT}[${Q.cop2VecSelect}]`,J[50]=(Q)=>`VRCPH     ${Q.cop2VD}[${Q.cop2DE}], DIVIN = DIVOUT, ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[51]=(Q)=>`VMOV      ${Q.cop2VD}[${Q.cop2DE}] = ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[52]=(Q)=>`VRSQ      ${Q.cop2VD}[${Q.cop2DE}] = 1/sqrt(${Q.cop2VT}[${Q.cop2VecSelect}])`,J[53]=(Q)=>`VRSQL     ${Q.cop2VD}[${Q.cop2DE}] = 1/sqrt(${Q.cop2VT}[${Q.cop2VecSelect}])`,J[54]=(Q)=>`VRSQH     ${Q.cop2VD}[${Q.cop2DE}], DIVIN = DIVOUT, ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[55]=(Q)=>"VNOP",J[56]=(Q)=>`VEXTT     ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[57]=(Q)=>`VEXTQ     ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[58]=(Q)=>`VEXTN     ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[59]=(Q)=>`V59       ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[60]=(Q)=>`VINST     ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[61]=(Q)=>`VINSQ     ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[62]=(Q)=>`VINSN     ${Q.cop2VD} = 0, ACC = ${Q.cop2VS} + ${Q.cop2VT}[${Q.cop2VecSelect}]`,J[63]=(Q)=>"VNULL",J})(),ez=(()=>{let J=[];for(let Q=0;Q<32;Q++)J.push(B6);return J[0]=(Q)=>`LBV       ${Q.vmemVT}${Q.vmemEls(1)} <- ${Q.vmemload(1)}`,J[1]=(Q)=>`LSV       ${Q.vmemVT}${Q.vmemEls(2)} <- ${Q.vmemload(2)}`,J[2]=(Q)=>`LLV       ${Q.vmemVT}${Q.vmemEls(3)} <- ${Q.vmemload(4)}`,J[3]=(Q)=>`LDV       ${Q.vmemVT}${Q.vmemEls(4)} <- ${Q.vmemload(8)}`,J[4]=(Q)=>`LQV       ${Q.vmemVT} <- ${Q.vmemload(16)}`,J[5]=(Q)=>`LRV       ${Q.vmemVT} <- ${Q.vmemload(16)}`,J[6]=(Q)=>`LPV       ${Q.vmemVT} <- ${Q.vmemload(8)}`,J[7]=(Q)=>`LUV       ${Q.vmemVT} <- ${Q.vmemload(8)}`,J[8]=(Q)=>`LHV       ${Q.vmemVT} <- ${Q.vmemload(16)}`,J[9]=(Q)=>`LFV       ${Q.vmemVT} <- ${Q.vmemload(16)}`,J[10]=(Q)=>`LWV       ${Q.vmemVT} <- ${Q.vmemload(16)}`,J[11]=(Q)=>`LTV       ${Q.vmemVT} <- ${Q.vmemload(16)}`,J})(),JH=(()=>{let J=[];for(let Q=0;Q<32;Q++)J.push(B6);return J[0]=(Q)=>`SBV       ${Q.vmemVT}${Q.vmemEls(1)} -> ${Q.vmemstore(1)}`,J[1]=(Q)=>`SSV       ${Q.vmemVT}${Q.vmemEls(2)} -> ${Q.vmemstore(2)}`,J[2]=(Q)=>`SLV       ${Q.vmemVT}${Q.vmemEls(4)} -> ${Q.vmemstore(4)}`,J[3]=(Q)=>`SDV       ${Q.vmemVT}${Q.vmemEls(8)} -> ${Q.vmemstore(8)}`,J[4]=(Q)=>`SQV       ${Q.vmemVT} -> ${Q.vmemstore(16)}`,J[5]=(Q)=>`SRV       ${Q.vmemVT} -> ${Q.vmemstore(16)}`,J[6]=(Q)=>`SPV       ${Q.vmemVT} -> ${Q.vmemstore(8)}`,J[7]=(Q)=>`SUV       ${Q.vmemVT} -> ${Q.vmemstore(8)}`,J[8]=(Q)=>`SHV       ${Q.vmemVT} -> ${Q.vmemstore(16)}`,J[9]=(Q)=>`SFV       ${Q.vmemVT} -> ${Q.vmemstore(16)}`,J[10]=(Q)=>`SWV       ${Q.vmemVT} -> ${Q.vmemstore(16)}`,J[11]=(Q)=>`STV       ${Q.vmemVT} -> ${Q.vmemstore(16)}`,J})(),QH=(()=>{let J=[];for(let Q=0;Q<64;Q++)J.push(B6);return J[0]=(Q)=>dz[dK(Q.opcode)](Q),J[1]=(Q)=>az[uJ(Q.opcode)](Q),J[2]=(Q)=>`J         --> ${Q.jumpAddress}`,J[3]=(Q)=>`JAL       --> ${Q.jumpAddress}${Q.writesRA()}`,J[4]=(Q)=>{if(fJ(Q.opcode)==uJ(Q.opcode))return`B         --> ${Q.branchAddress}`;return`BEQ       ${Q.rs} == ${Q.rt} --> ${Q.branchAddress}`},J[5]=(Q)=>`BNE       ${Q.rs} != ${Q.rt} --> ${Q.branchAddress}`,J[6]=(Q)=>`BLEZ      ${Q.rs} <= 0 --> ${Q.branchAddress}`,J[7]=(Q)=>`BGTZ      ${Q.rs} > 0 --> ${Q.branchAddress}`,J[8]=(Q)=>`ADDI      ${Q.rt_d} = ${Q.rs} + ${Q.imm}`,J[9]=(Q)=>`ADDIU     ${Q.rt_d} = ${Q.rs} + ${Q.imm}`,J[10]=(Q)=>`SLTI      ${Q.rt_d} = (${Q.rs} < ${Q.imm})`,J[11]=(Q)=>`SLTIU     ${Q.rt_d} = (${Q.rs} < ${Q.imm})`,J[12]=(Q)=>`ANDI      ${Q.rt_d} = ${Q.rs} & ${Q.imm}`,J[13]=(Q)=>`ORI       ${Q.rt_d} = ${Q.rs} | ${Q.imm}`,J[14]=(Q)=>`XORI      ${Q.rt_d} = ${Q.rs} ^ ${Q.imm}`,J[15]=(Q)=>`LUI       ${Q.rt_d} = ${Q.imm} << 16`,J[16]=(Q)=>rz[fJ(Q.opcode)](Q),J[18]=(Q)=>sz[fJ(Q.opcode)](Q),J[32]=(Q)=>`LB        ${Q.rt_d} <- ${Q.memload()}`,J[33]=(Q)=>`LH        ${Q.rt_d} <- ${Q.memload()}`,J[35]=(Q)=>`LW        ${Q.rt_d} <- ${Q.memload()}`,J[36]=(Q)=>`LBU       ${Q.rt_d} <- ${Q.memload()}`,J[37]=(Q)=>`LHU       ${Q.rt_d} <- ${Q.memload()}`,J[39]=(Q)=>`LWU       ${Q.rt_d} <- ${Q.memload()}`,J[40]=(Q)=>`SB        ${Q.rt} -> ${Q.memstore()}`,J[41]=(Q)=>`SH        ${Q.rt} -> ${Q.memstore()}`,J[43]=(Q)=>`SW        ${Q.rt} -> ${Q.memstore()}`,J[50]=(Q)=>ez[o6(Q.opcode)](Q),J[58]=(Q)=>JH[o6(Q.opcode)](Q),J})();var Zq=function(J){let Q,q;if(Q=J.match(/(#|0x)?([a-f0-9]{6})/i))q=Q[2];else if(Q=J.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))q=parseInt(Q[1]).toString(16).padStart(2,0)+parseInt(Q[2]).toString(16).padStart(2,0)+parseInt(Q[3]).toString(16).padStart(2,0);else if(Q=J.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))q=Q[1]+Q[1]+Q[2]+Q[2]+Q[3]+Q[3];if(q)return"#"+q;return!1},XH=function(J){return KH.find((Q)=>Q.match(J))},$H=function(J){const Q=document.createElement("style");Q.innerHTML=J;const q=document.querySelector("head link[rel=stylesheet], head style");if(q)document.head.insertBefore(Q,q);else document.head.appendChild(Q)};class Z6{constructor(J,Q,q,Y,Z="div"){this.parent=J,this.object=Q,this.property=q,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(Y),this.$name=document.createElement("div"),this.$name.classList.add("name"),Z6.nextNameID=Z6.nextNameID||0,this.$name.id=`lil-gui-name-${++Z6.nextNameID}`,this.$widget=document.createElement(Z),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.domElement.addEventListener("keydown",(K)=>K.stopPropagation()),this.domElement.addEventListener("keyup",(K)=>K.stopPropagation()),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(q)}name(J){return this._name=J,this.$name.innerHTML=J,this}onChange(J){return this._onChange=J,this}_callOnChange(){if(this.parent._callOnChange(this),this._onChange!==void 0)this._onChange.call(this,this.getValue());this._changed=!0}onFinishChange(J){return this._onFinishChange=J,this}_callOnFinishChange(){if(this._changed){if(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0)this._onFinishChange.call(this,this.getValue())}this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(J=!0){return this.disable(!J)}disable(J=!0){if(J===this._disabled)return this;return this._disabled=J,this.domElement.classList.toggle("disabled",J),this.$disable.toggleAttribute("disabled",J),this}show(J=!0){return this._hidden=!J,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(J){const Q=this.parent.add(this.object,this.property,J);return Q.name(this._name),this.destroy(),Q}min(J){return this}max(J){return this}step(J){return this}decimals(J){return this}listen(J=!0){if(this._listening=J,this._listenCallbackID!==void 0)cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0;if(this._listening)this._listenCallback();return this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const J=this.save();if(J!==this._listenPrevValue)this.updateDisplay();this._listenPrevValue=J}getValue(){return this.object[this.property]}setValue(J){return this.object[this.property]=J,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(J){return this.setValue(J),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class tK extends Z6{constructor(J,Q,q){super(J,Q,q,"boolean","label");this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}var qH={isPrimitive:!0,match:(J)=>typeof J==="string",fromHexString:Zq,toHexString:Zq},XJ={isPrimitive:!0,match:(J)=>typeof J==="number",fromHexString:(J)=>parseInt(J.substring(1),16),toHexString:(J)=>"#"+J.toString(16).padStart(6,0)},YH={isPrimitive:!1,match:(J)=>Array.isArray(J),fromHexString(J,Q,q=1){const Y=XJ.fromHexString(J);Q[0]=(Y>>16&255)/255*q,Q[1]=(Y>>8&255)/255*q,Q[2]=(Y&255)/255*q},toHexString([J,Q,q],Y=1){Y=255/Y;const Z=J*Y<<16^Q*Y<<8^q*Y<<0;return XJ.toHexString(Z)}},ZH={isPrimitive:!1,match:(J)=>Object(J)===J,fromHexString(J,Q,q=1){const Y=XJ.fromHexString(J);Q.r=(Y>>16&255)/255*q,Q.g=(Y>>8&255)/255*q,Q.b=(Y&255)/255*q},toHexString({r:J,g:Q,b:q},Y=1){Y=255/Y;const Z=J*Y<<16^Q*Y<<8^q*Y<<0;return XJ.toHexString(Z)}},KH=[qH,XJ,YH,ZH];class eK extends Z6{constructor(J,Q,q,Y){super(J,Q,q,"color");this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=XH(this.initialValue),this._rgbScale=Y,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const Z=Zq(this.$text.value);if(Z)this._setValueFromHexString(Z)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(J){if(this._format.isPrimitive){const Q=this._format.fromHexString(J);this.setValue(Q)}else this._format.fromHexString(J,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(J){return this._setValueFromHexString(J),this._callOnFinishChange(),this}updateDisplay(){if(this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),!this._textFocused)this.$text.value=this.$input.value.substring(1);return this.$display.style.backgroundColor=this.$input.value,this}}class xJ extends Z6{constructor(J,Q,q){super(J,Q,q,"function");this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",(Y)=>{Y.preventDefault(),this.getValue().call(this.object),this._callOnChange()}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class JX extends Z6{constructor(J,Q,q,Y,Z,K){super(J,Q,q,"number");this._initInput(),this.min(Y),this.max(Z);const X=K!==void 0;this.step(X?K:this._getImplicitStep(),X),this.updateDisplay()}decimals(J){return this._decimals=J,this.updateDisplay(),this}min(J){return this._min=J,this._onUpdateMinMax(),this}max(J){return this._max=J,this._onUpdateMinMax(),this}step(J,Q=!0){return this._step=J,this._stepExplicit=Q,this}updateDisplay(){const J=this.getValue();if(this._hasSlider){let Q=(J-this._min)/(this._max-this._min);Q=Math.max(0,Math.min(Q,1)),this.$fill.style.width=Q*100+"%"}if(!this._inputFocused)this.$input.value=this._decimals===void 0?J:J.toFixed(this._decimals);return this}_initInput(){if(this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),window.matchMedia("(pointer: coarse)").matches)this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any");this.$widget.appendChild(this.$input),this.$disable=this.$input;const Q=()=>{let C=parseFloat(this.$input.value);if(isNaN(C))return;if(this._stepExplicit)C=this._snap(C);this.setValue(this._clamp(C))},q=(C)=>{const D=parseFloat(this.$input.value);if(isNaN(D))return;this._snapClampSetValue(D+C),this.$input.value=this.getValue()},Y=(C)=>{if(C.key==="Enter")this.$input.blur();if(C.code==="ArrowUp")C.preventDefault(),q(this._step*this._arrowKeyMultiplier(C));if(C.code==="ArrowDown")C.preventDefault(),q(this._step*this._arrowKeyMultiplier(C)*-1)},Z=(C)=>{if(this._inputFocused)C.preventDefault(),q(this._step*this._normalizeMouseWheel(C))};let K=!1,X,W,z,F,N;const G=5,P=(C)=>{X=C.clientX,W=z=C.clientY,K=!0,F=this.getValue(),N=0,window.addEventListener("mousemove",L),window.addEventListener("mouseup",U)},L=(C)=>{if(K){const D=C.clientX-X,u=C.clientY-W;if(Math.abs(u)>G)C.preventDefault(),this.$input.blur(),K=!1,this._setDraggingStyle(!0,"vertical");else if(Math.abs(D)>G)U()}if(!K){const D=C.clientY-z;if(N-=D*this._step*this._arrowKeyMultiplier(C),F+N>this._max)N=this._max-F;else if(F+N<this._min)N=this._min-F;this._snapClampSetValue(F+N)}z=C.clientY},U=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",L),window.removeEventListener("mouseup",U)},E=()=>{this._inputFocused=!0},A=()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()};this.$input.addEventListener("input",Q),this.$input.addEventListener("keydown",Y),this.$input.addEventListener("wheel",Z,{passive:!1}),this.$input.addEventListener("mousedown",P),this.$input.addEventListener("focus",E),this.$input.addEventListener("blur",A)}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const J=(A,C,D,u,n)=>{return(A-C)/(D-C)*(n-u)+u},Q=(A)=>{const C=this.$slider.getBoundingClientRect();let D=J(A,C.left,C.right,this._min,this._max);this._snapClampSetValue(D)},q=(A)=>{this._setDraggingStyle(!0),Q(A.clientX),window.addEventListener("mousemove",Y),window.addEventListener("mouseup",Z)},Y=(A)=>{Q(A.clientX)},Z=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",Y),window.removeEventListener("mouseup",Z)};let K=!1,X,W;const z=(A)=>{A.preventDefault(),this._setDraggingStyle(!0),Q(A.touches[0].clientX),K=!1},F=(A)=>{if(A.touches.length>1)return;if(this._hasScrollBar)X=A.touches[0].clientX,W=A.touches[0].clientY,K=!0;else z(A);window.addEventListener("touchmove",N,{passive:!1}),window.addEventListener("touchend",G)},N=(A)=>{if(K){const C=A.touches[0].clientX-X,D=A.touches[0].clientY-W;if(Math.abs(C)>Math.abs(D))z(A);else window.removeEventListener("touchmove",N),window.removeEventListener("touchend",G)}else A.preventDefault(),Q(A.touches[0].clientX)},G=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",N),window.removeEventListener("touchend",G)},P=this._callOnFinishChange.bind(this),L=400;let U;const E=(A)=>{if(Math.abs(A.deltaX)<Math.abs(A.deltaY)&&this._hasScrollBar)return;A.preventDefault();const D=this._normalizeMouseWheel(A)*this._step;this._snapClampSetValue(this.getValue()+D),this.$input.value=this.getValue(),clearTimeout(U),U=setTimeout(P,L)};this.$slider.addEventListener("mousedown",q),this.$slider.addEventListener("touchstart",F,{passive:!1}),this.$slider.addEventListener("wheel",E,{passive:!1})}_setDraggingStyle(J,Q="horizontal"){if(this.$slider)this.$slider.classList.toggle("active",J);document.body.classList.toggle("lil-gui-dragging",J),document.body.classList.toggle(`lil-gui-${Q}`,J)}_getImplicitStep(){if(this._hasMin&&this._hasMax)return(this._max-this._min)/1000;return 0.1}_onUpdateMinMax(){if(!this._hasSlider&&this._hasMin&&this._hasMax){if(!this._stepExplicit)this.step(this._getImplicitStep(),!1);this._initSlider(),this.updateDisplay()}}_normalizeMouseWheel(J){let{deltaX:Q,deltaY:q}=J;if(Math.floor(J.deltaY)!==J.deltaY&&J.wheelDelta)Q=0,q=-J.wheelDelta/120,q*=this._stepExplicit?1:10;return Q+-q}_arrowKeyMultiplier(J){let Q=this._stepExplicit?1:10;if(J.shiftKey)Q*=10;else if(J.altKey)Q/=10;return Q}_snap(J){const Q=Math.round(J/this._step)*this._step;return parseFloat(Q.toPrecision(15))}_clamp(J){if(J<this._min)J=this._min;if(J>this._max)J=this._max;return J}_snapClampSetValue(J){this.setValue(this._clamp(this._snap(J)))}get _hasScrollBar(){const J=this.parent.root.$children;return J.scrollHeight>J.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class QX extends Z6{constructor(J,Q,q,Y){super(J,Q,q,"option");this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(Y)?Y:Object.values(Y),this._names=Array.isArray(Y)?Y:Object.keys(Y),this._names.forEach((Z)=>{const K=document.createElement("option");K.innerHTML=Z,this.$select.appendChild(K)}),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const J=this.getValue(),Q=this._values.indexOf(J);return this.$select.selectedIndex=Q,this.$display.innerHTML=Q===-1?J:this._names[Q],this}}class qX extends Z6{constructor(J,Q,q){super(J,Q,q,"string");this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",(Y)=>{if(Y.code==="Enter")this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}var WH=`.lil-gui {
  font-family: var(--font-family);
  font-size: var(--font-size);
  line-height: 1;
  font-weight: normal;
  font-style: normal;
  text-align: left;
  background-color: var(--background-color);
  color: var(--text-color);
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  --background-color: #1f1f1f;
  --text-color: #ebebeb;
  --title-background-color: #111111;
  --title-text-color: #ebebeb;
  --widget-color: #424242;
  --hover-color: #4f4f4f;
  --focus-color: #595959;
  --number-color: #2cc9ff;
  --string-color: #a2db3c;
  --font-size: 11px;
  --input-font-size: 11px;
  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;
  --padding: 4px;
  --spacing: 4px;
  --widget-height: 20px;
  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);
  --name-width: 45%;
  --slider-knob-width: 2px;
  --slider-input-width: 27%;
  --color-input-width: 27%;
  --slider-input-min-width: 45px;
  --color-input-min-width: 45px;
  --folder-indent: 7px;
  --widget-padding: 0 0 0 3px;
  --widget-border-radius: 2px;
  --checkbox-size: calc(0.75 * var(--widget-height));
  --scrollbar-width: 5px;
}
.lil-gui, .lil-gui * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
.lil-gui.root {
  width: var(--width, 245px);
  display: flex;
  flex-direction: column;
}
.lil-gui.root > .title {
  background: var(--title-background-color);
  color: var(--title-text-color);
}
.lil-gui.root > .children {
  overflow-x: hidden;
  overflow-y: auto;
}
.lil-gui.root > .children::-webkit-scrollbar {
  width: var(--scrollbar-width);
  height: var(--scrollbar-width);
  background: var(--background-color);
}
.lil-gui.root > .children::-webkit-scrollbar-thumb {
  border-radius: var(--scrollbar-width);
  background: var(--focus-color);
}
@media (pointer: coarse) {
  .lil-gui.allow-touch-styles, .lil-gui.allow-touch-styles .lil-gui {
    --widget-height: 28px;
    --padding: 6px;
    --spacing: 6px;
    --font-size: 13px;
    --input-font-size: 16px;
    --folder-indent: 10px;
    --scrollbar-width: 7px;
    --slider-input-min-width: 50px;
    --color-input-min-width: 65px;
  }
}
.lil-gui.force-touch-styles, .lil-gui.force-touch-styles .lil-gui {
  --widget-height: 28px;
  --padding: 6px;
  --spacing: 6px;
  --font-size: 13px;
  --input-font-size: 16px;
  --folder-indent: 10px;
  --scrollbar-width: 7px;
  --slider-input-min-width: 50px;
  --color-input-min-width: 65px;
}
.lil-gui.autoPlace {
  max-height: 100%;
  position: fixed;
  top: 0;
  right: 15px;
  z-index: 1001;
}

.lil-gui .controller {
  display: flex;
  align-items: center;
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
}
.lil-gui .controller.disabled {
  opacity: 0.5;
}
.lil-gui .controller.disabled, .lil-gui .controller.disabled * {
  pointer-events: none !important;
}
.lil-gui .controller > .name {
  min-width: var(--name-width);
  flex-shrink: 0;
  white-space: pre;
  padding-right: var(--spacing);
  line-height: var(--widget-height);
}
.lil-gui .controller .widget {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  min-height: var(--widget-height);
}
.lil-gui .controller.string input {
  color: var(--string-color);
}
.lil-gui .controller.boolean .widget {
  cursor: pointer;
}
.lil-gui .controller.color .display {
  width: 100%;
  height: var(--widget-height);
  border-radius: var(--widget-border-radius);
  position: relative;
}
@media (hover: hover) {
  .lil-gui .controller.color .display:hover:before {
    content: " ";
    display: block;
    position: absolute;
    border-radius: var(--widget-border-radius);
    border: 1px solid #fff9;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
.lil-gui .controller.color input[type=color] {
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
.lil-gui .controller.color input[type=text] {
  margin-left: var(--spacing);
  font-family: var(--font-family-mono);
  min-width: var(--color-input-min-width);
  width: var(--color-input-width);
  flex-shrink: 0;
}
.lil-gui .controller.option select {
  opacity: 0;
  position: absolute;
  width: 100%;
  max-width: 100%;
}
.lil-gui .controller.option .display {
  position: relative;
  pointer-events: none;
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  line-height: var(--widget-height);
  max-width: 100%;
  overflow: hidden;
  word-break: break-all;
  padding-left: 0.55em;
  padding-right: 1.75em;
  background: var(--widget-color);
}
@media (hover: hover) {
  .lil-gui .controller.option .display.focus {
    background: var(--focus-color);
  }
}
.lil-gui .controller.option .display.active {
  background: var(--focus-color);
}
.lil-gui .controller.option .display:after {
  font-family: "lil-gui";
  content: "\u2195";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  padding-right: 0.375em;
}
.lil-gui .controller.option .widget,
.lil-gui .controller.option select {
  cursor: pointer;
}
@media (hover: hover) {
  .lil-gui .controller.option .widget:hover .display {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number input {
  color: var(--number-color);
}
.lil-gui .controller.number.hasSlider input {
  margin-left: var(--spacing);
  width: var(--slider-input-width);
  min-width: var(--slider-input-min-width);
  flex-shrink: 0;
}
.lil-gui .controller.number .slider {
  width: 100%;
  height: var(--widget-height);
  background-color: var(--widget-color);
  border-radius: var(--widget-border-radius);
  padding-right: var(--slider-knob-width);
  overflow: hidden;
  cursor: ew-resize;
  touch-action: pan-y;
}
@media (hover: hover) {
  .lil-gui .controller.number .slider:hover {
    background-color: var(--hover-color);
  }
}
.lil-gui .controller.number .slider.active {
  background-color: var(--focus-color);
}
.lil-gui .controller.number .slider.active .fill {
  opacity: 0.95;
}
.lil-gui .controller.number .fill {
  height: 100%;
  border-right: var(--slider-knob-width) solid var(--number-color);
  box-sizing: content-box;
}

.lil-gui-dragging .lil-gui {
  --hover-color: var(--widget-color);
}
.lil-gui-dragging * {
  cursor: ew-resize !important;
}

.lil-gui-dragging.lil-gui-vertical * {
  cursor: ns-resize !important;
}

.lil-gui .title {
  height: var(--title-height);
  line-height: calc(var(--title-height) - 4px);
  font-weight: 600;
  padding: 0 var(--padding);
  -webkit-tap-highlight-color: transparent;
  cursor: pointer;
  outline: none;
  text-decoration-skip: objects;
}
.lil-gui .title:before {
  font-family: "lil-gui";
  content: "\u25BE";
  padding-right: 2px;
  display: inline-block;
}
.lil-gui .title:active {
  background: var(--title-background-color);
  opacity: 0.75;
}
@media (hover: hover) {
  body:not(.lil-gui-dragging) .lil-gui .title:hover {
    background: var(--title-background-color);
    opacity: 0.85;
  }
  .lil-gui .title:focus {
    text-decoration: underline var(--focus-color);
  }
}
.lil-gui.root > .title:focus {
  text-decoration: none !important;
}
.lil-gui.closed > .title:before {
  content: "\u25B8";
}
.lil-gui.closed > .children {
  transform: translateY(-7px);
  opacity: 0;
}
.lil-gui.closed:not(.transition) > .children {
  display: none;
}
.lil-gui.transition > .children {
  transition-duration: 300ms;
  transition-property: height, opacity, transform;
  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);
  overflow: hidden;
  pointer-events: none;
}
.lil-gui .children:empty:before {
  content: "Empty";
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
  display: block;
  height: var(--widget-height);
  font-style: italic;
  line-height: var(--widget-height);
  opacity: 0.5;
}
.lil-gui.root > .children > .lil-gui > .title {
  border: 0 solid var(--widget-color);
  border-width: 1px 0;
  transition: border-color 300ms;
}
.lil-gui.root > .children > .lil-gui.closed > .title {
  border-bottom-color: transparent;
}
.lil-gui + .controller {
  border-top: 1px solid var(--widget-color);
  margin-top: 0;
  padding-top: var(--spacing);
}
.lil-gui .lil-gui .lil-gui > .title {
  border: none;
}
.lil-gui .lil-gui .lil-gui > .children {
  border: none;
  margin-left: var(--folder-indent);
  border-left: 2px solid var(--widget-color);
}
.lil-gui .lil-gui .controller {
  border: none;
}

.lil-gui input {
  -webkit-tap-highlight-color: transparent;
  border: 0;
  outline: none;
  font-family: var(--font-family);
  font-size: var(--input-font-size);
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  background: var(--widget-color);
  color: var(--text-color);
  width: 100%;
}
@media (hover: hover) {
  .lil-gui input:hover {
    background: var(--hover-color);
  }
  .lil-gui input:active {
    background: var(--focus-color);
  }
}
.lil-gui input:disabled {
  opacity: 1;
}
.lil-gui input[type=text],
.lil-gui input[type=number] {
  padding: var(--widget-padding);
}
.lil-gui input[type=text]:focus,
.lil-gui input[type=number]:focus {
  background: var(--focus-color);
}
.lil-gui input::-webkit-outer-spin-button,
.lil-gui input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
.lil-gui input[type=number] {
  -moz-appearance: textfield;
}
.lil-gui input[type=checkbox] {
  appearance: none;
  -webkit-appearance: none;
  height: var(--checkbox-size);
  width: var(--checkbox-size);
  border-radius: var(--widget-border-radius);
  text-align: center;
  cursor: pointer;
}
.lil-gui input[type=checkbox]:checked:before {
  font-family: "lil-gui";
  content: "\u2713";
  font-size: var(--checkbox-size);
  line-height: var(--checkbox-size);
}
@media (hover: hover) {
  .lil-gui input[type=checkbox]:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui button {
  -webkit-tap-highlight-color: transparent;
  outline: none;
  cursor: pointer;
  font-family: var(--font-family);
  font-size: var(--font-size);
  color: var(--text-color);
  width: 100%;
  height: var(--widget-height);
  text-transform: none;
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
  border: 1px solid var(--widget-color);
  text-align: center;
  line-height: calc(var(--widget-height) - 4px);
}
@media (hover: hover) {
  .lil-gui button:hover {
    background: var(--hover-color);
    border-color: var(--hover-color);
  }
  .lil-gui button:focus {
    border-color: var(--focus-color);
  }
}
.lil-gui button:active {
  background: var(--focus-color);
}

@font-face {
  font-family: "lil-gui";
  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");
}`,iK=!1;class Kq{constructor({parent:J,autoPlace:Q=J===void 0,container:q,width:Y,title:Z="Controls",closeFolders:K=!1,injectStyles:X=!0,touchStyles:W=!0}={}){if(this.parent=J,this.root=J?J.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",(z)=>{if(z.code==="Enter"||z.code==="Space")z.preventDefault(),this.$title.click()}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(Z),this.parent){this.parent.children.push(this),this.parent.folders.push(this),this.parent.$children.appendChild(this.domElement);return}if(this.domElement.classList.add("root"),W)this.domElement.classList.add("allow-touch-styles");if(!iK&&X)$H(WH),iK=!0;if(q)q.appendChild(this.domElement);else if(Q)this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement);if(Y)this.domElement.style.setProperty("--width",Y+"px");this._closeFolders=K}add(J,Q,q,Y,Z){if(Object(q)===q)return new QX(this,J,Q,q);const K=J[Q];switch(typeof K){case"number":return new JX(this,J,Q,q,Y,Z);case"boolean":return new tK(this,J,Q);case"string":return new qX(this,J,Q);case"function":return new xJ(this,J,Q)}console.error(`gui.add failed
	property:`,Q,`
	object:`,J,`
	value:`,K)}addColor(J,Q,q=1){return new eK(this,J,Q,q)}addFolder(J){const Q=new Kq({parent:this,title:J});if(this.root._closeFolders)Q.close();return Q}load(J,Q=!0){if(J.controllers)this.controllers.forEach((q)=>{if(q instanceof xJ)return;if(q._name in J.controllers)q.load(J.controllers[q._name])});if(Q&&J.folders)this.folders.forEach((q)=>{if(q._title in J.folders)q.load(J.folders[q._title])});return this}save(J=!0){const Q={controllers:{},folders:{}};if(this.controllers.forEach((q)=>{if(q instanceof xJ)return;if(q._name in Q.controllers)throw new Error(`Cannot save GUI with duplicate property "${q._name}"`);Q.controllers[q._name]=q.save()}),J)this.folders.forEach((q)=>{if(q._title in Q.folders)throw new Error(`Cannot save GUI with duplicate folder "${q._title}"`);Q.folders[q._title]=q.save()});return Q}open(J=!0){return this._setClosed(!J),this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}_setClosed(J){if(this._closed===J)return;this._closed=J,this._callOnOpenClose(this)}show(J=!0){return this._hidden=!J,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(J=!0){return this._setClosed(!J),this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const Q=this.$children.clientHeight;this.$children.style.height=Q+"px",this.domElement.classList.add("transition");const q=(Z)=>{if(Z.target!==this.$children)return;this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",q)};this.$children.addEventListener("transitionend",q);const Y=!J?0:this.$children.scrollHeight;this.domElement.classList.toggle("closed",!J),requestAnimationFrame(()=>{this.$children.style.height=Y+"px"})}),this}title(J){return this._title=J,this.$title.innerHTML=J,this}reset(J=!0){return(J?this.controllersRecursive():this.controllers).forEach((q)=>q.reset()),this}onChange(J){return this._onChange=J,this}_callOnChange(J){if(this.parent)this.parent._callOnChange(J);if(this._onChange!==void 0)this._onChange.call(this,{object:J.object,property:J.property,value:J.getValue(),controller:J})}onFinishChange(J){return this._onFinishChange=J,this}_callOnFinishChange(J){if(this.parent)this.parent._callOnFinishChange(J);if(this._onFinishChange!==void 0)this._onFinishChange.call(this,{object:J.object,property:J.property,value:J.getValue(),controller:J})}onOpenClose(J){return this._onOpenClose=J,this}_callOnOpenClose(J){if(this.parent)this.parent._callOnOpenClose(J);if(this._onOpenClose!==void 0)this._onOpenClose.call(this,J)}destroy(){if(this.parent)this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1);if(this.domElement.parentElement)this.domElement.parentElement.removeChild(this.domElement);Array.from(this.children).forEach((J)=>J.destroy())}controllersRecursive(){let J=Array.from(this.controllers);return this.folders.forEach((Q)=>{J=J.concat(Q.controllersRecursive())}),J}foldersRecursive(){let J=Array.from(this.folders);return this.folders.forEach((Q)=>{J=J.concat(Q.foldersRecursive())}),J}}var YX=Kq;var P6=new YX;P6.title("Options");function XX(){Xq=new Map,pJ=new Map,Wq=[]}function $q(){return pJ}function N8(J){let Q=pJ.get(J);if(!Q){if(!ZX.enableDynarec)return null;let q=Xq.get(J)||0;if(q++,Xq.set(J,q),q<HH)return null;Q=new KX(J),pJ.set(J,Q)}if(!Q.func)Q.invalidate();return Q}function WX(){let J=Wq;return Wq=[],J}var ZX={enableDynarec:!0},zH=P6.addFolder("Performance");zH.add(ZX,"enableDynarec").name("Dynamic Recompilation");var HH=500,pJ=new Map,Xq=new Map,Wq=[];class KX{constructor(J){this.entryPC=J,this.minPC=J,this.maxPC=J+4,this.func=void 0,this.opsCompiled=0,this.executionCount=0,this.bailedOut=!1,this.nextFragments=[],this.bodyCode="",this.needsDelayCheck=!0,this.cop1statusKnown=!1,this.usesCop1=!1}invalidate(){this.minPC=this.entryPC,this.maxPC=this.entryPC+4,this.func=void 0,this.opsCompiled=0,this.executionCount=0,this.bailedOut=!1,this.nextFragments=[],this.bodyCode="",this.needsDelayCheck=!0,this.cop1statusKnown=!1,this.usesCop1=!1}updateMinMax(J){this.minPC=Math.min(this.minPC,J),this.maxPC=Math.max(this.maxPC,J+4)}getNextFragment(J,Q){let q=this.nextFragments[Q];if(!q||q.entryPC!==J)q=J===this.entryPC?this:N8(J),this.nextFragments[Q]=q;if(q&&q.opsCompiled>0&&!q.func)q.invalidate();return q}}function dJ(J){var Q="";if(J&$0.AA_EN)Q+="|AA_EN";if(J&$0.Z_CMP)Q+="|Z_CMP";if(J&$0.Z_UPD)Q+="|Z_UPD";if(J&$0.IM_RD)Q+="|IM_RD";if(J&$0.CLR_ON_CVG)Q+="|CLR_ON_CVG";var q=J&768;if(q===$0.CVG_DST_CLAMP)Q+="|CVG_DST_CLAMP";else if(q===$0.CVG_DST_WRAP)Q+="|CVG_DST_WRAP";else if(q===$0.CVG_DST_FULL)Q+="|CVG_DST_FULL";else if(q===$0.CVG_DST_SAVE)Q+="|CVG_DST_SAVE";var Y=J&3072;if(Y===$0.ZMODE_OPA)Q+="|ZMODE_OPA";else if(Y===$0.ZMODE_INTER)Q+="|ZMODE_INTER";else if(Y===$0.ZMODE_XLU)Q+="|ZMODE_XLU";else if(Y===$0.ZMODE_DEC)Q+="|ZMODE_DEC";if(J&$0.CVG_X_ALPHA)Q+="|CVG_X_ALPHA";if(J&$0.ALPHA_CVG_SEL)Q+="|ALPHA_CVG_SEL";if(J&$0.FORCE_BL)Q+="|FORCE_BL";var Z=Q.length>0?Q.substr(1):"0",K=J>>>Gq,X="GBL_c1("+lJ(K>>>2)+") | GBL_c2("+lJ(K)+") /*"+x(K)+"*/";return Z+", "+X}function E0(J){var Q=J;if(J===Vq)Q="G_TX_LOADTILE";if(J===FH)Q="G_TX_RENDERTILE";return Q}function h8(J){switch(J){case jH:return"G_TX_WRAP";case HJ:return"G_TX_MIRROR";case R6:return"G_TX_CLAMP";case HJ|R6:return"G_TX_MIRROR|G_TX_CLAMP"}return J}function O8(J,Q){var q="";if(Q&J.G_ZBUFFER)q+="|G_ZBUFFER";if(Q&J.G_TEXTURE_ENABLE)q+="|G_TEXTURE_ENABLE";if(Q&J.G_SHADE)q+="|G_SHADE";if(Q&J.G_SHADING_SMOOTH)q+="|G_SHADING_SMOOTH";var Y=Q&J.G_CULL_BOTH;if(Y===J.G_CULL_FRONT)q+="|G_CULL_FRONT";else if(Y===J.G_CULL_BACK)q+="|G_CULL_BACK";else if(Y===J.G_CULL_BOTH)q+="|G_CULL_BOTH";if(Q&J.G_FOG)q+="|G_FOG";if(Q&J.G_LIGHTING)q+="|G_LIGHTING";if(Q&J.G_TEXTURE_GEN)q+="|G_TEXTURE_GEN";if(Q&J.G_TEXTURE_GEN_LINEAR)q+="|G_TEXTURE_GEN_LINEAR";if(Q&J.G_LOD)q+="|G_LOD";return q.length>0?q.substr(1):"0"}var Y0=function(J){return J.nameOf=(Q)=>{for(var q in J)if(Object.prototype.hasOwnProperty.call(J,q)&&J[q]===Q)return q;return j(Q)},Object.freeze(J)};function lJ(J){var Q=J>>>12&3,q=J>>>8&3,Y=J>>>4&3,Z=J>>>0&3;return zX[Q]+","+NH[q]+","+zX[Y]+","+GH[Z]}var $0={AA_EN:8,Z_CMP:16,Z_UPD:32,IM_RD:64,CLR_ON_CVG:128,CVG_DST_CLAMP:0,CVG_DST_WRAP:256,CVG_DST_FULL:512,CVG_DST_SAVE:768,ZMODE_OPA:0,ZMODE_INTER:1024,ZMODE_XLU:2048,ZMODE_DEC:3072,CVG_X_ALPHA:4096,ALPHA_CVG_SEL:8192,FORCE_BL:16384,TEX_EDGE:0},zq=0,$X=2;var Gq=16,G8=3,aJ=4,HX=4294967288,FX=0,WJ=4,$J=6,Hq=8,mJ=9,nJ=12,oJ=14,Fq=16,cJ=17,jq=19,zJ=20;var Nq=23,g0=Y0({G_GBI2_MV_VIEWPORT:8,G_GBI2_MV_LIGHT:10,G_GBI2_MV_POINT:12,G_GBI2_MV_MATRIX:14,G_GBI2_MVO_LOOKATX:0,G_GBI2_MVO_LOOKATY:24,G_GBI2_MVO_L0:48,G_GBI2_MVO_L1:72,G_GBI2_MVO_L2:96,G_GBI2_MVO_L3:120,G_GBI2_MVO_L4:144,G_GBI2_MVO_L5:168,G_GBI2_MVO_L6:192,G_GBI2_MVO_L7:216}),rJ=1<<Nq,L8=3<<zJ,sJ=1<<jq,iJ=3<<cJ,tJ=1<<Fq,P8=3<<oJ,V8=3<<nJ,eJ=7<<mJ,J9=1<<Hq,Q9=3<<$J,q9=3<<WJ;var Y9=1;var Lq=2;var Pq=4,U8=0;var j0=Y0({G_MW_MATRIX:0,G_MW_NUMLIGHT:2,G_MW_CLIP:4,G_MW_SEGMENT:6,G_MW_FOG:8,G_MW_LIGHTCOL:10,G_MW_POINTS:12,G_MW_PERSPNORM:14}),z0=Y0({G_MV_VIEWPORT:128,G_MV_LOOKATY:130,G_MV_LOOKATX:132,G_MV_L0:134,G_MV_L1:136,G_MV_L2:138,G_MV_L3:140,G_MV_L4:142,G_MV_L5:144,G_MV_L6:146,G_MV_L7:148,G_MV_TXTATT:150,G_MV_MATRIX_1:158,G_MV_MATRIX_2:152,G_MV_MATRIX_3:154,G_MV_MATRIX_4:156}),jX=0,Z9=Y0({G_MWO_CLIP_RNX:4,G_MWO_CLIP_RNY:12,G_MWO_CLIP_RPX:20,G_MWO_CLIP_RPY:28}),K9=1,X9=2,W9=4,$9=8,z9=16,H9=32,F9=Y0({FR_NEG_FRUSTRATIO_1:1,FR_POS_FRUSTRATIO_1:65535,FR_NEG_FRUSTRATIO_2:2,FR_POS_FRUSTRATIO_2:65534,FR_NEG_FRUSTRATIO_3:3,FR_POS_FRUSTRATIO_3:65533,FR_NEG_FRUSTRATIO_4:4,FR_POS_FRUSTRATIO_4:65532,FR_NEG_FRUSTRATIO_5:5,FR_POS_FRUSTRATIO_5:65531,FR_NEG_FRUSTRATIO_6:6,FR_POS_FRUSTRATIO_6:65530}),j9=Y0({G_MWO_SEGMENT_0:0,G_MWO_SEGMENT_1:1,G_MWO_SEGMENT_2:2,G_MWO_SEGMENT_3:3,G_MWO_SEGMENT_4:4,G_MWO_SEGMENT_5:5,G_MWO_SEGMENT_6:6,G_MWO_SEGMENT_7:7,G_MWO_SEGMENT_8:8,G_MWO_SEGMENT_9:9,G_MWO_SEGMENT_A:10,G_MWO_SEGMENT_B:11,G_MWO_SEGMENT_C:12,G_MWO_SEGMENT_D:13,G_MWO_SEGMENT_E:14,G_MWO_SEGMENT_F:15});var M8=Y0({G_MWO_POINT_RGBA:16,G_MWO_POINT_ST:20,G_MWO_POINT_XYSCREEN:24,G_MWO_POINT_ZSCREEN:28}),N9=Y0({NUMLIGHTS_1:1,NUMLIGHTS_2:2,NUMLIGHTS_3:3,NUMLIGHTS_4:4,NUMLIGHTS_5:5,NUMLIGHTS_6:6,NUMLIGHTS_7:7}),Vq=7,FH=0,jH=0,HJ=1,R6=2,NX=Y0({G_SC_NON_INTERLACE:0,G_SC_ODD_INTERLACE:3,G_SC_EVEN_INTERLACE:2}),d0={G_ZBUFFER:1,G_TEXTURE_ENABLE:2,G_SHADE:4,G_SHADING_SMOOTH:512,G_CULL_FRONT:4096,G_CULL_BACK:8192,G_CULL_BOTH:12288,G_FOG:65536,G_LIGHTING:131072,G_TEXTURE_GEN:262144,G_TEXTURE_GEN_LINEAR:524288,G_LOD:1048576},V6={G_TEXTURE_ENABLE:2,G_SHADE:0,G_ZBUFFER:1,G_CULL_BACK:512,G_CULL_FRONT:1024,G_CULL_BOTH:1536,G_FOG:65536,G_LIGHTING:131072,G_TEXTURE_GEN:262144,G_TEXTURE_GEN_LINEAR:524288,G_LOD:1048576,G_SHADING_SMOOTH:2097152},Z0=Y0({G_IM_FMT_RGBA:0,G_IM_FMT_YUV:1,G_IM_FMT_CI:2,G_IM_FMT_IA:3,G_IM_FMT_I:4}),g=Y0({G_IM_SIZ_4b:0,G_IM_SIZ_8b:1,G_IM_SIZ_16b:2,G_IM_SIZ_32b:3}),G9=Y0({G_PM_1PRIMITIVE:1<<Nq,G_PM_NPRIMITIVE:0<<Nq}),K0=Y0({G_CYC_1CYCLE:0<<zJ,G_CYC_2CYCLE:1<<zJ,G_CYC_COPY:2<<zJ,G_CYC_FILL:3<<zJ}),L9=Y0({G_TP_NONE:0<<jq,G_TP_PERSP:1<<jq}),P9=Y0({G_TD_CLAMP:0<<cJ,G_TD_SHARPEN:1<<cJ,G_TD_DETAIL:2<<cJ}),V9=Y0({G_TL_TILE:0<<Fq,G_TL_LOD:1<<Fq}),E8=Y0({G_TT_NONE:0<<oJ,G_TT_RGBA16:2<<oJ,G_TT_IA16:3<<oJ}),A8=Y0({G_TF_POINT:0<<nJ,G_TF_AVERAGE:3<<nJ,G_TF_BILERP:2<<nJ}),U9=Y0({G_TC_CONV:0<<mJ,G_TC_FILTCONV:5<<mJ,G_TC_FILT:6<<mJ}),M9=Y0({G_CK_NONE:0<<Hq,G_CK_KEY:1<<Hq}),h9=Y0({G_CD_MAGICSQ:0<<$J,G_CD_BAYER:1<<$J,G_CD_NOISE:2<<$J,G_CD_DISABLE:3<<$J}),O9=Y0({G_AD_PATTERN:0<<WJ,G_AD_NOTPATTERN:1<<WJ,G_AD_NOISE:2<<WJ,G_AD_DISABLE:3<<WJ}),c6=Y0({G_AC_NONE:0<<zq,G_AC_THRESHOLD:1<<zq,G_AC_DITHER:3<<zq}),l6=Y0({G_ZS_PIXEL:0<<$X,G_ZS_PRIM:1<<$X}),zX=["G_BL_CLR_IN","G_BL_CLR_MEM","G_BL_CLR_BL","G_BL_CLR_FOG"],NH=["G_BL_A_IN","G_BL_A_FOG","G_BL_A_SHADE","G_BL_0"],GH=["G_BL_1MA","G_BL_A_MEM","G_BL_1","G_BL_0"];function LH(J){var Q=J>>>8&255;let q=J&255;return Q<<24|Q<<16|Q<<8|q}function hq(J){let Q=w8[J>>>11&31],q=w8[J>>>6&31],Y=w8[J>>>1&31],Z=J&1?255:0;return Q<<24|q<<16|Y<<8|Z}var PH=function(J,Q,q){const Y=J.data,Z=J.width*4;let K=0;const X=q.line<<4;let W=q.tmem<<3,z=0;for(let F=0;F<q.height;++F){let N=W,G=K;for(let P=0;P<q.width;++P){const L=N^z;Y[G+0]=Q[L+0],Y[G+1]=Q[L+1],Y[G+2]=Q[L+2],Y[G+3]=Q[L+3],N+=4,G+=4}W+=X,K+=Z,z^=8}},VH=function(J,Q,q){let Y=J.data,Z=J.width*4,K=0,X=q.line<<3,W=q.tmem<<3,z=0;for(let F=0;F<q.height;++F){let N=W,G=K;for(let P=0;P<q.width;++P){let L=N^z,U=Q[L]<<8|Q[L+1];Y[G+0]=w8[U>>>11&31],Y[G+1]=w8[U>>>6&31],Y[G+2]=w8[U>>>1&31],Y[G+3]=U&1?255:0,N+=2,G+=4}W+=X,K+=Z,z^=4}},UH=function(J,Q,q){let Y=J.data,Z=J.width*4,K=0,X=q.line<<3,W=q.tmem<<3,z=0;for(let F=0;F<q.height;++F){let N=W,G=K;for(let P=0;P<q.width;++P){let L=N^z,U=Q[L],E=Q[L+1];Y[G+0]=U,Y[G+1]=U,Y[G+2]=U,Y[G+3]=E,N+=2,G+=4}W+=X,K+=Z,z^=4}},MH=function(J,Q,q){let Y=J.data,Z=J.width*4,K=0,X=q.line<<3,W=q.tmem<<3,z=0;for(let F=0;F<q.height;++F){let N=W,G=K;for(let P=0;P<q.width;++P){let L=N^z,U=Q[L],E=FJ[U>>>4&15],A=FJ[U&15];Y[G+0]=E,Y[G+1]=E,Y[G+2]=E,Y[G+3]=A,N+=1,G+=4}W+=X,K+=Z,z^=4}},hH=function(J,Q,q){let Y=J.data,Z=J.width*4,K=0,X=q.line<<3,W=q.tmem<<3,z=0;for(let F=0;F<q.height;++F){let N=W,G=K;for(let P=0;P+1<q.width;P+=2){let L=N^z,U=Q[L],E=Mq[(U&224)>>>5],A=Uq[(U&16)>>>4],C=Mq[(U&14)>>>1],D=Uq[(U&1)>>>0];Y[G+0]=E,Y[G+1]=E,Y[G+2]=E,Y[G+3]=A,Y[G+4]=C,Y[G+5]=C,Y[G+6]=C,Y[G+7]=D,N+=1,G+=8}if(q.width&1){let P=N^z,L=Q[P],U=Mq[(L&224)>>>5],E=Uq[(L&16)>>>4];Y[G+0]=U,Y[G+1]=U,Y[G+2]=U,Y[G+3]=E,N+=1,G+=4}W+=X,K+=Z,z^=4}},OH=function(J,Q,q){let Y=J.data,Z=J.width*4,K=0,X=q.line<<3,W=q.tmem<<3,z=0;for(let F=0;F<q.height;++F){let N=W,G=K;for(let P=0;P<q.width;++P){let L=Q[N^z];Y[G+0]=L,Y[G+1]=L,Y[G+2]=L,Y[G+3]=L,N+=1,G+=4}W+=X,K+=Z,z^=4}},EH=function(J,Q,q){let Y=J.data,Z=J.width*4,K=0,X=q.line<<3,W=q.tmem<<3,z=0;for(let F=0;F<q.height;++F){let N=W,G=K;for(let P=0;P+1<q.width;P+=2){let L=Q[N^z],U=FJ[(L&240)>>>4],E=FJ[(L&15)>>>0];Y[G+0]=U,Y[G+1]=U,Y[G+2]=U,Y[G+3]=U,Y[G+4]=E,Y[G+5]=E,Y[G+6]=E,Y[G+7]=E,N+=1,G+=8}if(q.width&1){let P=Q[N^z],L=FJ[(P&240)>>>4];Y[G+0]=L,Y[G+1]=L,Y[G+2]=L,Y[G+3]=L,N+=1,G+=4}W+=X,K+=Z,z^=4}},GX=function(J,Q,q,Y){const Z=J.data,K=J.width*4;let X=0;const W=q.line<<3;let z=q.tmem<<3;const F=0;for(let G=0;G<256;++G){const U=2048+(G*4+F)*2,E=Q[U+0]<<8|Q[U+1];k8[G]=Y(E)}let N=0;for(let G=0;G<q.height;++G){let P=z,L=X;for(let U=0;U<q.width;++U){const E=k8[Q[P^N]];Z[L+0]=E>>24&255,Z[L+1]=E>>16&255,Z[L+2]=E>>8&255,Z[L+3]=E&255,P+=1,L+=4}z+=W,X+=K,N^=4}},LX=function(J,Q,q,Y,Z){const K=J.data,X=J.width*4;let W=0;const z=q.line<<3;let F=q.tmem<<3;const N=0;for(let P=0;P<16;++P){const E=2048+((Y*16|P)*4+N)*2,A=Q[E+0]<<8|Q[E+1];k8[P]=Z(A)}let G=0;for(let P=0;P<q.height;++P){let L=F,U=W;for(let E=0;E+1<q.width;E+=2){let A=Q[L^G],C=k8[(A&240)>>>4],D=k8[(A&15)>>>0];K[U+0]=C>>24&255,K[U+1]=C>>16&255,K[U+2]=C>>8&255,K[U+3]=C&255,K[U+4]=D>>24&255,K[U+5]=D>>16&255,K[U+6]=D>>8&255,K[U+7]=D&255,L+=1,U+=8}if(q.width&1){let E=Q[L^G],A=k8[(E&240)>>>4];K[U+0]=A>>24&255,K[U+1]=A>>16&255,K[U+2]=A>>8&255,K[U+3]=A&255,L+=1,U+=4}F+=z,W+=X,G^=4}};function PX(J,Q,q,Y){var Z=Y===E8.G_TT_IA16?LH:hq;switch(q.format){case Z0.G_IM_FMT_RGBA:switch(q.size){case g.G_IM_SIZ_32b:return PH(J,Q,q),!0;case g.G_IM_SIZ_16b:return VH(J,Q,q),!0;case g.G_IM_SIZ_8b:return GX(J,Q,q,Z),!0;case g.G_IM_SIZ_4b:return LX(J,Q,q,q.palette,Z),!0}break;case Z0.G_IM_FMT_IA:switch(q.size){case g.G_IM_SIZ_16b:return UH(J,Q,q),!0;case g.G_IM_SIZ_8b:return MH(J,Q,q),!0;case g.G_IM_SIZ_4b:return hH(J,Q,q),!0}break;case Z0.G_IM_FMT_I:switch(q.size){case g.G_IM_SIZ_8b:return OH(J,Q,q),!0;case g.G_IM_SIZ_4b:return EH(J,Q,q),!0}break;case Z0.G_IM_FMT_CI:switch(q.size){case g.G_IM_SIZ_8b:return GX(J,Q,q,Z),!0;case g.G_IM_SIZ_4b:return LX(J,Q,q,q.palette,Z),!0}break}return!1}var Uq=[0,255],Mq=[0,36,73,109,146,182,219,255],FJ=[0,17,34,51,68,85,102,119,136,153,170,187,204,221,238,255],w8=[0,8,16,24,33,41,49,57,66,74,82,90,99,107,115,123,132,140,148,156,165,173,181,189,198,206,214,222,231,239,247,255],k8=new Uint32Array(256);function E9(J,Q,q){let Y;switch(Q){case G8:Y=`gsDPSetAlphaCompare(${c6.nameOf(q)});`;break;case aJ:Y=`gsDPSetDepthSource(${l6.nameOf(q)});`;break;case HX:Y=`gsDPSetRenderMode(${dJ(q)});`;break;default:Y=`gsSPSetOtherMode(G_SETOTHERMODE_L, ${j(Q)}, ${j(q)}`;break}J.text(Y)}function A9(J,Q,q,Y,Z){let K;switch(Q){case FX:break;case q9:K=`gsDPSetAlphaDither(${O9.nameOf(Z)});`;break;case Q9:K=`gsDPSetColorDither(${h9.nameOf(Z)});`;break;case J9:K=`gsDPSetCombineKey(${M9.nameOf(Z)});`;break;case eJ:K=`gsDPSetTextureConvert(${U9.nameOf(Z)});`;break;case V8:K=`gsDPSetTextureFilter(${A8.nameOf(Z)});`;break;case tJ:K=`gsDPSetTextureLOD(${V9.nameOf(Z)});`;break;case P8:K=`gsDPSetTextureLUT(${E8.nameOf(Z)});`;break;case iJ:K=`gsDPSetTextureDetail(${P9.nameOf(Z)});`;break;case sJ:K=`gsDPSetTexturePersp(${L9.nameOf(Z)});`;break;case L8:K=`gsDPSetCycleType(${K0.nameOf(Z)});`;break;case rJ:K=`gsDPPipelineMode(${G9.nameOf(Z)});`;break;default:K=`gsSPSetOtherMode(G_SETOTHERMODE_H, ${j(Q)}, ${j(Z)});`;break}J.text(K)}var VX=function(J,Q,q,Y){const Z=`${J}, ${Q}, ${q}`,K=`${Z}, ${Y}`;if(J<128&&Q<128||Q<128&&q<128||q<128&&J<128)return`<span style="color: white; background-color: rgb(${Z})">${K}</span>`;return`<span style="background-color: rgb(${Z})">${K}</span>`};function b6(J){const Q=J>>>24&255,q=J>>>16&255,Y=J>>>8&255,Z=J&255;return VX(Q,q,Y,Z)}function k9(J){const Q=J&255,q=J>>>8&255,Y=J>>>16&255,Z=J>>>24&255;return VX(Q,q,Y,Z)}function UX(J){return b6(hq(J))}function kq(J,Q,q){let Y=Aq(J,Q),Z=Aq(J,q),K=J.createProgram();if(J.attachShader(K,Y),J.attachShader(K,Z),J.linkProgram(K),!J.getProgramParameter(K,J.LINK_STATUS))r(!1,"Unable to initialize the shader program.");return K}var Aq=function(J,Q){let q=document.getElementById(Q);if(!q)return null;let Y=kX(q),Z;if(q.type==="x-shader/x-fragment")Z=J.FRAGMENT_SHADER;else if(q.type==="x-shader/x-vertex")Z=J.VERTEX_SHADER;else return null;return wX(J,Y,Z)},kX=function(J){let Q="",q=J.firstChild;while(q){if(q.nodeType==Node.TEXT_NODE)Q+=q.textContent;q=q.nextSibling}return Q},wX=function(J,Q,q){let Y=J.createShader(q);if(J.shaderSource(Y,Q),J.compileShader(Y),!J.getShaderParameter(Y,J.COMPILE_STATUS))return r(!1,"An error occurred compiling the shaders: "+J.getShaderInfoLog(Y)),null;return Y};function yX(J,Q,q,Y,Z){let K=Y<K0.G_CYC_COPY?`${Q.toString(16)+q.toString(16)}_${Y}`:Y.toString();if(Z)K+="_alphaThreshold";let X=hX.get(K);if(X)return X;if(!Eq)Eq=Aq(J,"n64-shader-vs");if(!Oq){let C6=document.getElementById("n64-shader-fs");if(C6)Oq=kX(C6)}let W=Q>>>20&15,z=q>>>28&15,F=Q>>>15&31,N=q>>>15&7,G=Q>>>12&7,P=q>>>12&7,L=Q>>>9&7,U=q>>>9&7,E=Q>>>5&15,A=q>>>24&15,C=Q>>>0&31,D=q>>>6&7,u=q>>>21&7,n=q>>>3&7,d=q>>>18&7,H0=q>>>0&7,k0;if(Y===K0.G_CYC_FILL)k0="col = shade;\n";else if(Y===K0.G_CYC_COPY)k0="col = tex0;\n";else if(Y===K0.G_CYC_1CYCLE)k0="",k0+="col.rgb = ("+w9[W]+" - "+w9[z]+") * "+OX[F]+" + "+AX[N]+";\n",k0+="col.a = ("+T6[G]+" - "+T6[P]+") * "+T6[L]+" + "+T6[U]+";\n";else k0="",k0+="col.rgb = ("+w9[W]+" - "+w9[z]+") * "+OX[F]+" + "+AX[N]+";\n",k0+="col.a = ("+T6[G]+" - "+T6[P]+") * "+T6[L]+" + "+T6[U]+";\n",k0+="combined = vec4(col.rgb, col.a);\n",k0+="col.rgb = ("+EX[E]+" - "+EX[A]+") * "+kH[C]+" + "+wH[D]+";\n",k0+="col.a = ("+C9[u]+" - "+C9[n]+") * "+C9[d]+" + "+C9[H0]+";\n";if(Z)k0+="if(col.a <= uAlphaThreshold) discard;\n";let n8=Oq.replace("{{body}}",k0);if(AH){let C6="\n";C6+="\tRGB0 = ("+D9[W]+" - "+I9[z]+") * "+y9[F]+" + "+B9[N]+"\n",C6+="\t  A0 = ("+_6[G]+" - "+_6[P]+") * "+R9[L]+" + "+b9[U]+"\n",C6+="\tRGB1 = ("+D9[E]+" - "+I9[A]+") * "+y9[C]+" + "+B9[D]+"\n",C6+="\t  A1 = ("+_6[u]+" - "+_6[n]+") * "+R9[d]+" + "+b9[H0]+"\n";let t7=n8.split("\n").join("<br>");M("Compiled "+C6+"\nto\n"+t7)}let gZ=wX(J,n8,J.FRAGMENT_SHADER);if(!gZ)return null;let o8=J.createProgram();if(J.attachShader(o8,Eq),J.attachShader(o8,gZ),J.linkProgram(o8),!J.getProgramParameter(o8,J.LINK_STATUS))r(!1,"Unable to initialize the shader program.");return X=new CX(J,o8,n8),hX.set(K,X),X}function T9(J,Q){let q=J>>>20&15,Y=Q>>>28&15,Z=J>>>15&31,K=Q>>>15&7,X=J>>>12&7,W=Q>>>12&7,z=J>>>9&7,F=Q>>>9&7,N=J>>>5&15,G=Q>>>24&15,P=J>>>0&31,L=Q>>>6&7,U=Q>>>21&7,E=Q>>>3&7,A=Q>>>18&7,C=Q>>>0&7,D="";return D+="RGB0 = ("+D9[q]+" - "+I9[Y]+") * "+y9[Z]+" + "+B9[K]+"\n",D+="  A0 = ("+_6[X]+" - "+_6[W]+") * "+R9[z]+" + "+b9[F]+"\n",D+="RGB1 = ("+D9[N]+" - "+I9[G]+") * "+y9[P]+" + "+B9[L]+"\n",D+="  A1 = ("+_6[U]+" - "+_6[E]+") * "+R9[A]+" + "+b9[C]+"\n",D}var AH=!1,hX=new Map,Oq=null,Eq=null,OX=["combined.rgb","tex0.rgb","tex1.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","combined.a","tex0.a","tex1.a","prim.a","shade.a","env.a","lod_frac","prim_lod_frac","k5","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","zero.rgb"],kH=["combined.rgb","tex1.rgb","tex0.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","combined.a","tex1.a","tex0.a","prim.a","shade.a","env.a","lod_frac","prim_lod_frac","k5","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","zero.rgb"],w9=["combined.rgb","tex0.rgb","tex1.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","combined.a","tex0.a","tex1.a","prim.a","shade.a","env.a","lod_frac","prim_lod_frac","zero.rgb"],EX=["combined.rgb","tex1.rgb","tex0.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","combined.a","tex1.a","tex0.a","prim.a","shade.a","env.a","lod_frac","prim_lod_frac","zero.rgb"],AX=["combined.rgb","tex0.rgb","tex1.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","zero.rgb"],wH=["combined.rgb","tex1.rgb","tex0.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","zero.rgb"],T6=["combined.a","tex0.a","tex1.a","prim.a","shade.a","env.a","one.a","zero.a"],C9=["combined.a","tex1.a","tex0.a","prim.a","shade.a","env.a","one.a","zero.a"],y9=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","KeyScale    ","CombinedAlph","Texel0_Alpha","Texel1_Alpha","Prim_Alpha  ","Shade_Alpha ","Env_Alpha   ","LOD_Frac    ","PrimLODFrac ","K5          ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           "],D9=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","1           ","Noise       ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           "],I9=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","KeyCenter   ","K4          ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           "],B9=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","1           ","0           "],_6=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","PrimLODFrac ","0           "],R9=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","1           ","0           "],b9=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","1           ","0           "];class CX{constructor(J,Q,q){this.program=Q,this.shaderSource=q,this.vertexPositionAttribute=J.getAttribLocation(Q,"aVertexPosition"),this.vertexColorAttribute=J.getAttribLocation(Q,"aVertexColor"),this.texCoordAttribute=J.getAttribLocation(Q,"aTextureCoord"),this.uSamplerUniform0=J.getUniformLocation(Q,"uSampler0"),this.uSamplerUniform1=J.getUniformLocation(Q,"uSampler1"),this.uTexScaleUniform0=J.getUniformLocation(Q,"uTexScale0"),this.uTexScaleUniform1=J.getUniformLocation(Q,"uTexScale1"),this.uTexOffsetUniform0=J.getUniformLocation(Q,"uTexOffset0"),this.uTexOffsetUniform1=J.getUniformLocation(Q,"uTexOffset1"),this.uPrimColorUniform=J.getUniformLocation(Q,"uPrimColor"),this.uEnvColorUniform=J.getUniformLocation(Q,"uEnvColor"),this.uAlphaThresholdUniform=J.getUniformLocation(Q,"uAlphaThresholdUniform")}}var yH=function(J){const Q=Cq("x",J,$9,K9),q=Cq("y",J,z9,X9),Y=Cq("z",J,H9,W9);return`${Q} ${q} ${Y}`},Cq=function(J,Q,q,Y){const Z=Q&q,K=Q&Y;let X="",W="";if(Z&&K)X="clip-err",W="!";else if(Z)X="clip-pos",W=">";else if(K)X="clip-neg",W="<";else X="clip-none",W="0";return`<span class="${X}">${J}${W}</span>`},_9,C8,S6,DX=$("#dlist-content"),CH=0,IX="";class yq{constructor(J,Q){this.state=J,this.processDList=Q,this.currentOp=0,this.numOps=0,this.bailAfter=-1,this.lastTask,this.stateTimeShown=-1,this.running=!1,this.requested=!1,this.dlFocusCounter=0}onNewTask(J){if(this.lastTask=J,this.requested){if(IX==""||J.detectVersionString().includes(IX)){if(this.dlFocusCounter==CH)this.requested=!1,n64js.breakEmulationForDisplayListDebug(),this.stateTimeShown=-1,this.running=!0;this.dlFocusCounter++}}else this.dlFocusCounter=0}toggle(){if(this.running)this.hideUI(),this.bailAfter=-1,this.running=!1,n64js.toggleRun();else this.showUI(),this.requested=!0}halt(){this.showUI(),this.requested=!1,this.running=!0,this.bailAfter=this.currentOp,this.stateTimeShown=-1}debugDisplayList(){if(this.stateTimeShown==-1){const J=new BX(this);this.processDList(this.lastTask,J,-1),J.finalise(),this.numOps=J.numOps>0?J.numOps-1:0,this.setScrubRange(this.numOps);const Q=this.bailAfter==-1?this.numOps:this.bailAfter;this.setScrubTime(Q)}if(this.processDList(this.lastTask,null,this.bailAfter),this.stateTimeShown!==this.bailAfter)this.updateStateUI(),this.stateTimeShown=this.bailAfter}postOp(J){if(J>-1&&this.currentOp>=J)return!0;return this.currentOp++,!1}updateStateUI(){C8.find("#dl-geometrymode-content").html(this.buildStateTab()),C8.find("#dl-vertices-content").html(this.buildVerticesTab()),C8.find("#dl-tiles-content").html(this.buildTilesTab()),C8.find("#dl-combiner-content").html(this.buildCombinerTab()),C8.find("#dl-rdp-content").html(this.buildRDPTab())}setScrubText(J,Q){_9.find(".scrub-text").html(`uCode op ${J}/${Q}.`)}setScrubRange(J){_9.find("input").attr({min:0,max:J,value:J}),this.setScrubText(J,J)}setScrubTime(J){this.bailAfter=J,this.setScrubText(this.bailAfter,this.numOps);const Q=S6.find(`#I${this.bailAfter}`);S6.scrollTop(S6.scrollTop()+Q.position().top-S6.height()/2+Q.height()/2);const q="hle-cur-instr";S6.find(".hle-instr").removeClass(q),Q.addClass(q)}initUI(){const J=DX.find("#controls");this.bailAfter=-1,this.numOps=0;const Q=this;J.find("#rwd").click(()=>{if(Q.running&&Q.bailAfter>0)Q.setScrubTime(Q.bailAfter-1)}),J.find("#fwd").click(()=>{if(Q.running&&Q.bailAfter<Q.numOps)Q.setScrubTime(Q.bailAfter+1)}),J.find("#stop").click(()=>{this.toggle()}),_9=J.find(".scrub"),_9.find("input").change(function(){Q.setScrubTime($(this).val()|0)}),this.setScrubRange(0),C8=DX.find(".hle-state"),S6=$('<div class="hle-disasm"></div>'),$("#adjacent-debug").empty().append(S6)}showUI(){$(".debug").show(),$("#dlist-tab").tab("show")}hideUI(){$(".debug").hide()}setDisplayListOutput(J){S6.html(J),J.find(".dl-tip").parent().click(function(){$(this).find(".dl-tip").toggle()})}buildStateTab(){const J=$('<table class="table table-condensed dl-debug-table" style="width: auto;"></table>'),Q=$("<tr />");for(let q in this.state.geometryMode)if(Object.prototype.hasOwnProperty.call(this.state.geometryMode,q)){const Y=$(`<td>${q}</td>`);Y.addClass(this.state.geometryMode[q]?"dl-debug-geommode-enabled":"dl-debug-geommode-disabled"),Q.append(Y)}return J.append(Q),J}buildRDPTab(){const J=this.state.rdpOtherModeL,Q=this.state.rdpOtherModeH,q=this.state.textureImage,Y=new Map([["alphaCompare",c6.nameOf(J&G8)],["depthSource",l6.nameOf(J&aJ)],["renderMode",dJ(J)],["alphaDither",O9.nameOf(Q&q9)],["colorDither",h9.nameOf(Q&Q9)],["combineKey",M9.nameOf(Q&J9)],["textureConvert",U9.nameOf(Q&eJ)],["textureFilter",A8.nameOf(Q&V8)],["textureLUT",E8.nameOf(Q&P8)],["textureLOD",V9.nameOf(Q&tJ)],["texturePersp",L9.nameOf(Q&sJ)],["textureDetail",P9.nameOf(Q&iJ)],["cycleType",K0.nameOf(Q&L8)],["pipelineMode",G9.nameOf(Q&rJ)],["","&nbsp"],["TI.format",Z0.nameOf(q.format)],["TI.size",g.nameOf(q.size)],["TI.width",q.width],["TI.address",j(q.address)]]),Z=$('<table class="table table-condensed dl-debug-table" style="width: auto;"></table>');for(let[K,X]of Y){let W=$(`<tr><td>${K}</td><td>${X}</td></tr>`);Z.append(W)}return Z}buildColorsTable(){const J=["fillColor","envColor","primColor","blendColor","fogColor"],Q=$('<table class="table table-condensed dl-debug-table" style="width: auto;"></table>');for(let q of J){let Y=$(`<tr><td>${q}</td><td>${b6(this.state[q])}</td></tr>`);Q.append(Y)}return Q}buildCombinerTab(){const J=$('<pre class="combine"></pre>');J.append(K0.nameOf(this.state.getCycleType())+"\n"),J.append(this.buildColorsTable()),J.append(T9(this.state.combine.hi,this.state.combine.lo));const Q=this.renderer.getCurrentN64Shader();if(Q)J.append(Q.shaderSource);return J}buildTexture(J){const Q=this.renderer.lookupTexture(J);if(Q)return Q.createScaledCanvas(8)}buildTilesTab(){const J=$("<div />");J.append(this.buildTilesTable());const Q=[],q=$("<tr />");for(let Z=0;Z<8;++Z){let K=this.buildTexture(Z);Q.push(E0(Z));let X=$("<td />");X.append(K?K:""),q.append(X)}const Y=$('<table class="table table-condensed dl-debug-table" style="width: auto"></table>');return Y.append($(`<tr><th>${Q.join("</th><th>")}</th></tr>`)),Y.append(q),J.append(Y),J}buildTilesTable(){const J=["tile #","format","size","line","tmem","palette","cmS","maskS","shiftS","cmT","maskT","shiftT","left","top","right","bottom","width","height","unmasked w","unmasked h"],Q=$('<table class="table table-condensed dl-debug-table" style="width: auto"></table>'),q=$(`<tr><th>${J.join("</th><th>")}</th></tr>`);Q.append(q);for(let Y=0;Y<this.state.tiles.length;++Y){const Z=this.state.tiles[Y];if(Z.format===-1)continue;const K=[];K.push(E0(Y)),K.push(Z0.nameOf(Z.format)),K.push(g.nameOf(Z.size)),K.push(Z.line),K.push(Z.tmem),K.push(Z.palette),K.push(h8(Z.cmS)),K.push(Z.maskS),K.push(Z.shiftS),K.push(h8(Z.cmT)),K.push(Z.maskT),K.push(Z.shiftT),K.push(Z.left),K.push(Z.top),K.push(Z.right),K.push(Z.bottom),K.push(Z.width),K.push(Z.height),K.push(Z.unmaskedWidth),K.push(Z.unmaskedHeight);const X=$(`<tr><td>${K.join("</td><td>")}</td></tr>`);Q.append(X)}return Q}buildVerticesTab(){const J=["vtx #","x","y","z","px","py","pz","pw","color","u","v","clip"],Q=$('<table class="table table-condensed dl-debug-table" style="width: auto"></table>'),q=$(`<tr><th>${J.join("</th><th>")}</th></tr>`);Q.append(q);for(let Y=0;Y<this.state.projectedVertices.length;++Y){const Z=this.state.projectedVertices[Y];if(!Z.set)continue;const K=Z.pos.x/Z.pos.w,X=Z.pos.y/Z.pos.w,W=Z.pos.z/Z.pos.w,z=[];z.push(Y),z.push(K.toFixed(3)),z.push(X.toFixed(3)),z.push(W.toFixed(3)),z.push(Z.pos.x.toFixed(3)),z.push(Z.pos.y.toFixed(3)),z.push(Z.pos.z.toFixed(3)),z.push(Z.pos.w.toFixed(3)),z.push(k9(Z.color)),z.push(Z.u.toFixed(3)),z.push(Z.v.toFixed(3)),z.push(yH(Z.clipFlags));const F=$(`<tr><td>${z.join("</td><td>")}</td></tr>`);Q.append(F)}return Q}}class BX{constructor(J){this.debugController=J,this.$currentDis=$("<pre></pre>"),this.$span=void 0,this.numOps=0}begin(J,Q,q){const Y=new Array(q+1).join("  ");this.$span=$(`<span class="hle-instr" id="I${this.numOps}" />`),this.$span.append(`${HK(this.numOps,5)} ${B(J,32)}${B(Q,32)} ${Y}`),this.$currentDis.append(this.$span)}text(J){this.$span.append(J)}tip(J){const Q=$(`<div class="dl-tip">${J}</div>`);Q.hide(),this.$span.append(Q)}end(){this.$span.append("<br>"),this.numOps++}finalise=function(){this.debugController.setDisplayListOutput(this.$currentDis)};rgba8888(J){return b6(J)}rgba5551(J){return UX(J)}}class X0{constructor(J,Q,q){if(q!==void 0)this.elems=new Float32Array(3),this.elems[0]=J,this.elems[1]=Q,this.elems[2]=q;else this.elems=J||new Float32Array(3)}get x(){return this.elems[0]}get y(){return this.elems[1]}get z(){return this.elems[2]}set x(J){this.elems[0]=J}set y(J){this.elems[1]=J}set z(J){this.elems[2]=J}set(J,Q,q){return this.x=J,this.y=Q,this.z=q,this}dot(J){let Q=0;for(let q=0;q<this.elems.length;++q)Q+=this.elems[q]*J.elems[q];return Q}lengthSqr(){return this.dot(this)}length(){return Math.sqrt(this.lengthSqr())}addInPlace(J){for(var Q=0;Q<this.elems.length;++Q)this.elems[Q]+=J.elems[Q];return this}subInPlace(J){for(var Q=0;Q<this.elems.length;++Q)this.elems[Q]-=J.elems[Q];return this}scaleInPlace(J){for(var Q=0;Q<this.elems.length;++Q)this.elems[Q]*=J;return this}vecScaleInPlace(J){for(var Q=0;Q<this.elems.length;++Q)this.elems[Q]*=J.elems[Q];return this}invVecScaleInPlace(J){for(var Q=0;Q<this.elems.length;++Q)this.elems[Q]/=J.elems[Q];return this}normaliseInPlace(){var J=this.length();if(J>0)return this.scaleInPlace(1/J);return this}static create(J){let Q=new X0;return Q.elems[0]=J[0],Q.elems[1]=J[1],Q.elems[2]=J[2],Q}}class D0{constructor(J){this.elems=J||new Float32Array(16)}multiply(J){let Q=this.elems,q=J.elems,Y=new Float32Array(16);for(let Z=0;Z<4;++Z)for(let K=0;K<4;++K)Y[Z*4+K]+=Q[Z*4+0]*q[0+K],Y[Z*4+K]+=Q[Z*4+1]*q[4+K],Y[Z*4+K]+=Q[Z*4+2]*q[8+K],Y[Z*4+K]+=Q[Z*4+3]*q[12+K];return new D0(Y)}transformNormal(J,Q){let q=this.elems,Y=J.elems,Z=Y[0],K=Y[1],X=Y[2];Q.elems[0]=q[0]*Z+q[1]*K+q[2]*X,Q.elems[1]=q[4]*Z+q[5]*K+q[6]*X,Q.elems[2]=q[8]*Z+q[9]*K+q[10]*X}transformPoint(J,Q){let q=this.elems,Y=J.elems,Z=Y[0],K=Y[1],X=Y[2];Q.elems[0]=q[0]*Z+q[1]*K+q[2]*X+q[3],Q.elems[1]=q[4]*Z+q[5]*K+q[6]*X+q[7],Q.elems[2]=q[8]*Z+q[9]*K+q[10]*X+q[11],Q.elems[3]=q[12]*Z+q[13]*K+q[14]*X+q[15]}static identity(){let J=new Float32Array(16);return J[0]=1,J[5]=1,J[10]=1,J[15]=1,new D0(J)}copy(){let J=new Float32Array(16);for(let Q=0;Q<16;Q++)J[Q]=this.elems[Q];return new D0(J)}static makeOrtho(J,Q,q,Y,Z,K){let X=-(Q+J)/(Q-J),W=-(Y+q)/(Y-q),z=-(K+Z)/(K-Z),F=new Float32Array(16);return F[0]=2/(Q-J),F[1]=0,F[2]=0,F[3]=0,F[4]=0,F[5]=2/(Y-q),F[6]=0,F[7]=0,F[8]=0,F[9]=0,F[10]=-2/(K-Z),F[11]=0,F[12]=X,F[13]=W,F[14]=z,F[15]=1,new D0(F)}}var K6={canvasScale:1,haltOnWarning:!1,dumpMicrocodeSubstring:""},Dq=P6.addFolder("Graphics");Dq.add(K6,"canvasScale").name("Canvas Scale").min(1).max(4).step(0.25);Dq.add(K6,"haltOnWarning").name("Halt on Warning");Dq.add(K6,"dumpMicrocodeSubstring").name("Dump Microcode");function S9(J,Q){return(J>>>2)-(Q>>>2)+1&1023}var RX=function(J,Q){return Q?Math.min(1<<Q,J):J};class Iq{constructor(){this.format=-1,this.size=0,this.line=0,this.tmem=0,this.palette=0,this.cmT=0,this.maskT=0,this.shiftT=0,this.cmS=0,this.maskS=0,this.shiftS=0,this.uls=0,this.ult=0,this.lrs=0,this.lrt=0,this.hash=0}get left(){return this.uls/4}get top(){return this.ult/4}get right(){return this.lrs/4}get bottom(){return this.lrt/4}get unmaskedWidth(){return S9(this.lrs,this.uls)}get unmaskedHeight(){return S9(this.lrt,this.ult)}get width(){return RX(this.unmaskedWidth,this.maskS)}get height(){return RX(this.unmaskedHeight,this.maskT)}set(J,Q,q,Y,Z,K,X,W,z,F,N){this.format=J,this.size=Q,this.line=q,this.tmem=Y,this.palette=Z,this.cmS=K,this.maskS=X,this.shiftS=W,this.cmT=z,this.maskT=F,this.shiftT=N,this.hash=0}setSize(J,Q,q,Y){this.uls=J,this.ult=Q,this.lrs=q,this.lrt=Y,this.hash=0}}class Bq{constructor(J){this.numTris=0,this.maxTris=J,this.positions=new Float32Array(J*3*4),this.colours=new Uint32Array(J*3*1),this.coords=new Float32Array(J*3*2)}reset(){this.numTris=0}empty(){return this.numTris==0}hasCapacity(J){return this.numTris+J<this.maxTris}pushTri(J,Q,q){if(this.numTris>=this.maxTris)return!1;var Y=this.numTris*3*4,Z=this.numTris*3*1,K=this.numTris*3*2,X=J.pos,W=Q.pos,z=q.pos;return this.positions[Y+0]=X.x,this.positions[Y+1]=X.y,this.positions[Y+2]=X.z,this.positions[Y+3]=X.w,this.positions[Y+4]=W.x,this.positions[Y+5]=W.y,this.positions[Y+6]=W.z,this.positions[Y+7]=W.w,this.positions[Y+8]=z.x,this.positions[Y+9]=z.y,this.positions[Y+10]=z.z,this.positions[Y+11]=z.w,this.colours[Z+0]=J.color,this.colours[Z+1]=Q.color,this.colours[Z+2]=q.color,this.coords[K+0]=J.u,this.coords[K+1]=J.v,this.coords[K+2]=Q.u,this.coords[K+3]=Q.v,this.coords[K+4]=q.u,this.coords[K+5]=q.v,this.numTris++,!0}pushTriWithUV(J,Q,q,Y,Z,K,X,W,z){if(this.numTris>=this.maxTris)return!1;var F=this.numTris*3*4,N=this.numTris*3*1,G=this.numTris*3*2,P=J.pos,L=Q.pos,U=q.pos;return this.positions[F+0]=P.x,this.positions[F+1]=P.y,this.positions[F+2]=P.z,this.positions[F+3]=P.w,this.positions[F+4]=L.x,this.positions[F+5]=L.y,this.positions[F+6]=L.z,this.positions[F+7]=L.w,this.positions[F+8]=U.x,this.positions[F+9]=U.y,this.positions[F+10]=U.z,this.positions[F+11]=U.w,this.colours[N+0]=J.color,this.colours[N+1]=Q.color,this.colours[N+2]=q.color,this.coords[G+0]=Y,this.coords[G+1]=Z,this.coords[G+2]=K,this.coords[G+3]=X,this.coords[G+4]=W,this.coords[G+5]=z,this.numTris++,!0}}var IH=function(J){return{r:(J>>>11&31)/31,g:(J>>>6&31)/31,b:(J>>>1&31)/31,a:(J>>>0&1)/1}},_X=function(J){return{r:(J>>>24&255)/255,g:(J>>>16&255)/255,b:(J>>>8&255)/255,a:(J>>>0&255)/255}},DH=!0,bX=new Map,TX=new Map;class jJ{constructor(J,Q){this.state=J,this.ramDV=Q,this.vertexStride=2,this.version="",this.triangleBuffer=new Bq(64),this.onLoadUcodeHandler=null,this.gbiCommonCommands=new Map([[228,this.executeTexRect.bind(this)],[229,this.executeTexRectFlip.bind(this)],[230,this.executeRDPLoadSync.bind(this)],[231,this.executeRDPPipeSync.bind(this)],[232,this.executeRDPTileSync.bind(this)],[233,this.executeRDPFullSync.bind(this)],[234,this.executeSetKeyGB.bind(this)],[235,this.executeSetKeyR.bind(this)],[236,this.executeSetConvert.bind(this)],[237,this.executeSetScissor.bind(this)],[238,this.executeSetPrimDepth.bind(this)],[239,this.executeSetRDPOtherMode.bind(this)],[240,this.executeLoadTLut.bind(this)],[242,this.executeSetTileSize.bind(this)],[243,this.executeLoadBlock.bind(this)],[244,this.executeLoadTile.bind(this)],[245,this.executeSetTile.bind(this)],[246,this.executeFillRect.bind(this)],[247,this.executeSetFillColor.bind(this)],[248,this.executeSetFogColor.bind(this)],[249,this.executeSetBlendColor.bind(this)],[250,this.executeSetPrimColor.bind(this)],[251,this.executeSetEnvColor.bind(this)],[252,this.executeSetCombine.bind(this)],[253,this.executeSetTImg.bind(this)],[254,this.executeSetZImg.bind(this)],[255,this.executeSetCImg.bind(this)]])}buildCommandTable(){const J=[];for(let Q=0;Q<256;++Q){let q=this.getHandler(Q);if(!q)q=this.executeUnknown.bind(this);J.push(q)}return J}getHandler(J){const Q=this.gbiCommonCommands.get(J);if(Q)return Q;return null}onLoadUcode(J){this.onLoadUcodeHandler=J}executeUnknown(J,Q){this.warn(`Unknown display list op ${M0(J>>>24)}`,`cmd0 ${j(J)}, cmd1 ${j(Q)}`)}warnUnimplemented(J){this.warn(J,"unimplemented")}warn(J,Q){if(TX.get(J))return;TX.set(J,!0);const q=Q!==void 0?`${J}: ${Q}`:J;if(K6.haltOnWarning)this.hleHalt(q);else n64js.warn(q)}loadMatrix(J,Q){const Y=new DataView(this.ramDV.buffer,J);if(Q!=64)this.warn("Unusual matrix length",`${Q}`);const Z=new Float32Array(16);for(let K=0;K<4;++K)Z[0+K]=(Y.getInt16(K*8+0)<<16|Y.getUint16(K*8+0+32))*0.0000152587890625,Z[4+K]=(Y.getInt16(K*8+2)<<16|Y.getUint16(K*8+2+32))*0.0000152587890625,Z[8+K]=(Y.getInt16(K*8+4)<<16|Y.getUint16(K*8+4+32))*0.0000152587890625,Z[12+K]=(Y.getInt16(K*8+6)<<16|Y.getUint16(K*8+6+32))*0.0000152587890625;return new D0(Z)}previewMatrix(J){const Q=J.elems,q=[Q[0],Q[1],Q[2],Q[3]],Y=[Q[4],Q[5],Q[6],Q[7]],Z=[Q[8],Q[9],Q[10],Q[11]],K=[Q[12],Q[13],Q[14],Q[15]];return`<div><table class="matrix-table">
      <tr><td>${q.join("</td><td>")}</td></tr>
      <tr><td>${Y.join("</td><td>")}</td></tr>
      <tr><td>${Z.join("</td><td>")}</td></tr>
      <tr><td>${K.join("</td><td>")}</td></tr>
    </table></div>`}loadViewport(J){const Q=new X0(+this.ramDV.getInt16(J+0)/4,-this.ramDV.getInt16(J+2)/4,+this.ramDV.getInt16(J+4)),q=new X0(this.ramDV.getInt16(J+8)/4,this.ramDV.getInt16(J+10)/4,this.ramDV.getInt16(J+12));this.state.viewport.set(Q,q)}previewViewport(J){const Q=new X0(this.ramDV.getInt16(J+0)/4,this.ramDV.getInt16(J+2)/4,this.ramDV.getInt16(J+4)),q=new X0(this.ramDV.getInt16(J+8)/4,this.ramDV.getInt16(J+10)/4,this.ramDV.getInt16(J+12));let Y="";return Y+=`scale = (${Q.x}, ${Q.y}, ${Q.z}) `,Y+=`trans = (${q.x}, ${q.y}, ${q.z}) `,Y}loadLight(J,Q){if(J>=this.state.lights.length){M(`light index ${J} out of range`);return}this.state.lights[J].color=_X(this.ramDV.getUint32(Q+0)),this.state.lights[J].dir=X0.create([this.ramDV.getInt8(Q+8),this.ramDV.getInt8(Q+9),this.ramDV.getInt8(Q+10)]).normaliseInPlace()}previewLight(J){let Q="";Q+=`color = ${b6(this.ramDV.getUint32(J+0))} `,Q+=`colorCopy = ${b6(this.ramDV.getUint32(J+4))} `;const q=X0.create([this.ramDV.getInt8(J+8),this.ramDV.getInt8(J+9),this.ramDV.getInt8(J+10)]).normaliseInPlace();return Q+=`norm = (${q.x}, ${q.y}, ${q.z})`,Q}loadVertices(J,Q,q,Y){const Z=this.state.geometryMode.lighting,K=this.state.geometryMode.textureGen,X=this.state.geometryMode.textureGenLinear,W=new DataView(this.ramDV.buffer,q);if(Y)this.previewVertex(J,Q,W,Y,Z);if(J+Q>=this.state.projectedVertices.length){this.warn("Too many verts");return}const z=this.state.modelview[this.state.modelview.length-1],N=this.state.projection[this.state.projection.length-1].multiply(z),G=this.state.texture.scaleS/32,P=this.state.texture.scaleT/32,L=new X0,U=new X0,E=new X0,A=this.renderer.nativeTransform.viTransform,C=this.state.viewport.transform,D=16;for(let u=0;u<Q;++u){const n=u*D,d=this.state.projectedVertices[J+u];if(d.set=!0,L.x=W.getInt16(n+0),L.y=W.getInt16(n+2),L.z=W.getInt16(n+4),d.u=W.getInt16(n+8)*G,d.v=W.getInt16(n+10)*P,d.color=W.getUint32(n+12,!0),this.projectInPlace(d,L,N,C,A),Z){if(this.unpackNormal(U,d.color),z.transformNormal(U,E),E.normaliseInPlace(),d.color=this.calculateLighting(E,255),K)if(X)d.calculateLinearUV(E);else d.calculateSphericalUV(E)}}}projectInPlace(J,Q,q,Y,Z){const K=J.pos;q.transformPoint(Q,K),J.clipFlags=this.calculateClipFlags(K);const X=K.w;K.scaleInPlace(1/X),Y.transformInPlace(K),Z.invTransformInPlace(K),K.scaleInPlace(X)}calculateClipFlags(J){let Q=0;if(J.x<-J.w)Q|=$9;else if(J.x>J.w)Q|=K9;if(J.y<-J.w)Q|=z9;else if(J.y>J.w)Q|=X9;if(J.z<-J.w)Q|=H9;else if(J.z>J.w)Q|=W9;return Q}unpackNormal(J,Q){J.x=Q<<24>>24,J.y=Q<<16>>24,J.z=Q<<8>>24}calculateLighting(J,Q){const q=this.state.numLights;let Y=this.state.lights[q].color.r,Z=this.state.lights[q].color.g,K=this.state.lights[q].color.b;for(let X=0;X<q;++X){const W=this.state.lights[X],z=J.dot(W.dir);if(z>0)Y+=W.color.r*z,Z+=W.color.g*z,K+=W.color.b*z}return Y=Math.min(Y,1)*255,Z=Math.min(Z,1)*255,K=Math.min(K,1)*255,Q<<24|K<<16|Z<<8|Y}previewVertex(J,Q,q,Y,Z){const K=["#","x","y","z","?","u","v",Z?"norm":"rgba"];let X="";X+='<table class="vertex-table">',X+=`<tr><th>${K.join("</th><th>")}</th></tr>\n`;for(let W=0;W<Q;++W){const z=W*16,F=Z?`${q.getInt8(z+12)},${q.getInt8(z+13)},${q.getInt8(z+14)}`:b6(q.getUint32(z+12)),N=[J+W,q.getInt16(z+0),q.getInt16(z+2),q.getInt16(z+4),q.getInt16(z+6),q.getInt16(z+8),q.getInt16(z+10),F];X+=`<tr><td>${N.join("</td><td>")}</td></tr>\n`}X+="</table>",Y.tip(X)}executeNoop(J,Q,q){if(q)q.text("gsDPNoOp();")}executeSpNoop(J,Q,q){if(q)q.text("gsSPNoOp();")}executeLoadUcode(J,Q,q){const Y=Q&268435455,K=this.state.rdpHalf1,X=(J&65535)+1;let W="?";if(this.onLoadUcodeHandler){const z=this.onLoadUcodeHandler(Y,4096,K,X);z.onLoadUcode(this.onLoadUcodeHandler),W=z.version}else this.warn("No loadUcodeHandler set!");if(q)q.text(`gsSPLoadUCode(${j(Y)}, 4096, ${j(K)} ${X}); // ${W}`)}executeRDPHalf1(J,Q,q){if(q)q.text(`gsImmp1(G_RDPHALF_1, ${j(Q)});`);this.state.rdpHalf1=Q}executeRDPHalf2(J,Q,q){if(q)q.text(`gsImmp1(G_RDPHALF_2, ${j(Q)});`);this.state.rdpHalf2=Q}executeRDPLoadSync(J,Q,q){if(q)q.text("gsDPLoadSync();")}executeRDPPipeSync(J,Q,q){if(q)q.text("gsDPPipeSync();")}executeRDPTileSync(J,Q,q){if(q)q.text("gsDPTileSync();")}executeRDPFullSync(J,Q,q){if(q)q.text("gsDPFullSync();")}executeSetKeyGB(J,Q,q){if(q)q.text("gsDPSetKeyGB(???);")}executeSetKeyR(J,Q,q){if(q)q.text("gsDPSetKeyR(???);")}executeSetConvert(J,Q,q){if(q)q.text("gsDPSetConvert(???);")}executeSetScissor(J,Q,q){const Y=(J>>>12&4095)/4,Z=(J>>>0&4095)/4,K=(Q>>>12&4095)/4,X=(Q>>>0&4095)/4,W=Q>>>24&2;if(q)q.text(`gsDPSetScissor(${NX.nameOf(W)}, ${Y}, ${Z}, ${K}, ${X});`);this.state.scissor.x0=Y,this.state.scissor.y0=Z,this.state.scissor.x1=K,this.state.scissor.y1=X,this.state.scissor.mode=W}executeSetRDPOtherMode(J,Q,q){if(q)q.text(`gsDPSetOtherMode(${j(J)}, ${j(Q)}); // TODO: fix formatting`);this.state.rdpOtherModeH=J,this.state.rdpOtherModeL=Q}executeSetTile(J,Q,q){const Y=J>>>21&7,Z=J>>>19&3,K=J>>>9&511,X=J>>>0&511,W=Q>>>24&7,z=Q>>>20&15,F=Q>>>18&3,N=Q>>>14&15,G=Q>>>10&15,P=Q>>>8&3,L=Q>>>4&15,U=Q>>>0&15;if(this.state.tiles[W].set(Y,Z,K,X,z,P,L,U,F,N,G),q){const A=Z0.nameOf(Y),C=g.nameOf(Z),D=E0(W),u=h8(P),n=h8(F);q.text(`gsDPSetTile(${A}, ${C}, ${K}, ${X}, ${D}, ${z}, ${n}, ${N}, ${G}, ${u}, ${L}, ${U});`)}}executeSetTileSize(J,Q,q){const Y=J>>>12&4095,Z=J>>>0&4095,K=Q>>>24&7,X=Q>>>12&4095,W=Q>>>0&4095,z=this.state.tiles[K];if(z.setSize(Y,Z,X,W),q){const F=E0(K);q.text(`gsDPSetTileSize(${F}, ${z.left}, ${z.top}, ${z.right}, ${z.bottom});`),q.tip(`size (${z.width} x ${z.height}), unmasked (${z.unmaskedWidth} x ${z.unmaskedHeight})`)}}executeSetFillColor(J,Q,q){if(q)q.text(`gsDPSetFillColor(${q.rgba8888(Q)}); // hi as 5551 = ${q.rgba5551(Q>>>16)}, lo as 5551 = ${q.rgba5551(Q&65535)} `);this.state.fillColor=Q}executeSetFogColor(J,Q,q){if(q)q.text(`gsDPSetFogColor(${q.rgba8888(Q)});`);this.state.fogColor=Q}executeSetBlendColor(J,Q,q){if(q)q.text(`gsDPSetBlendColor(${q.rgba8888(Q)});`);this.state.blendColor=Q}executeSetPrimColor(J,Q,q){if(q){const Y=J>>>8&255,Z=J>>>0&255;q.text(`gsDPSetPrimColor(${Y}, ${Z}, ${q.rgba8888(Q)});`)}this.state.primColor=Q}executeSetPrimDepth(J,Q,q){const Y=Q>>>16&65535,Z=Q&65535;if(q)q.text(`gsDPSetPrimDepth(${Y},${Z});`)}executeSetEnvColor(J,Q,q){if(q)q.text(`gsDPSetEnvColor(${q.rgba8888(Q)});`);this.state.envColor=Q}executeSetCombine(J,Q,q){if(q){const Y=J&16777215,Z=Q,K=T9(Y,Z);q.text(`gsDPSetCombine(${j(Y)}, ${j(Z)});\n${K}`)}this.state.combine.hi=J&16777215,this.state.combine.lo=Q}executeSetTImg(J,Q,q){const Y=J>>>21&7,Z=J>>>19&3,K=(J>>>0&4095)+1,X=this.state.rdpSegmentAddress(Q);if(q)q.text(`gsDPSetTextureImage(${Z0.nameOf(Y)}, ${g.nameOf(Z)}, ${K}, ${j(X)});`);this.state.textureImage.set(Y,Z,K,X)}executeSetZImg(J,Q,q){const Y=this.state.rdpSegmentAddress(Q);if(q)q.text(`gsDPSetDepthImage(${j(Y)});`);this.state.depthImage.address=Y}executeSetCImg(J,Q,q){const Y=J>>>21&7,Z=J>>>19&3,K=(J>>>0&4095)+1,X=this.state.rdpSegmentAddress(Q);if(q)q.text(`gsDPSetColorImage(${Z0.nameOf(Y)}, ${g.nameOf(Z)}, ${K}, ${j(X)});`);if(this.state.colorImage={format:Y,size:Z,width:K,address:X},DH&&!bX.get(X))M(`Setting colorImage to ${j(X)}, ${K}, size ${g.nameOf(Z)}, format ${Z0.nameOf(Y)}`),bX.set(X,!0)}executeLoadBlock(J,Q,q){const Y=Q>>>24&7,Z=Q>>>12&4095,K=Q>>>0&4095,X=J>>>12&4095,W=J>>>0&4095;if(X!==0)this.warn("Unexpected non-zero uls in load block");if(W!==0)this.warn("Unexpected non-zero ult in load block");const z=this.state.tiles[Y],F=X>>>2,N=W>>>2,G=this.state.textureImage.calcAddress(F,N),P=Z-X+1&4095,L=this.state.textureImage.texelsToBytes(P),U=L+7>>>3;if(q){const E=E0(Y);q.text(`gsDPLoadBlock(${E}, ${X}, ${W}, ${Z}, ${K});`),q.tip(`bytes ${L}, qwords ${U}`)}this.state.tmem.loadBlock(z,G,K,U),this.state.invalidateTileHashes()}executeLoadTile(J,Q,q){const Y=Q>>>24&7,Z=J>>>12&4095,K=J>>>0&4095,X=Q>>>12&4095,W=Q>>>0&4095,z=this.state.tiles[Y],F=this.state.textureImage;if(q){const N=E0(Y);q.text(`gsDPLoadTile(${N}, ${Z/4}, ${K/4}, ${X/4}, ${W/4});`)}this.state.tmem.loadTile(F,z,Z,K,X,W,q),this.state.invalidateTileHashes()}executeLoadTLut(J,Q,q){const Y=Q>>>24&7,Z=Q>>>14&1023,K=J>>>12&4095,X=J>>>0&4095,W=Q>>>12&4095,z=Q>>>0&4095;if(q){const P=E0(Y);q.text(`gsDPLoadTLUTCmd(${P}, ${Z}); //${K}, ${X}, ${W}, ${z}`)}const F=this.state.textureImage.calcAddress(K>>>2,X>>>2,g.G_IM_SIZ_16b),N=this.state.tiles[Y],G=S9(W,K);this.state.tmem.loadTLUT(N,F,G),this.state.invalidateTileHashes()}executeFillRect(J,Q,q){const Y=(Q>>>12&4095)>>>2,Z=(Q>>>0&4095)>>>2;let K=(J>>>12&4095)>>>2,X=(J>>>0&4095)>>>2;const W=this.gl;if(q)q.text(`gsDPFillRectangle(${Y}, ${Z}, ${K}, ${X});`);if(this.state.depthImage.address==this.state.colorImage.address){W.clearDepth(1),W.depthMask(!0),W.clear(W.DEPTH_BUFFER_BIT);return}const z=this.state.getCycleType();let F={r:0,g:0,b:0,a:0};if(z===K0.G_CYC_FILL){if(K+=1,X+=1,this.state.colorImage.size===g.G_IM_SIZ_16b)F=IH(this.state.fillColor&65535);else F=_X(this.state.fillColor);const N=K-Y,G=X-Z;if(N===this.renderer.nativeTransform.viWidth&&G===this.renderer.nativeTransform.viHeight){W.clearColor(F.r,F.g,F.b,F.a),W.clear(W.COLOR_BUFFER_BIT);return}}else if(z===K0.G_CYC_COPY)K+=1,X+=1;this.renderer.fillRect(Y,Z,K,X,F)}executeTexRect(J,Q,q){this.state.nextCommand();const Y=this.state.cmd1;this.state.nextCommand();const Z=this.state.cmd1;let K=(J>>>12&4095)/4,X=(J>>>0&4095)/4;const W=Q>>>24&7,z=(Q>>>12&4095)/4,F=(Q>>>0&4095)/4;let N=(Y>>>16&65535)/32,G=(Y>>>0&65535)/32,P=((Z|0)>>16)/1024;const L=(Z<<16>>16)/1024,U=this.state.getCycleType();if(U===K0.G_CYC_COPY)P*=0.25;if(U===K0.G_CYC_COPY||U===K0.G_CYC_FILL)K+=1,X+=1;if(P<0)N++;if(L<0)G++;const E=N+P*(K-z),A=G+L*(X-F);if(q){const C=E0(W);q.text(`gsSPTextureRectangle(${z},${F},${K},${X},${C},${N},${G},${P},${L});`),q.tip(`cmd2 = ${j(Y)}, cmd3 = ${j(Z)}`),q.tip(`st0 = (${N}, ${G}) st1 = (${E}, ${A})`)}this.renderer.texRect(W,z,F,K,X,N,G,E,A,!1)}executeTexRectFlip(J,Q,q){this.state.nextCommand();const Y=this.state.cmd1;this.state.nextCommand();const Z=this.state.cmd1;let K=(J>>>12&4095)/4,X=(J>>>0&4095)/4;const W=Q>>>24&7,z=(Q>>>12&4095)/4,F=(Q>>>0&4095)/4;let N=(Y>>>16&65535)/32,G=(Y>>>0&65535)/32,P=((Z|0)>>16)/1024;const L=(Z<<16>>16)/1024,U=this.state.getCycleType();if(U===K0.G_CYC_COPY)P*=0.25;if(U===K0.G_CYC_COPY||U===K0.G_CYC_FILL)K+=1,X+=1;if(P<0)N++;if(L<0)G++;const E=N+P*(X-F),A=G+L*(K-z);if(q){const C=E0(W);q.text(`gsSPTextureRectangleFlip(${z},${F},${K},${X},${C},${N},${G},${P},${L});`),q.tip(`cmd2 = ${j(Y)}, cmd3 = ${j(Z)}`),q.tip(`st0 = (${N}, ${G}) st1 = (${E}, ${A})`)}this.renderer.texRect(W,z,F,K,X,N,G,E,A,!0)}executeCullDL(J,Q,q){const Y=(J&65535)>>>1,Z=(Q&65535)>>>1,K=this.testClipFlags(Y,Z);if(q)q.text(`gSPCullDisplayList(${Y}, ${Z}); // ${K?"continue":"end"}`);if(!K)this.state.endDisplayList()}testClipFlags(J,Q){if(Q<=J)return this.warn("begin and end vertices for testClipFlags are inverted or empty"),!0;if(Q>=this.state.projectedVertices.length)return this.warn("end vertex for testClipFlags is out of bounds"),!0;let q=~0;for(let Y=J;Y<=Q;Y++)q&=this.state.projectedVertices[Y].clipFlags;return q==0}calcTextureScale(J){if(J===0||J===65535)return 1;return J/65536}}var v9=!1;class v6 extends jJ{constructor(J,Q){super(J,Q);this.vertexStride=2,this.gbi1Commands=new Map([[0,this.executeSpNoop.bind(this)],[1,this.executeMatrix.bind(this)],[3,this.executeMoveMem.bind(this)],[4,this.executeVertex.bind(this)],[6,this.executeDL.bind(this)],[9,this.executeSprite2DBase.bind(this)],[175,this.executeLoadUcode.bind(this)],[176,this.executeBranchZ.bind(this)],[177,this.executeTri2.bind(this)],[178,this.executeModifyVertex.bind(this)],[179,this.executeRDPHalf2.bind(this)],[180,this.executeRDPHalf1.bind(this)],[181,this.executeLine3D.bind(this)],[182,this.executeClearGeometryMode.bind(this)],[183,this.executeSetGeometryMode.bind(this)],[184,this.executeEndDL.bind(this)],[185,this.executeSetOtherModeL.bind(this)],[186,this.executeSetOtherModeH.bind(this)],[187,this.executeTexture.bind(this)],[188,this.executeMoveWord.bind(this)],[189,this.executePopMatrix.bind(this)],[190,this.executeCullDL.bind(this)],[191,this.executeTri1.bind(this)],[192,this.executeNoop.bind(this)]])}getHandler(J){const Q=this.gbi1Commands.get(J);if(Q)return Q;return super.getHandler(J)}executeDL(J,Q,q){const Y=J>>>16&255,Z=this.state.rdpSegmentAddress(Q);if(q){const K=Y===U8?"gsSPDisplayList":"gsSPBranchList";q.text(`${K}(<span class="dl-branch">${j(Z)}</span>);`)}if(Y===U8)this.state.pushDisplayList(Z);else this.state.branchDisplayList(Z)}executeEndDL(J,Q,q){if(q)q.text("gsSPEndDisplayList();");this.state.endDisplayList()}executeBranchZ(J,Q,q){const Y=this.state.rdpSegmentAddress(this.state.rdpHalf1);if(this.warnUnimplemented("BranchLessZ"),q)q.text("gsSPBranchLessZ(/* TODO */);");this.state.branchDisplayList(Y)}executeClearGeometryMode(J,Q,q){if(q)q.text(`gsSPClearGeometryMode(${O8(d0,Q)});`);this.state.geometryModeBits&=~Q,this.state.updateGeometryModeFromBits(d0)}executeSetGeometryMode(J,Q,q){if(q)q.text(`gsSPSetGeometryMode(${O8(d0,Q)});`);this.state.geometryModeBits|=Q,this.state.updateGeometryModeFromBits(d0)}executeSetOtherModeL(J,Q,q){const Y=J>>>8&255,Z=J>>>0&255,K=Q,X=(1<<Z)-1<<Y>>>0;if(q)E9(q,X,K);this.state.rdpOtherModeL=this.state.rdpOtherModeL&~X|K}executeSetOtherModeH(J,Q,q){const Y=J>>>8&255,Z=J>>>0&255,K=Q,X=(1<<Z)-1<<Y>>>0;if(q)A9(q,X,Z,Y,K);this.state.rdpOtherModeH=this.state.rdpOtherModeH&~X|K}executeTexture(J,Q,q){const Y=J>>>16&255,Z=J>>>11&3,K=J>>>8&7,X=J>>>0&255,W=this.calcTextureScale(Q>>>16&65535),z=this.calcTextureScale(Q>>>0&65535);if(q){const F=W.toString(),N=z.toString(),G=E0(K),P=X?"G_ON":"G_OFF";if(Y!==0)q.text(`gsSPTextureL(${F}, ${N}, ${Z}, ${Y}, ${G}, ${P});`);else q.text(`gsSPTexture(${F}, ${N}, ${Z}, ${G}, ${P});`)}if(this.state.setTexture(W,z,Z,K),X)this.state.geometryModeBits|=d0.G_TEXTURE_ENABLE;else this.state.geometryModeBits&=~d0.G_TEXTURE_ENABLE;this.state.updateGeometryModeFromBits(d0)}executeMatrix(J,Q,q){const Y=J>>>16&255,Z=J>>>0&65535,K=this.state.rdpSegmentAddress(Q);let X=this.loadMatrix(K,Z);if(q){let z="";z+=Y&Y9?"G_MTX_PROJECTION":"G_MTX_MODELVIEW",z+=Y&Lq?"|G_MTX_LOAD":"|G_MTX_MUL",z+=Y&Pq?"|G_MTX_PUSH":"",q.text(`gsSPMatrix(${j(K)}, ${z});`),q.tip(this.previewMatrix(X))}const W=Y&Y9?this.state.projection:this.state.modelview;if((Y&Lq)==0)X=W[W.length-1].multiply(X);if(Y&Pq)W.push(X);else W[W.length-1]=X}executePopMatrix(J,Q,q){const Y=Q>>>0&255;if(q){let Z="";Z+=Y&Y9?"G_MTX_PROJECTION":"G_MTX_MODELVIEW",q.text(`gsSPPopMatrix(${Z});`)}if(this.state.modelview.length>0)this.state.modelview.pop()}executeVertex(J,Q,q){const Y=(J>>>16&255)/this.vertexStride,Z=J>>>10&63,K=this.state.rdpSegmentAddress(Q);if(q)q.text(`gsSPVertex(${j(K)}, ${Y}, ${Z});`);this.loadVertices(Y,Z,K,q)}executeModifyVertex(J,Q,q){if(this.warnUnimplemented("ModifyVertex"),q)q.text("gsSPModifyVertex(???);")}executeSprite2DBase(J,Q,q){if(this.warnUnimplemented("Sprite2DBase"),q)q.text("gsSPSprite2DBase(/* TODO */);")}executeMoveMem(J,Q,q){const Y=J>>>16&255,Z=J>>>0&65535,K=this.state.rdpSegmentAddress(Q);if(q){const X=j(K),W=z0.nameOf(Y);let z=`gsDma1p(G_MOVEMEM, ${X}, ${Z}, ${W});`;switch(Y){case z0.G_MV_VIEWPORT:if(Z===16)z=`gsSPViewport(${X});`;break}q.text(z),this.previewMoveMem(Y,Z,K,q)}switch(Y){case z0.G_MV_VIEWPORT:this.loadViewport(K);break;case z0.G_MV_L0:case z0.G_MV_L1:case z0.G_MV_L2:case z0.G_MV_L3:case z0.G_MV_L4:case z0.G_MV_L5:case z0.G_MV_L6:case z0.G_MV_L7:{const X=(Y-z0.G_MV_L0)/2;this.loadLight(X,K)}break}}previewMoveMem(J,Q,q,Y){let Z="";for(let K=0;K<Q;++K)Z+=B(this.ramDV.getUint8(q+K),8)+" ";switch(Z+="<br>",J){case z0.G_MV_VIEWPORT:Z+=this.previewViewport(q);break;case z0.G_MV_L0:case z0.G_MV_L1:case z0.G_MV_L2:case z0.G_MV_L3:case z0.G_MV_L4:case z0.G_MV_L5:case z0.G_MV_L6:case z0.G_MV_L7:Z+=this.previewLight(q);break}Y.tip(Z)}executeMoveWord(J,Q,q){const Y=J&255,Z=J>>>8&65535,K=Q;let X="";switch(Y){case j0.G_MW_MATRIX:this.warnUnimplemented("MoveWord Matrix");break;case j0.G_MW_NUMLIGHT:{let W=(K-2147483648>>>5)-1;if(q){if(Z===jX)X=`gsSPNumLights(${N9.nameOf(W)});`}this.state.numLights=W}break;case j0.G_MW_CLIP:if(q)X=`gSPClipRatio(${Z9.nameOf(Z)}, ${F9.nameOf(K)});`;break;case j0.G_MW_SEGMENT:{const W=Z>>>2&15;if(q)X=`gsSPSegment(${j9.nameOf(W)}, ${j(K)});`;this.state.segments[W]=K}break;case j0.G_MW_FOG:{const W=Q>>16,z=Q&65535;if(q)X=`gSPFogPosition(${W}, ${z});`;this.state.fogParameters.set(W,z)}break;case j0.G_MW_LIGHTCOL:this.warnUnimplemented("MoveWord LightCol");break;case j0.G_MW_POINTS:this.warnUnimplemented("MoveWord Points");break;case j0.G_MW_PERSPNORM:if(q)X=`gSPPerspNormalize(${K});`;break;default:this.warnUnimplemented("MoveWord Unknown");break}if(q){if(!X)X=`gMoveWd(${j0.nameOf(Y)}, ${x(Z)}, ${j(K)});`;q.text(X)}}executeTri1(J,Q,q){const Y=this.vertexStride,Z=this.state.projectedVertices,K=this.triangleBuffer;K.reset();let X=q?1:0,W=this.state.executeBatch(X,(z,F)=>{const N=F>>>24&255,G=(F>>>16&255)/Y,P=(F>>>8&255)/Y,L=(F>>>0&255)/Y;if(q)q.text(`gsSP1Triangle(${G}, ${P}, ${L}, ${N});`);return K.pushTri(Z[G],Z[P],Z[L]),K.hasCapacity(1)});this.debugController.currentOp+=W-1,this.renderer.flushTris(K)}executeTri2(J,Q,q){const Y=this.vertexStride,Z=this.state.projectedVertices,K=this.triangleBuffer;K.reset();let X=q?1:0,W=this.state.executeBatch(X,(z,F)=>{const N=(z>>>16&255)/Y,G=(z>>>8&255)/Y,P=(z>>>0&255)/Y,L=(F>>>16&255)/Y,U=(F>>>8&255)/Y,E=(F>>>0&255)/Y;if(q)q.text(`gsSP1Triangle2(${N},${G},${P}, ${L},${U},${E});`);return K.pushTri(Z[N],Z[G],Z[P]),K.pushTri(Z[L],Z[U],Z[E]),K.hasCapacity(2)});this.debugController.currentOp+=W-1,this.renderer.flushTris(K)}executeLine3D(J,Q,q){const Y=this.vertexStride,Z=this.state.projectedVertices,K=this.triangleBuffer;K.reset();let X=q?1:0,W=this.state.executeBatch(X,(z,F)=>{const N=(F>>>24&255)/Y,G=(F>>>16&255)/Y,P=(F>>>8&255)/Y,L=(F>>>0&255)/Y;if(q)q.text(`gsSPLine3D(${G}, ${P}, ${L}, ${N});`);if(G<Z.length&&P<Z.length&&L<Z.length)K.pushTri(Z[G],Z[P],Z[L]);else if(!v9)console.log(`verts out of bounds, ignoring: ${G}, ${P}, ${L} vs ${Z.length}, stride ${Y}`),v9=!0;if(L<Z.length&&N<Z.length&&G<Z.length)K.pushTri(Z[L],Z[N],Z[G]);else if(!v9)console.log(`verts out of bounds, ignoring: ${L}, ${N}, ${G} vs ${Z.length}, stride ${Y}`),v9=!0;return K.hasCapacity(2)});this.debugController.currentOp+=W-1,this.renderer.flushTris(K)}}class Rq extends v6{constructor(J,Q){super(J,Q);this.vertexStride=2}}class X6 extends v6{constructor(J,Q){super(J,Q);this.vertexStride=10,this.gbi0Commands=new Map([[176,this.executeUnknown.bind(this)],[177,this.executeTri4.bind(this)],[178,this.executeRDPHalf_Cont.bind(this)]])}getHandler(J){const Q=this.gbi0Commands.get(J);if(Q)return Q;return super.getHandler(J)}executeCullDL(J,Q,q){const Y=(J&16777215)/40&15,Z=Q/40&15,K=this.testClipFlags(Y,Z);if(q)q.text(`gSPCullDisplayList(${Y}, ${Z}); // ${K?"continue":"end"}`);if(!K)this.state.endDisplayList()}executeVertex(J,Q,q){const Y=(J>>>20&15)+1,Z=J>>>16&15,K=this.state.rdpSegmentAddress(Q);if(q)q.text(`gsSPVertex(${j(K)}, ${Z}, ${Y});`);this.loadVertices(Z,Y,K,q)}executeRDPHalf_Cont(J,Q,q){if(this.warnUnimplemented("RDPHalf_Cont"),q)q.text("gsDPHalf_Cont(/* TODO */);")}executeRDPHalf1Goldeneye(J,Q,q){if(this.warnUnimplemented("executeRDPHalf1"),q)q.text("gsSPRDPHalf();")}executeTri4(J,Q,q){const Y=this.state.projectedVertices,Z=this.triangleBuffer;Z.reset();let K=q?1:0,X=this.state.executeBatch(K,(W,z)=>{const F=W>>>12&15,N=W>>>8&15,G=W>>>4&15,P=W>>>0&15,L=z>>>28&15,U=z>>>24&15,E=z>>>20&15,A=z>>>16&15,C=z>>>12&15,D=z>>>8&15,u=z>>>4&15,n=z>>>0&15;if(q)q.text(`gsSP1Triangle4(${P},${n},${u}, ${G},${D},${C}, ${N},${A},${E}, ${F},${U},${L});`);if(P!==n)Z.pushTri(Y[P],Y[n],Y[u]);if(G!==D)Z.pushTri(Y[G],Y[D],Y[C]);if(N!==A)Z.pushTri(Y[N],Y[A],Y[E]);if(F!==U)Z.pushTri(Y[F],Y[U],Y[L]);return Z.hasCapacity(4)});this.debugController.currentOp+=X-1,this.renderer.flushTris(Z)}}class bq extends X6{constructor(J,Q){super(J,Q);this.vertexStride=10,this.geCommands=new Map([[180,this.executeRDPHalf1Goldeneye.bind(this)]])}getHandler(J){const Q=this.geCommands.get(J);if(Q)return Q;return super.getHandler(J)}}class Tq extends X6{constructor(J,Q){super(J,Q);this.vertexStride=10,this.auxAddress=0,this.pdCommands=new Map([[7,this.executeSetVertexColorIndex.bind(this)],[180,this.executeRDPHalf1Goldeneye.bind(this)]])}getHandler(J){const Q=this.pdCommands.get(J);if(Q)return Q;return super.getHandler(J)}executeSetVertexColorIndex(J,Q,q){const Y=this.state.rdpSegmentAddress(Q);if(q)q.text(`gsSPSetVertexColorIndex(${j(Y)});`);this.auxAddress=Y}loadVertices(J,Q,q,Y){const Z=this.state.geometryMode.lighting,K=this.state.geometryMode.textureGen,X=this.state.geometryMode.textureGenLinear,W=new DataView(this.ramDV.buffer,q),z=new DataView(this.ramDV.buffer,this.auxAddress);if(Y)this.previewVertex(J,Q,W,Y,Z);if(J+Q>=this.state.projectedVertices.length){this.warn("Too many verts");return}const F=12,N=this.state.modelview[this.state.modelview.length-1],P=this.state.projection[this.state.projection.length-1].multiply(N),L=this.state.texture.scaleS/32,U=this.state.texture.scaleT/32,E=new X0,A=new X0,C=new X0,D=this.renderer.nativeTransform.viTransform,u=this.state.viewport.transform;for(let n=0;n<Q;++n){const d=n*F,H0=this.state.projectedVertices[J+n];H0.set=!0,E.x=W.getInt16(d+0),E.y=W.getInt16(d+2),E.z=W.getInt16(d+4);const k0=W.getUint8(d+7);if(H0.u=W.getInt16(d+8)*L,H0.v=W.getInt16(d+10)*U,H0.color=z.getUint32(k0+0,!0),this.projectInPlace(H0,E,P,u,D),Z){const n8=H0.color&255;if(this.unpackNormal(A,H0.color),N.transformNormal(A,C),C.normaliseInPlace(),H0.color=this.calculateLighting(C,n8),X)H0.calculateLinearUV(C);else if(K)H0.calculateSphericalUV(C)}}}}class _q extends X6{constructor(J,Q){super(J,Q);this.vertexStride=5}executeVertex(J,Q,q){const Y=J>>>9&127,Z=(J>>>16&255)/5,K=this.state.rdpSegmentAddress(Q);if(q)q.text(`gsSPVertex(${j(K)}, ${Z}, ${Y});`);this.loadVertices(Z,Y,K,q)}}class Sq extends X6{constructor(J,Q){super(J,Q);this.vertexStride=5}executeVertex(J,Q,q){const Y=(J>>>4&4095)/33+1,K=this.state.rdpSegmentAddress(Q);if(q)q.text(`gsSPVertex(${j(K)}, 0, ${Y});`);this.loadVertices(0,Y,K,q)}}class vq extends X6{constructor(J,Q){super(J,Q);this.vertexStride=10,this.matrixAddress=0,this.matrixIndex=0,this.matrixArray=[D0.identity(),D0.identity(),D0.identity(),D0.identity()],this.vertexAddress=0,this.vertexOffset=0,this.billboardMode=!1,this.dkrCommands=new Map([[5,this.executeTriDMA.bind(this)],[7,this.executeDisplayListLen.bind(this)],[191,this.executeSetAddresses.bind(this)]])}getHandler(J){const Q=this.dkrCommands.get(J);if(Q)return Q;return super.getHandler(J)}executeDisplayListLen(J,Q,q){const Y=J>>>16&255,Z=this.state.rdpSegmentAddress(Q);if(q)q.text(`gsSPDisplayListLen(<span class="dl-branch">${j(Z)}</span>, ${Y});`);this.state.pushDisplayList(Z,Y)}executeSetAddresses(J,Q,q){if(this.matrixAddress=this.state.rdpSegmentAddress(J),this.vertexAddress=this.state.rdpSegmentAddress(Q),this.vertexOffset=0,q)q.text(`gsSPSetAddress(${j(this.matrixAddress)}, ${j(this.vertexAddress)};`)}executeMoveWord(J,Q,q){const Y=J&255;if(Y==2){if(this.billboardMode=(Q&1)!=0,q)q.text(`gSetBillboardMode(${this.billboardMode});`)}else if(Y==10){if(this.matrixIndex=Q>>6&3,q)q.text(`gSetMatrixIndex(${this.matrixIndex});`)}else super.executeMoveWord(J,Q,q)}executeTexture(J,Q,q){const Y=J>>>16&255,Z=J>>>11&3,K=J>>>8&7,W=this.calcTextureScale(Q>>>16&65535),z=this.calcTextureScale(Q>>>0&65535);if(q){const F=W.toString(),N=z.toString(),G=E0(K);if(Y!==0)q.text(`gsSPTextureL(${F}, ${N}, ${Z}, ${Y}, ${G}, G_ON);`);else q.text(`gsSPTexture(${F}, ${N}, ${Z}, ${G}, G_ON);`)}this.state.setTexture(W,z,Z,K),this.state.geometryModeBits|=d0.G_TEXTURE_ENABLE,this.state.updateGeometryModeFromBits(d0)}executeMatrix(J,Q,q){const Y=this.matrixAddress+Q,Z=J>>22&3,K=J&65535,X=this.loadMatrix(Y,K);if(q)q.text(`gsSPMatrix(${j(Y)}, ${Z});`),q.tip(this.previewMatrix(X));this.matrixArray[Z]=X,this.matrixIndex=Z}executeVertex(J,Q,q){const Y=this.vertexAddress+Q,Z=(J>>>19&31)+1,K=J&65536,X=J>>>9&31;if(this.billboardMode)this.vertexOffset=K?1:0;else if(!K)this.vertexOffset=0;const W=this.vertexOffset+X;if(q)q.text(`gsSPVertex(${j(Y)}, ${W}, ${Z});`);this.loadVertices(W,Z,Y,q),this.vertexOffset+=Z}loadVertices(J,Q,q,Y){if(J+Q>=this.state.projectedVertices.length){this.warn("Too many verts");return}const Z=10,K=new DataView(this.ramDV.buffer,q);let X=this.matrixArray[this.matrixIndex];const W=this.renderer.nativeTransform.viTransform,z=this.state.viewport.transform,F=new X0;if(this.billboardMode){X=X.copy();const G=this.state.projectedVertices[0].pos;X.elems[3]+=G.x,X.elems[7]+=G.y,X.elems[11]+=G.z,X.elems[15]+=G.w}let N="";if(Y){const G=["#","x","y","z","rgba"];N+='<table class="vertex-table">',N+=`<tr><th>${G.join("</th><th>")}</th></tr>\n`}for(let G=0,P=0;G<Q;G++,P+=Z){const L=this.state.projectedVertices[J+G];if(L.set=!0,F.x=K.getInt16(P+0),F.y=K.getInt16(P+2),F.z=K.getInt16(P+4),L.color=K.getUint32(P+6,!0),this.projectInPlace(L,F,X,z,W),Y){const U=[J+G,F.x,F.y,F.z,k9(K.getUint32(P+6,!0))];N+=`<tr><td>${U.join("</td><td>")}</td></tr>\n`}}if(Y)N+="</table>",Y.tip(N)}executeTriDMA(J,Q,q){const Y=J>>>4&31,Z=this.state.rdpSegmentAddress(Q),K=new DataView(this.ramDV.buffer,Z),X=this.state.projectedVertices,W=this.triangleBuffer;if(W.reset(),q)q.text(`gsSPTriDMA(${j(Z)}, ${Y});`);let z="";if(Y>W.maxTris)this.warn(`Too many triangles for buffer: ${Y} > ${W.maxTris}`);const F=16;for(let N=0;N<Y&&W.hasCapacity(1);++N){const G=N*F,P=K.getUint8(G+0),L=K.getUint8(G+1),U=K.getUint8(G+2),E=K.getUint8(G+3),A=K.getInt16(G+4)/32,C=K.getInt16(G+6)/32,D=K.getInt16(G+8)/32,u=K.getInt16(G+10)/32,n=K.getInt16(G+12)/32,d=K.getInt16(G+14)/32;if(W.pushTriWithUV(X[L],X[U],X[E],A,C,D,u,n,d),q)z+=`${N}: ${P}, v${L} (${A}, ${C}), v${U} (${D}, ${u}), v${E} (${n}, ${d})\n`}if(this.renderer.flushTris(W),this.vertexOffset=0,q)q.tip(z)}}class y8 extends jJ{constructor(J,Q){super(J,Q);this.vertexStride=2,this.gbi2Commands=new Map([[0,this.executeNoop.bind(this)],[1,this.executeVertex.bind(this)],[2,this.executeModifyVtx.bind(this)],[3,this.executeCullDL.bind(this)],[4,this.executeBranchZ.bind(this)],[5,this.executeTri1.bind(this)],[6,this.executeTri2.bind(this)],[7,this.executeQuad.bind(this)],[8,this.executeLine3D.bind(this)],[9,this.executeBgRect1Cyc.bind(this)],[10,this.executeBgRectCopy.bind(this)],[11,this.executeObjRenderMode.bind(this)],[214,this.executeDmaIo.bind(this)],[215,this.executeTexture.bind(this)],[216,this.executePopMatrix.bind(this)],[217,this.executeGeometryMode.bind(this)],[218,this.executeMatrix.bind(this)],[219,this.executeMoveWord.bind(this)],[220,this.executeMoveMem.bind(this)],[221,this.executeLoadUcode.bind(this)],[222,this.executeDL.bind(this)],[223,this.executeEndDL.bind(this)],[224,this.executeSpNoop.bind(this)],[225,this.executeRDPHalf1.bind(this)],[226,this.executeSetOtherModeL.bind(this)],[227,this.executeSetOtherModeH.bind(this)],[241,this.executeRDPHalf2.bind(this)]])}getHandler(J){const Q=this.gbi2Commands.get(J);if(Q)return Q;return super.getHandler(J)}executeDL(J,Q,q){const Y=J>>>16&255,Z=this.state.rdpSegmentAddress(Q);if(q){const K=Y===U8?"gsSPDisplayList":"gsSPBranchList";q.text(`${K}(<span class="dl-branch">${j(Z)}</span>);`)}if(Y===U8)this.state.pushDisplayList(Z);else this.state.branchDisplayList(Z)}executeEndDL(J,Q,q){if(q)q.text("gsSPEndDisplayList();");this.state.endDisplayList()}executeSetOtherModeL(J,Q,q){const Y=J>>>8&255,Z=J>>>0&255,K=Q,X=2147483648>>Z>>>Y;if(q)E9(q,X,K);this.state.rdpOtherModeL=this.state.rdpOtherModeL&~X|K}executeSetOtherModeH(J,Q,q){const Y=J>>>8&255,Z=J>>>0&255,K=Q,X=2147483648>>Z>>>Y;if(q)A9(q,X,Z,Y,K);this.state.rdpOtherModeH=this.state.rdpOtherModeH&~X|K}executeMatrix(J,Q,q){const Y=this.state.rdpSegmentAddress(Q),Z=(J&1)===0,K=J>>>1&1,X=J>>>2&1;let W=this.loadMatrix(Y,64);if(q){let F="";F+=X?"G_MTX_PROJECTION":"G_MTX_MODELVIEW",F+=K?"|G_MTX_LOAD":"|G_MTX_MUL",F+=Z?"|G_MTX_PUSH":"",q.text(`gsSPMatrix(${j(Y)}, ${F});`),q.tip(this.previewMatrix(W))}const z=X?this.state.projection:this.state.modelview;if(!K)W=z[z.length-1].multiply(W);if(Z)z.push(W);else z[z.length-1]=W}executeVertex(J,Q,q){const Y=(J&255)>>1,Z=J>>>12&255,K=Y-Z,X=this.state.rdpSegmentAddress(Q);if(q)q.text(`gsSPVertex(${j(X)}, ${K}, ${Z});`);this.loadVertices(K,Z,X,q)}executeBranchZ(J,Q,q){if(this.warnUnimplemented("BranchZ"),q)q.text("gsSPBranchZ(/* TODO */);")}executeLine3D(J,Q,q){if(this.warnUnimplemented("Line3D"),q)q.text("gsSPLine3D(/* TODO */);")}executeBgRect1Cyc(J,Q,q){if(this.warnUnimplemented("BgRect1Cyc"),q)q.text("gsSPBgRect1Cyc(/* TODO */);")}executeBgRectCopy(J,Q,q){if(this.warnUnimplemented("BgRectCopy"),q)q.text("gsSPBgRectCopy(/* TODO */);")}executeObjRenderMode(J,Q,q){if(this.warnUnimplemented("ObjRenderMode"),q)q.text("gsSPObjRenderMode(/* TODO */);")}executeDmaIo(J,Q,q){if(q)q.text("DmaIo(/* TODO */);")}executeTri1(J,Q,q){const Y=this.state.projectedVertices,Z=this.triangleBuffer;Z.reset();let K=q?1:0,X=this.state.executeBatch(K,(W,z)=>{const F=W>>>1&127,N=W>>>9&127,G=W>>>17&127,P=z>>>24&255;if(q)q.text(`gsSP1Triangle(${F},${N},${G}, ${P});`);return Z.pushTri(Y[F],Y[N],Y[G]),Z.hasCapacity(1)});this.debugController.currentOp+=X-1,this.renderer.flushTris(Z)}executeTri2(J,Q,q){const Y=this.state.projectedVertices,Z=this.triangleBuffer;Z.reset();let K=q?1:0,X=this.state.executeBatch(K,(W,z)=>{const F=z>>>1&127,N=z>>>9&127,G=z>>>17&127,P=W>>>1&127,L=W>>>9&127,U=W>>>17&127;if(q)q.text(`gsSP2Triangles(${F},${N},${G}, ${P},${L},${U});`);return Z.pushTri(Y[F],Y[N],Y[G]),Z.pushTri(Y[P],Y[L],Y[U]),Z.hasCapacity(2)});this.debugController.currentOp+=X-1,this.renderer.flushTris(Z)}executeQuad(J,Q,q){const Y=this.state.projectedVertices,Z=this.triangleBuffer;Z.reset();let K=q?1:0,X=this.state.executeBatch(K,(W,z)=>{const F=z>>>1&127,N=z>>>9&127,G=z>>>17&127,P=W>>>1&127,L=W>>>9&127,U=W>>>17&127;if(q)q.text(`gSP1Quadrangle(${F},${N},${G}, ${P},${L},${U});`);return Z.pushTri(Y[F],Y[N],Y[G]),Z.pushTri(Y[P],Y[L],Y[U]),Z.hasCapacity(2)});this.debugController.currentOp+=X-1,this.renderer.flushTris(Z)}executeModifyVtx(J,Q,q){const Y=J>>>1&32767,Z=J>>>16&255,K=Q;if(q)q.text(`gsSPModifyVertex(${Y},${M8.nameOf(Z)},${j(K)});`);if(Y>=this.state.projectedVertices.length){this.warn("crazy vertex index",Y);return}const X=this.state.projectedVertices[Y];switch(Z){case M8.G_MWO_POINT_RGBA:this.warnUnimplemented("modifyVtx RGBA");break;case M8.G_MWO_POINT_ST:{const W=K>>16,z=(K&65535)<<16>>16;X.set=!0,X.u=W*this.state.texture.scaleS/32,X.v=z*this.state.texture.scaleT/32}break;case M8.G_MWO_POINT_XYSCREEN:this.warnUnimplemented("modifyVtx XYSCREEN");break;case M8.G_MWO_POINT_ZSCREEN:this.warnUnimplemented("modifyVtx ZSCREEN");break;default:this.warnUnimplemented("modifyVtx");break}}executeTexture(J,Q,q){const Y=J>>>16&255,Z=J>>>11&3,K=J>>>8&7,X=J>>>1&1,W=this.calcTextureScale(Q>>>16&65535),z=this.calcTextureScale(Q>>>0&65535);if(q){const F=W.toString(),N=z.toString(),G=E0(K);if(Y!==0)q.text(`gsSPTextureL(${F}, ${N}, ${Z}, ${Y}, ${G}, ${X});`);else q.text(`gsSPTexture(${F}, ${N}, ${Z}, ${G}, ${X});`)}if(this.state.setTexture(W,z,Z,K),X)this.state.geometryModeBits|=V6.G_TEXTURE_ENABLE;else this.state.geometryModeBits&=~V6.G_TEXTURE_ENABLE;this.state.updateGeometryModeFromBits(V6)}executeGeometryMode(J,Q,q){const Y=J&16777215,Z=Q;if(q){const K=O8(V6,~Y),X=O8(V6,Z);q.text(`gsSPGeometryMode(~(${K}),${X});`)}this.state.geometryModeBits&=Y|V6.G_TEXTURE_ENABLE,this.state.geometryModeBits|=Z&~V6.G_TEXTURE_ENABLE,this.state.updateGeometryModeFromBits(V6)}executePopMatrix(J,Q,q){if(q)q.text("gsSPPopMatrix(G_MTX_MODELVIEW);");const Z=this.state.modelview;if(Z.length>0)Z.pop()}executeMoveWord(J,Q,q){const Y=J>>>16&255,Z=J&65535,K=Q;let X="";switch(Y){case j0.G_MW_MATRIX:this.warnUnimplemented("MoveWord Matrix");break;case j0.G_MW_NUMLIGHT:{let W=Math.floor(K/24);if(q)X=`gsSPNumLights(${N9.nameOf(W)});`;this.state.numLights=W}break;case j0.G_MW_CLIP:if(q)X=`gSPClipRatio(${Z9.nameOf(Z)}, ${F9.nameOf(K)});`;break;case j0.G_MW_SEGMENT:{const W=Z>>>2&15;if(q)X=`gsSPSegment(${j9.nameOf(W)}, ${j(K)});`;this.state.segments[W]=K}break;case j0.G_MW_FOG:{const W=Q>>16,z=Q&65535;if(q)X=`gSPFogPosition(${W}, ${z});`;this.state.fogParameters.set(W,z)}break;case j0.G_MW_LIGHTCOL:this.warnUnimplemented("MoveWord LightCol");break;case j0.G_MW_POINTS:this.warnUnimplemented("MoveWord Points");break;case j0.G_MW_PERSPNORM:if(q)X=`gSPPerspNormalize(${K});`;break;default:this.warnUnimplemented("MoveWord Unknown");break}if(q){if(!X)X=`gMoveWd(${j0.nameOf(Y)}, ${x(Z)}, ${j(K)});`;q.text(X)}}executeMoveMem(J,Q,q){const Y=this.state.rdpSegmentAddress(Q),Z=(J>>>16&255)<<1,K=(J>>>8&255)<<3,X=J&254;let W;if(q)W=`gsDma1p(G_MOVEMEM, ${j(Y)}, ${Z}, ${K}, ${g0.nameOf(X)});`;switch(X){case g0.G_GBI2_MV_VIEWPORT:if(q)W=`gsSPViewport(${j(Y)});`;this.loadViewport(Y);break;case g0.G_GBI2_MV_LIGHT:if(K==g0.G_GBI2_MVO_LOOKATX){if(q)W=`gSPLookAtX(${j(Y)});`}else if(K==g0.G_GBI2_MVO_LOOKATY){if(q)W=`gSPLookAtY(${j(Y)});`}else if(K>=g0.G_GBI2_MVO_L0&&K<=g0.G_GBI2_MVO_L7){let z=(K-g0.G_GBI2_MVO_L0)/24>>>0;if(q)W=`gsSPLight(${j(Y)}, ${z})`;if(this.loadLight(z,Y),Z!=16)console.log(`unexpected gsSPLight length ${Z}. Is this setting multiple lights?`)}else if(q)W+=` // (unknown offset ${x(K)})`;break;case g0.G_GBI2_MV_POINT:this.warnUnimplemented("MoveMem G_GBI2_MV_POINT");break;case g0.G_GBI2_MV_MATRIX:this.warnUnimplemented("MoveMem G_GBI2_MV_MATRIX");break;default:this.warnUnimplemented(`MoveMem ${X.toString(16)}`)}if(q)q.text(W),this.previewMoveMem(X,Z,Y,q)}previewMoveMem(J,Q,q,Y){let Z="";for(let K=0;K<Q;K+=4)Z+=B(this.ramDV.getUint32(q+K),32)+" ";switch(Z+="<br>",J){case g0.G_GBI2_MV_VIEWPORT:Z+=this.previewViewport(q);break;case g0.G_GBI2_MV_LIGHT:Z+=this.previewLight(q);break}Y.tip(Z)}}class fq extends y8{constructor(J,Q){super(J,Q);this.vertexStride=2}}var uq=0,gq=1,xq=2,pq=3;class uX{constructor(){this.imageX=0,this.imageW=0,this.frameX=0,this.frameW=0,this.imageY=0,this.imageH=0,this.frameY=0,this.frameH=0,this.imagePtr=0,this.imageLoad=0,this.imageFmt=0,this.imageSiz=0,this.imagePal=0,this.imageFlip=0,this.scaleW=0,this.scaleH=0,this.imageYorig=0}load(J,Q){this.imageX=J.getUint16(Q+0,!1)/32,this.imageW=J.getUint16(Q+2,!1)/4,this.frameX=J.getInt16(Q+4,!1)/4,this.frameW=J.getUint16(Q+6,!1)/4,this.imageY=J.getUint16(Q+8,!1)/32,this.imageH=J.getUint16(Q+10,!1)/4,this.frameY=J.getInt16(Q+12,!1)/4,this.frameH=J.getUint16(Q+14,!1)/4,this.imagePtr=J.getUint32(Q+16,!1),this.imageLoad=J.getUint16(Q+20,!1),this.imageFmt=J.getUint8(Q+22,!1),this.imageSiz=J.getUint8(Q+23,!1),this.imagePal=J.getUint16(Q+24,!1),this.imageFlip=J.getUint16(Q+26,!1),this.scaleW=J.getUint16(Q+28,!1)/1024,this.scaleH=J.getUint16(Q+30,!1)/1024,this.imageYorig=J.getInt32(Q+32,!1)/32}toString(){return`imageX/Y = (${this.imageX}, ${this.imageY}), imageW/H = (${this.imageW}, ${this.imageH})
frameX/Y = (${this.frameX}, ${this.frameY}), frameW/H = (${this.frameW}, ${this.frameH})
imagePtr = ${j(this.imagePtr)}, imageLoad = ${this.imageLoad}
imageFmt = ${Z0.nameOf(this.imageFmt)}, imageSiz = ${g.nameOf(this.imageSiz)}
imagePal = ${this.imagePal}, imageFlip = ${this.imageFlip}
scaleW/H = (${this.scaleW}, ${this.scaleH})`}}class gX{constructor(){this.a=1,this.b=0,this.c=0,this.d=1,this.x=0,this.y=0,this.sx=1,this.sy=1}loadFullMatrix(J,Q){this.a=J.getInt32(Q+0,!1)/65536,this.b=J.getInt32(Q+4,!1)/65536,this.c=J.getInt32(Q+8,!1)/65536,this.d=J.getInt32(Q+12,!1)/65536,this.loadSubMatrix(J,Q+16)}loadSubMatrix(J,Q){this.x=J.getInt16(Q+0,!1)/4,this.y=J.getInt16(Q+2,!1)/4,this.sx=J.getUint16(Q+4,!1)/1024,this.sy=J.getUint16(Q+6,!1)/1024}toString(){return`rot = (${this.a}, ${this.b}, ${this.c}, ${this.d}), trans = (${this.x}, ${this.y}), scale = (${this.sx}, ${this.sy})`}}class xX{constructor(){this.objX=0,this.scaleW=0,this.imageW=0,this.objY=0,this.scaleH=0,this.imageH=0,this.imageStride=0,this.imageAdrs=0,this.imageFmt=0,this.imageSiz=0,this.imagePal=0,this.imageFlags=0}load(J,Q){this.objX=J.getInt16(Q+0,!1)/4,this.scaleW=J.getUint16(Q+2,!1)/1024,this.imageW=J.getUint16(Q+4,!1)/32,this.objY=J.getInt16(Q+8,!1)/4,this.scaleH=J.getUint16(Q+10,!1)/1024,this.imageH=J.getUint16(Q+12,!1)/32,this.imageStride=J.getUint16(Q+16,!1),this.imageAdrs=J.getUint16(Q+18,!1),this.imageFmt=J.getUint8(Q+20,!1),this.imageSiz=J.getUint8(Q+21,!1),this.imagePal=J.getUint8(Q+22,!1),this.imageFlags=J.getUint8(Q+23,!1)}get objW(){return this.imageW/this.scaleW}get objH(){return this.imageH/this.scaleH}toString(){return`pos = (${this.objX}, ${this.objY}), scale = (${this.scaleW}, ${this.scaleH}), image = (${this.imageW}, ${this.imageH})
stride = ${this.imageStride}, address = ${x(this.imageAdrs)}, format = ${Z0.nameOf(this.imageFmt)}, size = ${g.nameOf(this.imageSiz)}
paletteIdx = ${this.imagePal}, flags = ${this.imageFlags}`}}var SX=4147,vX=16519220,fX=48;var BH=48;var RH=51,bH=52;class pX{constructor(){this.type=0,this.image=0,this.texLoadSize=0,this.tileTMEM=0,this.tmem=0,this.tsize=0,this.tline=0,this.twidth=0,this.theight=0,this.phead=0,this.pnum=0,this.sid=0,this.flag=0,this.mask=0}load(J,Q){switch(this.type=J.getUint32(Q+0,!1),this.image=J.getUint32(Q+4,!1),this.tmem=0,this.tsize=0,this.tline=0,this.twidth=0,this.theight=0,this.phead=0,this.pnum=0,this.texLoadSize=J.getUint16(Q+10,!1),this.tileTMEM=J.getUint16(Q+8,!1),this.type){case SX:this.tmem=this.tileTMEM,this.tsize=this.texLoadSize,this.tline=J.getUint16(Q+12,!1);break;case vX:this.tmem=this.tileTMEM,this.twidth=this.texLoadSize,this.theight=J.getUint16(Q+12,!1);break;case fX:this.phead=this.tileTMEM,this.pnum=this.texLoadSize;break}this.sid=J.getUint16(Q+14,!1),this.flag=J.getUint32(Q+16,!1),this.mask=J.getUint32(Q+20,!1)}toString(){let J=`type = ${j(this.type)}, image = ${j(this.image)}\n`;switch(this.type){case SX:J+=`Block: tmem = ${x(this.tmem)}, tsize = ${x(this.tsize)}, tline = ${x(this.tline)}`;break;case vX:J+=`Tile: tmem = ${x(this.tmem)}, twidth = ${x(this.twidth)}, theight = ${x(this.theight)}`;break;case fX:J+=`TLUT: phead = ${x(this.phead)}, pnum = ${x(this.pnum)}`;break;default:J+="UNKNOWN"}return J}}class mq{constructor(J,Q,q){this.state=J,this.ramDV=Q,this.gbi=q,this.scaleBg=new uX,this.matrix=new gX,this.sprite=new xX,this.texture=new pX}executeBg1cyc(J,Q,q){const Y=this.state.rdpSegmentAddress(Q);if(this.scaleBg.load(this.ramDV,Y),this.gbi.warnUnimplemented("gSPBgRect1Cyc"),q)q.text(`gSPBgRect1Cyc(${j(Y)});`),q.tip(this.scaleBg.toString())}executeBgCopy(J,Q,q){if(this.gbi.warnUnimplemented("gSPBgRectCopy"),q)q.text("gSPBgRectCopy(/* TODO */);")}executeObjRectangle(J,Q,q){this.execLoadTxRenderObj("gSPObjRectangle",!1,pq,Q,q)}executeObjRectangleR(J,Q,q){this.execLoadTxRenderObj("gSPObjRectangleR",!1,xq,Q,q)}executeObjSprite(J,Q,q){this.execLoadTxRenderObj("gSPObjSprite",!1,gq,Q,q)}executeObjLoadTxRect(J,Q,q){this.execLoadTxRenderObj("gSPObjLoadTxRect",!0,pq,Q,q)}executeObjLoadTxRectR(J,Q,q){this.execLoadTxRenderObj("gSPObjLoadTxRectR",!0,xq,Q,q)}executeObjLoadTxSprite(J,Q,q){this.execLoadTxRenderObj("gSPObjLoadTxSprite",!0,gq,Q,q)}executeObjLoadTxtr(J,Q,q){this.execLoadTxRenderObj("gSPObjLoadTxtr",!0,uq,Q,q)}execLoadTxRenderObj(J,Q,q,Y,Z){const K=this.state.rdpSegmentAddress(Y);let X=K;if(Q)this.texture.load(this.ramDV,X),this.loadTexture(),X+=24;if(q!=uq)this.sprite.load(this.ramDV,X),this.renderSprite(q),X+=24;let W="";if(Z){if(Z.text(`${J}(${j(K)});`),Q)W+=this.texture.toString()+"\n";if(q!=uq)W+=this.sprite.toString()+"\n";Z.tip(W)}}executeObjMoveMem(J,Q,q){const Y=this.state.rdpSegmentAddress(Q),Z=J&65535;switch(Z){case 0:if(q)q.text(`gSPObjMatrix(${j(Y)});`);this.setObjMatrix(Y,q);break;case 2:if(q)q.text(`gSPObjSubMatrix(${j(Y)});`);this.setObjSubMatrix(Y,q);break;default:if(q)q.text(`gSPObjMoveMem(${Z}, ${j(Y)});`)}}setObjMatrix(J,Q){if(this.matrix.loadFullMatrix(this.ramDV,J),Q)Q.tip(this.matrix.toString())}setObjSubMatrix(J,Q){if(this.matrix.loadSubMatrix(this.ramDV,J),Q)Q.tip(this.matrix.toString())}executeSelectDL(J,Q,q){if(this.gbi.warnUnimplemented("gSPSelectDL"),q)q.text("gSPSelectDL(/* TODO */);")}executeObjRendermode(J,Q,q){if(q)q.text("gSPObjRenderMode(/* ignored */);")}executeTriRSP(J,Q,q){if(this.gbi.warnUnimplemented("executeTriRSP"),q)q.text("executeTriRSP(); // ignored")}executeRDPHalf0(J,Q,q){if(this.gbi.warnUnimplemented("executeRDPHalf0"),q)q.text(`gsImmp1(G_RDPHALF_0, ${j(Q)});`)}loadTexture(){const J=this.texture,Q=this.state.tiles[Vq],q=this.state.rdpSegmentAddress(J.image),Y=this.state.textureImage;Y.set(Z0.G_IM_FMT_RGBA,g.G_IM_SIZ_16b,J.texLoadSize+1,q);const Z=J.type>>>8&255,K=Z>>>5&7,X=Z>>>3&3,W=J.type<<8>>24,z=(J.texLoadSize+1&W)>>>2,F=0;switch(Q.set(K,X,z,J.tileTMEM,F,0,0,0,0,0,0),J.type>>>0&255){case RH:{const G=J.tline,P=J.texLoadSize+1;this.state.tmem.loadBlock(Q,q,G,P)}break;case bH:this.state.tmem.loadTile(Y,Q,0,0,J.twidth<<2,J.theight);break;case BH:this.state.tmem.loadTLUT(Q,q,J.pnum+1);break;default:this.gbi.warnUnimplemented(`load texture type ${J.type}`);break}this.state.invalidateTileHashes()}renderSprite(J){const Q=this.sprite,q=this.matrix,Z=Q.objX,K=Q.objY,X=Q.objW+Z,W=Q.objH+K,z=this.state.tiles[0];z.set(Q.imageFmt,Q.imageSiz,Q.imageStride,Q.imageAdrs,Q.imagePal,R6,0,0,R6,0,0),z.setSize(0,0,Q.imageW-1<<2,Q.imageH-1<<2);const F=Q.imageFlags&1,N=Q.imageFlags&16;if(F||N)this.gbi.warnUnimplemented("swapX/Y");const G=0,P=0,L=Q.imageW,U=Q.imageH;if(J==gq){const E=q.x+q.a*Z+q.b*K,A=q.y+q.c*Z+q.d*K,C=q.x+q.a*X+q.b*K,D=q.y+q.c*X+q.d*K,u=q.x+q.a*Z+q.b*W,n=q.y+q.c*Z+q.d*W,d=q.x+q.a*X+q.b*W,H0=q.y+q.c*X+q.d*W;this.gbi.renderer.texRectRot(0,E,A,C,D,u,n,d,H0,G,P,L,U)}else if(J==xq){const E=q.x+Z/q.sx,A=q.y+K/q.sy,C=q.x+X/q.sx,D=q.y+W/q.sy;this.gbi.renderer.texRect(0,E,A,C,D,G,P,L,U,!1)}else if(J==pq){const E=Z,A=X,C=K,D=W;this.gbi.renderer.texRect(0,E,C,A,D,G,P,L,U,!1)}}}class nq extends v6{constructor(J,Q){super(J,Q);this.vertexStride=2,this.s2dex=new mq(J,Q,this),this.sdexCommands=new Map([[1,this.s2dex.executeBg1cyc.bind(this.s2dex)],[2,this.s2dex.executeBgCopy.bind(this.s2dex)],[3,this.s2dex.executeObjRectangle.bind(this.s2dex)],[4,this.s2dex.executeObjSprite.bind(this.s2dex)],[5,this.s2dex.executeObjMoveMem.bind(this.s2dex)],[176,this.s2dex.executeSelectDL.bind(this.s2dex)],[177,this.s2dex.executeObjRendermode.bind(this.s2dex)],[178,this.s2dex.executeObjRectangleR.bind(this.s2dex)],[193,this.s2dex.executeObjLoadTxtr.bind(this.s2dex)],[194,this.s2dex.executeObjLoadTxSprite.bind(this.s2dex)],[195,this.s2dex.executeObjLoadTxRect.bind(this.s2dex)],[196,this.s2dex.executeObjLoadTxRectR.bind(this.s2dex)],[200,this.s2dex.executeTriRSP.bind(this.s2dex)],[201,this.s2dex.executeTriRSP.bind(this.s2dex)],[202,this.s2dex.executeTriRSP.bind(this.s2dex)],[203,this.s2dex.executeTriRSP.bind(this.s2dex)],[204,this.s2dex.executeTriRSP.bind(this.s2dex)],[205,this.s2dex.executeTriRSP.bind(this.s2dex)],[206,this.s2dex.executeTriRSP.bind(this.s2dex)],[207,this.s2dex.executeTriRSP.bind(this.s2dex)],[228,this.s2dex.executeRDPHalf0.bind(this.s2dex)]])}getHandler(J){const Q=this.sdexCommands.get(J);if(Q)return Q;return super.getHandler(J)}}class oq extends y8{constructor(J,Q){super(J,Q);this.vertexStride=2,this.s2dex=new mq(J,Q,this),this.sdexCommands=new Map([[1,this.s2dex.executeObjRectangle.bind(this.s2dex)],[2,this.s2dex.executeObjSprite.bind(this.s2dex)],[4,this.s2dex.executeSelectDL.bind(this.s2dex)],[5,this.s2dex.executeObjLoadTxtr.bind(this.s2dex)],[6,this.s2dex.executeObjLoadTxSprite.bind(this.s2dex)],[7,this.s2dex.executeObjLoadTxRect.bind(this.s2dex)],[8,this.s2dex.executeObjLoadTxRectR.bind(this.s2dex)],[9,this.s2dex.executeBg1cyc.bind(this.s2dex)],[10,this.s2dex.executeBgCopy.bind(this.s2dex)],[11,this.s2dex.executeObjRendermode.bind(this.s2dex)],[200,this.s2dex.executeTriRSP.bind(this.s2dex)],[201,this.s2dex.executeTriRSP.bind(this.s2dex)],[202,this.s2dex.executeTriRSP.bind(this.s2dex)],[203,this.s2dex.executeTriRSP.bind(this.s2dex)],[204,this.s2dex.executeTriRSP.bind(this.s2dex)],[205,this.s2dex.executeTriRSP.bind(this.s2dex)],[206,this.s2dex.executeTriRSP.bind(this.s2dex)],[207,this.s2dex.executeTriRSP.bind(this.s2dex)],[213,this.executeDLCount.bind(this)],[218,this.s2dex.executeObjRectangleR.bind(this.s2dex)]])}getHandler(J){const Q=this.sdexCommands.get(J);if(Q)return Q;return super.getHandler(J)}executeDLCount(J,Q,q){if(this.warnUnimplemented("executeDL_Count"),q)q.text("executeDL_Count(/* TODO */);")}executeMoveMem(J,Q,q){const Y=J&254;if(Y==0){const Z=this.state.rdpSegmentAddress(Q);if(q)q.text(`gSPObjMatrix(${j(Z)});`);this.s2dex.setObjMatrix(Z,q);return}else if(Y==2){const Z=this.state.rdpSegmentAddress(Q);if(q)q.text(`gSPObjSubMatrix(${j(Z)});`);this.s2dex.setObjSubMatrix(Z,q);return}super.executeMoveMem(J,Q,q)}}function eX(J,Q,q){const Y=J.detectVersionString(),Z=K6.dumpMicrocodeSubstring;if(Z!=""&&!mX&&Y.includes(Z))J.dumpCode(),mX=!0;const K=J.computeMicrocodeHash(),X=SH(Y,K),W=_H(X,Q,q);return W.version=Y,W}var _H=function(J,Q,q){switch(J){case g9:return new X6(Q,q);case f9:return new vq(Q,q);case rX:return new Sq(Q,q);case tX:return new Tq(Q,q);case sX:return new bq(Q,q);case aX:return new _q(Q,q);case oX:return new v6(Q,q);case u9:return new Rq(Q,q);case lX:return new nq(Q,q);case cX:return new y8(Q,q);case iX:return new fq(Q,q);case dX:return new oq(Q,q)}return M(`unhandled ucode during table init: ${J}`),new X6(Q,q)},SH=function(J,Q){let q=TH.get(Q);if(q===void 0)q=fH(J);return vH(J,q),q},vH=function(J,Q){if(nX.get(J))return;nX.set(J,!0),M(`New RSP graphics ucode seen: ${J} = ucode ${Q}`)},fH=function(J){const Q=["F3","L3","S2DEX"];let q=-1;for(let Y of Q)if(q=J.indexOf(Y),q>=0)break;if(q>=0){if(J.indexOf("fifo",q)>=0||J.indexOf("xbux",q)>=0)return J.indexOf("S2DEX")>=0?dX:cX;return J.indexOf("S2DEX")>=0?lX:oX}return g9},g9=0,oX=1,cX=2,lX=3,dX=4,aX=5,f9=6,u9=7,rX=8,sX=9,iX=10,tX=11,TH=new Map([[1613065980,iX],[1837886526,u9],[202381338,f9],[1899172316,f9],[603530562,sX],[379440285,f9],[651856460,u9],[3401874884,tX],[1824215581,rX],[3713401635,u9],[1691120285,aX],[3610907332,g9],[826213259,g9]]),mX=!1,nX=new Map;class o0{constructor(J,Q,q,Y){if(Y!==void 0)this.elems=new Float32Array(4),this.elems[0]=J,this.elems[1]=Q,this.elems[2]=q,this.elems[3]=Y;else this.elems=J||new Float32Array(4)}get x(){return this.elems[0]}get y(){return this.elems[1]}get z(){return this.elems[2]}get w(){return this.elems[3]}set x(J){this.elems[0]=J}set y(J){this.elems[1]=J}set z(J){this.elems[2]=J}set w(J){this.elems[3]=J}set(J,Q,q,Y){return this.x=J,this.y=Q,this.z=q,this.w=Y,this}setV3(J,Q){return this.x=J.x,this.y=J.y,this.z=J.z,this.w=Q,this}dot(J){var Q=0;for(var q=0;q<this.elems.length;++q)Q+=this.elems[q]*J.elems[q];return Q}lengthSqr(){return this.dot(this)}length(){return Math.sqrt(this.lengthSqr())}addInPlace(J){for(var Q=0;Q<this.elems.length;++Q)this.elems[Q]+=J.elems[Q];return this}subInPlace(J){for(var Q=0;Q<this.elems.length;++Q)this.elems[Q]-=J.elems[Q];return this}scaleInPlace(J){for(var Q=0;Q<this.elems.length;++Q)this.elems[Q]*=J;return this}vecScaleInPlace(J){for(var Q=0;Q<this.elems.length;++Q)this.elems[Q]*=J.elems[Q];return this}invVecScaleInPlace(J){for(var Q=0;Q<this.elems.length;++Q)this.elems[Q]/=J.elems[Q];return this}normaliseInPlace(){var J=this.length();if(J>0)return this.scaleInPlace(1/J);return this}static create(J){var Q=new X0;return Q.elems[0]=J[0],Q.elems[1]=J[1],Q.elems[2]=J[2],Q.elems[3]=J[3],Q}}class cq{constructor(){this.pos=new o0,this.color=0,this.u=0,this.v=0,this.clipFlags=0,this.set=!1}calculateLinearUV(J){this.u=0.5*(1+J.x),this.v=0.5*(1+J.y)}calculateSphericalUV(J){this.u=Math.acos(J.x)/Math.PI,this.v=Math.acos(J.y)/Math.PI}}class NJ{constructor(J,Q){this.scale=J||new o0(1,1,1,1),this.trans=Q||new o0(0,0,0,0)}transformInPlace(J){J.vecScaleInPlace(this.scale),J.addInPlace(this.trans)}invTransformInPlace(J){J.subInPlace(this.trans),J.invVecScaleInPlace(this.scale)}}var gH=function(){return n64js.hardware().cachedMemDevice.s32},JW=function(){return n64js.hardware().cachedMemDevice.u8},lq=function(J,Q,q,Y){let Z=Q>>2,K=Q+q>>2;while(Z<K)Y=Y*17+J[Z]>>>0,++Z;return Y},QW=function(J,Q,q,Y,Z){for(let K=0;K<Z;++K)J[Q+0]=q[Y+0],J[Q+1]=q[Y+1],Q+=2,Y+=2},xH=function(J,Q,q,Y,Z,K){r((Q&1)==0,"tmem isn't qword aligned");for(let X=0;X<Z;++X)J[Q+0^K]=q[Y+0],J[Q+1^K]=q[Y+1],Q+=2,Y+=2},pH=function(J,Q,q,Y,Z,K){for(let X=0;X<Z;++X)J[Q+X]=q[Y+X];for(let X=Z;X<K;++X)J[Q+X]=0},mH=function(J,Q,q,Y,Z,K,X){for(let W=0;W<Z;++W)J[Q+W^X]=q[Y+W];for(let W=Z;W<K;++W)J[Q+W^X]=0},nH=function(J,Q,q,Y,Z){for(let K=0;K<Z;K++){const X=q[Y+K*2+0],W=q[Y+K*2+1];J[Q+K*8+0]=X,J[Q+K*8+1]=W,J[Q+K*8+2]=X,J[Q+K*8+3]=W,J[Q+K*8+4]=X,J[Q+K*8+5]=W,J[Q+K*8+6]=X,J[Q+K*8+7]=W}};class dq{constructor(){const J=new ArrayBuffer(4096);this.tmemData32=new Int32Array(J),this.tmemData=new Uint8Array(J)}loadBlock(J,Q,q,Y){const Z=this.tmemData32;let K=Q>>>2,X=J.tmem<<3>>>2;const W=gH(),z=J.size==g.G_IM_SIZ_32b?2:1;if(q===0)QW(Z,X,W,K,Y);else{const F=Math.ceil(2048/q);let N=0;for(let G=0;G<Y;){const P=Math.min(Y-G,F);if(N)xH(Z,X,W,K,P,z);else QW(Z,X,W,K,P);G+=P,X+=P*2,K+=P*2,N^=1}}}loadTile(J,Q,q,Y,Z,K,X){const W=q>>>2,z=Y>>>2,F=Z>>>2,N=K>>>2,G=F+1-W,P=N+1-z,L=J.calcAddress(W,z),U=J.texelsToBytes(G),E=J.stride(),A=this.tmemData;let C=Q.tmem<<3,D=L;const u=J.size==g.G_IM_SIZ_32b?Q.line<<4:Q.line<<3,n=Q.size==g.G_IM_SIZ_32b?8:4;if(X)X.tip(`size (${G} x ${P}), rowBytes ${U}, ramStride ${E}, tmemStride ${u}, ramOffset ${j(D)}, tmemOffset ${x(C)}`);const d=JW();for(let H0=0;H0<P;++H0){if(H0&1)mH(A,C,d,D,U,u,n);else pH(A,C,d,D,U,u);C+=u,D+=E}}loadTLUT(J,Q,q){const Y=JW();var Z=J.tmem<<3;nH(this.tmemData,Z,Y,Q,q)}convertTexels(J,Q,q){return PX(q,this.tmemData,J,Q)}calculateCRC(J){if(J.hash)return J.hash;var Q=J.height,q=this.tmemData32,Y=J.tmem<<3,Z=J.line<<3;if(J.format==Z0.G_IM_FMT_RGBA&&J.size==g.G_IM_SIZ_32b)Z*=2;var K=Q*Z,X=lq(q,Y,K,0);if(J.format===Z0.G_IM_FMT_CI||J.format===Z0.G_IM_FMT_RGBA){if(J.size===g.G_IM_SIZ_8b)X=lq(q,2048,2048,X);else if(J.size===g.G_IM_SIZ_4b)X=lq(q,2048+J.palette*16*2,128,X)}return J.hash=X,X}}var aq=function(J,Q){return J<<Q>>>1};class rq{constructor(){this.ramDV=null,this.pc=0,this.pcEnd=0,this.dlistStack=[],this.cmd0=0,this.cmd1=0,this.segments=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.tiles=new Array(8),this.lights=new Array(8),this.numLights=0,this.geometryModeBits=0,this.geometryMode={zbuffer:0,texture:0,shade:0,shadeSmooth:0,cullFront:0,cullBack:0,fog:0,lighting:0,textureGen:0,textureGenLinear:0,lod:0},this.rdpOtherModeL=0,this.rdpOtherModeH=0,this.rdpHalf1=0,this.rdpHalf2=0,this.viewport=new qW,this.projection=[],this.modelview=[],this.projectedVertices=new Array(64),this.scissor={mode:0,x0:0,y0:0,x1:320,y1:240},this.texture={tile:0,level:0,scaleS:1,scaleT:1},this.combine={lo:0,hi:0},this.fillColor=0,this.envColor=0,this.primColor=0,this.blendColor=0,this.fogColor=0,this.primDepth=0,this.fogParameters=new YW,this.colorImage={format:0,size:0,width:0,address:0},this.textureImage=new ZW,this.depthImage={address:0},this.tmem=new dq,this.screenContext2d=null}reset(J,Q){this.ramDV=J,this.pc=Q,this.pcEnd=0,this.dlistStack=[],this.cmd0=0,this.cmd1=0;for(let q=0;q<this.segments.length;++q)this.segments[q]=0;this.rdpOtherModeL=5242881,this.rdpOtherModeH=0,this.projection=[D0.identity()],this.modelview=[D0.identity()],this.geometryModeBits=0,this.geometryMode.zbuffer=0,this.geometryMode.texture=0,this.geometryMode.shade=0,this.geometryMode.shadeSmooth=0,this.geometryMode.cullFront=0,this.geometryMode.cullBack=0,this.geometryMode.fog=0,this.geometryMode.lighting=0,this.geometryMode.textureGen=0,this.geometryMode.textureGenLinear=0,this.geometryMode.lod=0;for(let q=0;q<this.tiles.length;++q)this.tiles[q]=new Iq;this.numLights=0;for(let q=0;q<this.lights.length;++q)this.lights[q]={color:{r:0,g:0,b:0,a:0},dir:X0.create([1,0,0])};for(let q=0;q<this.projectedVertices.length;++q)this.projectedVertices[q]=new cq;this.viewport.reset(),this.fogParameters.reset()}nextCommand(){if(this.pcEnd&&this.pc>=this.pcEnd)this.endDisplayList();if(this.pc==0)return!1;return this.cmd0=this.ramDV.getUint32(this.pc+0),this.cmd1=this.ramDV.getUint32(this.pc+4),this.pc+=8,!0}advanceIfCommand(J){if(this.pc==0||this.pcEnd&&this.pc>this.pcEnd)return!1;const Q=this.ramDV.getUint32(this.pc+0);if(Q>>>24!==J)return!1;return this.cmd0=Q,this.cmd1=this.ramDV.getUint32(this.pc+4),this.pc+=8,!0}executeBatch(J,Q){const q=this.cmd0>>>24,Y=J<=0;let Z=0;do if(Z++,!Q(this.cmd0,this.cmd1))break;while((Y||Z<J)&&this.advanceIfCommand(q));return Z}pushDisplayList(J,Q){const q=Q==void 0?0:J+Q*8;this.dlistStack.push({pc:this.pc,pcEnd:this.pcEnd}),this.pc=J,this.pcEnd=q}branchDisplayList(J){this.pc=J}endDisplayList(){if(this.dlistStack.length<=0){this.pc=0,this.pcEnd=0;return}const J=this.dlistStack.pop();this.pc=J.pc,this.pcEnd=J.pcEnd}invalidateTileHashes(){for(let J=0;J<8;++J)this.tiles[J].hash=0}rdpSegmentAddress(J){const Q=J>>>24&15;return(this.segments[Q]&8388607)+(J&8388607)}setTexture(J,Q,q,Y){this.texture.scaleS=J,this.texture.scaleT=Q,this.texture.level=q,this.texture.tile=Y}updateGeometryModeFromBits(J){var Q=this.geometryMode,q=this.geometryModeBits;Q.zbuffer=q&J.G_ZBUFFER?1:0,Q.texture=q&J.G_TEXTURE_ENABLE?1:0,Q.shade=q&J.G_SHADE?1:0,Q.shadeSmooth=q&J.G_SHADING_SMOOTH?1:0,Q.cullFront=q&J.G_CULL_FRONT?1:0,Q.cullBack=q&J.G_CULL_BACK?1:0,Q.fog=q&J.G_FOG?1:0,Q.lighting=q&J.G_LIGHTING?1:0,Q.textureGen=q&J.G_TEXTURE_GEN?1:0,Q.textureGenLinear=q&J.G_TEXTURE_GEN_LINEAR?1:0,Q.lod=q&J.G_LOD?1:0}getCycleType(){return this.rdpOtherModeH&L8}getTextureFilterType(){return this.rdpOtherModeH&V8}getTextureLUTType(){return this.rdpOtherModeH&P8}getAlphaCompareType(){return this.rdpOtherModeL&G8}getCoverageTimesAlpha(){return(this.rdpOtherModeL&$0.CVG_X_ALPHA)!==0}getAlphaCoverageSelect(){return(this.rdpOtherModeL&$0.ALPHA_CVG_SEL)!==0}}class qW{constructor(){this.reset()}reset(){const J=new X0(160,-120,1),Q=new X0(160,120,0);this.set(J,Q)}set(J,Q){this.scale=J,this.trans=Q;const q=new o0().setV3(J,1),Y=new o0().setV3(Q,0);this.transform=new NJ(q,Y)}}class YW{constructor(){this.reset()}reset(){this.multiplier=0,this.offset=0}set(J,Q){this.multiplier=J,this.offset=Q}}class ZW{constructor(){this.format=0,this.size=0,this.width=0,this.address=0}set(J,Q,q,Y){this.format=J,this.size=Q,this.width=q,this.address=Y}calcAddress(J,Q,q){const Y=q===void 0?this.size:q;return this.address+Q*aq(this.width,Y)+aq(J,Y)}texelsToBytes(J){return aq(J,this.size)}stride(){return this.texelsToBytes(this.width)}}class N0{constructor(J,Q){this.x=J,this.y=Q}dot(J){return this.x*J.x+this.y*J.y}lengthSqr(){return this.dot(this)}length(){return Math.sqrt(this.lengthSqr())}add(J){return new N0(this.x+J.x,this.y+J.y)}sub(J){return new N0(this.x-J.x,this.y-J.y)}scale(J){return new N0(this.x*J,this.y*J)}normaliseInPlace(){const J=this.length();if(J>0)this.x/=J,this.y/=J;return this}}class sq{constructor(J,Q){this.scale=J||new N0(1,1),this.trans=Q||new N0(0,0)}transform(J){const Q=this.scale.x*J.x+this.trans.x,q=this.scale.y*J.y+this.trans.y;return new N0(Q,q)}}function XW(J,Q,q){let Y=J.data,Z=J.width*4,K=0;if(Q<J.width){let X=0;for(;K<q;++K){let W=X+(Q-1)*4,z=Y[W+0],F=Y[W+1],N=Y[W+2],G=Y[W+3];W+=4;for(let P=Q;P<J.width;++P)Y[W+0]=z,Y[W+1]=F,Y[W+2]=N,Y[W+3]=G,W+=4;X+=Z}}if(q<J.height){let X=Z*q,W=X-Z;for(;K<J.height;++K){for(let z=0;z<Z;++z)Y[X+z]=Y[W+z];X+=Z}}}var KW=function(J){var Q=1;while(Q<J)Q*=2;return Q};class iq{constructor(J,Q,q){this.width=Q,this.height=q;var Y=KW(Q),Z=KW(q);this.nativeWidth=Y,this.nativeHeight=Z,this.$canvas=$('<canvas width="'+Y+'" height="'+Z+'" />',{width:Y,height:Z}),this.texture=J.createTexture()}createScaledCanvas(J){var Q=this.width*J,q=this.height*J,Y=$('<canvas width="'+Q+'" height="'+q+'" style="background-color: black" />',{width:Q,height:q}),Z=this.$canvas[0].getContext("2d"),K=Y[0].getContext("2d"),X=Z.getImageData(0,0,this.width,this.height),W=K.createImageData(Q,q),z=X.data,F=W.data,N=X.width*4,G=W.width*4;for(let E=0;E<q;++E){var P=N*Math.floor(E/J),L=G*E;for(let A=0;A<Q;++A){var U=P+Math.floor(A/J)*4;F[L+0]=z[U+0],F[L+1]=z[U+1],F[L+2]=z[U+2],F[L+3]=z[U+3],L+=4}}return K.putImageData(W,0,0),Y}}var jW=function(J){if(J<=10)return 1/(1<<J);return 1<<16-J},WW=0,tq=1,$W=2,zW=3,HW=4,FW=new Map;class eq{constructor(J,Q,q,Y){this.gl=J,this.state=Q,this.nativeTransform=new NW,this.textureCache=new Map,this.frameBuffer=J.createFramebuffer(),J.bindFramebuffer(J.FRAMEBUFFER,this.frameBuffer),this.frameBuffer.width=q,this.frameBuffer.height=Y,this.frameBufferTexture2D=J.createTexture(),J.bindTexture(J.TEXTURE_2D,this.frameBufferTexture2D),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.NEAREST),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.NEAREST),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),this.frameBufferTexture3D=J.createTexture(),J.bindTexture(J.TEXTURE_2D,this.frameBufferTexture3D),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.NEAREST),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.NEAREST),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texImage2D(J.TEXTURE_2D,0,J.RGBA,q,Y,0,J.RGBA,J.UNSIGNED_BYTE,null),J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_2D,this.frameBufferTexture3D,0),J.bindTexture(J.TEXTURE_2D,null);const Z=J.createRenderbuffer();J.bindRenderbuffer(J.RENDERBUFFER,Z),J.renderbufferStorage(J.RENDERBUFFER,J.DEPTH_COMPONENT16,q,Y),J.framebufferRenderbuffer(J.FRAMEBUFFER,J.DEPTH_ATTACHMENT,J.RENDERBUFFER,Z),J.bindRenderbuffer(J.RENDERBUFFER,null),J.bindFramebuffer(J.FRAMEBUFFER,null),this.blitShaderProgram=kq(J,"blit-shader-vs","blit-shader-fs"),this.blitVertexPositionAttribute=J.getAttribLocation(this.blitShaderProgram,"aVertexPosition"),this.blitTexCoordAttribute=J.getAttribLocation(this.blitShaderProgram,"aTextureCoord"),this.blitSamplerUniform=J.getUniformLocation(this.blitShaderProgram,"uSampler"),this.fillShaderProgram=kq(J,"fill-shader-vs","fill-shader-fs"),this.fillVertexPositionAttribute=J.getAttribLocation(this.fillShaderProgram,"aVertexPosition"),this.fillFillColorUniform=J.getUniformLocation(this.fillShaderProgram,"uFillColor"),this.fillVerticesBuffer=J.createBuffer(),this.n64PositionsBuffer=J.createBuffer(),this.n64ColorsBuffer=J.createBuffer(),this.n64UVBuffer=J.createBuffer(),this.$textureOutput=$("#texture-content")}reset(){this.textureCache.clear(),this.$textureOutput.html("")}newFrame(){const J=this.gl;J.bindFramebuffer(J.FRAMEBUFFER,this.frameBuffer),J.viewport(0,0,this.frameBuffer.width,this.frameBuffer.height)}copyTextureToFrontBuffer(J){const Q=this.gl;Q.bindFramebuffer(Q.FRAMEBUFFER,null);const q=[-1,-1,0,1,1,-1,0,1,-1,1,0,1,1,1,0,1],Y=[0,0,1,0,0,1,1,1];Q.useProgram(this.blitShaderProgram);const Z=document.getElementById("display");Q.viewport(0,0,Z.width,Z.height),Q.enableVertexAttribArray(this.blitVertexPositionAttribute),Q.bindBuffer(Q.ARRAY_BUFFER,this.n64PositionsBuffer),Q.bufferData(Q.ARRAY_BUFFER,new Float32Array(q),Q.STATIC_DRAW),Q.vertexAttribPointer(this.blitVertexPositionAttribute,4,Q.FLOAT,!1,0,0),Q.enableVertexAttribArray(this.blitTexCoordAttribute),Q.bindBuffer(Q.ARRAY_BUFFER,this.n64UVBuffer),Q.bufferData(Q.ARRAY_BUFFER,new Float32Array(Y),Q.STATIC_DRAW),Q.vertexAttribPointer(this.blitTexCoordAttribute,2,Q.FLOAT,!1,0,0),Q.activeTexture(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,J),Q.uniform1i(this.blitSamplerUniform,0),Q.disable(Q.CULL_FACE),Q.disable(Q.BLEND),Q.disable(Q.DEPTH_TEST),Q.depthMask(!1),Q.drawArrays(Q.TRIANGLE_STRIP,0,4)}copyBackBufferToFrontBuffer(){this.copyTextureToFrontBuffer(this.frameBufferTexture3D)}copyPixelsToFrontBuffer(J,Q,q,Y){const Z=this.gl;if(Z.activeTexture(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,this.frameBufferTexture2D),Y==32)Z.texImage2D(Z.TEXTURE_2D,0,Z.RGBA,Q,q,0,Z.RGBA,Z.UNSIGNED_BYTE,J);else if(Y==16)Z.texImage2D(Z.TEXTURE_2D,0,Z.RGBA,Q,q,0,Z.RGBA,Z.UNSIGNED_SHORT_5_5_5_1,J);this.copyTextureToFrontBuffer(this.frameBufferTexture2D)}flushTris(J){const Q=this.gl;if(J.empty())return;const q=this.state.geometryMode.texture,Y=this.state.geometryMode.lighting&&this.state.geometryMode.textureGen;if(this.setProgramState(J.positions,J.colours,J.coords,q,Y,this.state.texture.tile),this.initDepth(),this.state.geometryMode.cullFront||this.state.geometryMode.cullBack){Q.enable(Q.CULL_FACE);const Z=this.state.geometryMode.cullFront?Q.FRONT:Q.BACK;Q.cullFace(Z)}else Q.disable(Q.CULL_FACE);Q.drawArrays(Q.TRIANGLES,0,J.numTris*3),J.reset()}fillRect(J,Q,q,Y,Z){const K=this.gl;this.setGLBlendMode();const X=this.nativeTransform.convertN64ToDisplay(new N0(J,Q)),W=this.nativeTransform.convertN64ToDisplay(new N0(q,Y)),z=[W.x,W.y,0,1,X.x,W.y,0,1,W.x,X.y,0,1,X.x,X.y,0,1];K.useProgram(this.fillShaderProgram),K.enableVertexAttribArray(this.fillVertexPositionAttribute),K.bindBuffer(K.ARRAY_BUFFER,this.fillVerticesBuffer),K.bufferData(K.ARRAY_BUFFER,new Float32Array(z),K.STATIC_DRAW),K.vertexAttribPointer(this.fillVertexPositionAttribute,4,K.FLOAT,!1,0,0),K.uniform4f(this.fillFillColorUniform,Z.r,Z.g,Z.b,Z.a),K.disable(K.CULL_FACE),K.disable(K.DEPTH_TEST),K.depthMask(!1),K.drawArrays(K.TRIANGLE_STRIP,0,4)}texRect(J,Q,q,Y,Z,K,X,W,z,F){const N=this.gl,G=this.nativeTransform.convertN64ToDisplay(new N0(Q,q)),P=this.nativeTransform.convertN64ToDisplay(new N0(Y,Z)),L=(this.state.rdpOtherModeL&l6.G_ZS_PRIM)!==0,U=L?this.state.primDepth:0,E=[G.x,G.y,U,1,P.x,G.y,U,1,G.x,P.y,U,1,P.x,P.y,U,1];let A;if(F)A=[K,X,K,z,W,X,W,z];else A=[K,X,W,X,K,z,W,z];const C=[4294967295,4294967295,4294967295,4294967295];if(this.setProgramState(new Float32Array(E),new Uint32Array(C),new Float32Array(A),!0,!1,J),N.disable(N.CULL_FACE),L?!0:!1)this.initDepth();else N.disable(N.DEPTH_TEST),N.depthMask(!1);N.drawArrays(N.TRIANGLE_STRIP,0,4)}texRectRot(J,Q,q,Y,Z,K,X,W,z,F,N,G,P){const L=this.gl,U=this.nativeTransform.convertN64ToDisplay(new N0(Q,q)),E=this.nativeTransform.convertN64ToDisplay(new N0(Y,Z)),A=this.nativeTransform.convertN64ToDisplay(new N0(K,X)),C=this.nativeTransform.convertN64ToDisplay(new N0(W,z)),D=(this.state.rdpOtherModeL&l6.G_ZS_PRIM)!==0,u=D?this.state.primDepth:0,n=[U.x,U.y,u,1,E.x,E.y,u,1,A.x,A.y,u,1,C.x,C.y,u,1];let d=[F,N,G,N,F,P,G,P];const H0=[4294967295,4294967295,4294967295,4294967295];if(this.setProgramState(new Float32Array(n),new Uint32Array(H0),new Float32Array(d),!0,!1,J),L.disable(L.CULL_FACE),D?!0:!1)this.initDepth();else L.disable(L.DEPTH_TEST),L.depthMask(!1);L.drawArrays(L.TRIANGLE_STRIP,0,4)}initDepth(){const J=this.gl,Q=this.state.geometryMode.zbuffer!==0,q=(this.state.rdpOtherModeL&$0.Z_CMP)!==0,Y=(this.state.rdpOtherModeL&$0.Z_UPD)!==0;if(Q&&q||Y)J.enable(J.DEPTH_TEST),J.depthFunc(J.LEQUAL);else J.disable(J.DEPTH_TEST);J.depthMask(Y)}setProgramState(J,Q,q,Y,Z,K){const X=this.gl;this.setGLBlendMode();const W=this.state.getCycleType();let z,F,N,G;if(Y){const U=K+0&7,E=K+1&7;z=this.state.tiles[U],F=this.state.tiles[E],N=this.lookupTexture(U),G=W==K0.G_CYC_2CYCLE?this.lookupTexture(E):null}let P=-1;if(this.state.getAlphaCompareType()===c6.G_AC_THRESHOLD)P=(this.state.blendColor>>>0&255)/255;const L=this.getCurrentN64Shader();X.useProgram(L.program),X.enableVertexAttribArray(L.vertexPositionAttribute),X.bindBuffer(X.ARRAY_BUFFER,this.n64PositionsBuffer),X.bufferData(X.ARRAY_BUFFER,J,X.STATIC_DRAW),X.vertexAttribPointer(L.vertexPositionAttribute,4,X.FLOAT,!1,0,0),X.enableVertexAttribArray(L.vertexColorAttribute),X.bindBuffer(X.ARRAY_BUFFER,this.n64ColorsBuffer),X.bufferData(X.ARRAY_BUFFER,Q,X.STATIC_DRAW),X.vertexAttribPointer(L.vertexColorAttribute,4,X.UNSIGNED_BYTE,!0,0,0),X.enableVertexAttribArray(L.texCoordAttribute),X.bindBuffer(X.ARRAY_BUFFER,this.n64UVBuffer),X.bufferData(X.ARRAY_BUFFER,q,X.STATIC_DRAW),X.vertexAttribPointer(L.texCoordAttribute,2,X.FLOAT,!1,0,0),this.bindTexture(0,X.TEXTURE0,z,N,Z,L.uSamplerUniform0,L.uTexScaleUniform0,L.uTexOffsetUniform0),this.bindTexture(1,X.TEXTURE1,F,G,Z,L.uSamplerUniform1,L.uTexScaleUniform1,L.uTexOffsetUniform1),X.uniform1f(L.uAlphaThresholdUniform,P),X.uniform4f(L.uPrimColorUniform,(this.state.primColor>>>24&255)/255,(this.state.primColor>>>16&255)/255,(this.state.primColor>>>8&255)/255,(this.state.primColor>>>0&255)/255),X.uniform4f(L.uEnvColorUniform,(this.state.envColor>>>24&255)/255,(this.state.envColor>>>16&255)/255,(this.state.envColor>>>8&255)/255,(this.state.envColor>>>0&255)/255)}getCurrentN64Shader(){const J=this.state.combine.hi,Q=this.state.combine.lo,q=this.state.getCycleType(),Y=this.state.getAlphaCompareType()===c6.G_AC_THRESHOLD;return yX(this.gl,J,Q,q,Y)}lookupTexture(J){const Q=this.state.tiles[J];if(Q.line===0)return null;const q=this.state.tmem.calculateCRC(Q),Y=`${j(q)}_${Q.format}_${Q.size}_${Q.width}_${Q.height}_${Q.palette}`;if(this.textureCache.has(Y))return this.textureCache.get(Y);const Z=this.decodeTexture(Q,this.state.getTextureLUTType(),Y);return this.textureCache.set(Y,Z),Z}decodeTexture(J,Q,q){const Y=this.gl,Z=new iq(Y,J.width,J.height);if(!Z.$canvas[0].getContext)return null;this.$textureOutput.append(`${q}: ${Z0.nameOf(J.format)}, ${g.nameOf(J.size)},${J.width}x${J.height}, <br>`);const K=Z.$canvas[0].getContext("2d"),X=K.createImageData(Z.nativeWidth,Z.nativeHeight);if(this.state.tmem.convertTexels(J,Q,X))XW(X,J.width,J.height),K.putImageData(X,0,0),this.$textureOutput.append(Z.$canvas),this.$textureOutput.append("<br>");else{const z=`${Z0.nameOf(J.format)}/${g.nameOf(J.size)} is unhandled`;this.$textureOutput.append(z),this.hleHalt(z)}return Y.activeTexture(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,Z.texture),Y.texImage2D(Y.TEXTURE_2D,0,Y.RGBA,Y.RGBA,Y.UNSIGNED_BYTE,Z.$canvas[0]),Y.generateMipmap(Y.TEXTURE_2D),Y.bindTexture(Y.TEXTURE_2D,null),Z}bindTexture(J,Q,q,Y,Z,K,X,W){const z=this.gl;if(z.activeTexture(Q),!Y){z.bindTexture(z.TEXTURE_2D,null);return}let{left:F,top:N}=q,G=1/Y.nativeWidth,P=1/Y.nativeHeight;if(Y.width===56&&Y.height===29)G*=0.5,P*=0.5;if(Z)G=1,P=1,F=0,N=0;if(G*=jW(q.shiftS),P*=jW(q.shiftT),z.bindTexture(z.TEXTURE_2D,Y.texture),z.uniform1i(K,J),z.uniform2f(X,G,P),z.uniform2f(W,F,N),this.state.getTextureFilterType()==A8.G_TF_POINT)z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.NEAREST),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.NEAREST_MIPMAP_NEAREST);else z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.LINEAR_MIPMAP_NEAREST);const L=q.cmS===R6||q.maskS===0,U=q.cmT===R6||q.maskT===0,E=q.cmS===HJ,A=q.cmT===HJ,C=L?z.CLAMP_TO_EDGE:E?z.MIRRORED_REPEAT:z.REPEAT,D=U?z.CLAMP_TO_EDGE:A?z.MIRRORED_REPEAT:z.REPEAT;z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,C),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,D)}setGLBlendMode(){const J=this.gl,Q=this.state.getCoverageTimesAlpha(),q=this.state.getAlphaCoverageSelect(),Y=this.state.getCycleType();if(Y==K0.G_CYC_FILL||Y==K0.G_CYC_COPY){J.disable(J.BLEND);return}const Z=this.state.rdpOtherModeL>>Gq,K=(Y===K0.G_CYC_2CYCLE?Z:Z>>>2)&13107;let X=WW;switch(K){case 0:case 770:X=tq;break;case 16:case 17:if(!q||Q)X=$W;break;case 272:X=tq;break;case 784:case 4880:X=zW;break;case 12560:X=HW;break}let W=!1;switch(X){case tq:J.disable(J.BLEND);break;case $W:J.blendFunc(J.SRC_ALPHA,J.ONE_MINUS_SRC_ALPHA),J.blendEquation(J.FUNC_ADD),J.enable(J.BLEND);break;case zW:J.blendFunc(J.ZERO,J.ONE_MINUS_SRC_ALPHA),J.blendEquation(J.FUNC_ADD),J.enable(J.BLEND);break;case HW:W=!0,J.disable(J.BLEND);break;case WW:W=!0,J.disable(J.BLEND);break}if(W)this.logUnhandledBlendMode(K,q,Q)}logUnhandledBlendMode(J,Q,q){if(FW.get(J))return;FW.set(J,!0),n64js.warn(`Unhandled blend mode: ${x(J)} = ${lJ(J)}, alphaCvgSel ${Q}, cvgXAlpha ${q}`)}}class NW{constructor(){this.initDimensions(320,240)}initDimensions(J,Q){this.viWidth=J,this.viHeight=Q,this.n64FramebufferToDevice=new sq(new N0(2/J,-2/Q),new N0(-1,1));const q=J/2,Y=Q/2,Z=512,K=511,X=new o0(q,-Y,Z,1),W=new o0(q,+Y,K,0);this.viTransform=new NJ(X,W)}convertN64ToDisplay(J){return this.n64FramebufferToDevice.transform(J)}}function PW(J){R0.initUI();const Q=J[0];if(oH(Q),!U6)return;W6=new eq(U6,I0,640,480),W6.hleHalt=wW,R0.renderer=W6}function VW(){if(W6)W6.reset()}var oH=function(J){if(U6)return;try{U6=J.getContext("webgl")||J.getContext("experimental-webgl")}catch(Q){}if(!U6)alert("Unable to initialize WebGL. Your browser may not support it.")};function UW(){return R0.running}function MW(){return R0.requested}function hW(){R0.toggle()}function OW(){R0.debugDisplayList()}function EW(J){R0.onNewTask(J),AW(J,null,-1)}function x9(){if(n64js.onPresent(),LW!==0){W6.copyBackBufferToFrontBuffer();return}kW();const J=n64js.hardware().viRegDevice,Q=J.renderBackBuffer();if(!Q)return;W6.copyPixelsToFrontBuffer(Q,J.screenWidth,J.screenHeight,J.bitDepth)}var AW=function(J,Q,q){if(LW++,!U6)return;const Y=n64js.hardware().cachedMemDevice.mem.dataView;I0.reset(Y,J.dataPtr);let Z=GW(J,Y),K=Z.buildCommandTable();if(Z.onLoadUcode((X,W,z,F)=>{return J.loadUcode(X,W,z,F),Z=GW(J,Y),K=Z.buildCommandTable(),Z}),kW(),W6.newFrame(),Q){R0.currentOp=0;while(I0.nextCommand())Q.begin(I0.cmd0,I0.cmd1,I0.dlistStack.length),K[I0.cmd0>>>24](I0.cmd0,I0.cmd1,Q),Q.end(),R0.currentOp++}else{R0.currentOp=0;while(I0.nextCommand())if(K[I0.cmd0>>>24](I0.cmd0,I0.cmd1),R0.postOp(q))break}U6.bindFramebuffer(U6.FRAMEBUFFER,null)},kW=function(){const Q=n64js.hardware().viRegDevice.computeDimensions();if(!Q)return;W6.nativeTransform.initDimensions(Q.srcWidth,Q.srcHeight);const q=document.getElementById("display");q.width=Q.screenWidth*K6.canvasScale,q.height=Q.screenHeight*K6.canvasScale},GW=function(J,Q){const q=eX(J,I0,Q);return q.debugController=R0,q.hleHalt=wW,q.gl=U6,q.renderer=W6,q},wW=function(J){if(R0.running)return;n64js.ui().displayWarning(J),n64js.breakEmulationForDisplayListDebug(),R0.halt()};window.n64js=window.n64js||{};var LW=0,U6=null,W6,I0=new rq,R0=new yq(I0,AW);var QF=function(J){return J<<tH},qF=function(J){return J<<q$},YF=function(J){return J<<Y$},a0=function(J){const Q=J&ZQ,q=J&ZF;if(Q==ZQ){if(q==0)return J&s6?h6:M6;return J&KF?p0:O6}if(Q==0){if(q!=0)return r0;return J&s6?XY:KY}return X$},z6=function(J){const Q=J&KQ,q=J&WF;if(Q==KQ){if(q==0)return J&i6?h6:M6;return J&$F?p0:O6}if(Q==0){if(q!=0)return r0;return J&i6?XY:KY}return X$},YQ=function(J){return J==p0||J==O6},d6=function(J){return J==KY||J==XY},H6=function(J){return J==M6||J==h6},ZY=function(J,Q,q){return J[Q*2+(q?1:0)]},W$=function(J){if(J.length!=8)throw"Case table is unexpected size.";return J},dW=function(J,Q){return J[Q]},WY=function(J){if(J.length!=XQ)throw"Case table is unexpected size.";return J},iW=function(J,Q,q){return J[Q*XQ+q]},WQ=function(J){if(J.length!=XQ*XQ)throw"Case table is unexpected size.";return J},CW=0,yW=1,DW=2,IW=3,BW=4,RW=5,bW=6,TW=7,p9=8,m9=9,n9=10,o9=11,c9=12,l9=13,d9=14,a9=15,r9=32,s9=33,i9=36,t9=37,cH=0,lH=1,dH=2,aH=3;var rH=128,sH=256;var _W=131072,SW=8388608,iH=16777216,e9=3,G0=1,JQ=2,GJ=4,vW=8,$6=16,tH=2,q$=7,Y$=12;var eH=3968,fW=258048,JF=25427967,s6=2147483648,ZQ=2139095040,ZF=8388607,KF=1<<22,QQ=2143289343,JY=0,QY=s6,Z$=8388608,XF=s6|Z$,uW=ZQ,gW=s6|ZQ,i6=0x8000_0000_0000_0000n,KQ=0x7ff0_0000_0000_0000n,WF=0x000f_ffff_ffff_ffffn,$F=1n<<51n,qQ=0x7ff7_ffff_ffff_ffffn,qY=0n,YY=i6,K$=0x0010_0000_0000_0000n,zF=i6|K$,xW=KQ,pW=i6|KQ,mW=Number.MAX_SAFE_INTEGER,nW=Number.MIN_SAFE_INTEGER,oW=2147483647,cW=-2147483648,X$=0,KY=1,XY=2,M6=3,h6=4,p0=5,O6=6,r0=7,XQ=8,lW=W$([QY,JY,QY,JY,QY,Z$,XF,JY]),HF=W$([YY,qY,YY,qY,YY,K$,zF,qY]),I=0,O=1,F6=2,e=3,i=4,L0=5,x0=6,D8=7,a6=8,r6=9,aW=WY([D8,D8,D8,D8,I,I,O,O]),rW=WY([a6,a6,a6,a6,a6,I,O,O]),sW=WY([r6,r6,r6,r6,r6,I,O,O]),tW=WQ([e,e,e,e,e,I,O,O,e,e,e,e,e,I,O,O,e,e,e,e,e,I,O,O,e,e,e,e,I,I,O,O,e,e,e,I,e,I,O,O,I,I,I,I,I,I,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O]),eW=WQ([i,i,i,i,i,I,O,O,i,i,i,i,i,I,O,O,i,i,i,i,i,I,O,O,i,i,i,i,i,I,O,O,i,i,i,i,i,I,O,O,I,I,I,I,I,I,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O]),J$=WQ([L0,L0,L0,L0,L0,I,O,O,L0,L0,L0,I,I,I,O,O,L0,L0,L0,I,I,I,O,O,L0,I,I,L0,L0,I,O,O,L0,I,I,L0,L0,I,O,O,I,I,I,I,I,I,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O]),Q$=WQ([x0,F6,F6,x0,x0,I,O,O,x0,I,F6,x0,x0,I,O,O,x0,I,F6,x0,x0,I,O,O,x0,F6,F6,I,I,I,O,O,x0,F6,F6,I,I,I,O,O,I,I,I,I,I,I,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O]),c0=0,s0=1,i0=2,t0=3;class $Y{constructor(J){this.cpu0=J,this.control=new Uint32Array(32),this.mem=new ArrayBuffer(256),this.regF32=new Float32Array(this.mem),this.regF64=new Float64Array(this.mem),this.regS32=new Int32Array(this.mem),this.regU32=new Uint32Array(this.mem),this.regS64=new BigInt64Array(this.mem),this.regU64=new BigUint64Array(this.mem),this.regIdx32_cop=new Uint32Array(new ArrayBuffer(128)),this.regIdx32_d=new Uint32Array(new ArrayBuffer(128)),this.regIdx32_s=new Uint32Array(new ArrayBuffer(128)),this.regIdx32_t=new Uint32Array(new ArrayBuffer(128)),this.regIdx64_cop=new Uint32Array(new ArrayBuffer(128)),this.regIdx64_d=new Uint32Array(new ArrayBuffer(128)),this.regIdx64_s=new Uint32Array(new ArrayBuffer(128)),this.regIdx64_t=new Uint32Array(new ArrayBuffer(128)),this.tempBuf=new ArrayBuffer(8),this.tempF32=new Float32Array(this.tempBuf),this.tempF64=new Float64Array(this.tempBuf),this.tempU32=new Uint32Array(this.tempBuf),this.tempS32=new Int32Array(this.tempBuf),this.tempU64=new BigUint64Array(this.tempBuf),this.tempS64=new BigInt64Array(this.tempBuf),this._fullMode=!0,this.fullMode=!0,this.reset()}reset(){for(var J=0;J<32;++J)this.control[J]=0,this.regS64[J]=0n;this.control[0]=2560,this.fullMode=!0}set fullMode(J){if(this._fullMode=J,this._fullMode)for(let Q=0;Q<32;Q++)this.regIdx32_cop[Q]=Q*2,this.regIdx32_d[Q]=Q*2,this.regIdx32_s[Q]=Q*2,this.regIdx32_t[Q]=Q*2,this.regIdx64_cop[Q]=Q,this.regIdx64_d[Q]=Q,this.regIdx64_s[Q]=Q,this.regIdx64_t[Q]=Q;else for(let Q=0;Q<32;Q++){const q=Q&~1;this.regIdx32_cop[Q]=q*2+(Q&1),this.regIdx32_d[Q]=Q*2,this.regIdx32_s[Q]=q*2,this.regIdx32_t[Q]=Q*2,this.regIdx64_cop[Q]=q,this.regIdx64_d[Q]=Q,this.regIdx64_s[Q]=q,this.regIdx64_t[Q]=Q}}execSInstr(J,Q,q,Y){if(J<48){switch(J){case CW:this.ADD_S(Q,q,Y);return;case yW:this.SUB_S(Q,q,Y);return;case DW:this.MUL_S(Q,q,Y);return;case IW:this.DIV_S(Q,q,Y);return;case BW:this.SQRT_S(Q,q);return;case RW:this.ABS_S(Q,q);return;case bW:this.MOV_S(Q,q);return;case TW:this.NEG_S(Q,q);return;case p9:this.ConvertSToL(Q,q,c0);return;case m9:this.ConvertSToL(Q,q,s0);return;case n9:this.ConvertSToL(Q,q,i0);return;case o9:this.ConvertSToL(Q,q,t0);return;case c9:this.ConvertSToW(Q,q,c0);return;case l9:this.ConvertSToW(Q,q,s0);return;case d9:this.ConvertSToW(Q,q,i0);return;case a9:this.ConvertSToW(Q,q,t0);return;case r9:this.raiseUnimplemented();return;case s9:this.CVT_D_S(Q,q);return;case i9:this.ConvertSToW(Q,q,this.roundingMode);return;case t9:this.ConvertSToL(Q,q,this.roundingMode);return}r(!1,"unhandled S instruction"),this.raiseUnimplemented()}else this.handleFloatCompareSingle(J,q,Y)}execDInstr(J,Q,q,Y){if(J<48){switch(J){case CW:this.ADD_D(Q,q,Y);return;case yW:this.SUB_D(Q,q,Y);return;case DW:this.MUL_D(Q,q,Y);return;case IW:this.DIV_D(Q,q,Y);return;case BW:this.SQRT_D(Q,q);return;case RW:this.ABS_D(Q,q);return;case bW:this.MOV_D(Q,q);return;case TW:this.NEG_D(Q,q);return;case p9:this.ConvertDToL(Q,q,c0);return;case m9:this.ConvertDToL(Q,q,s0);return;case n9:this.ConvertDToL(Q,q,i0);return;case o9:this.ConvertDToL(Q,q,t0);return;case c9:this.ConvertDToW(Q,q,c0);return;case l9:this.ConvertDToW(Q,q,s0);return;case d9:this.ConvertDToW(Q,q,i0);return;case a9:this.ConvertDToW(Q,q,t0);return;case r9:this.CVT_S_D(Q,q);return;case s9:this.raiseUnimplemented();return;case i9:this.ConvertDToW(Q,q,this.roundingMode);return;case t9:this.ConvertDToL(Q,q,this.roundingMode);return}r(!1,"unhandled D instruction"),this.raiseUnimplemented()}else this.handleFloatCompareDouble(J,q,Y)}execWInstr(J,Q,q,Y){switch(J){case p9:this.raiseUnimplemented();return;case m9:this.raiseUnimplemented();return;case n9:this.raiseUnimplemented();return;case o9:this.raiseUnimplemented();return;case c9:this.raiseUnimplemented();return;case l9:this.raiseUnimplemented();return;case d9:this.raiseUnimplemented();return;case a9:this.raiseUnimplemented();return;case r9:this.CVT_S_W(Q,q);return;case s9:this.CVT_D_W(Q,q);return;case i9:this.raiseUnimplemented();return;case t9:this.raiseUnimplemented();return}r(!1,"unhandled W instruction"),this.raiseUnimplemented()}execLInstr(J,Q,q,Y){switch(J){case p9:this.raiseUnimplemented();return;case m9:this.raiseUnimplemented();return;case n9:this.raiseUnimplemented();return;case o9:this.raiseUnimplemented();return;case c9:this.raiseUnimplemented();return;case l9:this.raiseUnimplemented();return;case d9:this.raiseUnimplemented();return;case a9:this.raiseUnimplemented();return;case r9:this.CVT_S_L(Q,q);return;case s9:this.CVT_D_L(Q,q);return;case i9:this.raiseUnimplemented();return;case t9:this.raiseUnimplemented();return}r(!1,"unhandled L instruction"),this.raiseUnimplemented()}handleFloatCompareSingle(J,Q,q){const Y=a0(this.loadU32(this.fsRegIdx32(Q))),Z=a0(this.loadU32(this.ftRegIdx32(q)));let K=!1;if(YQ(Y)||YQ(Z)){if(J&8||Y==p0||Z==p0){if(this.raiseException($6))return}if(J&1)K=!0}else{const X=this.loadF32(this.fsRegIdx32(Q)),W=this.loadF32(this.ftRegIdx32(q));if(J&4)K|=X<W;if(J&2)K|=X==W}this.setCondition(K)}handleFloatCompareDouble(J,Q,q){const Y=z6(this.loadU64(this.fsRegIdx64(Q))),Z=z6(this.loadU64(this.ftRegIdx64(q)));let K=!1;if(YQ(Y)||YQ(Z)){if(J&8||Y==p0||Z==p0){if(this.raiseException($6))return}if(J&1)K=!0}else{const X=this.loadF64(this.fsRegIdx64(Q)),W=this.loadF64(this.ftRegIdx64(q));if(J&4)K|=X<W;if(J&2)K|=X==W}this.setCondition(K)}DCFC1(J,Q){this.clearCause(),this.raiseUnimplemented()}DCTC1(J,Q){this.clearCause(),this.raiseUnimplemented()}MOV_S(J,Q){this.store64(this.fdRegIdx64(J),this.loadU64(this.fsRegIdx64(Q)))}SQRT_S(J,Q){this.f32UnaryOp(J,Q,aW)}ABS_S(J,Q){this.f32UnaryOp(J,Q,rW)}NEG_S(J,Q){this.f32UnaryOp(J,Q,sW)}ADD_S(J,Q,q){this.f32BinaryOp(J,Q,q,tW)}SUB_S(J,Q,q){this.f32BinaryOp(J,Q,q,eW)}MUL_S(J,Q,q){this.f32BinaryOp(J,Q,q,J$)}DIV_S(J,Q,q){this.f32BinaryOp(J,Q,q,Q$)}MOV_D(J,Q){this.store64(this.fdRegIdx64(J),this.loadU64(this.fsRegIdx64(Q)))}SQRT_D(J,Q){this.f64UnaryOp(J,Q,aW)}ABS_D(J,Q){this.f64UnaryOp(J,Q,rW)}NEG_D(J,Q){this.f64UnaryOp(J,Q,sW)}ADD_D(J,Q,q){this.f64BinaryOp(J,Q,q,tW)}SUB_D(J,Q,q){this.f64BinaryOp(J,Q,q,eW)}MUL_D(J,Q,q){this.f64BinaryOp(J,Q,q,J$)}DIV_D(J,Q,q){this.f64BinaryOp(J,Q,q,Q$)}CVT_S_D(J,Q){this.clearCause();const q=z6(this.loadU64(this.fsRegIdx64(Q)));let Y=0;switch(q){case O6:case r0:this.raiseUnimplemented();return;case p0:Y|=$6,this.tempU32[0]=QQ;break;case M6:this.tempU32[0]=uW;break;case h6:this.tempU32[0]=gW;break;default:const Z=this.loadF64(this.fsRegIdx64(Q));this.tempF32[0]=Z;const K=a0(this.tempU32[0]);if(Z!=this.tempF32[0])Y|=G0;if((K==r0||d6(K))&&Z!=0)Y|=G0|JQ,this.tempU32[0]=ZY(lW,this.control[31]&e9,Z>0);if(!isFinite(this.tempF32[0]))Y|=GJ;break}if(this.raiseException(Y))return;this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}CVT_S_W(J,Q){this.clearCause();const q=this.loadS32(this.fsRegIdx32(Q));this.tempF32[0]=q;let Y=0;if(q!=this.tempF32[0])Y|=G0;if(this.raiseException(Y))return;this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}CVT_S_L(J,Q){this.clearCause();const q=this.loadS64(this.fsRegIdx64(Q));if(q>=1n<<55n||q<-(1n<<55n)){this.raiseUnimplemented();return}this.tempF32[0]=Number(q);let Y=0;if(q!=this.tempF32[0])Y|=G0;if(this.raiseException(Y))return;this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}f32UnaryOp(J,Q,q){this.clearCause();const Y=this.loadF32(this.fsRegIdx32(Q)),Z=a0(this.loadU32(this.fsRegIdx32(Q))),K=dW(q,Z);let X;switch(K){case O:this.raiseUnimplemented();return;case I:if(!this.raiseException($6))this.store32ZeroExtend(this.fdRegIdx32(J),QQ);return;case D8:if(Y<0){if(!this.raiseException($6))this.store32ZeroExtend(this.fdRegIdx32(J),QQ);return}X=Math.sqrt(Y);break;case a6:X=Math.abs(Y);break;case r6:X=-Y;break;default:throw`unhandled op case: ${K}`}this.tempF32[0]=X;const W=a0(this.tempU32[0]);let z=0;if(X!=this.tempF32[0])z|=G0;if(H6(W)&&!H6(Z))z|=G0|GJ;if(!this.raiseException(z))this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}f32BinaryOp(J,Q,q,Y){this.clearCause();const Z=this.loadF32(this.fsRegIdx32(Q)),K=this.loadF32(this.ftRegIdx32(q)),X=this.loadU32(this.fsRegIdx32(Q)),W=this.loadU32(this.ftRegIdx32(q)),z=a0(X),F=a0(W),N=iW(Y,z,F);let G;switch(N){case O:this.raiseUnimplemented();return;case I:if(!this.raiseException($6))this.store32ZeroExtend(this.fdRegIdx32(J),QQ);return;case F6:if(!this.raiseException(vW)){const U=(X&s6)==(W&s6);this.store32ZeroExtend(this.fdRegIdx32(J),U?uW:gW)}return;case e:G=Z+K;break;case i:G=Z-K;break;case L0:G=Z*K;break;case x0:G=Z/K;break;default:throw`unhandled op case: ${N}`}this.tempF32[0]=G;const P=a0(this.tempU32[0]);let L=0;if(G!=this.tempF32[0])L|=G0;if(N==e||N==i){if(!d6(F)&&G==Z||!d6(z)&&G==K)L|=G0}if(H6(P)&&!H6(z)&&!H6(F))L|=G0|GJ;if((P==r0||d6(P))&&G!=0)L|=G0|JQ,this.tempU32[0]=ZY(lW,this.control[31]&e9,G>0);if(!this.raiseException(L))this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}CVT_D_S(J,Q){this.clearCause();let q=0;switch(a0(this.loadU32(this.fsRegIdx32(Q)))){case O6:case r0:this.raiseUnimplemented();return;case p0:q|=$6,this.tempU64[0]=qQ;break;case M6:this.tempU64[0]=xW;break;case h6:this.tempU64[0]=pW;break;default:const Z=this.loadF32(this.fsRegIdx32(Q));this.tempF64[0]=Z;break}if(this.raiseException(q))return;this.store64(this.fdRegIdx64(J),this.tempU64[0])}CVT_D_W(J,Q){this.clearCause(),this.tempF64[0]=this.loadS32(this.fsRegIdx32(Q)),this.store64(this.fdRegIdx64(J),this.tempU64[0])}CVT_D_L(J,Q){this.clearCause();const q=this.loadS64(this.fsRegIdx64(Q));if(q>=1n<<55n||q<-(1n<<55n)){this.raiseUnimplemented();return}let Y=0;if(this.tempF64[0]=Number(q),this.raiseException(Y))return;this.store64(this.fdRegIdx64(J),this.tempU64[0])}f64UnaryOp(J,Q,q){this.clearCause();const Y=this.loadF64(this.fsRegIdx64(Q)),Z=z6(this.loadU64(this.fsRegIdx64(Q))),K=dW(q,Z);let X;switch(K){case O:this.raiseUnimplemented();return;case I:if(!this.raiseException($6))this.store64(this.fdRegIdx64(J),qQ);return;case D8:if(Y<0){if(!this.raiseException($6))this.store64(this.fdRegIdx64(J),qQ);return}X=Math.sqrt(Y);break;case a6:X=Math.abs(Y);break;case r6:X=-Y;break;default:throw`unhandled op case: ${K}`}this.tempF64[0]=X;const W=z6(this.tempU64[0]);let z=0;if(X!=this.tempF64[0])z|=G0;if(H6(W)&&!H6(Z))z|=G0|GJ;if(!this.raiseException(z))this.store64(this.fdRegIdx64(J),this.tempU64[0])}f64BinaryOp(J,Q,q,Y){this.clearCause();const Z=this.loadF64(this.fsRegIdx64(Q)),K=this.loadF64(this.ftRegIdx64(q)),X=this.loadU64(this.fsRegIdx64(Q)),W=this.loadU64(this.ftRegIdx64(q)),z=z6(X),F=z6(W),N=iW(Y,z,F);let G;switch(N){case O:this.raiseUnimplemented();return;case I:if(!this.raiseException($6))this.store64(this.fdRegIdx64(J),qQ);return;case F6:if(!this.raiseException(vW)){const U=(X&i6)==(W&i6);this.store64(this.fdRegIdx64(J),U?xW:pW)}return;case e:G=Z+K;break;case i:G=Z-K;break;case L0:G=Z*K;break;case x0:G=Z/K;break;default:throw`unhandled op case: ${N}`}this.tempF64[0]=G;const P=z6(this.tempU64[0]);let L=0;if(N==e||N==i){if(!d6(F)&&G==Z||!d6(z)&&G==K)L|=G0}if(H6(P)&&!H6(z)&&!H6(F))L|=G0|GJ;if((P==r0||d6(P))&&G!=0)L|=G0|JQ,this.tempU64[0]=ZY(HF,this.control[31]&e9,G>0);if(!this.raiseException(L))this.store64(this.fdRegIdx64(J),this.tempU64[0])}ConvertSToL(J,Q,q){this.clearCause();let Y=0;switch(a0(this.loadU32(this.fsRegIdx32(Q)))){case O6:case p0:case r0:case M6:case h6:this.raiseUnimplemented();return;default:const K=this.loadF32(this.fsRegIdx32(Q)),X=this.convertUsingMode(K,q);if(X>mW||X<nW){this.raiseUnimplemented();return}if(this.tempS64[0]=BigInt(X),K!=this.tempS64[0])Y|=G0;break}if(this.raiseException(Y))return;this.store64(this.fdRegIdx64(J),this.tempS64[0])}ConvertDToL(J,Q,q){this.clearCause();const Y=z6(this.loadU64(this.fsRegIdx64(Q)));let Z=0;switch(Y){case O6:case p0:case r0:case M6:case h6:this.raiseUnimplemented();return;default:const K=this.loadF64(this.fsRegIdx64(Q)),X=this.convertUsingMode(K,q);if(X>mW||X<nW){this.raiseUnimplemented();return}if(this.tempS64[0]=BigInt(X),K!=this.tempS64[0])Z|=G0;break}if(this.raiseException(Z))return;this.store64(this.fdRegIdx64(J),this.tempS64[0])}ConvertSToW(J,Q,q){this.clearCause();const Y=a0(this.loadU32(this.fsRegIdx32(Q)));let Z=0;switch(Y){case O6:case p0:case r0:case M6:case h6:this.raiseUnimplemented();return;default:const K=this.loadF32(this.fsRegIdx32(Q)),X=this.convertUsingMode(K,q);if(X>oW||X<cW){this.raiseUnimplemented();return}if(this.tempS32[0]=X,K!=this.tempS32[0])Z|=G0;break}if(this.raiseException(Z))return;this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}ConvertDToW(J,Q,q){this.clearCause();const Y=z6(this.loadU64(this.fsRegIdx64(Q)));let Z=0;switch(Y){case O6:case p0:case r0:case M6:case h6:this.raiseUnimplemented();return;default:const K=this.loadF64(this.fsRegIdx64(Q)),X=this.convertUsingMode(K,q);if(X>oW||X<cW){this.raiseUnimplemented();return}if(this.tempS32[0]=X,K!=this.tempS32[0])Z|=G0;break}if(this.raiseException(Z))return;this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}get roundingMode(){switch(this.control[31]&e9){case cH:return c0;case lH:return s0;case dH:return i0;case aH:return t0}return r(!1,"unknown rounding mode"),c0}convertUsingMode(J,Q){switch(Q){case c0:return this.round(J);case s0:return this.trunc(J);case i0:return Math.ceil(J);case t0:return Math.floor(J)}r(!1,"unknown rounding mode")}round(J){const Q=Math.floor(J);if(J-Q==0.5){const Y=Math.ceil(J);if(J<0)return Y%2!=0?Q:Y;return Q%2!=0?Y:Q}return Math.round(J)}trunc(J){if(J<0)return Math.ceil(J);return Math.floor(J)}setCondition(J){if(J)this.control[31]|=SW;else this.control[31]&=~SW}get flushSubnormals(){return(this.control[31]&iH)!=0}clearCause(){this.control[31]&=~fW}raiseException(J){if(!J)return!1;if(J&JQ){if((this.control[31]&(sH|rH))!=0||!this.flushSubnormals)return this.raiseUnimplemented()}const Q=qF(J),q=YF(J),Y=QF(J);return this.setStatusBits(Q,q,Y)}raiseUnimplemented(J){return this.control[31]|=_W,this.cpu0.raiseFPE(),!0}setStatusBits(J,Q,q){if(this.control[31]&J)return this.control[31]|=Q,this.cpu0.raiseFPE(),!0;return this.control[31]|=q|Q,!1}setStatus(J){this.control[31]=J&JF;const Q=(J&eH)>>q$,q=(J&fW)>>Y$;if(Q&q||J&_W)return this.cpu0.raiseFPE(),!0;return!1}copRegIdx32(J){return this.regIdx32_cop[J]}fdRegIdx32(J){return this.regIdx32_d[J]}fsRegIdx32(J){return this.regIdx32_s[J]}ftRegIdx32(J){return this.regIdx32_t[J]}copRegIdx64(J){return this.regIdx64_cop[J]}fdRegIdx64(J){return this.regIdx64_d[J]}fsRegIdx64(J){return this.regIdx64_s[J]}ftRegIdx64(J){return this.regIdx64_t[J]}store64(J,Q){this.regU64[J]=Q}store32ZeroExtend(J,Q){this.regU32[J]=Q|0,this.regU32[J+1]=0}store32(J,Q){this.regU32[J]=Q|0}loadS32(J){return this.regS32[J]}loadU32(J){return this.regU32[J]}loadF32(J){return this.regF32[J]}loadU64(J){return this.regU64[J]}loadF64(J){return this.regF64[J]}loadS64(J){return this.regS64[J]}dump(){let J="Regs: ";for(let Q=0;Q<6;+Q++)J+=j(this.regS32[Q])+", ";M(J),M(`float32: [${this.regF32[0]}, ${this.regF32[1]}, ${this.regF32[2]}, ${this.regF32[3]}, ${this.regF32[4]}, ${this.regF32[5]}, ...]`),M(`float64: [${this.regF64[0]}, ${this.regF64[1]}, ...]`),console.log("")}}function $$(J,Q){b0=J.memMap.getMemoryHandler.bind(J.memMap),l0=J.cachedMemDevice.mem.dataView,E6=Q}function FF(J){if(J&7)E6.unalignedLoad(J);return b0(J).readU64(J)}function jF(J){if(J&1)E6.unalignedLoad(J);return b0(J).readU16(J)}function NF(J){if(J&3)E6.unalignedLoad(J);return b0(J).readU32(J)}function GF(J){return b0(J).readU8(J)}function zY(J){if(J&3)E6.unalignedLoad(J);return b0(J).readS32(J)}function LF(J){if(J&1)E6.unalignedLoad(J);return b0(J).readS16(J)}function PF(J){return b0(J).readS8(J)}function VF(J,Q){if(J&7)E6.unalignedStore(J);b0(J).write64(J,Q)}function UF(J,Q){if(J&3)E6.unalignedStore(J);b0(J).write32(J,Q)}function MF(J,Q){if(J&1)E6.unalignedStore(J);b0(J).write16(J,Q)}function hF(J,Q){b0(J).write8(J,Q)}function $Q(J,Q,q){b0(J).write32masked(J,Q,q)}function zQ(J,Q,q){b0(J).write64masked(J,Q,q)}function HY(J){if(J<-2139095040){const Q=J+2147483648|0;return l0.getUint8(Q,!1)}return GF(J>>>0)}function FY(J){if(J<-2139095040){const Q=J+2147483648|0;return l0.getInt8(Q,!1)}return PF(J>>>0)}function jY(J){if((J&1)==0&&J<-2139095040){const Q=J+2147483648|0;return l0.getUint16(Q,!1)}return jF(J>>>0)}function NY(J){if((J&1)==0&&J<-2139095040){const Q=J+2147483648|0;return l0.getInt16(Q,!1)}return LF(J>>>0)}function LJ(J){if((J&3)==0&&J<-2139095040){const Q=J+2147483648|0;return l0.getUint32(Q,!1)}return NF(J>>>0)}function PJ(J){if((J&3)==0&&J<-2139095040){const Q=J+2147483648|0;return l0.getInt32(Q,!1)}return zY(J>>>0)}function t6(J){if((J&7)==0&&J<-2139095040){const Q=J+2147483648|0;return l0.getBigUint64(Q,!1)}return FF(J>>>0)}function GY(J,Q){if(J<-2139095040){const q=J+2147483648|0;l0.setUint8(q,Q,!1);return}hF(J>>>0,Q)}function LY(J,Q){if((J&1)==0&&J<-2139095040){const q=J+2147483648|0;l0.setUint16(q,Q,!1);return}MF(J>>>0,Q)}function VJ(J,Q){if((J&3)==0&&J<-2139095040){const q=J+2147483648|0;l0.setUint32(q,Q,!1);return}UF(J>>>0,Q)}function UJ(J,Q){if((J&7)==0&&J<-2139095040){const q=J+2147483648|0;l0.setBigUint64(q,Q,!1);return}VF(J>>>0,Q)}var b0,l0,E6;class PY{constructor(){this.cyclesToFirstEvent=0,this.firstEvent=null}reset(){this.cyclesToFirstEvent=0,this.firstEvent=null}nextEventCountdown(){return this.cyclesToFirstEvent}incrementCount(J){this.cyclesToFirstEvent-=J;while(this.cyclesToFirstEvent<=0){const Q=this.firstEvent;if(!Q)break;this.unlink(Q),Q.handler()}}unlink(J){if(J.prev)J.prev.cyclesToNextEvent=J.next?J.prev.cyclesToNextEvent+J.cyclesToNextEvent:0,J.prev.next=J.next;else this.cyclesToFirstEvent=J.next?this.cyclesToFirstEvent+J.cyclesToNextEvent:0,this.firstEvent=J.next;if(J.next)J.next.prev=J.prev;J.prev=null,J.next=null}insertAfter(J,Q,q,Y){const Z=J?J.next:this.firstEvent;if(q.cyclesToNextEvent=Z?Q-Y:0,r(q.cyclesToNextEvent>=0,"cyclesToNextEvent must be positive or zero"),q.next=Z,q.prev=J,Z)Z.prev=q;if(J)J.cyclesToNextEvent=Y,J.next=q;else this.cyclesToFirstEvent=Y,this.firstEvent=q}skipToNextEvent(J){if(!this.firstEvent||this.cyclesToFirstEvent<J)return 0;const Q=this.cyclesToFirstEvent-J;return this.cyclesToFirstEvent=J,Q}addEvent(J,Q,q){r(!this.hasEvent(J),`Already has event of type ${J}`),r(Q>0,"cycles must be positive");const Y=new z$(J,q);let Z=null,K=this.cyclesToFirstEvent;for(let X=this.firstEvent;X;X=X.next){if(Q<=K){this.insertAfter(Z,K,Y,Q);return}Q-=K,K=X.cyclesToNextEvent,Z=X}this.insertAfter(Z,K,Y,Q)}removeEvent(J){let Q=this.cyclesToFirstEvent;for(let q=this.firstEvent;q;q=q.next){if(q.type==J)return this.unlink(q),Q;Q+=q.cyclesToNextEvent}return-1}getEvent(J){for(let Q=this.firstEvent;Q;Q=Q.next)if(Q.type==J)return Q;return null}getCyclesUntilEvent(J){let Q=this.cyclesToFirstEvent;for(let q=this.firstEvent;q;q=q.next){if(q.type==J)return Q;Q+=q.cyclesToNextEvent}return-1}hasEvent(J){return Boolean(this.getEvent(J))}}class z${constructor(J,Q){this.type=J,this.cyclesToNextEvent=0,this.handler=Q,this.prev=null,this.next=null}getName(){return this.type}}var I8=!0,e6=!1;function M$(J){J.needsDelayCheck=J.fragment.needsDelayCheck,J.isTrivial=!1;let Q="";if(H$)Q=T0(`
      if (c.pc != ${j(J.pc)}) {
        throw 'expected pc ${j(J.pc)}, got ' + c.pc.toString(16);
      }
    `);let q=Q+ON(J);if(J.dump)console.log(q);if(!J.isTrivial&&J.delayedPCUpdate!==0)J.fragment.bodyCode+=`// Applying delayed pc\nc.pc = ${j(J.delayedPCUpdate)};\n`,J.delayedPCUpdate=0;if(J.fragment.needsDelayCheck=J.needsDelayCheck,J.fragment.bailedOut|=J.bailOut,n64js.getSyncFlow())q=`if (!n64js.checkSyncState(sync, ${j(J.pc)})) { return ${J.fragment.opsCompiled}; }\n${q}`;const Z=vJ(J.pc,J.instruction,!1),K=kF(q,"  ");J.fragment.bodyCode+=`// ${Z.disassembly}
{
${K}
}

`}var kF=function(J,Q){return T0(J).split("\n").filter((X)=>X!="").map((X)=>Q+X).join("\n")},T0=function(J){J=J.replace(/^\n/,"");const Q=J.match(/^\s+/);if(!Q)return J;const q=Q[0];return Q?J.replace(new RegExp("^"+q,"gm"),""):J},J8=function(J){if(!J.startsWith("\n"))J="\n"+J;if(!J.endsWith("\n"))J+="\n";return J},h$=function(J,Q,q){let Y="";if(Y+=Q.genAssert(`c.pc === ${j(Q.pc)}`,"pc mismatch"),Q.needsDelayCheck)Y+=`if (c.delayPC) { c.nextPC = c.delayPC; c.delayPC = 0; } else { c.nextPC = ${j(Q.pc+4)}; }\n`,Y+=J8(J),Y+="c.pc = c.nextPC;\n";else if(q)Y+=Q.genAssert("c.delayPC === 0","delay pc should be zero"),Y+=`c.nextPC = ${j(Q.pc+4)};\n`,Y+=J8(J),Y+="c.pc = c.nextPC;\n";else Y+=Q.genAssert("c.delayPC === 0","delay pc should be zero"),Y+=J8(J),Y+=`c.pc = ${j(Q.pc+4)};\n`;return Y},T=function(J,Q){let q="";if(q+=Q.genAssert(`c.pc === ${j(Q.pc)}`,"pc mismatch"),Q.needsDelayCheck)q+=`c.nextPC = c.delayPC || ${j(Q.pc+4)};\n`;else q+=Q.genAssert("c.delayPC === 0","delay pc should be zero"),q+=`c.nextPC = ${j(Q.pc+4)};\n`;if(q+="c.branchTarget = 0;\n",q+=J8(J),q+="c.pc = c.nextPC;\n",q+="c.delayPC = c.branchTarget;\n",Q.needsDelayCheck=!0,e6)q+="c.incrementCount(1);\n";if(Q.bailOut)q+=`return ${Q.fragment.opsCompiled};\n`;else q+=`if (c.stuffToDo) { return ${Q.fragment.opsCompiled}; }\n`,q+=`if (c.pc !== ${j(Q.postPC)}) { return ${Q.fragment.opsCompiled}; }\n`;return q},t=function(J,Q){let q="";if(q+=h$(J,Q,!0),q+=Q.genAssert("c.delayPC === 0","delay pc should be zero"),Q.needsDelayCheck=!1,e6)q+="c.incrementCount(1);\n";return r(!Q.bailOut,"Not expecting bailOut to be set for memory access"),q+=`if (c.stuffToDo) { return ${Q.fragment.opsCompiled}; }\n`,q+=`if (c.pc !== ${j(Q.postPC)}) { return ${Q.fragment.opsCompiled}; }\n`,q},y0=function(J,Q,q){let Y="";const Z=Q.needsDelayCheck||q||Q.postPC!==Q.pc+4;if(Y+=h$(J,Q,q),Q.needsDelayCheck=!0,e6)Y+="c.incrementCount(1);\n";if(Y+=Q.genAssert("c.stuffToDo === 0","stuffToDo should be zero"),Q.bailOut)Y+=`return ${Q.fragment.opsCompiled};\n`;else if(Z)Y+=`if (c.pc !== ${j(Q.postPC)}) { return ${Q.fragment.opsCompiled}; }\n`;else Y+="// Skipping pc test\n";return Y},_=function(J,Q){let q="";if(q+=J8(J),Q.isTrivial=!0,e6)q+="c.incrementCount(1);\n";if(Q.needsDelayCheck)q+=`if (c.delayPC) { c.pc = c.delayPC; c.delayPC = 0; } else { c.pc = ${j(Q.pc+4)}; }\n`,q+=`if (c.pc !== ${j(Q.postPC)}) { return ${Q.fragment.opsCompiled}; }\n`;else{q+=Q.genAssert("c.delayPC === 0","delay pc should be zero");const Y=Q.pc+4;if(Q.postPC!==Y)r("postPC should always be pc+4 for trival ops?"),q+=`c.pc = ${j(Y)};\n`,q+=`if (c.pc !== ${j(Q.postPC)}) { return ${Q.fragment.opsCompiled}; }\n`;else if(q+="// Delaying pc update\n",Q.delayedPCUpdate=Y,H$)q+=`c.pc = ${j(Y)};\n`}return q+=Q.genAssert("c.delayPC === 0","delay pc should be zero"),Q.needsDelayCheck=!1,q+=Q.genAssert("c.stuffToDo === 0","stuffToDo should be zero"),q},O$=function(J,Q){return _(`// ${J}\n`,Q)},E$=function(J){if(J===0)return"0";return`c.getRegU32Lo(${J})`},u6=function(J){if(J===0)return"0n";return`c.getRegS64(${J})`},f6=function(J){if(J===0)return"0n";return`c.getRegU64(${J})`},w=function(J){const Q=`throw 'unknown op, pc ${j(J.pc)}, instruction: ${j(J.instruction)}'`;return T(Q,J)},wF=function(J){if(J.instruction===0)return O$("NOP",J);const Q=`c.execSLL(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return _(Q,J)},CF=function(J){const Q=`c.execSRL(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return _(Q,J)},yF=function(J){const Q=`c.execSRA(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return _(Q,J)},DF=function(J){const Q=`c.execSLLV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},IF=function(J){const Q=`c.execSRLV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},BF=function(J){const Q=`c.execSRAV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},RF=function(J){const Q=`c.execDSLLV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},bF=function(J){const Q=`c.execDSRLV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},TF=function(J){const Q=`c.execDSRAV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},_F=function(J){const Q=`c.execDSLL(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return _(Q,J)},SF=function(J){const Q=`c.execDSLL32(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return _(Q,J)},vF=function(J){const Q=`c.execDSRL(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return _(Q,J)},fF=function(J){const Q=`c.execDSRL32(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return _(Q,J)},uF=function(J){const Q=`c.execDSRA(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return _(Q,J)},gF=function(J){const Q=`c.execDSRA32(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return _(Q,J)},xF=function(J){return T("c.execRESERVED(0);",J)},pF=function(J){return T("c.execSYSCALL();",J)},mF=function(J){return T("c.execBREAK();",J)},nF=function(J){return T("c.execSYNC();",J)},oF=function(J){const Q=`c.execTGE(${J.instr_rt()}, ${J.instr_rs()});`;return T(Q,J)},cF=function(J){const Q=`c.execTGEU(${J.instr_rt()}, ${J.instr_rs()});`;return T(Q,J)},lF=function(J){const Q=`c.execTLT(${J.instr_rt()}, ${J.instr_rs()});`;return T(Q,J)},dF=function(J){const Q=`c.execTLTU(${J.instr_rt()}, ${J.instr_rs()});`;return T(Q,J)},aF=function(J){const Q=`c.execTEQ(${J.instr_rt()}, ${J.instr_rs()});`;return T(Q,J)},rF=function(J){const Q=`c.execTNE(${J.instr_rt()}, ${J.instr_rs()});`;return T(Q,J)},sF=function(J){const Q=`c.execMFHI(${J.instr_rd()});`;return _(Q,J)},iF=function(J){const Q=`c.execMFLO(${J.instr_rd()});`;return _(Q,J)},tF=function(J){const Q=`c.execMTHI(${J.instr_rs()});`;return _(Q,J)},eF=function(J){const Q=`c.execMTLO(${J.instr_rs()});`;return _(Q,J)},Jj=function(J){const Q=`c.execMULT(${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},Qj=function(J){const Q=`c.execMULTU(${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},qj=function(J){const Q=`c.execDMULT(${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},Yj=function(J){const Q=`c.execDMULTU(${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},Zj=function(J){const Q=`c.execDIV(${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},Kj=function(J){const Q=`c.execDIVU(${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},Xj=function(J){const Q=`c.execDDIV(${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},Wj=function(J){const Q=`c.execDDIVU(${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},$j=function(J){const Q=`c.execADD(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return T(Q,J)},zj=function(J){const Q=`c.execDADD(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return T(Q,J)},Hj=function(J){const Q=`c.execADDU(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},Fj=function(J){const Q=`c.execDADDU(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},jj=function(J){const Q=`c.execSUB(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return T(Q,J)},Nj=function(J){const Q=`c.execDSUB(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return T(Q,J)},Gj=function(J){const Q=`c.execSUBU(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},Lj=function(J){const Q=`c.execDSUBU(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},Pj=function(J){const Q=`c.execAND(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},Vj=function(J){let Q;if(J.instr_rt()===0)if(J.instr_rs()===0)Q=`c.execCLEAR(${J.instr_rd()});`;else Q=`c.execMOV(${J.instr_rd()}, ${J.instr_rs()});`;else Q=`c.execOR(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},Uj=function(J){const Q=`c.execXOR(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},Mj=function(J){const Q=`c.execNOR(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},hj=function(J){const Q=`c.execSLT(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},Oj=function(J){const Q=`c.execSLTU(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return _(Q,J)},Ej=function(J){const Q=`c.execADDI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return T(Q,J)},Aj=function(J){const Q=`c.execDADDI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return T(Q,J)},kj=function(J){const Q=`c.execADDI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return _(Q,J)},wj=function(J){const Q=`c.execDADDIU(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return _(Q,J)},Cj=function(J){const Q=`c.execMFC0(${J.instr_rt()}, ${J.instr_fs()});`;return T(Q,J)},yj=function(J){const Q=`c.execDMFC0(${J.instr_rt()}, ${J.instr_fs()});`;return T(Q,J)},Dj=function(J){if(J.instr_fs()===U0)J.fragment.cop1statusKnown=!1;const Q=`c.execMTC0(${J.instr_rt()}, ${J.instr_fs()});`;return T(Q,J)},Ij=function(J){if(J.instr_fs()===U0)J.fragment.cop1statusKnown=!1;const Q=`c.execDMTC0(${J.instr_rt()}, ${J.instr_fs()});`;return T(Q,J)},Bj=function(J){const Q=`c.execTLB(${J.instr_tlbop()});`;return T(Q,J)},Rj=function(J){const Q=`c.execMFC2(${J.instr_rt()});`;return T(Q,J)},bj=function(J){const Q=`c.execDMFC2(${J.instr_rt()});`;return T(Q,J)},Tj=function(J){const Q=`c.execCFC2(${J.instr_rt()});`;return T(Q,J)},_j=function(J){const Q=`c.execDCFC2(${J.instr_rt()});`;return T(Q,J)},Sj=function(J){const Q=`c.execMTC2(${J.instr_rt()});`;return T(Q,J)},vj=function(J){const Q=`c.execDMTC2(${J.instr_rt()});`;return T(Q,J)},fj=function(J){const Q=`c.execCTC2(${J.instr_rt()});`;return T(Q,J)},uj=function(J){const Q=`c.execDCTC2(${J.instr_rt()});`;return T(Q,J)},gj=function(J){const Q=I6(J.pc,J.instruction),q="c.delayPC = "+j(Q)+";";return y0(q,J,!1)},xj=function(J){const Q=I6(J.pc,J.instruction),q=J.nextPC+4,Y=q&2147483648?-1:0,Z=T0(`
      c.delayPC = ${j(Q)};
      c.setRegS64LoHi(${Q6}, ${j(q)}, ${Y});
      `);return y0(Z,J,!1)},pj=function(J){const Q=J.instr_rs(),q=J.instr_rd(),Y=J.nextPC+4,Z=Y&2147483648?-1:0,K=T0(`
      c.delayPC = ${E$(Q)};
      c.setRegS64LoHi(${q}, ${j(Y)}, ${Z});
      `);return y0(K,J,!1)},mj=function(J){const Q=`c.delayPC = ${E$(J.instr_rs())};`;return y0(Q,J,!1)},nj=function(J){const Q=J.instr_rs(),q=J.instr_rt(),Y=J.instr_offset(),Z=C0(J.pc,J.instruction);let K="";if(Q===q){if(I8&&Y===-1)K+="c.speedHack();\n",J.bailOut=!0;K+=`c.delayPC = ${j(Z)};\n`}else{if(K+=`if (${f6(Q)} === ${f6(q)}) {\n`,I8&&Y===-1)K+="  c.speedHack();\n",J.bailOut=!0;K+=`  c.delayPC = ${j(Z)};\n`,K+="} else {\n",K+=`  c.delayPC = ${j(J.pc+8)};\n`,K+="}\n"}return y0(K,J,!1)},oj=function(J){const Q=J.instr_rs(),q=J.instr_rt(),Y=C0(J.pc,J.instruction),Z=T0(`
      if (${f6(Q)} === ${f6(q)}) {
        c.delayPC = ${j(Y)};
      } else {
        c.nextPC += 4;
      }`);return y0(Z,J,!0)},cj=function(J){const Q=J.instr_rs(),q=J.instr_rt(),Y=J.instr_offset(),Z=C0(J.pc,J.instruction);let K="";if(K+=`if (${f6(Q)} !== ${f6(q)}) {\n`,I8&&Y===-1)K+="  c.speedHack();\n",J.bailOut=!0;return K+=`  c.delayPC = ${j(Z)};\n`,K+="} else {\n",K+=`  c.delayPC = ${j(J.pc+8)};\n`,K+="}\n",y0(K,J,!1)},lj=function(J){const Q=J.instr_rs(),q=J.instr_rt(),Y=C0(J.pc,J.instruction),Z=T0(`
      if (${f6(Q)} !== ${f6(q)}) {
        c.delayPC = ${j(Y)};
      } else {
        c.nextPC += 4;
      }
      `);return y0(Z,J,!0)},dj=function(J){const Q=J.instr_rs(),q=C0(J.pc,J.instruction),Y=T0(`
      if ( ${u6(Q)} <= 0n) {
        c.delayPC = ${j(q)};
      } else {
        c.delayPC = ${j(J.pc+8)};
      }`);return y0(Y,J,!1)},aj=function(J){const Q=J.instr_rs(),q=C0(J.pc,J.instruction),Y=T0(`
      if ( ${u6(Q)} <= 0n) {
        c.delayPC = ${j(q)};
      } else {
        c.nextPC += 4;
      }`);return y0(Y,J,!1)},rj=function(J){const Q=J.instr_rs(),q=C0(J.pc,J.instruction),Y=T0(`
      if (${u6(Q)} > 0) {
        c.delayPC = ${j(q)};
      } else {
        c.delayPC = ${j(J.pc+8)};
      }`);return y0(Y,J,!1)},sj=function(J){const Q=J.instr_rs(),q=C0(J.pc,J.instruction),Y=T0(`
      if (${u6(Q)} > 0) {
        c.delayPC = ${j(q)};
      } else {
        c.nextPC += 4;
      }`);return y0(Y,J,!1)},ij=function(J){const Q=J.instr_rs(),q=C0(J.pc,J.instruction),Y=T0(`
      if (${u6(Q)} < 0n) {
        c.delayPC = ${j(q)};
      } else {
        c.delayPC = ${j(J.pc+8)};
      }`);return y0(Y,J,!1)},tj=function(J){const Q=J.instr_rs(),q=C0(J.pc,J.instruction),Y=T0(`
      if (${u6(Q)} < 0n) {
        c.delayPC = ${j(q)};
      } else {
        c.nextPC += 4;
      }`);return y0(Y,J,!0)},ej=function(J){const Q=J.instr_rs(),q=C0(J.pc,J.instruction),Y=T0(`
      if (${u6(Q)} >= 0n) {
        c.delayPC = ${j(q)};
      } else {
        c.delayPC = ${j(J.pc+8)};
      }`);return y0(Y,J,!1)},J4=function(J){const Q=J.instr_rs(),q=C0(J.pc,J.instruction),Y=T0(`
      if (${u6(Q)} >= 0n) {
        c.delayPC = ${j(q)};
      } else {
        c.nextPC += 4;
      }`);return y0(Y,J,!0)},Q4=function(J){const Q=`c.execBLTZAL(${J.instr_rs()}, ${J.instr_imms()});`;return T(Q,J)},q4=function(J){const Q=`c.execBGEZAL(${J.instr_rs()}, ${J.instr_imms()});`;return T(Q,J)},Y4=function(J){const Q=`c.execBLTZALL(${J.instr_rs()}, ${J.instr_imms()});`;return T(Q,J)},Z4=function(J){const Q=`c.execBGEZALL(${J.instr_rs()}, ${J.instr_imms()});`;return T(Q,J)},K4=function(J){const Q=`c.execTGEI(${J.instr_rs()}, ${J.instr_imms()});`;return T(Q,J)},X4=function(J){const Q=`c.execTGEIU(${J.instr_rs()}, ${J.instr_imms()});`;return T(Q,J)},W4=function(J){const Q=`c.execTLTI(${J.instr_rs()}, ${J.instr_imms()});`;return T(Q,J)},$4=function(J){const Q=`c.execTLTIU(${J.instr_rs()}, ${J.instr_imms()});`;return T(Q,J)},z4=function(J){const Q=`c.execTEQI(${J.instr_rs()}, ${J.instr_imms()});`;return T(Q,J)},H4=function(J){const Q=`c.execTNEI(${J.instr_rs()}, ${J.instr_imms()});`;return T(Q,J)},F4=function(J){const Q=`c.execSLTI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return _(Q,J)},j4=function(J){const Q=`c.execSLTIU(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return _(Q,J)},N4=function(J){const Q=`c.execANDI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imm()});`;return _(Q,J)},G4=function(J){const Q=`c.execORI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imm()});`;return _(Q,J)},L4=function(J){const Q=`c.execXORI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imm()});`;return _(Q,J)},P4=function(J){const Q=`c.execLUI(${J.instr_rt()}, ${J.instr_imm()});`;return _(Q,J)},V4=function(J){const Q=`c.execLB(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},U4=function(J){const Q=`c.execLBU(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},M4=function(J){const Q=`c.execLH(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},h4=function(J){const Q=`c.execLHU(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},O4=function(J){const Q=`c.execLW(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},E4=function(J){const Q=`c.execLWU(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},A4=function(J){const Q=`c.execLD(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},k4=function(J){const Q=`c.execLWL(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},w4=function(J){const Q=`c.execLWR(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},C4=function(J){const Q=`c.execLDL(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},y4=function(J){const Q=`c.execLDR(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},D4=function(J){J.fragment.usesCop1=!0;const Q=`c.execLWC1(${J.instr_ft()}, ${J.instr_base()}, ${J.instr_imms()});`;return T(Q,J)},I4=function(J){J.fragment.usesCop1=!0;const Q=`c.execLDC1(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return T(Q,J)},B4=function(J){const Q=`c.execLWC2(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},R4=function(J){const Q=`c.execLWC3(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},b4=function(J){const Q=`c.execLDC2(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},T4=function(J){const Q=`c.execSB(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},_4=function(J){const Q=`c.execSH(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},S4=function(J){const Q=`c.execSW(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},v4=function(J){const Q=`c.execSD(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},f4=function(J){const Q=`c.execSWL(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},u4=function(J){const Q=`c.execSWR(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},g4=function(J){const Q=`c.execSDL(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},x4=function(J){const Q=`c.execSDR(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},p4=function(J){J.fragment.usesCop1=!0;const Q=`c.execSWC1(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return T(Q,J)},m4=function(J){J.fragment.usesCop1=!0;const Q=`c.execSDC1(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return T(Q,J)},n4=function(J){const Q=`c.execSWC2(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},o4=function(J){const Q=`c.execSWC3(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},c4=function(J){const Q=`c.execSDC2(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},l4=function(J){const Q=`c.execLL(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},d4=function(J){const Q=`c.execLLD(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},a4=function(J){const Q=`c.execSC(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},r4=function(J){const Q=`c.execSCD(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return t(Q,J)},s4=function(J){if(!n64js.cpu0.ignoreCacheOp(J.instr_rt())){const Q=`c.execCACHE(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return _(Q,J)}else return O$("CACHE (ignored)",J)},i4=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execMFC1(${J.instr_rt()}, ${J.instr_fs()});`},t4=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execDMFC1(${J.instr_rt()}, ${J.instr_fs()});`},e4=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execMTC1(${J.instr_rt()}, ${J.instr_fs()});`},JN=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execDMTC1(${J.instr_rt()}, ${J.instr_fs()});`},QN=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execCFC1(${J.instr_rt()}, ${J.instr_fs()});`},qN=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execCTC1(${J.instr_rt()}, ${J.instr_fs()});`},YN=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!1,`c.execDCFC1(${J.instr_rt()}, ${J.instr_fs()});`},ZN=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!1,`c.execDCTC1(${J.instr_rt()}, ${J.instr_fs()});`},KN=function(J){const Q=J.instruction;r((Q>>>18&7)===0,"cc bit is not 0");const q=(Q&65536)!==0,Y=(Q&131072)!==0,Z=C0(J.pc,Q);J.fragment.usesCop1=!0,J.isTrivial=!1;let X=`const cond = (cpu1.control[31] & FPCSR_C) ${q?"!==":"==="} 0;\n`;if(Y)X+="if (cond) {\n",X+=`  c.branchTarget = ${j(Z)};\n`,X+="} else {\n",X+="  c.nextPC += 4;\n",X+="}\n";else X+="if (cond) {\n",X+=`  c.branchTarget = ${j(Z)};\n`,X+="} else {\n",X+=`  c.branchTarget = ${j(J.pc+8)};\n`,X+="}\n";return X},XN=function(J){const Q=J.instr_fs(),q=J.instr_ft(),Y=J.instr_fd();J.fragment.usesCop1=!0,J.isTrivial=!1;const Z=u0(J.instruction);if(Z<48){switch(Z){case F$:return`cpu1.ADD_S(${Y}, ${Q}, ${q});`;case j$:return`cpu1.SUB_S(${Y}, ${Q}, ${q});`;case N$:return`cpu1.MUL_S(${Y}, ${Q}, ${q});`;case G$:return`cpu1.DIV_S(${Y}, ${Q}, ${q});`;case L$:return`cpu1.SQRT_S(${Y}, ${Q});`;case P$:return`cpu1.ABS_S(${Y}, ${Q});`;case V$:return`cpu1.MOV_S(${Y}, ${Q});`;case U$:return`cpu1.NEG_S(${Y}, ${Q});`;case HQ:return`cpu1.ConvertSToL(${Y}, ${Q}, ${c0});`;case FQ:return`cpu1.ConvertSToL(${Y}, ${Q}, ${s0});`;case jQ:return`cpu1.ConvertSToL(${Y}, ${Q}, ${i0});`;case NQ:return`cpu1.ConvertSToL(${Y}, ${Q}, ${t0});`;case GQ:return`cpu1.ConvertSToW(${Y}, ${Q}, ${c0});`;case LQ:return`cpu1.ConvertSToW(${Y}, ${Q}, ${s0});`;case PQ:return`cpu1.ConvertSToW(${Y}, ${Q}, ${i0});`;case VQ:return`cpu1.ConvertSToW(${Y}, ${Q}, ${t0});`;case UQ:return"cpu1.raiseUnimplemented();";case MQ:return`cpu1.CVT_D_S(${Y}, ${Q});`;case hQ:return`cpu1.ConvertSToW(${Y}, ${Q}, cpu1.roundingMode);`;case OQ:return`cpu1.ConvertSToL(${Y}, ${Q}, cpu1.roundingMode);`}return`unimplemented(${j(J.pc)},${j(J.instruction)});`}return`cpu1.handleFloatCompareSingle(${Z}, ${Q}, ${q});`},WN=function(J){const Q=J.instr_fs(),q=J.instr_ft(),Y=J.instr_fd();J.fragment.usesCop1=!0,J.isTrivial=!1;const Z=u0(J.instruction);if(Z<48){switch(Z){case F$:return`cpu1.ADD_D(${Y}, ${Q}, ${q});`;case j$:return`cpu1.SUB_D(${Y}, ${Q}, ${q});`;case N$:return`cpu1.MUL_D(${Y}, ${Q}, ${q});`;case G$:return`cpu1.DIV_D(${Y}, ${Q}, ${q});`;case L$:return`cpu1.SQRT_D(${Y}, ${Q});`;case P$:return`cpu1.ABS_D(${Y}, ${Q});`;case V$:return`cpu1.MOV_D(${Y}, ${Q});`;case U$:return`cpu1.NEG_D(${Y}, ${Q});`;case HQ:return`cpu1.ConvertDToL(${Y}, ${Q}, ${c0});`;case FQ:return`cpu1.ConvertDToL(${Y}, ${Q}, ${s0});`;case jQ:return`cpu1.ConvertDToL(${Y}, ${Q}, ${i0});`;case NQ:return`cpu1.ConvertDToL(${Y}, ${Q}, ${t0});`;case GQ:return`cpu1.ConvertDToW(${Y}, ${Q}, ${c0});`;case LQ:return`cpu1.ConvertDToW(${Y}, ${Q}, ${s0});`;case PQ:return`cpu1.ConvertDToW(${Y}, ${Q}, ${i0});`;case VQ:return`cpu1.ConvertDToW(${Y}, ${Q}, ${t0});`;case UQ:return`cpu1.CVT_S_D(${Y}, ${Q});`;case MQ:return"cpu1.raiseUnimplemented();";case hQ:return`cpu1.ConvertDToW(${Y}, ${Q}, cpu1.roundingMode);`;case OQ:return`cpu1.ConvertDToL(${Y}, ${Q}, cpu1.roundingMode);`}return`unimplemented(${j(J.pc)},${j(J.instruction)});`}return`cpu1.handleFloatCompareDouble(${Z}, ${Q}, ${q});`},$N=function(J){const Q=J.instr_fs(),q=J.instr_fd();switch(J.fragment.usesCop1=!0,J.isTrivial=!1,u0(J.instruction)){case HQ:return"cpu1.raiseUnimplemented();";case FQ:return"cpu1.raiseUnimplemented();";case jQ:return"cpu1.raiseUnimplemented();";case NQ:return"cpu1.raiseUnimplemented();";case GQ:return"cpu1.raiseUnimplemented();";case LQ:return"cpu1.raiseUnimplemented();";case PQ:return"cpu1.raiseUnimplemented();";case VQ:return"cpu1.raiseUnimplemented();";case UQ:return`cpu1.CVT_S_W(${q}, ${Q});`;case MQ:return`cpu1.CVT_D_W(${q}, ${Q});`;case hQ:return"cpu1.raiseUnimplemented();";case OQ:return"cpu1.raiseUnimplemented();"}return`unimplemented(${j(J.pc)},${j(J.instruction)});`},zN=function(J){const Q=J.instr_fs(),q=J.instr_fd();switch(J.fragment.usesCop1=!0,J.isTrivial=!1,u0(J.instruction)){case HQ:return"cpu1.raiseUnimplemented();";case FQ:return"cpu1.raiseUnimplemented();";case jQ:return"cpu1.raiseUnimplemented();";case NQ:return"cpu1.raiseUnimplemented();";case GQ:return"cpu1.raiseUnimplemented();";case LQ:return"cpu1.raiseUnimplemented();";case PQ:return"cpu1.raiseUnimplemented();";case VQ:return"cpu1.raiseUnimplemented();";case UQ:return`cpu1.CVT_S_L(${q}, ${Q});`;case MQ:return`cpu1.CVT_D_L(${q}, ${Q});`;case hQ:return"cpu1.raiseUnimplemented();";case OQ:return"cpu1.raiseUnimplemented();"}return`unimplemented(${j(J.pc)},${j(J.instruction)});`},HN=function(J){const Q=VN[f0(J.instruction)],q=Q(J);let Y="";if(J.fragment.usesCop1=!0,J.fragment.cop1statusKnown)Y+=J.genAssert("(c.getControlU32(12) & SR_CU1) !== 0","cop1 should be enabled"),Y+=J8(q);else return Y+="if( (c.getControlU32(12) & SR_CU1) === 0 ) {\n",Y+=`  n64js.executeCop1_disabled(${j(J.instruction)});\n`,Y+="} else {\n",Y+="  "+J8(q),Y+="}\n",J.isTrivial=!1,J.fragment.cop1statusKnown=!0,T(Y,J);if(J.isTrivial)return _(Y,J);return T(Y,J)},FN=function(J){return T("c.execBreakpoint();",J)},jN=function(J){if(J.length!=64)throw"Special table is unexpected size.";return J},UY=function(J){if(J.length!=32)throw"Cop table is unexpected size.";return J},NN=function(J){if(J.length!=32)throw"RegImm table is unexpected size.";return J},GN=function(J){if(J.length!=64)throw"Simple table is unexpected size.";return J},ON=function(J){if(AF)return hN[W8(J.instruction)](J);const Q=`n64js.executeOp(${J.instruction});`;return T(Q,J)},EN=function(J){return LN[z8(J.instruction)](J)},AN=function(J){return MN[$8(J.instruction)](J)},kN=function(J){return PN[f0(J.instruction)](J)},wN=function(J){return UN[f0(J.instruction)](J)},CN=function(J){return T("c.execRESERVED(0);",J)},EF=!1,H$=!1,AF=!0,F$=0,j$=1,N$=2,G$=3,L$=4,P$=5,V$=6,U$=7,HQ=8,FQ=9,jQ=10,NQ=11,GQ=12,LQ=13,PQ=14,VQ=15,UQ=32,MQ=33,hQ=36,OQ=37;class VY{constructor(){this.fragment=void 0,this.pc=0,this.instruction=0,this.postPC=0,this.bailOut=!1,this.nextPC=0,this.needsDelayCheck=!0,this.isTrivial=!1,this.delayedPCUpdate=0,this.dump=!1}genAssert(J,Q){if(EF)return"window.n64jsAssert("+J+', "'+Q+'");\n';return""}newFragment(){this.delayedPCUpdate=0}set(J,Q,q,Y,Z){this.fragment=J,this.pc=Q,this.instruction=q,this.postPC=Y,this.nextPC=Z,this.bailOut=!1,this.needsDelayCheck=!0,this.isTrivial=!1,this.dump=!1}instr_rs(){return y(this.instruction)}instr_rt(){return h(this.instruction)}instr_rd(){return R(this.instruction)}instr_sa(){return B0(this.instruction)}instr_fs(){return J0(this.instruction)}instr_ft(){return Y6(this.instruction)}instr_fd(){return G6(this.instruction)}instr_base(){return v(this.instruction)}instr_offset(){return Q0(this.instruction)}instr_imms(){return b(this.instruction)}instr_imm(){return L6(this.instruction)}instr_tlbop(){return H8(this.instruction)}}var LN=jN([wF,w,CF,yF,DF,w,IF,BF,mj,pj,w,w,pF,mF,w,nF,sF,tF,iF,eF,RF,w,bF,TF,Jj,Qj,Zj,Kj,qj,Yj,Xj,Wj,$j,Hj,jj,Gj,Pj,Vj,Uj,Mj,w,w,hj,Oj,zj,Fj,Nj,Lj,oF,cF,lF,dF,aF,w,rF,w,_F,w,vF,uF,SF,w,fF,gF]),PN=UY([Cj,yj,w,w,Dj,Ij,w,w,w,w,w,w,w,w,w,w,Bj,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w]),VN=UY([i4,t4,QN,YN,e4,JN,qN,ZN,KN,w,w,w,w,w,w,w,XN,WN,w,w,$N,zN,w,w,w,w,w,w,w,w,w,w]),UN=UY([Rj,bj,Tj,_j,Sj,vj,fj,uj,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w]),MN=NN([ij,ej,tj,J4,w,w,w,w,K4,X4,W4,$4,z4,w,H4,w,Q4,q4,Y4,Z4,w,w,w,w,w,w,w,w,w,w,w,w]),hN=GN([EN,AN,gj,xj,nj,cj,dj,rj,Ej,kj,F4,j4,N4,G4,L4,P4,kN,HN,wN,CN,oj,lj,aj,sj,Aj,wj,C4,y4,FN,w,w,xF,V4,M4,k4,O4,U4,h4,w4,E4,T4,_4,f4,S4,g4,x4,u4,s4,l4,D4,B4,R4,d4,I4,b4,A4,a4,p4,n4,o4,r4,m4,c4,v4]);window.n64jsAssert=(J,Q)=>{r(J,Q)};var DN=function(J){const Q=J<256?BigInt(J)+256n:(BigInt(J)-256n<<1n)+512n;let q=1n<<17n,Y=512n;while(Y!=0){while(Q*(q+Y)*(q+Y)<1n<<44n)q+=Y;Y>>=1n}return Number(q>>1n&0xffffn)};function MY(J){if(J==-32768)return 4294901760;else if(J==0)return 2147483647;const Q=J>>>0>4294934528?J-1:J,q=Q>>31,Y=Q^q,Z=Math.clz32(Y)+1,X=Y<<Z>>>23;return(65536|yN[X])<<14>>>32-Z^q}function hY(J){if(J==-32768)return 4294901760;else if(J==0)return 2147483647;const Q=J>>>0>4294934528?J-1:J,q=Q>>31,Y=Q^q,Z=Math.clz32(Y)+1,X=Y<<Z>>>24|(Z&1)<<8;return(65536|IN[X])<<14>>>(32-Z>>1)^q}var yN=function(){const J=[];J.push(65535);for(let Q=1;Q<512;Q++){const q=(1n<<34n)/(BigInt(Q)+512n);J.push(Number(q+1n>>8n&0xffffn))}return J}(),IN=function(){const J=[];for(let Q=0;Q<512;Q++)J.push(DN(Q));return J}();function x$(J){H=new n$(J)}var p$=function(J){return J&63},g6=function(J){return(J&65535)<<16>>16},EY=function(J){return J>>>6&31},q0=function(J){return J>>>11&31},S=function(J){return J>>>16&31},a=function(J){return J>>>21&31},BN=function(J){return J>>>26&63},RN=function(J){return J>>>21&31},A0=function(J){return J>>>16&31},P0=function(J){return J>>>7&15},bN=function(J){return(J&127)<<25>>25},o=function(J){return J>>>21&15},AY=function(J){return J>>>11&31},l=function(J){return J>>>16&31},s=function(J){return J>>>11&31},p=function(J){return J>>>6&31},TN=function(J){return J&67108863},EQ=function(J){return J&65535},B8=function(J){return EQ(J)<<16>>16},_N=function(J){return J>>>21&31};var m$=function(J,Q){return J&4026531840|TN(Q)*4},u$=function(J){return J*4},g$=function(J){return(J-OY)*4},mN=function(J){return pN[p$(J)](J)},x6=function(J){H.disassembleAll(),n64js.halt(`RSP: unknown op, pc: ${x(H.pc)}, instruction: ${j(J)}`)},lN=function(J){H.setRegS32(q0(J),H.getRegS32(S(J))<<EY(J))},dN=function(J){H.setRegS32(q0(J),H.getRegS32(S(J))>>>EY(J))},aN=function(J){H.setRegS32(q0(J),H.getRegS32(S(J))>>EY(J))},rN=function(J){H.setRegS32(q0(J),H.getRegS32(S(J))<<(H.getRegS32(a(J))&31))},sN=function(J){H.setRegS32(q0(J),H.getRegS32(S(J))>>>(H.getRegS32(a(J))&31))},iN=function(J){H.setRegS32(q0(J),H.getRegS32(S(J))>>(H.getRegS32(a(J))&31))},tN=function(J){H.jump(H.getRegS32(a(J)))},eN=function(J){const Q=H.getRegS32(a(J));H.setRegS32(q0(J),H.nextPC+4),H.jump(Q)},JG=function(J){H.halt(vN)},QG=function(J){H.setRegS32(q0(J),H.getRegS32(a(J))+H.getRegS32(S(J)))},qG=function(J){H.setRegU32(q0(J),H.getRegU32(a(J))+H.getRegU32(S(J)))},YG=function(J){H.setRegS32(q0(J),H.getRegS32(a(J))-H.getRegS32(S(J)))},ZG=function(J){H.setRegU32(q0(J),H.getRegU32(a(J))-H.getRegU32(S(J)))},KG=function(J){H.setRegU32(q0(J),H.getRegU32(a(J))&H.getRegU32(S(J)))},XG=function(J){H.setRegU32(q0(J),H.getRegU32(a(J))|H.getRegU32(S(J)))},WG=function(J){H.setRegU32(q0(J),H.getRegU32(a(J))^H.getRegU32(S(J)))},$G=function(J){H.setRegU32(q0(J),~(H.getRegU32(a(J))|H.getRegU32(S(J))))},zG=function(J){H.setRegS32(q0(J),H.getRegS32(a(J))<H.getRegS32(S(J))?1:0)},HG=function(J){H.setRegU32(q0(J),H.getRegU32(a(J))<H.getRegU32(S(J))?1:0)},FG=function(J){H.conditionalBranch(H.getRegS32(a(J))<0,g6(J))},jG=function(J){H.conditionalBranch(H.getRegS32(a(J))>=0,g6(J))},NG=function(J){const Q=H.getRegS32(a(J))<0;H.setRegS32(kY,H.nextPC+4),H.conditionalBranch(Q,g6(J))},GG=function(J){const Q=H.getRegS32(a(J))>=0;H.setRegS32(kY,H.nextPC+4),H.conditionalBranch(Q,g6(J))},LG=function(J){H.setRegU32(S(J),H.moveFromControl(q0(J)))},PG=function(J){H.moveToControl(q0(J),H.getRegU32(S(J)))},VG=function(J){H.setRegS16SignExtend(S(J),H.getVecU16UnalignedWrap(q0(J),P0(J)))},UG=function(J){H.setVecU16UnalignedNoWrap(q0(J),P0(J),H.getRegU32(S(J)))},MG=function(J){let Q;switch(q0(J)&3){case 0:Q=H.VCO<<16>>16;break;case 1:Q=H.VCC<<16>>16;break;case 2:Q=H.VCE;break;case 3:Q=H.VCE;break}H.setRegU32(S(J),Q)},hG=function(J){const Q=H.getRegS32(S(J));switch(q0(J)&3){case 0:H.VCO=Q;break;case 1:H.VCC=Q;break;case 2:H.VCE=Q;break;case 3:H.VCE=Q;break}},OG=function(J,Q,q,Y){if(J>=0)return(J&~0x7fff_ffffn)!=0?Y:Number(J>>Q);return(~J&~0x7fff_ffffn)!=0?q:Number(J>>Q)},EG=function(J,Q,q,Y){if(J>=0)return(J&~0x7fff_ffffn)!=0?Y:Number(J>>Q);return q},o$=function(J){if(J<-32768)return-32768;if(J>32767)return 32767;return J},V0=function(J){const Q=s(J),q=l(J);for(let Y=0,Z=H.vecSelectU32[o(J)];Y<8;Y++,Z>>=4){const K=H.getVecS16(Q,Y),X=H.getVecS16(q,Z&7);H.setAccLow(Y,K+X)}H.setVecZero(p(J))},AG=function(J){V0(J)},kG=function(J){V0(J)},wG=function(J){V0(J)},CG=function(J){V0(J)},yG=function(J){V0(J)},DG=function(J){V0(J)},IG=function(J){V0(J)},BG=function(J){V0(J)},RG=function(J){V0(J)},bG=function(J){V0(J)},TG=function(J){V0(J)},_G=function(J){V0(J)},SG=function(J){V0(J)},vG=function(J){V0(J)},fG=function(J){V0(J)},uG=function(J){V0(J)},gG=function(J){V0(J)},xG=function(J){V0(J)},pG=function(J){V0(J)},AQ=function(J,Q,q,Y,Z){for(let K=0,X=H.vecSelectU32[q];K<8;K++,X>>=4){const W=H.getVecS16(J,K),z=H.getVecS16(Q,X&7),F=W*z*2+Z;H.updateAcc32Signed(K,F,Y)}},c$=function(J,Q,q,Y){for(let Z=0,K=H.vecSelectU32[q];Z<8;Z++,K>>=4){const X=H.getVecU16(J,Z),W=H.getVecU16(Q,K&7),z=X*W>>>16;H.updateAccU32(Z,z,Y)}},l$=function(J,Q,q,Y){for(let Z=0,K=H.vecSelectU32[q];Z<8;Z++,K>>=4){const X=H.getVecS16(J,Z),W=H.getVecU16(Q,K&7);H.updateAcc32Signed(Z,X*W,Y)}},d$=function(J,Q,q,Y){for(let Z=0,K=H.vecSelectU32[q];Z<8;Z++,K>>=4){const X=H.getVecU16(J,Z),W=H.getVecS16(Q,K&7);H.updateAcc32Signed(Z,X*W,Y)}},a$=function(J,Q,q,Y){for(let Z=0,K=H.vecSelectU32[q];Z<8;Z++,K>>=4){const X=H.getVecS16(J,Z),W=H.getVecS16(Q,K&7);H.updateAcc32SignedShift16(Z,X*W,Y)}},r$=function(J,Q,q,Y){const Z=J&1?16:0;for(let K=0,X=H.vecSelectU32[q];K<8;K++,X>>=4){const W=H.getAccS48(K),z=H.getVecS16(Q,X&7)<<Z,F=Y?W>=0:W<0;H.setAccS48(K,W+(F?BigInt(z):0n))}},mG=function(J){AQ(s(J),l(J),o(J),!1,32768),H.setVecFromAccSignedMid(p(J))},nG=function(J){AQ(s(J),l(J),o(J),!1,32768),H.setVecFromAccUnsignedMid(p(J))},oG=function(J){AQ(s(J),l(J),o(J),!0,0),H.setVecFromAccSignedMid(p(J))},cG=function(J){AQ(s(J),l(J),o(J),!0,0),H.setVecFromAccUnsignedMid(p(J))},lG=function(J){r$(s(J),l(J),o(J),!1),H.setVecFromAccSignedMid(p(J))},dG=function(J){r$(s(J),l(J),o(J),!0),H.setVecFromAccSignedMid(p(J))},aG=function(J){c$(s(J),l(J),o(J),!1),H.setVecFromAccLow(p(J))},rG=function(J){c$(s(J),l(J),o(J),!0),H.setVecFromAccSignedLow(p(J))},sG=function(J){l$(s(J),l(J),o(J),!1),H.setVecFromAccMid(p(J))},iG=function(J){l$(s(J),l(J),o(J),!0),H.setVecFromAccSignedMid(p(J))},tG=function(J){d$(s(J),l(J),o(J),!1),H.setVecFromAccLow(p(J))},eG=function(J){d$(s(J),l(J),o(J),!0),H.setVecFromAccSignedLow(p(J))},JL=function(J){a$(s(J),l(J),o(J),!1),H.setVecFromAccSignedMid(p(J))},QL=function(J){a$(s(J),l(J),o(J),!0),H.setVecFromAccSignedMid(p(J))},qL=function(J){const Q=s(J),q=l(J);for(let Y=0,Z=H.vecSelectU32[o(J)];Y<8;Y++,Z>>=4){const K=H.getVecS16(Q,Y),X=H.getVecS16(q,Z&7),W=BigInt(K*X)<<16n;H.setAccS48(Y,W+(W<0?0x1f0000n:0n))}H.setVecFromAccOddified(p(J))},YL=function(J){for(let Q=0;Q<8;Q++){const q=H.getAccS48(Q);let Y=0n;if((q&0x20_0000n)==0){const Z=q>>22n;if(Z<0)Y=0x20_0000n;else if(Z>0)Y=-0x20_0000n}H.setAccS48(Q,q+Y)}H.setVecFromAccOddified(p(J))},ZL=function(J){const Q=s(J),q=l(J),Y=H.VCO,Z=H.vecTemp;for(let K=0,X=H.vecSelectU32[o(J)];K<8;K++,X>>=4){const W=H.getVecS16(Q,K),z=H.getVecS16(q,X&7),F=Y>>K&1,N=W+z+F;H.setAccLow(K,N),Z.setInt16(K*2,o$(N))}H.setVecFromTemp(p(J)),H.VCO=0},KL=function(J){const Q=s(J),q=l(J),Y=H.VCO,Z=H.vecTemp;for(let K=0,X=H.vecSelectU32[o(J)];K<8;K++,X>>=4){const W=H.getVecS16(Q,K),z=H.getVecS16(q,X&7),F=Y>>K&1,N=W-(z+F);H.setAccLow(K,N),Z.setInt16(K*2,o$(N))}H.setVecFromTemp(p(J)),H.VCO=0},XL=function(J,Q){if(J<0)return-Q;if(J>0)return Q;return 0},WL=function(J){const Q=s(J),q=l(J),Y=H.vecTemp;for(let Z=0,K=H.vecSelectU32[o(J)];Z<8;Z++,K>>=4){const X=H.getVecS16(Q,Z),W=H.getVecU16(q,K&7),z=X<0&&W==32768,F=XL(X,W);H.setAccLow(Z,z?32768:F),Y.setInt16(Z*2,z?32767:F)}H.setVecFromTemp(p(J))},$L=function(J){const Q=s(J),q=l(J);let Y=0;for(let Z=0,K=H.vecSelectU32[o(J)];Z<8;Z++,K>>=4){const X=H.getVecU16(Q,Z),W=H.getVecU16(q,K&7),z=X+W;H.setAccLow(Z,z),Y|=z&~65535?1<<Z:0}H.setVecFromAccLow(p(J)),H.VCO=Y},zL=function(J){const Q=s(J),q=l(J);let Y=0;for(let Z=0,K=H.vecSelectU32[o(J)];Z<8;Z++,K>>=4){const X=H.getVecU16(Q,Z),W=H.getVecU16(q,K&7),z=X-W;H.setAccLow(Z,z),Y|=z!=0?1<<Z+8:0,Y|=z<0?1<<Z+0:0}H.setVecFromAccLow(p(J)),H.VCO=Y},NL=function(J){let Q=64n;switch(o(J)){case HL:Q=32n;break;case FL:Q=16n;break;case jL:Q=0n;break}const q=p(J);for(let Y=0;Y<8;Y++)H.setVecS16(q,Y,Number(H.vAcc[Y]>>Q))},GL=function(J){const Q=s(J),q=l(J),Y=H.VCO;let Z=0,K=0;for(let X=0,W=H.vecSelectU32[o(J)];X<8;X++,W>>=4){const z=H.getVecS16(Q,X),F=H.getVecS16(q,W&7),N=1<<X,G=(Y&N)!=0,P=(Y&N<<8)!=0,L=G&&P,U=z<F||z==F&&L,E=U?z:F;Z|=U?N:0,H.setAccLow(X,E)}H.setVecFromAccLow(p(J)),H.setVCCHiLo(K,Z),H.VCO=0},LL=function(J){const Q=s(J),q=l(J),Y=H.VCO;let Z=0,K=0;for(let X=0,W=H.vecSelectU32[o(J)];X<8;X++,W>>=4){const z=H.getVecS16(Q,X),F=H.getVecS16(q,W&7),N=1<<X,G=(Y&N<<8)!=0,P=z==F&&!G,L=F;Z|=P?N:0,H.setAccLow(X,L)}H.setVecFromAccLow(p(J)),H.setVCCHiLo(K,Z),H.VCO=0},PL=function(J){const Q=s(J),q=l(J),Y=H.VCO;let Z=0,K=0;for(let X=0,W=H.vecSelectU32[o(J)];X<8;X++,W>>=4){const z=H.getVecS16(Q,X),F=H.getVecS16(q,W&7),N=1<<X,G=(Y&N<<8)!=0,P=z!=F||G,L=z;Z|=P?N:0,H.setAccLow(X,L)}H.setVecFromAccLow(p(J)),H.VCC=K<<8|Z,H.setVCCHiLo(K,Z),H.VCO=0},VL=function(J){const Q=s(J),q=l(J),Y=H.VCO;let Z=0,K=0;for(let X=0,W=H.vecSelectU32[o(J)];X<8;X++,W>>=4){const z=H.getVecS16(Q,X),F=H.getVecS16(q,W&7),N=1<<X,G=(Y&N)!=0,P=(Y&N<<8)!=0,L=G&&P,U=z>F||z==F&&!L,E=U?z:F;Z|=U?N:0,H.setAccLow(X,E)}H.setVecFromAccLow(p(J)),H.setVCCHiLo(K,Z),H.VCO=0},UL=function(J){const Q=s(J),q=l(J),Y=H.VCCHi,Z=H.VCCLo,K=H.VCE,X=H.VCOHi,W=H.VCOLo;let z=0,F=0;for(let N=0,G=H.vecSelectU32[o(J)];N<8;N++,G>>=4){const P=H.getVecU16(Q,N),L=H.getVecU16(q,G&7);let U=Z>>N&1,E=Y>>N&1;const A=K>>N&1,C=~(X>>N)&1,D=W>>N&1;let u;if(D){if(C){const n=P+L&65535,d=P+L>65535;U=!A&&(!n&&!d)||A&&(!n||!d)}u=U?-L:P}else{if(C)E=P-L>=0;u=E?L:P}H.setAccLow(N,u),z|=E<<N,F|=U<<N}H.setVecFromAccLow(p(J)),H.setVCCHiLo(z,F),H.VCO=0,H.VCE=0},ML=function(J){const Q=s(J),q=l(J);let Y=0,Z=0,K=0,X=0,W=0;for(let z=0,F=H.vecSelectU32[o(J)];z<8;z++,F>>=4){const N=H.getVecS16(Q,z),G=H.getVecS16(q,F&7);let P,L,U,E,A;const C=(N^G)<0;if(C){const D=N+G<<16>>16;L=G<0,P=D<=0,U=D==-1,E=D!=0&&N!=~G,A=P?-G:N}else{const D=N-G<<16>>16;P=G<0,L=D>=0,U=0,E=D!=0,A=L?G:N}H.setAccLow(z,A),Y|=L<<z,Z|=P<<z,K|=E<<z,X|=C<<z,W|=U<<z}H.setVecFromAccLow(p(J)),H.setVCCHiLo(Y,Z),H.setVCOHiLo(K,X),H.VCE=W},hL=function(J){const Q=s(J),q=l(J);let Y=0,Z=0;for(let K=0,X=H.vecSelectU32[o(J)];K<8;K++,X>>=4){const W=H.getVecS16(Q,K),z=H.getVecS16(q,X&7);let F,N,G;if((W^z)<0)N=z<0,F=W+z+1<=0,G=F?~z:W;else F=z<0,N=W-z>=0,G=N?z:W;Z|=F<<K,Y|=N<<K,H.setAccLow(K,G)}H.setVecFromAccLow(p(J)),H.setVCCHiLo(Y,Z),H.VCO=0,H.VCE=0},OL=function(J){const Q=s(J),q=l(J);let Y=H.VCC;for(let Z=0,K=H.vecSelectU32[o(J)];Z<8;Z++,Y>>=1,K>>=4){const X=H.getVecU16(Q,Z),W=H.getVecU16(q,K&7),z=Y&1?X:W;H.setAccLow(Z,z)}H.setVecFromAccLow(p(J)),H.VCO=0},EL=function(J){R8(J,(Q,q)=>Q&q)},AL=function(J){R8(J,(Q,q)=>~(Q&q))},kL=function(J){R8(J,(Q,q)=>Q|q)},wL=function(J){R8(J,(Q,q)=>~(Q|q))},CL=function(J){R8(J,(Q,q)=>Q^q)},yL=function(J){R8(J,(Q,q)=>~(Q^q))},R8=function(J,Q){const q=s(J),Y=l(J);for(let Z=0,K=H.vecSelectU32[o(J)];Z<8;Z++,K>>=4){const X=H.getVecU16(q,Z),W=H.getVecU16(Y,K&7);H.setAccLow(Z,Q(X,W))}H.setVecFromAccLow(p(J))},DL=function(J){const Q=l(J),q=p(J),Y=AY(J)&7,Z=H.vecSelectU32[o(J)];for(let K=0,X=Z;K<8;K++,X>>=4){const W=H.getVecS16(Q,X&7);H.setAccLow(K,W)}H.setVecS16(q,Y&7,H.getVecS16(Q,Z>>4*Y&7))},s$=function(J,Q){for(let q=0,Y=H.vecSelectU32[Q];q<8;q++,Y>>=4){const Z=H.getVecS16(J,Y&7);H.setAccLow(q,Z)}},i$=function(J){const Q=l(J),q=o(J);s$(Q,q),H.divDP=!0,H.divIn=H.getVecS16(Q,q&7),H.setVecS16(p(J),AY(J)&7,H.divOut)},kQ=function(J,Q,q){const Y=l(J),Z=o(J),K=H.getVecS16(Y,Z&7),X=q&&H.divDP?H.divIn<<16|K&65535:K;s$(Y,Z);const W=Q(X);H.divDP=!1,H.divOut=W>>16,H.setVecS16(p(J),AY(J)&7,W&65535)},IL=function(J){kQ(J,MY,!1)},BL=function(J){kQ(J,MY,!0)},RL=function(J){i$(J)},bL=function(J){kQ(J,hY,!1)},TL=function(J){kQ(J,hY,!0)},_L=function(J){i$(J)},SL=function(J){},vL=function(J){},fL=function(J){H.jump(m$(H.pc,J))},uL=function(J){H.setRegS32(kY,H.nextPC+4),H.jump(m$(H.pc,J))},gL=function(J){H.conditionalBranch(H.getRegS32(a(J))===H.getRegS32(S(J)),g6(J))},xL=function(J){H.conditionalBranch(H.getRegS32(a(J))!==H.getRegS32(S(J)),g6(J))},pL=function(J){H.conditionalBranch(H.getRegS32(a(J))<=0,g6(J))},mL=function(J){H.conditionalBranch(H.getRegS32(a(J))>0,g6(J))},nL=function(J){H.setRegS32(S(J),H.getRegS32(a(J))+B8(J))},oL=function(J){H.setRegS32(S(J),H.getRegS32(a(J))+B8(J))},cL=function(J){H.setRegS32(S(J),H.getRegS32(a(J))<B8(J)?1:0)},lL=function(J){H.setRegS32(S(J),H.getRegU32(a(J))<B8(J)>>>0?1:0)},dL=function(J){H.setRegS32(S(J),H.getRegS32(a(J))&EQ(J))},aL=function(J){H.setRegS32(S(J),H.getRegS32(a(J))|EQ(J))},rL=function(J){H.setRegS32(S(J),H.getRegS32(a(J))^EQ(J))},sL=function(J){H.setRegS32(S(J),B8(J)<<16)},iL=function(J){H.setRegS32(S(J),H.loadS8(H.calcAddress(J)))},tL=function(J){H.setRegU32(S(J),H.loadU8(H.calcAddress(J)))},eL=function(J){H.setRegS32(S(J),H.loadS16(H.calcAddress(J)))},JP=function(J){H.setRegU32(S(J),H.loadU16(H.calcAddress(J)))},QP=function(J){H.setRegS32(S(J),H.loadS32(H.calcAddress(J)))},qP=function(J){H.setRegU32(S(J),H.loadU32(H.calcAddress(J)))},YP=function(J){H.store8(H.calcAddress(J),H.getRegS32(S(J)))},ZP=function(J){H.store16(H.calcAddress(J),H.getRegS32(S(J)))},KP=function(J){H.store32(H.calcAddress(J),H.getRegS32(S(J)))},wQ=function(J,Q){const q=H.calcVecAddress(J,Q),Y=A0(J),Z=P0(J),K=16-Z<Q?16-Z:Q;for(let X=0;X<K;X++)H.setVecS8(Y,Z+X,H.loadS8(q+X))},CQ=function(J,Q){const q=H.calcVecAddress(J,Q),Y=A0(J),Z=P0(J);for(let K=0;K<Q;K++)H.store8(q+K,H.getVecS8(Y,Z+K&15))},XP=function(J){wQ(J,1)},WP=function(J){wQ(J,2)},$P=function(J){wQ(J,4)},zP=function(J){wQ(J,8)},HP=function(J){const Q=H.calcVecAddress(J,16),q=(Q&4080)+16,Y=A0(J),Z=P0(J),K=Math.min(q-Q,16-Z);for(let X=0;X<K;X++)H.setVecS8(Y,Z+X,H.loadU8(Q+X))},FP=function(J){const Q=H.calcVecAddress(J,16),q=Q&4080,Y=A0(J),Z=P0(J),K=Q&15,X=16-K+Z,W=Math.min(K,16-X);for(let z=0;z<W;z++)H.setVecS8(Y,X+z,H.loadU8(q+z))},wY=function(J,Q,q,Y,Z){const K=J&7,X=J&4088;for(let W=0;W<8;W++){const z=16-q+W*Z+K&15;H.setVecS16(Q,W,H.loadU8(X+z)<<Y)}},jP=function(J){wY(H.calcVecAddress(J,8),A0(J),P0(J),8,1)},NP=function(J){wY(H.calcVecAddress(J,8),A0(J),P0(J),7,1)},GP=function(J){wY(H.calcVecAddress(J,16),A0(J),P0(J),7,2)},LP=function(J){const Q=H.calcVecAddress(J,16),q=A0(J),Y=P0(J),Z=Q&7,K=Q&4088,X=H.vecTemp;X.setInt16(0,H.loadU8(K+(Z+0-Y&15))<<7,!1),X.setInt16(2,H.loadU8(K+(Z+4-Y&15))<<7,!1),X.setInt16(4,H.loadU8(K+(Z+8-Y&15))<<7,!1),X.setInt16(6,H.loadU8(K+(Z+12-Y&15))<<7,!1),X.setInt16(8,H.loadU8(K+(Z+8-Y&15))<<7,!1),X.setInt16(10,H.loadU8(K+(Z+12-Y&15))<<7,!1),X.setInt16(12,H.loadU8(K+(Z+0-Y&15))<<7,!1),X.setInt16(14,H.loadU8(K+(Z+4-Y&15))<<7,!1);const W=Math.min(8,16-Y);for(let z=Y,F=Y+W;z<F;z++)H.setVecS8(q,z,X.getInt8(z,!1))},PP=function(J){},VP=function(J){const Q=H.calcVecAddress(J,16),q=A0(J),Y=P0(J),Z=q&~7,K=Y>>1,X=Q&~7,W=(Q&8)+Y;for(let z=0;z<8;z++){const F=K+z&7;H.setVecS8(Z+F,z*2+0,H.loadU8(X+(W+z*2+0&15))),H.setVecS8(Z+F,z*2+1,H.loadU8(X+(W+z*2+1&15)))}},UP=function(J){CQ(J,1)},MP=function(J){CQ(J,2)},hP=function(J){CQ(J,4)},OP=function(J){CQ(J,8)},EP=function(J){const Q=H.calcVecAddress(J,16),q=(Q&4080)+16,Y=A0(J),Z=P0(J);let K=q-Q;for(let X=0;X<K;X++)H.store8(Q+X,H.getVecS8(Y,Z+X&15))},AP=function(J){const Q=H.calcVecAddress(J,16),q=Q&4080,Y=A0(J),Z=P0(J),K=Q&15,X=16-K+Z,W=K;for(let z=0;z<W;z++)H.store8(q+z,H.getVecS8(Y,X+z&15))},kP=function(J){const Q=H.calcVecAddress(J,8),q=A0(J),Y=P0(J);for(let Z=0;Z<8;Z++){const K=Y+Z,X=K&8?7:8,W=H.getVecS16(q,K&7)>>>X;H.store8(Q+Z,W)}},wP=function(J){const Q=H.calcVecAddress(J,8),q=A0(J),Y=P0(J);for(let Z=0;Z<8;Z++){const K=Y+Z,X=K&8?8:7,W=H.getVecS16(q,K&7)>>>X;H.store8(Q+Z,W)}},CP=function(J){const Q=H.calcVecAddress(J,16),q=A0(J),Y=P0(J),Z=Q&7,K=Q-Z;for(let X=0;X<8;X++){const W=Y+X*2,z=Z+X*2&15,F=H.getVecU16UnalignedWrap(q,W)>>>7;H.store8(K+z,F)}},DP=function(J){const Q=H.calcVecAddress(J,16),q=A0(J),Y=P0(J),Z=Q&7,K=Q-Z,X=yP.get(Y);if(X)for(let W=0;W<4;W++){const z=Z+W*4&15;H.store8(K+z,H.getVecU16(q,X[W])>>>7)}else for(let W=0;W<4;W++){const z=Z+W*4&15;H.store8(K+z,0)}},IP=function(J){const Q=H.calcVecAddress(J,16),q=A0(J),Y=P0(J),Z=Q&7,K=Q-Z;for(let X=0;X<16;X++){const W=Y+X&15,z=Z+X&15;H.store8(K+z,H.getVecS8(q,W))}},BP=function(J){const Q=H.calcVecAddress(J,16),q=A0(J),Y=P0(J),Z=Q&4088,K=Q&15,X=Q&8,W=q&~7,z=Y-(Q&8)>>1;for(let F=0;F<16;F++){const N=Z+(K+F&15),G=W+(z+(F>>1)&7),P=X+F&15;H.store8(N,H.getVecS8(G,P))}};window.n64js=window.n64js||{};var H,kY=31,A$=0,k$=1,w$=2,C$=3,y$=4,D$=5,I$=6,B$=7,OY=8,R$=9,b$=10,T$=11,_$=12,S$=13,v$=14,f$=15;var SN=1,vN=2;class n${constructor(J){this.hardware=J,this.dmem=J.sp_mem.subRegion(0,4096),this.imem=J.sp_mem.subRegion(4096,4096),this.halted=!0,this.pcDataView=J.sp_ibist_mem.dataView,this.pc=0,this.delayPC=0,this.nextPC=0,this.branchTarget=0;const Q=new ArrayBuffer(128);this.gprU32=new Uint32Array(Q),this.gprS32=new Int32Array(Q);const q=new ArrayBuffer(512);this.vpr=new DataView(q),this.vprS16=new Int16Array(q),this.vprS8=new Int8Array(q),this.vprU64=new BigUint64Array(q);const Y=new ArrayBuffer(64);this.vAcc=new BigInt64Array(Y),this.vAccS32=new Int32Array(Y),this.vAccU32=new Uint32Array(Y),this.vAccS16=new Int16Array(Y),this.vAccU16=new Uint16Array(Y),this.vuVCOReg=new Uint16Array(new ArrayBuffer(2)),this.vuVCCReg=new Uint16Array(new ArrayBuffer(2)),this.vuVCEReg=new Uint8Array(new ArrayBuffer(1)),this.divDP=!1,this.divIn=0,this.divOut=0,this.vecSelectU32=new Uint32Array(new ArrayBuffer(64)),this.vecSelectU32[0]=1985229328,this.vecSelectU32[1]=1985229328,this.vecSelectU32[2]=1715741184,this.vecSelectU32[3]=2002072337,this.vecSelectU32[4]=1145307136,this.vecSelectU32[5]=1431638289,this.vecSelectU32[6]=1717969442,this.vecSelectU32[7]=2004300595,this.vecSelectU32[8]=0,this.vecSelectU32[9]=286331153,this.vecSelectU32[10]=572662306,this.vecSelectU32[11]=858993459,this.vecSelectU32[12]=1145324612,this.vecSelectU32[13]=1431655765,this.vecSelectU32[14]=1717986918,this.vecSelectU32[15]=2004318071;const Z=new ArrayBuffer(128);this.vecTemp=new DataView(Z),this.vecTempU64=new BigUint64Array(Z),this.reset()}reset(){this.halted=!0,this.pc=0,this.delayPC=0,this.nextPC=0,this.branchTarget=0;for(let J=0;J<32;++J){this.gprS32[J]=0;for(let Q=0;Q<8;Q++)this.vprS16[J*8+Q]=0}this.vAcc[0]=0n,this.vuVCOReg[0]=0,this.vuVCCReg[0]=0,this.vuVCEReg[0]=0,this.divDP=!1,this.divIn=0,this.divOut=0}getRegS32(J){return this.gprS32[J]}getRegU32(J){return this.gprU32[J]}setRegS32(J,Q){if(J!=0)this.gprS32[J]=Q}setRegU32(J,Q){if(J!=0)this.gprU32[J]=Q}setRegS16SignExtend(J,Q){if(J!=0)this.gprS32[J]=Q<<16>>16}getAccS48(J){return this.vAcc[J]}setAccS48(J,Q){this.vAcc[J]=BigInt.asIntN(48,Q)}updateAcc32Signed(J,Q,q){if(q)this.setAccS48(J,this.vAcc[J]+BigInt(Q));else this.vAccS32[J*2+1]=Q>=0?0:4294967295,this.vAccS32[J*2+0]=Q}updateAccU32(J,Q,q){if(q)this.setAccS48(J,this.vAcc[J]+BigInt(Q));else this.vAccU32[J*2+1]=0,this.vAccU32[J*2+0]=Q}updateAcc32SignedShift16(J,Q,q){if(q)this.setAccS48(J,this.vAcc[J]+(BigInt(Q)<<16n));else this.vAccS32[J*2+1]=Q>>16,this.vAccS32[J*2+0]=Q<<16}setAccLow(J,Q){this.vAccS16[J*4+0]=Q}getAccLow(J){return this.vAccS16[J*4+0]}setAccMid(J,Q){this.vAccS16[J*4+1]=Q}getAccMid(J){return this.vAccS16[J*4+1]}setAccHigh(J,Q){this.vAccS16[J*4+2]=Q}getAccHigh(J){return this.vAccS16[J*4+2]}getAccHighMid(J){return this.vAccS16[J*4+2]<<16|this.vAccU16[J*4+1]}setVecFromAccSignedMid(J){for(let Q=0;Q<8;Q++){const q=this.getAccHighMid(Q);let Y;if(q>=0)Y=q&4294934528?32767:q;else Y=~q&4294934528?32768:q;this.setVecS16(J,Q,Y)}}setVecFromAccSignedLow(J){for(let Q=0;Q<8;Q++){const q=this.getAccHighMid(Q),Y=this.getAccLow(Q);let Z;if(q>=0)Z=q&4294934528?65535:Y;else Z=~q&4294934528?0:Y;this.setVecS16(J,Q,Z)}}setVecFromAccOddified(J){for(let Q=0;Q<8;Q++)this.setVecS16(J,Q,OG(this.vAcc[Q]>>1n,16n,32768,32767)&65520)}setVecFromAccUnsignedMid(J){for(let Q=0;Q<8;Q++)this.setVecS16(J,Q,EG(this.vAcc[Q],16n,0,65535))}setVecFromAccMid(J){for(let Q=0;Q<8;Q++)this.setVecS16(J,Q,this.getAccMid(Q))}setVecFromAccLow(J){for(let Q=0;Q<8;Q++)this.setVecS16(J,Q,this.getAccLow(Q))}get VCO(){return this.vuVCOReg[0]}get VCOHi(){return this.vuVCOReg[0]>>>8&255}get VCOLo(){return this.vuVCOReg[0]>>>0&255}get VCC(){return this.vuVCCReg[0]}get VCCHi(){return this.vuVCCReg[0]>>>8&255}get VCCLo(){return this.vuVCCReg[0]>>>0&255}get VCE(){return this.vuVCEReg[0]}set VCO(J){this.vuVCOReg[0]=J}set VCC(J){this.vuVCCReg[0]=J}set VCE(J){this.vuVCEReg[0]=J}setVCOHiLo(J,Q){this.vuVCOReg[0]=J<<8|Q}setVCCHiLo(J,Q){this.vuVCCReg[0]=J<<8|Q}getVecS16(J,Q){return this.vpr.getInt16(16*J+Q*2,!1)}getVecU16(J,Q){return this.vpr.getUint16(16*J+Q*2,!1)}getVecS8(J,Q){return this.vpr.getInt8(16*J+Q,!1)}getVecU8(J,Q){return this.vpr.getUint8(16*J+Q,!1)}setVecZero(J){this.vprU64[J*2+0]=0n,this.vprU64[J*2+1]=0n}setVecFromTemp(J){this.vprU64[J*2+0]=this.vecTempU64[0],this.vprU64[J*2+1]=this.vecTempU64[1]}setVecS16(J,Q,q){this.vpr.setInt16(16*J+Q*2,q,!1)}setVecS8(J,Q,q){this.vpr.setInt8(16*J+Q,q,!1)}getVecU16UnalignedWrap(J,Q){const q=this.getVecU8(J,Q&15),Y=this.getVecU8(J,Q+1&15);return q<<8|Y}setVecU16UnalignedNoWrap(J,Q,q){if(this.setVecS8(J,Q+0,q>>8),Q<15)this.setVecS8(J,Q+1,q)}sprintVecReg(J){let Q=[];for(let q=0;q<8;q++)Q.push(x(this.getVecS16(J,q)));return`V${J}: [${Q.join(", ")}]`}loadU8(J){return this.dmem.getU8(J&4095)}loadU16(J){return J<=4094?this.dmem.getU16(J):this.loadU16Wrapped(J)}loadU32(J){return J<=4092?this.dmem.getU32(J):this.loadU32Wrapped(J)}loadS8(J){return this.dmem.getS8(J&4095)}loadS16(J){return J<=4094?this.dmem.getS16(J):this.loadS16Wrapped(J)}loadS32(J){return J<=4092?this.dmem.getS32(J):this.loadS32Wrapped(J)}store8(J,Q){return this.dmem.set8(J&4095,Q)}store16(J,Q){return J<=4094?this.dmem.set16(J,Q):this.store16Wrapped(J,Q)}store32(J,Q){return J<=4092?this.dmem.set32(J,Q):this.store32Wrapped(J,Q)}store32masked(J,Q,q){const Z=this.loadU32(J,!1)&~q|Q&q;this.store32(J,Z)}loadU16Wrapped(J){return(this.loadU8(J+0)<<8|this.loadU8(J+1)<<0)>>>0}loadS16Wrapped(J){return this.loadU16Wrapped(J)<<16>>16}loadU32Wrapped(J){return(this.loadU8(J+0)<<24|this.loadU8(J+1)<<16|this.loadU8(J+2)<<8|this.loadU8(J+3)<<0)>>>0}loadS32Wrapped(J){return this.loadU32Wrapped(J)>>0}store16Wrapped(J,Q){this.store8(J+0,Q>>>8),this.store8(J+1,Q>>>0)}store32Wrapped(J,Q){this.store8(J+0,Q>>>24),this.store8(J+1,Q>>>16),this.store8(J+2,Q>>>8),this.store8(J+3,Q>>>0)}calcDebuggerAddress(J){return this.calcAddress(J)+2751463424}calcAddress(J){return this.getRegS32(_N(J))+B8(J)&4095}calcVecAddress(J,Q){return this.getRegS32(RN(J))+bN(J)*Q&4095}conditionalBranch(J,Q){const q=J?Q*4:4;this.branchTarget=this.pc+4+q&4092}jump(J){this.branchTarget=J>>>0&4092}get pc(){return this.pcDataView.getInt32(0,!1)}set pc(J){this.pcDataView.setUint32(0,J,!1)}unhalt(){this.halted=!1}step(){if(this.halted)return;this.nextPC=this.delayPC||this.pc+4&4092;const J=this.imem.getU32(this.pc);this.branchTarget=0,this.executeOp(J),this.pc=this.nextPC,this.delayPC=this.branchTarget}halt(J){this.hardware.spRegDevice.setStatusBits(J|SN),this.halted=!0}disassembleAll(){const J=gJ(this.imem,0,4096);for(let Q of J)console.log(`${B(Q.address,16)} ${Q.disassembly}`)}disassembleOp(J,Q){const q=KJ(J,Q);console.log(`${B(q.address,16)} ${q.disassembly}`)}executeOp(J){cN[BN(J)](J)}moveFromControl(J){switch(J){case A$:case k$:case w$:case C$:case y$:case D$:case I$:case B$:return this.hardware.spRegDevice.readRegU32(u$(J));case OY:case R$:case b$:case T$:case _$:case S$:case v$:case f$:return this.hardware.dpcDevice.readRegU32(g$(J))}return console.log(`MFC0: ${J} unhandled - returning 0`),0}moveToControl(J,Q){switch(J){case A$:case k$:case w$:case C$:case y$:case D$:case I$:case B$:this.hardware.spRegDevice.writeReg32(u$(J),Q);break;case OY:case R$:case b$:case T$:case _$:case S$:case v$:case f$:this.hardware.dpcDevice.writeReg32(g$(J),Q);break;default:console.log(`Unhandled RSP MTC0 register: ${J} = ${j(Q)}`);break}}}var fN=(()=>{let J=[];for(let Q=0;Q<64;Q++)J[Q]=x6;return J[0]=lN,J[2]=dN,J[3]=aN,J[4]=rN,J[6]=sN,J[7]=iN,J[8]=tN,J[9]=eN,J[13]=JG,J[32]=QG,J[33]=qG,J[34]=YG,J[35]=ZG,J[36]=KG,J[37]=XG,J[38]=WG,J[39]=$G,J[42]=zG,J[43]=HG,J})(),uN=(()=>{let J=[];for(let Q=0;Q<32;Q++)J.push(x6);return J[0]=FG,J[1]=jG,J[16]=NG,J[17]=GG,J})(),gN=(()=>{let J=[];for(let Q=0;Q<32;Q++)J.push(x6);return J[0]=LG,J[4]=PG,J})(),xN=(()=>{let J=[];for(let Q=0;Q<32;Q++)J.push(x6);J[0]=VG,J[2]=MG,J[4]=UG,J[6]=hG;for(let Q=16;Q<32;Q++)J[Q]=mN;return J})(),pN=(()=>{let J=[];for(let Q=0;Q<64;Q++)J.push(x6);return J[0]=mG,J[1]=nG,J[2]=dG,J[3]=qL,J[4]=aG,J[5]=sG,J[6]=tG,J[7]=JL,J[8]=oG,J[9]=cG,J[10]=lG,J[11]=YL,J[12]=rG,J[13]=iG,J[14]=eG,J[15]=QL,J[16]=ZL,J[17]=KL,J[18]=AG,J[19]=WL,J[20]=$L,J[21]=zL,J[22]=kG,J[23]=wG,J[24]=CG,J[25]=yG,J[26]=DG,J[27]=IG,J[28]=BG,J[29]=NL,J[30]=RG,J[31]=bG,J[32]=GL,J[33]=LL,J[34]=PL,J[35]=VL,J[36]=UL,J[37]=ML,J[38]=hL,J[39]=OL,J[40]=EL,J[41]=AL,J[42]=kL,J[43]=wL,J[44]=CL,J[45]=yL,J[46]=TG,J[47]=_G,J[48]=IL,J[49]=BL,J[50]=RL,J[51]=DL,J[52]=bL,J[53]=TL,J[54]=_L,J[55]=SL,J[56]=SG,J[57]=vG,J[58]=fG,J[59]=uG,J[60]=gG,J[61]=xG,J[62]=pG,J[63]=vL,J})(),nN=(()=>{let J=[];for(let Q=0;Q<32;Q++)J.push(x6);return J[0]=XP,J[1]=WP,J[2]=$P,J[3]=zP,J[4]=HP,J[5]=FP,J[6]=jP,J[7]=NP,J[8]=GP,J[9]=LP,J[10]=PP,J[11]=VP,J})(),oN=(()=>{let J=[];for(let Q=0;Q<32;Q++)J.push(x6);return J[0]=UP,J[1]=MP,J[2]=hP,J[3]=OP,J[4]=EP,J[5]=AP,J[6]=kP,J[7]=wP,J[8]=CP,J[9]=DP,J[10]=IP,J[11]=BP,J})(),cN=(()=>{let J=[];for(let Q=0;Q<64;Q++)J.push(x6);return J[0]=(Q)=>fN[p$(Q)](Q),J[1]=(Q)=>uN[S(Q)](Q),J[2]=fL,J[3]=uL,J[4]=gL,J[5]=xL,J[6]=pL,J[7]=mL,J[8]=nL,J[9]=oL,J[10]=cL,J[11]=lL,J[12]=dL,J[13]=aL,J[14]=rL,J[15]=sL,J[16]=(Q)=>gN[a(Q)](Q),J[18]=(Q)=>xN[a(Q)](Q),J[32]=iL,J[33]=eL,J[35]=QP,J[36]=tL,J[37]=JP,J[39]=qP,J[40]=YP,J[41]=ZP,J[43]=KP,J[50]=(Q)=>nN[q0(Q)](Q),J[58]=(Q)=>oN[q0(Q)](Q),J})(),HL=8,FL=9,jL=10,yP=new Map([[0,[0,1,2,3]],[1,[6,7,4,5]],[4,[1,2,3,0]],[5,[7,4,5,6]],[8,[4,5,6,7]],[11,[3,0,1,2]],[12,[5,6,7,4]],[15,[0,1,2,3]]]);function W5(J){V=new G5(J),c=new $Y(V),Q8=new L5,$$(J,V),fY(),n64js.cpu0=V}var LV=function(J){return J>>>13},PV=function(J){return(J&AJ)>>mP},VV=function(J){return(J&BY)>>pP},RY=function(J,Q,q){return(~(J^Q)&(q^J)&z5)!=0},F5=function(J,Q,q){return((J^Q)&(q^J)&z5)!=0},bY=function(J,Q,q){return(~(J^Q)&(q^J)&H5)!=0n},j5=function(J,Q,q){return((J^Q)&(q^J)&H5)!=0n},_Y=function(J){return J>>13&4095},MV=function(J){const q=_Y(J)&2730;return(q|q>>1)<<13},hV=function(J){const Q=_Y(J);if(Q&2048)return 1<<24;if(Q&512)return 1<<22;if(Q&128)return 1<<20;if(Q&32)return 1<<18;if(Q&8)return 1<<16;if(Q&2)return 1<<14;return 1<<12},OV=function(J){const Q=UV.get(J);if(Q)return Q;return`Unknown(${_Y(J).toString(2)})`};var k=function(J){throw`CPU: unknown op, pc: ${j(V.pc)}, instruction: ${j(J)}`},K5=function(){},EV=function(J){return J&~3758096384},X5=function(J){return EV(J>>>0)>>>4},AV=function(J){r((J>>>18&7)===0,"cc bit is not 0");const Q=(J&65536)!==0,q=(J&131072)!==0,Z=(c.control[31]&$5)!==0===Q;if(q)V.conditionalBranchLikely(Z,Q0(J));else V.conditionalBranch(Z,Q0(J))},kV=function(J){if(J.length!=64)throw"Special table is unexpected size.";return J},CV=function(J){wV[z8(J)](J)},SY=function(J){if(J.length!=32)throw"Cop table is unexpected size.";return J},DV=function(J){yV[f0(J)](J)},BV=function(J){IV[f0(J)](J)},bV=function(J){RV[f0(J)](J)},TV=function(J){V.raiseRESERVEDException(0)},vY=function(J){r((V.getControlU32(U0)&TY)===0,"SR_CU1 in inconsistent state"),V.raiseCopXUnusable(1)},fY=function(){const J=V.getControlU32(U0),Q=(J&TY)!==0;V5[17]=Q?BV:vY,c.fullMode=(J&bP)!==0},_V=function(J){if(J.length!=32)throw"RegImm table is unexpected size.";return J},vV=function(J){return SV[$8(J)](J)},fV=function(J){if(J.length!=64)throw"Simple table is unexpected size.";return J},P5=function(J){return V5[W8(J)](J)},uV=function(J,Q,q){return J-=Q,J-=q,J^=q>>>13,Q-=q,Q-=J,Q^=J<<8,q-=J,q-=Q,q^=Q>>>13,J-=Q,J-=q,J^=q>>>12,Q-=q,Q-=J,Q^=J<<16,q-=J,q-=Q,q^=Q>>>5,J-=Q,J-=q,J^=q>>>3,Q-=q,Q-=J,Q^=J<<10,q-=J,q-=Q,q^=Q>>>15,J},gV=function(J,Q){if(!J.sync32(Q,"pc"))return!1;{let q=0;for(let Y=0;Y<32;++Y)q=uV(q,V.getRegU32Lo(Y),0);if(q=q>>>0,!J.sync32(q,"regs"))return!1}return!0},xV=function(J,Q,q){if(q.nextEventCountdown()<J.opsCompiled*b8)return null;J.executionCount++;const Y=J.func(),Z=Y*b8;if(!e6)Q.incrementCount(Z);return q.incrementCount(Z),J.getNextFragment(Q.pc,Y)},pV=function(J,Q,q,Y){if(r(!J.func,`attempting to append op to already-compiled fragment ${j(J.entryPC)}`),J.opsCompiled===0)T8.newFragment();J.opsCompiled++,M5.addInstructionToFragment(J,Q),J.bodyCode+="rsp.step();\n",J.bodyCode+=`if (c.stuffToDo) { return ${J.opsCompiled-1}; }\n`,J.bodyCode+="\n";const Z=Q,K=Y.pc;if(T8.set(J,Z,q,K,Y.nextPC),M$(T8),J.opsCompiled>8&&Y.pc!==Q+4||J.opsCompiled>=RP||Y.stuffToDo)mV(J),J=N8(Y.pc);else J.bodyCode+=`// Keep going: ops ${J.opsCompiled}, pc: ${j(Y.pc)}, entry+4: ${j(Q+4)}, stuff: ${Y.stuffToDo}\n`;return J},mV=function(J){let Q="";if(n64js.getSyncFlow())Q+="const sync = n64js.getSyncFlow();\n";if(J.usesCop1)Q+=`const SR_CU1 = ${j(TY)};\n`,Q+=`const FPCSR_C = ${j($5)};\n`;if(T8.delayedPCUpdate!==0)J.bodyCode+=`c.pc = ${j(T8.delayedPCUpdate)};\n`,T8.delayedPCUpdate=0;J.bodyCode+=`return ${J.opsCompiled};\n`;const Y=`
  return function fragment_${j(J.entryPC)}_${J.opsCompiled}() {
  ${Q}
  ${J.bodyCode}
}`;J.bodyCode="",J.func=new Function("c","cpu1","rsp",Y)(V,c,H),J.nextFragments=[];for(let Z=0;Z<J.opsCompiled;Z++)J.nextFragments.push(void 0)};window.n64js=window.n64js||{};var V,c,Q8,IQ=!1,RP=250,b8=1,t$=2147483648;var _0=2147484032,BQ=1,OJ=2,EJ=4;var bP=67108864;var TY=536870912;var TP=28,_P=0xfff7_ffffn,e$=2147483648,SP=805306368,vP=28,fP=256,uP=512,CY=1024;var J5=32768,gP=65280;var Q5=124,xP=BigInt(fP|uP);var $5=8388608;var BY=0xc000000000000000n,pP=62n,AJ=0x000000ffffffe000n,mP=13n,MJ=0xffn,nP=0xc00000ffffffe0ffn;var oP=4,yY=2,DY=1,cP=0x3fffffffn,lP=2147483648;var dP=0x8000003fn;var aP=0x3fn;var rP=8388592,sP=4,iP=~0x7fffffn,tP=0x7fff_fff0n,eP=4n,JV=0x1_8000_0000n,QV=31n,qV=0xfffffffe_00000000n,YV=0,ZV=24576,KV=122880,XV=516096,WV=2088960,$V=8380416,zV=33546240,HV=8191,FV=0x01ffe000n,jV=0x0f00800fn,NV=0xffffffffn,GV=0xffn,IY=1<<0,yQ=1<<1,q5=1<<2,Y5="Compare",hJ="Run For Cycles";n64js.getSyncFlow=()=>n6;var z5=2147483648,H5=0x8000_0000_0000_0000n,DQ=4294967295,e0=0xffff_ffff_ffff_ffffn,Z5=0xffff_ffffn;n64js.s32CheckAddOverflow=RY;n64js.s32CheckSubOverflow=F5;n64js.s64CheckAddOverflow=bY;n64js.s64CheckSubOverflow=j5;class N5{constructor(){this.pagemask=0,this.hi=0n,this.pfne=0,this.pfno=0,this.global=0,this.offsetMask=0,this.vpnmask64=AJ,this.vpn2bits=0n,this.physEven=0,this.physOdd=0,this.checkbit=0}update(J,Q,q,Y,Z){if(IQ)M(`TLB update: index=${J}, pagemask=${j(Q)}, entryhi=${D6(q)}, entrylo0=${j(Y)}, entrylo1=${j(Z)}`),M(`       ${OV(Q)} Pagesize`);const K=Y&Z&DY;this.pagemask=MV(Q),this.hi=q,this.pfne=Y&~DY|K,this.pfno=Z&~DY|K,this.global=K,this.offsetMask=(this.pagemask|HV)>>>1,this.vpnmask64=AJ&BigInt(~this.pagemask),this.vpn2bits=q&this.vpnmask64,this.physEven=this.pfne<<6&~this.offsetMask,this.physOdd=this.pfno<<6&~this.offsetMask,this.checkbit=hV(this.pagemask)}}var UV=new Map([[YV,"4k"],[ZV,"16k"],[KV,"64k"],[XV,"256k"],[WV,"1M"],[$V,"4M"],[zV,"16M"]]);class G5{constructor(J){this.hardware=J,this.opsExecuted=0,this.ramDV=J.cachedMemDevice.mem.dataView;const Q=new ArrayBuffer(256);this.gprU32=new Uint32Array(Q),this.gprS32=new Int32Array(Q),this.gprU64=new BigUint64Array(Q),this.gprS64=new BigInt64Array(Q);const q=new ArrayBuffer(256);this.controlRegU32=new Uint32Array(q),this.controlRegS32=new Int32Array(q),this.controlRegU64=new BigUint64Array(q),this.controlRegS64=new BigInt64Array(q),this.controlCountValue=0,this.lastControlRegWrite=0n,this.pc=0,this.delayPC=0,this.nextPC=0,this.branchTarget=0,this.llBit=0,this.stuffToDo=0,this.eventQueue=new PY;const Y=new ArrayBuffer(8);this.multHiU32=new Uint32Array(Y),this.multHiS32=new Int32Array(Y),this.multHiU64=new BigUint64Array(Y),this.multHiS64=new BigInt64Array(Y);const Z=new ArrayBuffer(8);this.multLoU32=new Uint32Array(Z),this.multLoS32=new Int32Array(Z),this.multLoU64=new BigUint64Array(Z),this.multLoS64=new BigInt64Array(Z),this.tlbEntries=[];for(let K=0;K<32;++K)this.tlbEntries.push(new N5);this.loadU8fast=HY,this.loadU16fast=jY,this.loadU32fast=LJ,this.loadU64fast=t6,this.loadS8fast=FY,this.loadS16fast=NY,this.loadS32fast=PJ,this.store8fast=GY,this.store16fast=LY,this.store32fast=VJ,this.store64fast=UJ,this.store32masked=$Q,this.store64masked=zQ,this.reset()}conditionalBranch(J,Q){const q=J?Q*4:4;this.branchTarget=this.pc+4+q}conditionalBranchLikely(J,Q){if(J)this.branchTarget=this.pc+4+Q*4;else this.nextPC+=4}jump(J){this.branchTarget=J}getOpsExecuted(){return this.controlCountValue}incrementCount(J){this.controlCountValue+=J}getRegS32Lo(J){return this.gprS32[J*2+0]}getRegU32Lo(J){return this.gprU32[J*2+0]}getRegS64(J){return this.gprS64[J]}getRegU64(J){return this.gprU64[J]}setRegU64(J,Q){if(J==0)return;const q=Q&e0;this.gprU64[J]=q}setRegU64Masked(J,Q,q){if(J==0)return;this.gprU64[J]=this.gprU64[J]&~q|Q&q}setRegS64LoHi(J,Q,q){if(J==0)return;this.gprS32[J*2+0]=Q,this.gprS32[J*2+1]=q}setRegS32ExtendMasked(J,Q,q){if(J==0)return;const Y=this.gprS32[J*2+0]&~q|Q&q;this.gprS32[J*2+0]=Y,this.gprS32[J*2+1]=Y>>31}setRegS32Extend(J,Q){if(J==0)return;this.gprS32[J*2+0]=Q,this.gprS32[J*2+1]=Q>>31}setRegU32Extend(J,Q){if(J==0)return;this.gprU32[J*2+0]=Q,this.gprU32[J*2+1]=0}getMultLoS64(){return this.multLoS64[0]}getMultLoU64(){return this.multLoU64[0]}setMultLoS32Extend(J){this.multLoS64[0]=BigInt.asIntN(32,J)}setMultLoS64(J){this.multLoS64[0]=J}setMultLoU64(J){this.multLoU64[0]=J}getMultHiS64(){return this.multHiS64[0]}getMultHiU64(){return this.multHiU64[0]}setMultHiS32Extend(J){this.multHiS64[0]=BigInt.asIntN(32,J)}setMultHiS64(J){this.multHiS64[0]=J}setMultHiU64(J){this.multHiU64[0]=J}setControlU32(J,Q){this.controlRegU32[J*2+0]=Q}setControlS32(J,Q){this.controlRegS32[J*2+0]=Q}getControlU32(J){return this.controlRegU32[J*2+0]}getControlS32(J){return this.controlRegS32[J*2+0]}setControlS32Extend(J,Q){this.controlRegS32[J*2+0]=Q,this.controlRegS32[J*2+1]=Q>>31}setControlU64(J,Q){this.controlRegU64[J]=Q}setControlS64(J,Q){this.controlRegS64[J]=Q}getControlU64(J){return this.controlRegU64[J]}getControlS64(J){return this.controlRegS64[J]}maskControlBits32(J,Q,q){const Y=J*2+0;this.controlRegU32[Y]=this.controlRegU32[Y]&~Q|q&Q}setControlBits32(J,Q){this.controlRegU32[J*2+0]|=Q}clearControlBits32(J,Q){this.controlRegU32[J*2+0]&=~Q}maskControlBits64(J,Q,q){this.controlRegU64[J]=this.controlRegU64[J]&~Q|q&Q}setControlBits64(J,Q){this.controlRegU64[J]|=Q}clearControlBits64(J,Q){this.controlRegU64[J]&=~Q}reset(){XX();for(let J=0;J<32;++J)this.gprU64[J]=0n,this.controlRegU64[J]=0n;for(let J=0;J<32;++J)this.tlbEntries[J].update(J,0,0x80000000n,0,0);this.pc=0,this.delayPC=0,this.nextPC=0,this.branchTarget=0,this.stuffToDo=0,this.eventQueue.reset(),this.multLoU32[0]=this.multLoU32[1]=0,this.multHiU32[0]=this.multHiU32[1]=0,this.setControlU32(c8,31),this.setControlU32(U0,1883242500),this.setControlU32(i8,1879499875)}moveToControl(J,Q){switch(this.lastControlRegWrite=Q,J){case Y8:this.setControlU64(J,Q&dP);break;case l8:case d8:this.setControlU64(J,Q&cP);break;case a8:this.setControlU64(J,Q&iP);break;case r8:this.setControlU64(J,Q&FV);break;case fQ:this.setControlU64(J,Q&aP),this.setControlU64(c8,31n);break;case y6:this.setControlU64(J,Q&nP);break;case c8:case s8:case TJ:case pZ:break;case i8:this.maskControlBits64(J,jV,Q);break;case w0:M(`Setting cause register to ${j(Q)}`),n64js.check(Q===0,"Should only write 0 to Cause register."),this.maskControlBits64(J,xP,Q);break;case U0:this.setControlU64(J,Q&_P),this.statusRegisterChanged();break;case m6:this.controlCountValue=Number(Q)*2;break;case Z8:this.setCompare(Number(Q&0xffff_ffffn));break;case gQ:this.maskControlBits64(J,qV,Q);break;case N6:case mZ:case nZ:this.setControlU64(J,Q);break;case _J:this.maskControlBits64(J,NV,Q);break;case uQ:case xQ:case pQ:case mQ:case nQ:case oQ:case cQ:break;case xZ:this.setControlU64(J,Q&GV);break;case t8:this.setControlU64(J,Q);break;default:this.setControlU64(J,Q),M(`Write to cpu0 control register. ${D6(Q)} --> ${F8[J]}`);break}}moveFromControl(J){if(J===w0)this.checkCauseIP3Consistent();switch(J){case c8:return BigInt(this.getRandom());case uQ:case xQ:case pQ:case mQ:case nQ:case oQ:case cQ:return this.lastControlRegWrite;case m6:return BigInt(this.controlCountValue)>>1n;default:return this.getControlU64(J)}}breakExecution(){this.stuffToDo|=IY}run(J){this.stuffToDo&=~IY,this.checkCauseIP3Consistent(),n64js.hardware().checkSIStatusConsistent(),this.addRunForCyclesEvent(J);while(this.hasEvent(hJ))try{this.runImpl();break}catch(q){if(q instanceof A6)this.handleEmulatedException();else if(q instanceof K5)n64js.stopForBreakpoint();else{n64js.halt("Exception :"+q);break}}let Q=this.removeEvent(hJ);if(Q<0)Q=0;if(Q<J)this.opsExecuted+=J-Q}runImpl(){const J=this.eventQueue,Q=this.ramDV;while(this.hasEvent(hJ)){let q=N8(this.pc);while(!this.stuffToDo)if(q&&q.func)q=xV(q,this,J);else{if(H.step(),this.stuffToDo)break;const Y=this.pc|0;this.nextPC=this.delayPC||this.pc+4;let Z;if((Y&3)!=0){this.raiseAdELException(Y),this.pc=this.nextPC,q=N8(this.pc);continue}else if(Y<-2139095040){const K=Y+2147483648|0;Z=Q.getInt32(K,!1)}else Z=zY(Y>>>0);if(this.branchTarget=0,P5(Z),this.pc=this.nextPC,this.delayPC=this.branchTarget,this.incrementCount(b8),J.incrementCount(b8),q)q=pV(q,Y>>>0,Z,this);else if(this.pc<Y)q=N8(this.pc)}if(this.stuffToDo&=~q5,this.stuffToDo&yQ)this.stuffToDo&=~yQ,this.handleInterrupt();else if(this.stuffToDo&IY)break;else if(this.stuffToDo){n64js.warn("Don't know how to handle this event!");break}}}handleEmulatedException(){this.pc=this.nextPC,this.delayPC=0,this.branchTarget=0,this.incrementCount(b8),this.eventQueue.incrementCount(b8)}speedHack(){if(!H.halted)return;if(n64js.hardware().memMap.readMemoryInternal32(this.pc+4)!==0)return;const Q=this.removeEvent(hJ),q=this.eventQueue.skipToNextEvent(1);if(this.controlCountValue+=q,Q>=0)this.addRunForCyclesEvent(Q)}updateCause3(){if(n64js.hardware().miRegDevice.interruptsUnmasked())this.setControlBits32(w0,CY),this.updateStuffToDoForInterrupts();else this.clearControlBits32(w0,CY);this.checkCauseIP3Consistent()}checkCauseIP3Consistent(){const Q=n64js.hardware().miRegDevice.interruptsUnmasked(),q=(this.getControlU32(w0)&CY)!==0;r(Q===q,`CAUSE_IP3 ${q} inconsistent with MI_INTR_REG ${Q}`)}statusRegisterChanged(){fY(),this.updateStuffToDoForInterrupts()}checkForUnmaskedInterrupts(){const J=this.getControlU32(U0);if((J&(OJ|EJ|BQ))===BQ){const Q=this.getControlU32(w0);if((J&Q&gP)!==0)return!0}return!1}updateStuffToDoForInterrupts(){if(this.checkForUnmaskedInterrupts())this.stuffToDo|=yQ;else this.stuffToDo&=~yQ}setBadVAddr(J){this.setControlU64(s8,J)}setContext(J){const Q=Number(J&0xffffffffn),q=LV(Q)<<sP;this.maskControlBits32(a8,rP,q)}setXContext(J){const Q=PV(J)<<eP|VV(J)<<QV,q=tP|JV;this.maskControlBits64(gQ,q,Q)}checkCopXUsable(J){const Q=1<<TP+J;if((this.getControlU32(U0)&Q)==0)return this.raiseCopXUnusable(J),!1;return!0}maybeRaiseTRAPException(J){if(J)this.raiseTRAPException()}raiseCopXUnusable(J){this.raiseExceptionCopCode(_0,J,iZ)}raiseSYSCALLException(){this.raiseExceptionCopCode(_0,0,aZ)}raiseBREAKException(){this.raiseExceptionCopCode(_0,0,rZ)}raiseRESERVEDException(J){this.raiseExceptionCopCode(_0,J,sZ)}raiseTRAPException(){this.raiseExceptionCopCode(_0,0,eZ)}raiseOverflowException(){this.raiseExceptionCopCode(_0,0,tZ)}raiseFPE(){this.raiseExceptionCopCode(_0,0,JK)}raiseAdELException(J){this.raiseAddressException(_0,lZ,J)}raiseAdESException(J){this.raiseAddressException(_0,dZ,J)}raiseTLBException(J,Q,q){const Y=BigInt(q>>0);this.setBadVAddr(Y),this.setContext(Y),this.setXContext(Y),this.maskControlBits64(y6,AJ,Y),this.raiseExceptionCopCode(J,0,Q)}raiseAddressException(J,Q,q){const Y=BigInt(q>>0);this.setBadVAddr(Y),this.setContext(Y),this.setXContext(Y),this.raiseExceptionCopCode(J,0,Q)}raiseExceptionCopCode(J,Q,q){const Y=Q5|SP,Z=q<<lQ,K=Q<<vP;this.raiseException(Y,Z|K,J)}raiseException(J,Q,q){if(this.maskControlBits32(w0,J,Q),this.setControlBits32(U0,OJ),this.delayPC)this.setControlBits32(w0,e$),this.setControlS32Extend(N6,this.pc-4);else this.clearControlBits32(w0,e$),this.setControlS32Extend(N6,this.pc);this.nextPC=q}handleInterrupt(){if(this.checkForUnmaskedInterrupts())this.raiseException(Q5,oZ<<lQ,_0),this.pc=_0,this.delayPC=0;else r(!1,"Was expecting an unmasked interrupt - something wrong with kStuffToDoCheckInterrupts?")}setCompare(J){if(this.clearControlBits32(w0,J5),J===this.getControlU32(Z8));else{const Q=this.controlCountValue/2>>0,q=J-Q>>>0;this.removeEvent(Y5),this.addCompareEvent(q),this.setControlU32(Z8,J)}}addEvent(J,Q,q){return this.eventQueue.addEvent(J,Q,q)}removeEvent(J){return this.eventQueue.removeEvent(J)}getCyclesUntilEvent(J){this.eventQueue.getCyclesUntilEvent(J)}hasEvent(J){return this.eventQueue.hasEvent(J)}addCompareEvent(J){const Q=this;this.addEvent(Y5,J,()=>{Q.setControlBits32(w0,J5),Q.updateStuffToDoForInterrupts()})}addRunForCyclesEvent(J){const Q=this;this.addEvent(hJ,J,()=>{Q.stuffToDo|=q5})}getRandom(){const J=this.getControlU32(fQ),Q=J>=32?0:J&31,q=J>=32?64:32;let Y=Math.floor(Math.random()*(q-Q))+Q;if(r(Y>=Q&&Y<q,`Ooops - random should be in range [${Q},${q}), but got ${Y}`),n6)Y=n6.reflect32(Y);return Y}setTLB(J){const Q=J&31,q=this.getControlU32(r8),Y=this.getControlU64(y6),Z=this.getControlU32(d8),K=this.getControlU32(l8);this.tlbEntries[Q].update(Q,q,Y,K,Z)}tlbWriteIndex(){this.setTLB(this.getControlU32(Y8))}tlbWriteRandom(){this.setTLB(this.getRandom())}tlbRead(){const J=this.getControlU32(Y8)&31,Q=this.tlbEntries[J],q=(BY|AJ|MJ)&BigInt(~Q.pagemask);if(this.setControlU32(r8,Q.pagemask),this.setControlU64(y6,Q.hi&q),this.setControlU32(l8,Q.pfne&67108863),this.setControlU32(d8,Q.pfno&67108863),IQ)M("TLB Read Index "+M0(J)+"."),M("  PageMask: "+j(this.getControlU32(r8))),M("  EntryHi:  "+D6(this.getControlU64(y6))),M("  EntryLo0: "+j(this.getControlU32(l8))),M("  EntryLo1: "+j(this.getControlU32(d8)))}tlbProbe(){const J=this.getControlU64(y6),Q=J&MJ;for(let q=0;q<32;++q){const Y=this.tlbEntries[q],Z=Y.vpnmask64|BY;if((Y.hi&Z)!==(J&Z))continue;if(!Y.global&&(Y.hi&MJ)!==Q)continue;if(IQ)M("TLB Probe. EntryHi:"+j(J)+". Found matching TLB entry - "+M0(q));this.setControlU32(Y8,q);return}if(IQ)M("TLB Probe. EntryHi:"+j(J)+". Didn't find matching entry");this.setControlU32(Y8,lP)}tlbFindEntry(J){const q=this.getControlU64(y6)&MJ,Y=BigInt(J>>>0);for(let Z=0;Z<32;++Z){const K=this.tlbEntries[Z];if((Y&K.vpnmask64)!==K.vpn2bits)continue;if(!K.global&&(K.hi&MJ)!==q)continue;return K}return null}translateReadInternal(J){const Q=this.tlbFindEntry(J);if(!Q)return 0;const q=J&Q.checkbit;if(((q?Q.pfno:Q.pfne)&yY)===0)return 0;const Z=q?Q.physOdd:Q.physEven,K=J&Q.offsetMask;return Z|K}translateRead(J){const Q=this.tlbFindEntry(J);if(!Q)throw this.raiseTLBException(t$,dQ,J),new A6;const q=J&Q.checkbit;if(((q?Q.pfno:Q.pfne)&yY)===0)throw this.raiseTLBException(_0,dQ,J),new A6;const Z=q?Q.physOdd:Q.physEven,K=J&Q.offsetMask;return Z|K}translateWrite(J){const Q=this.tlbFindEntry(J);if(!Q)throw this.raiseTLBException(t$,aQ,J),new A6;const q=J&Q.checkbit,Y=q?Q.pfno:Q.pfne;if((Y&yY)===0)throw this.raiseTLBException(_0,aQ,J),new A6;if((Y&oP)===0)throw this.raiseTLBException(_0,cZ,J),new A6;const Z=q?Q.physOdd:Q.physEven,K=J&Q.offsetMask;return Z|K}unalignedLoad(J){throw this.raiseAdELException(J),new A6}unalignedStore(J){throw this.raiseAdESException(J),new A6}execBreakpoint(){throw new K5}execSLL(J,Q,q){this.setRegS32Extend(J,this.getRegS32Lo(Q)<<q)}execSRL(J,Q,q){this.setRegS32Extend(J,this.getRegU32Lo(Q)>>>q)}execSRA(J,Q,q){this.setRegS32Extend(J,Number(this.getRegS64(Q)>>BigInt(q)&0xffff_ffffn))}execSLLV(J,Q,q){this.setRegS32Extend(J,this.getRegS32Lo(Q)<<(this.getRegS32Lo(q)&31))}execSRLV(J,Q,q){this.setRegS32Extend(J,this.getRegS32Lo(Q)>>>(this.getRegS32Lo(q)&31))}execSRAV(J,Q,q){this.setRegS32Extend(J,Number(this.getRegS64(Q)>>BigInt(this.getRegS32Lo(q)&31)&0xffff_ffffn))}execDSLLV(J,Q,q){this.setRegU64(J,this.getRegU64(Q)<<BigInt(this.getRegU32Lo(q)&63))}execDSRLV(J,Q,q){this.setRegU64(J,this.getRegU64(Q)>>BigInt(this.getRegU32Lo(q)&63))}execDSRAV(J,Q,q){this.setRegU64(J,this.getRegS64(Q)>>BigInt(this.getRegU32Lo(q)&63))}execDSLL(J,Q,q){this.setRegU64(J,this.getRegU64(Q)<<BigInt(q))}execDSRL(J,Q,q){this.setRegU64(J,this.getRegU64(Q)>>BigInt(q))}execDSRA(J,Q,q){this.setRegU64(J,this.getRegS64(Q)>>BigInt(q))}execDSLL32(J,Q,q){this.setRegU64(J,this.getRegU64(Q)<<BigInt(q+32))}execDSRL32(J,Q,q){this.setRegU64(J,this.getRegU64(Q)>>BigInt(q+32))}execDSRA32(J,Q,q){this.setRegU64(J,this.getRegS64(Q)>>BigInt(q+32))}execRESERVED(J){this.raiseRESERVEDException(J)}execSYSCALL(){this.raiseSYSCALLException()}execBREAK(){this.raiseBREAKException()}execSYNC(){}execMFHI(J){this.setRegU64(J,this.getMultHiU64())}execMFLO(J){this.setRegU64(J,this.getMultLoU64())}execMTHI(J){this.setMultHiU64(this.getRegU64(J))}execMTLO(J){this.setMultLoU64(this.getRegU64(J))}execMULT(J,Q){const q=BigInt(this.getRegS32Lo(Q))*BigInt(this.getRegS32Lo(J));this.setMultLoS32Extend(q&Z5),this.setMultHiS32Extend(q>>32n)}execDMULT(J,Q){const q=this.getRegS64(Q)*this.getRegS64(J);this.setMultLoS64(q&e0),this.setMultHiS64(q>>64n)}execMULTU(J,Q){const q=BigInt(this.getRegU32Lo(Q))*BigInt(this.getRegU32Lo(J));this.setMultLoS32Extend(q&Z5),this.setMultHiS32Extend(q>>32n)}execDMULTU(J,Q){const q=this.getRegU64(Q)*this.getRegU64(J);this.setMultLoU64(q&e0),this.setMultHiU64(q>>64n)}execDIV(J,Q){const q=this.getRegS32Lo(Q),Y=this.getRegS32Lo(J);let Z,K;if(Y)Z=q/Y>>0,K=q%Y;else Z=q<0?1:-1,K=q;this.setMultLoS32Extend(BigInt(Z)),this.setMultHiS32Extend(BigInt(K))}execDDIV(J,Q){const q=this.getRegS64(J),Y=this.getRegS64(Q);let Z,K;if(q)Z=Y/q,K=Y%q;else Z=Y<0?1n:-1n,K=Y;this.setMultLoS64(Z),this.setMultHiS64(K)}execDIVU(J,Q){const q=this.getRegU32Lo(Q),Y=this.getRegU32Lo(J);let Z,K;if(Y)Z=q/Y>>0,K=q%Y;else Z=-1,K=q;this.setMultLoS32Extend(BigInt(Z)),this.setMultHiS32Extend(BigInt(K))}execDDIVU(J,Q){const q=this.getRegU64(J),Y=this.getRegU64(Q);let Z,K;if(q)Z=Y/q,K=Y%q;else Z=-1n,K=Y;this.setMultLoU64(Z),this.setMultHiU64(K)}execADD(J,Q,q){const Y=this.getRegS32Lo(q),Z=this.getRegS32Lo(Q),K=Y+Z;if(RY(Y,Z,K)){this.raiseOverflowException();return}this.setRegS32Extend(J,K)}execDADD(J,Q,q){const Y=this.getRegS64(q),Z=this.getRegS64(Q),K=Y+Z;if(bY(Y,Z,K)){this.raiseOverflowException();return}this.setRegU64(J,K)}execADDU(J,Q,q){const Y=this.getRegS32Lo(q),Z=this.getRegS32Lo(Q),K=Y+Z;this.setRegS32Extend(J,K)}execDADDU(J,Q,q){const Y=this.getRegS64(q),Z=this.getRegS64(Q),K=Y+Z;this.setRegU64(J,K)}execSUB(J,Q,q){const Y=this.getRegS32Lo(q),Z=this.getRegS32Lo(Q),K=Y-Z;if(F5(Y,Z,K)){this.raiseOverflowException();return}this.setRegS32Extend(J,K)}execDSUB(J,Q,q){const Y=this.getRegS64(q),Z=this.getRegS64(Q),K=Y-Z;if(j5(Y,Z,K)){this.raiseOverflowException();return}this.setRegU64(J,K)}execSUBU(J,Q,q){const Y=this.getRegS32Lo(q),Z=this.getRegS32Lo(Q),K=Y-Z;this.setRegS32Extend(J,K)}execDSUBU(J,Q,q){const Y=this.getRegS64(q),Z=this.getRegS64(Q),K=Y-Z;this.setRegU64(J,K)}execAND(J,Q,q){this.setRegU64(J,this.getRegU64(q)&this.getRegU64(Q))}execOR(J,Q,q){this.setRegU64(J,this.getRegU64(q)|this.getRegU64(Q))}execXOR(J,Q,q){this.setRegU64(J,this.getRegU64(q)^this.getRegU64(Q))}execNOR(J,Q,q){this.setRegU64(J,~(this.getRegU64(q)|this.getRegU64(Q)))}execCLEAR(J){this.setRegU64(J,0n)}execMOV(J,Q){this.setRegU64(J,this.getRegU64(Q))}execSLT(J,Q,q){const Y=this.getRegS64(q)<this.getRegS64(Q)?1:0;this.setRegU32Extend(J,Y)}execSLTU(J,Q,q){const Y=this.getRegU64(q)<this.getRegU64(Q)?1:0;this.setRegU32Extend(J,Y)}execADDI(J,Q,q){const Y=this.getRegS32Lo(Q),Z=Y+q;if(RY(Y,q,Z)){this.raiseOverflowException();return}this.setRegS32Extend(J,Z)}execDADDI(J,Q,q){const Y=this.getRegS64(Q),Z=BigInt(q),K=Y+Z;if(bY(Y,Z,K)){this.raiseOverflowException();return}this.setRegU64(J,K)}execADDIU(J,Q,q){this.setRegS32Extend(J,this.getRegS32Lo(Q)+q)}execDADDIU(J,Q,q){this.setRegU64(J,this.getRegS64(Q)+BigInt(q))}execSLTI(J,Q,q){this.setRegU32Extend(J,this.getRegS64(Q)<BigInt(q)?1:0)}execSLTIU(J,Q,q){const Y=BigInt.asUintN(64,BigInt(q));this.setRegU32Extend(J,this.getRegU64(Q)<Y?1:0)}execANDI(J,Q,q){this.setRegU64(J,this.getRegU64(Q)&BigInt(q))}execORI(J,Q,q){this.setRegU64(J,this.getRegU64(Q)|BigInt(q))}execXORI(J,Q,q){this.setRegU64(J,this.getRegU64(Q)^BigInt(q))}execLUI(J,Q){this.setRegS32Extend(J,Q<<16)}addrS32(J,Q){return this.getRegS32Lo(J)+Q>>0}addrU32(J,Q){return this.getRegS32Lo(J)+Q>>>0}calcDebuggerAddress(J){return this.addrS32(v(J),b(J))}execLB(J,Q,q){const Y=FY(this.addrS32(Q,q));this.setRegS32Extend(J,Y)}execLBU(J,Q,q){const Y=HY(this.addrS32(Q,q));this.setRegU32Extend(J,Y)}execLH(J,Q,q){const Y=NY(this.addrS32(Q,q));this.setRegS32Extend(J,Y)}execLHU(J,Q,q){const Y=jY(this.addrS32(Q,q));this.setRegU32Extend(J,Y)}execLW(J,Q,q){const Y=PJ(this.addrS32(Q,q));if(J==0){console.log("LW to register 0");return}this.setRegS32Extend(J,Y)}execLWU(J,Q,q){const Y=LJ(this.addrS32(Q,q));this.setRegU32Extend(J,Y)}execLD(J,Q,q){const Y=t6(this.addrS32(Q,q));this.setRegU64(J,Y)}execLWL(J,Q,q){const Y=this.addrU32(Q,q),Z=LJ((Y&~3)>>>0),K=8*(Y&3);this.setRegS32ExtendMasked(J,Z<<K,DQ<<K)}execLWR(J,Q,q){const Y=this.addrU32(Q,q),Z=LJ((Y&~3)>>>0),K=8*(3-(Y&3));this.setRegS32ExtendMasked(J,Z>>>K,DQ>>>K)}execLDL(J,Q,q){const Y=this.addrU32(Q,q),Z=BigInt(8*(Y&7)),K=t6((Y&~7)>>>0);this.setRegU64Masked(J,K<<Z&e0,e0<<Z&e0)}execLDR(J,Q,q){const Y=this.addrU32(Q,q),Z=BigInt(8*(7-(Y&7))),K=t6((Y&~7)>>>0);this.setRegU64Masked(J,K>>Z,e0>>Z)}execLWC1(J,Q,q){if(!this.checkCopXUsable(1))return;c.store32(c.copRegIdx32(J),PJ(this.addrS32(Q,q)))}execLWC2(J,Q,q){if(!this.checkCopXUsable(2))return;this.unimplemented(this.pc,"LWC2")}execLWC3(J,Q,q){if(!this.checkCopXUsable(3))return;this.unimplemented(this.pc,"LWC3")}execLDC1(J,Q,q){if(!this.checkCopXUsable(1))return;const Y=t6(this.addrS32(Q,q));c.store64(c.copRegIdx64(J),Y)}execLDC2(J,Q,q){if(!this.checkCopXUsable(2))return;this.unimplemented(this.pc,"LDC2")}execSB(J,Q,q){GY(this.addrS32(Q,q),this.getRegS32Lo(J))}execSH(J,Q,q){LY(this.addrS32(Q,q),this.getRegS32Lo(J))}execSW(J,Q,q){VJ(this.addrS32(Q,q),this.getRegS32Lo(J))}execSD(J,Q,q){UJ(this.addrS32(Q,q),this.getRegU64(J))}execSWL(J,Q,q){const Y=this.addrU32(Q,q),Z=8*(Y&3),K=this.getRegU32Lo(J);$Q(Y,K>>>Z,DQ>>>Z)}execSWR(J,Q,q){const Y=this.addrU32(Q,q),Z=8*(3-(Y&3)),K=this.getRegU32Lo(J);$Q(Y,K<<Z,DQ<<Z)}execSDL(J,Q,q){const Y=this.addrU32(Q,q),Z=BigInt(8*(Y&7)),K=this.getRegU64(J);zQ(Y,K>>Z,e0>>Z)}execSDR(J,Q,q){const Y=this.addrU32(Q,q),Z=this.getRegU64(J),K=BigInt(8*(7-(Y&7)));zQ(Y,Z<<K&e0,e0<<K&e0)}execSWC1(J,Q,q){if(!this.checkCopXUsable(1))return;VJ(this.addrS32(Q,q),c.loadU32(c.copRegIdx32(J)))}execSWC2(J,Q,q){if(!this.checkCopXUsable(2))return;this.unimplemented(this.pc,"SWC2")}execSWC3(J,Q,q){if(!this.checkCopXUsable(3))return;this.unimplemented(this.pc,"SWC3")}execSDC1(J,Q,q){if(!this.checkCopXUsable(1))return;UJ(this.addrS32(Q,q),c.loadU64(c.copRegIdx64(J)))}execSDC2(J,Q,q){if(!this.checkCopXUsable(2))return;this.unimplemented(this.pc,"SDC2")}execLL(J,Q,q){const Y=this.addrS32(Q,q);this.setControlU32(_J,X5(Y)),this.setRegS32Extend(J,PJ(Y)),this.llBit=1}execLLD(J,Q,q){const Y=this.addrS32(Q,q);this.setControlU32(_J,X5(Y)),this.setRegU64(J,t6(Y)),this.llBit=1}execSC(J,Q,q){let Y=0;if(this.llBit)VJ(this.addrS32(Q,q),this.getRegS32Lo(J)),this.llBit=0,Y=1;this.setRegU32Extend(J,Y)}execSCD(J,Q,q){let Y=0;if(this.llBit)UJ(this.addrS32(Q,q),this.getRegU64(J)),this.llBit=0,Y=1;this.setRegU32Extend(J,Y)}execCACHE(J,Q,q){if(!this.ignoreCacheOp(J))M5.invalidateEntry(this.addrU32(Q,q))}ignoreCacheOp(J){const Q=J&3,q=J>>>2&7;return Q!==0||q!==0&&q!==4}execTGE(J,Q){this.maybeRaiseTRAPException(this.getRegS64(Q)>=this.getRegS64(J))}execTGEU(J,Q){this.maybeRaiseTRAPException(this.getRegU64(Q)>=this.getRegU64(J))}execTLT(J,Q){this.maybeRaiseTRAPException(this.getRegS64(Q)<this.getRegS64(J))}execTLTU(J,Q){this.maybeRaiseTRAPException(this.getRegU64(Q)<this.getRegU64(J))}execTEQ(J,Q){this.maybeRaiseTRAPException(this.getRegS64(Q)==this.getRegS64(J))}execTNE(J,Q){this.maybeRaiseTRAPException(this.getRegS64(Q)!=this.getRegS64(J))}execTGEI(J,Q){this.maybeRaiseTRAPException(this.getRegS64(J)>=BigInt(Q))}execTGEIU(J,Q){this.maybeRaiseTRAPException(this.getRegU64(J)>=BigInt.asUintN(64,BigInt(Q)))}execTLTI(J,Q){this.maybeRaiseTRAPException(this.getRegS64(J)<BigInt(Q))}execTLTIU(J,Q){this.maybeRaiseTRAPException(this.getRegU64(J)<BigInt.asUintN(64,BigInt(Q)))}execTEQI(J,Q){this.maybeRaiseTRAPException(this.getRegS64(J)==BigInt(Q))}execTNEI(J,Q){this.maybeRaiseTRAPException(this.getRegS64(J)!=BigInt(Q))}execJ(J){this.jump(J)}execJR(J){this.jump(this.getRegU32Lo(J))}execJAL(J){this.setRegS32Extend(Q6,this.nextPC+4),this.jump(J)}execJALR(J,Q){const q=this.getRegU32Lo(Q);this.setRegS32Extend(J,this.nextPC+4),this.jump(q)}execBEQ(J,Q,q){const Y=this.getRegU64(Q)===this.getRegU64(J);if(this.conditionalBranch(Y,q),I8&&Y&&q===-1)this.speedHack()}execBNE(J,Q,q){this.conditionalBranch(this.getRegU64(Q)!==this.getRegU64(J),q)}execBEQL(J,Q,q){this.conditionalBranchLikely(this.getRegU64(Q)===this.getRegU64(J),q)}execBNEL(J,Q,q){this.conditionalBranchLikely(this.getRegU64(Q)!==this.getRegU64(J),q)}execBGEZ(J,Q){this.conditionalBranch(this.getRegS64(J)>=0n,Q)}execBGTZ(J,Q){this.conditionalBranch(this.getRegS64(J)>0n,Q)}execBLEZ(J,Q){this.conditionalBranch(this.getRegS64(J)<=0n,Q)}execBLTZ(J,Q){this.conditionalBranch(this.getRegS64(J)<0n,Q)}execBGEZL(J,Q){this.conditionalBranchLikely(this.getRegS64(J)>=0n,Q)}execBGTZL(J,Q){this.conditionalBranchLikely(this.getRegS64(J)>0n,Q)}execBLEZL(J,Q){this.conditionalBranchLikely(this.getRegS64(J)<=0n,Q)}execBLTZL(J,Q){this.conditionalBranchLikely(this.getRegS64(J)<0n,Q)}execBLTZAL(J,Q){const q=this.getRegS64(J)<0n;this.setRegS32Extend(Q6,this.nextPC+4),this.conditionalBranch(q,Q)}execBGEZAL(J,Q){const q=this.getRegS64(J)>=0n;this.setRegS32Extend(Q6,this.nextPC+4),this.conditionalBranch(q,Q)}execBLTZALL(J,Q){const q=this.getRegS64(J)<0n;this.setRegS32Extend(Q6,this.nextPC+4),this.conditionalBranchLikely(q,Q)}execBGEZALL(J,Q){const q=this.getRegS64(J)>=0n;this.setRegS32Extend(Q6,this.nextPC+4),this.conditionalBranchLikely(q,Q)}execMFC0(J,Q){this.setRegS32Extend(J,Number(this.moveFromControl(Q)&0xffff_ffffn))}execDMFC0(J,Q){this.setRegU64(J,this.moveFromControl(Q))}execMTC0(J,Q){this.moveToControl(Q,BigInt(this.getRegS32Lo(J)))}execDMTC0(J,Q){this.moveToControl(Q,this.getRegU64(J))}execTLB(J){switch(J){case 1:this.tlbRead();return;case 2:this.tlbWriteIndex();return;case 6:this.tlbWriteRandom();return;case 8:this.tlbProbe();return;case 24:this.execERET();return}n64js.warn(`CPU: unknown TLB op, pc: ${j(this.pc)}, op: ${j(J)}`)}execERET(){if(this.getControlU32(U0)&EJ)this.nextPC=this.getControlU32(t8),this.clearControlBits32(U0,EJ),M(`ERET from error trap - ${j(this.nextPC)}`);else this.nextPC=this.getControlU32(N6),this.clearControlBits32(U0,OJ);this.llBit=0}execMFC1(J,Q){this.setRegS32Extend(J,c.loadS32(c.copRegIdx32(Q)))}execDMFC1(J,Q){this.setRegU64(J,c.loadU64(c.copRegIdx64(Q)))}execMTC1(J,Q){c.store32(c.copRegIdx32(Q),this.getRegS32Lo(J))}execDMTC1(J,Q){c.store64(c.copRegIdx64(Q),this.getRegS64(J))}execCFC1(J,Q){switch(Q){case 0:case 31:this.setRegS32Extend(J,c.control[Q]);break}}execCTC1(J,Q){if(Q===31)c.setStatus(this.getRegU32Lo(J))}execDCFC1(J,Q){c.DCFC1(J,Q)}execDCTC1(J,Q){c.DCTC1(Q,J)}execMFC2(J){if(!this.checkCopXUsable(2))return;this.setRegS32Extend(J,Q8.getReg32())}execDMFC2(J){if(!this.checkCopXUsable(2))return;this.setRegU64(J,Q8.getReg64())}execCFC2(J){if(!this.checkCopXUsable(2))return;this.setRegS32Extend(J,Q8.getReg32())}execDCFC2(J){if(!this.checkCopXUsable(2))return;this.raiseRESERVEDException(2)}execMTC2(J){if(!this.checkCopXUsable(2))return;Q8.setReg64(this.getRegU64(J))}execDMTC2(J){if(!this.checkCopXUsable(2))return;Q8.setReg64(this.getRegU64(J))}execCTC2(J){if(!this.checkCopXUsable(2))return;Q8.setReg64(this.getRegU64(J))}execDCTC2(J){if(!this.checkCopXUsable(2))return;this.raiseRESERVEDException(2)}unimplemented(J,Q){n64js.warn(`${J}: ${Q} is unimplemented`)}}class L5{constructor(){const J=new ArrayBuffer(8);this.regU32=new Uint32Array(J),this.regU64=new BigUint64Array(J)}setReg32(J){this.regU32[0]=J,this.regU32[1]=J>>31}setReg64(J){this.regU64[0]=J}getReg32(){return this.regU32[0]}getReg64(){return this.regU64[0]}}class A6{}var wV=kV([(J)=>V.execSLL(R(J),h(J),B0(J)),k,(J)=>V.execSRL(R(J),h(J),B0(J)),(J)=>V.execSRA(R(J),h(J),B0(J)),(J)=>V.execSLLV(R(J),h(J),y(J)),k,(J)=>V.execSRLV(R(J),h(J),y(J)),(J)=>V.execSRAV(R(J),h(J),y(J)),(J)=>V.execJR(y(J)),(J)=>V.execJALR(R(J),y(J)),k,k,(J)=>V.execSYSCALL(),(J)=>V.execBREAK(),k,(J)=>V.execSYNC(),(J)=>V.execMFHI(R(J)),(J)=>V.execMTHI(y(J)),(J)=>V.execMFLO(R(J)),(J)=>V.execMTLO(y(J)),(J)=>V.execDSLLV(R(J),h(J),y(J)),k,(J)=>V.execDSRLV(R(J),h(J),y(J)),(J)=>V.execDSRAV(R(J),h(J),y(J)),(J)=>V.execMULT(h(J),y(J)),(J)=>V.execMULTU(h(J),y(J)),(J)=>V.execDIV(h(J),y(J)),(J)=>V.execDIVU(h(J),y(J)),(J)=>V.execDMULT(h(J),y(J)),(J)=>V.execDMULTU(h(J),y(J)),(J)=>V.execDDIV(h(J),y(J)),(J)=>V.execDDIVU(h(J),y(J)),(J)=>V.execADD(R(J),h(J),y(J)),(J)=>V.execADDU(R(J),h(J),y(J)),(J)=>V.execSUB(R(J),h(J),y(J)),(J)=>V.execSUBU(R(J),h(J),y(J)),(J)=>V.execAND(R(J),h(J),y(J)),(J)=>V.execOR(R(J),h(J),y(J)),(J)=>V.execXOR(R(J),h(J),y(J)),(J)=>V.execNOR(R(J),h(J),y(J)),k,k,(J)=>V.execSLT(R(J),h(J),y(J)),(J)=>V.execSLTU(R(J),h(J),y(J)),(J)=>V.execDADD(R(J),h(J),y(J)),(J)=>V.execDADDU(R(J),h(J),y(J)),(J)=>V.execDSUB(R(J),h(J),y(J)),(J)=>V.execDSUBU(R(J),h(J),y(J)),(J)=>V.execTGE(h(J),y(J)),(J)=>V.execTGEU(h(J),y(J)),(J)=>V.execTLT(h(J),y(J)),(J)=>V.execTLTU(h(J),y(J)),(J)=>V.execTEQ(h(J),y(J)),k,(J)=>V.execTNE(h(J),y(J)),k,(J)=>V.execDSLL(R(J),h(J),B0(J)),k,(J)=>V.execDSRL(R(J),h(J),B0(J)),(J)=>V.execDSRA(R(J),h(J),B0(J)),(J)=>V.execDSLL32(R(J),h(J),B0(J)),k,(J)=>V.execDSRL32(R(J),h(J),B0(J)),(J)=>V.execDSRA32(R(J),h(J),B0(J))]);n64js.executeUnknown=k;var yV=SY([(J)=>V.execMFC0(h(J),J0(J)),(J)=>V.execDMFC0(h(J),J0(J)),k,k,(J)=>V.execMTC0(h(J),J0(J)),(J)=>V.execDMTC0(h(J),J0(J)),k,k,k,k,k,k,k,k,k,k,(J)=>V.execTLB(H8(J)),k,k,k,k,k,k,k,k,k,k,k,k,k,k,k]),IV=SY([(J)=>V.execMFC1(h(J),J0(J)),(J)=>V.execDMFC1(h(J),J0(J)),(J)=>V.execCFC1(h(J),J0(J)),(J)=>V.execDCFC1(h(J),J0(J)),(J)=>V.execMTC1(h(J),J0(J)),(J)=>V.execDMTC1(h(J),J0(J)),(J)=>V.execCTC1(h(J),J0(J)),(J)=>V.execDCTC1(h(J),J0(J)),AV,k,k,k,k,k,k,k,(J)=>c.execSInstr(u0(J),G6(J),J0(J),Y6(J)),(J)=>c.execDInstr(u0(J),G6(J),J0(J),Y6(J)),k,k,(J)=>c.execWInstr(u0(J),G6(J),J0(J),Y6(J)),(J)=>c.execLInstr(u0(J),G6(J),J0(J),Y6(J)),k,k,k,k,k,k,k,k,k,k]),RV=SY([(J)=>V.execMFC2(h(J)),(J)=>V.execDMFC2(h(J)),(J)=>V.execCFC2(h(J)),(J)=>V.execDCFC2(h(J)),(J)=>V.execMTC2(h(J)),(J)=>V.execDMTC2(h(J)),(J)=>V.execCTC2(h(J)),(J)=>V.execDCTC2(h(J)),k,k,k,k,k,k,k,k,k,k,k,k,k,k,k,k,k,k,k,k,k,k,k,k]);n64js.executeCop1_disabled=vY;n64js.cop1ControlChanged=fY;var SV=_V([(J)=>V.execBLTZ(y(J),Q0(J)),(J)=>V.execBGEZ(y(J),Q0(J)),(J)=>V.execBLTZL(y(J),Q0(J)),(J)=>V.execBGEZL(y(J),Q0(J)),k,k,k,k,(J)=>V.execTGEI(y(J),b(J)),(J)=>V.execTGEIU(y(J),b(J)),(J)=>V.execTLTI(y(J),b(J)),(J)=>V.execTLTIU(y(J),b(J)),(J)=>V.execTEQI(y(J),b(J)),k,(J)=>V.execTNEI(y(J),b(J)),k,(J)=>V.execBLTZAL(y(J),Q0(J)),(J)=>V.execBGEZAL(y(J),Q0(J)),(J)=>V.execBLTZALL(y(J),Q0(J)),(J)=>V.execBGEZALL(y(J),Q0(J)),k,k,k,k,k,k,k,k,k,k,k,k]),V5=fV([CV,vV,(J)=>V.execJ(I6(V.pc,J)),(J)=>V.execJAL(I6(V.pc,J)),(J)=>V.execBEQ(h(J),y(J),Q0(J)),(J)=>V.execBNE(h(J),y(J),Q0(J)),(J)=>V.execBLEZ(y(J),Q0(J)),(J)=>V.execBGTZ(y(J),Q0(J)),(J)=>V.execADDI(h(J),y(J),b(J)),(J)=>V.execADDIU(h(J),y(J),b(J)),(J)=>V.execSLTI(h(J),y(J),b(J)),(J)=>V.execSLTIU(h(J),y(J),b(J)),(J)=>V.execANDI(h(J),y(J),L6(J)),(J)=>V.execORI(h(J),y(J),L6(J)),(J)=>V.execXORI(h(J),y(J),L6(J)),(J)=>V.execLUI(h(J),L6(J)),DV,vY,bV,TV,(J)=>V.execBEQL(h(J),y(J),Q0(J)),(J)=>V.execBNEL(h(J),y(J),Q0(J)),(J)=>V.execBLEZL(y(J),Q0(J)),(J)=>V.execBGTZL(y(J),Q0(J)),(J)=>V.execDADDI(h(J),y(J),b(J)),(J)=>V.execDADDIU(h(J),y(J),b(J)),(J)=>V.execLDL(h(J),v(J),b(J)),(J)=>V.execLDR(h(J),v(J),b(J)),(J)=>V.execBreakpoint(),k,k,(J)=>V.execRESERVED(0),(J)=>V.execLB(h(J),v(J),b(J)),(J)=>V.execLH(h(J),v(J),b(J)),(J)=>V.execLWL(h(J),v(J),b(J)),(J)=>V.execLW(h(J),v(J),b(J)),(J)=>V.execLBU(h(J),v(J),b(J)),(J)=>V.execLHU(h(J),v(J),b(J)),(J)=>V.execLWR(h(J),v(J),b(J)),(J)=>V.execLWU(h(J),v(J),b(J)),(J)=>V.execSB(h(J),v(J),b(J)),(J)=>V.execSH(h(J),v(J),b(J)),(J)=>V.execSWL(h(J),v(J),b(J)),(J)=>V.execSW(h(J),v(J),b(J)),(J)=>V.execSDL(h(J),v(J),b(J)),(J)=>V.execSDR(h(J),v(J),b(J)),(J)=>V.execSWR(h(J),v(J),b(J)),(J)=>V.execCACHE(h(J),v(J),b(J)),(J)=>V.execLL(h(J),v(J),b(J)),(J)=>V.execLWC1(h(J),v(J),b(J)),(J)=>V.execLWC2(h(J),v(J),b(J)),(J)=>V.execLWC3(h(J),v(J),b(J)),(J)=>V.execLLD(h(J),v(J),b(J)),(J)=>V.execLDC1(h(J),v(J),b(J)),(J)=>V.execLDC2(h(J),v(J),b(J)),(J)=>V.execLD(h(J),v(J),b(J)),(J)=>V.execSC(h(J),v(J),b(J)),(J)=>V.execSWC1(h(J),v(J),b(J)),(J)=>V.execSWC2(h(J),v(J),b(J)),(J)=>V.execSWC3(h(J),v(J),b(J)),(J)=>V.execSCD(h(J),v(J),b(J)),(J)=>V.execSDC1(h(J),v(J),b(J)),(J)=>V.execSDC2(h(J),v(J),b(J)),(J)=>V.execSD(h(J),v(J),b(J))]);n64js.singleStep=function(){let J=0;if(n64js.isBreakpoint(V.pc))J=V.pc,n64js.toggleBreakpoint(J);if(V.run(1),J)n64js.toggleBreakpoint(J)};class U5{constructor(){this.kNumEntries=16384,this.entries=[];for(let J=0;J<this.kNumEntries;++J)this.entries.push(new Set)}addressToCacheLine(J){return Math.floor(J>>>5)}addressToCacheLineRoundUp(J){return Math.floor(J+31>>>5)}lookupEntry(J){const q=this.addressToCacheLine(J)%this.entries.length;return this.entries[q]}addInstructionToFragment(J,Q){J.updateMinMax(Q),this.lookupEntry(Q).add(J)}invalidateEntry(J){const Q=this.lookupEntry(J);let q=0;const Y=this.addressToCacheLine(J);for(let[Z,K]of Q.entries())if(this.addressToCacheLine(Z.minPC)<=Y&&this.addressToCacheLineRoundUp(Z.maxPC)>=Y)Z.invalidate(),Q.delete(Z),q++}}var M5=new U5,T8=new VY;n64js.checkSyncState=gV;n64js.executeOp=P5;class m{constructor(J,Q,q,Y,Z){this.name=J,this.hardware=Q,this.mem=q,this.u8=q?q.u8:null,this.rangeStart=Y,this.rangeEnd=Z,this.quiet=!0}setMem(J){this.mem=J,this.u8=J.u8}reset(){}calcEA(J){return J-this.rangeStart}calcInternalEA(J){return this.calcEA(J)}calcReadEA(J){return this.calcEA(J)}calcWriteEA(J){return this.calcEA(J)}readInternal32(J){const Q=this.calcInternalEA(J);if(Q+4<=this.u8.length)return this.mem.getU32(Q);return 3722304989}writeInternal32(J,Q){const q=this.calcInternalEA(J);if(q+4<=this.u8.length)this.mem.set32(q,Q)}logRead(J){}logWrite(J,Q,q){}readU64(J){const Q=this.calcReadEA(J);if(Q+8>this.u8.length)return 0;return this.mem.getU64(Q)}readU32(J){const Q=this.calcReadEA(J);if(Q+4>this.u8.length)return 0;return this.mem.getU32(Q)}readU16(J){const Q=this.calcReadEA(J);if(Q+2>this.u8.length)return 0;return this.mem.getU16(Q)}readU8(J){const Q=this.calcReadEA(J);if(Q+1>this.u8.length)return 0;return this.mem.getU8(Q)}readS32(J){const Q=this.calcReadEA(J);if(Q+4>this.u8.length)return 0;return this.mem.getS32(Q)}readS16(J){const Q=this.calcReadEA(J);if(Q+2>this.u8.length)return 0;return this.mem.getS16(Q)}readS8(J){const Q=this.calcReadEA(J);if(Q+1>this.u8.length)return 0;return this.mem.getS8(Q)}write64masked(J,Q,q){const Y=this.calcWriteEA(J)&~7;if(Y+8>this.u8.length)return;this.mem.set64masked(Y,Q,q)}write32masked(J,Q,q){const Y=this.calcWriteEA(J)&~3;if(Y+4>this.u8.length)return;this.mem.set32masked(Y,Q,q)}write64(J,Q){const q=this.calcWriteEA(J);if(q+8>this.u8.length)return;this.mem.set64(q,Q)}write32(J,Q){const q=this.calcWriteEA(J);if(q+4>this.u8.length)return;this.mem.set32(q,Q)}write16(J,Q){const q=this.calcWriteEA(J);if(q+2>this.u8.length)return;this.mem.set16(q,Q)}write8(J,Q){const q=this.calcWriteEA(J);if(q+1>this.u8.length)return;this.mem.set8(q,Q)}}var uY=0,h5=4,W0=8,kJ=12,oV=128,cV=256,lV=512,dV=1024,aV=2048,rV=4096,sV=8192,O5=128,E5=256,A5=512,iV=1,tV=2,eV=4,JU=8,QU=16,qU=32,YU=64,ZU=128,KU=256,XU=512,WU=1024,$U=2048;var _8=1,k6=2,wJ=4,CJ=8,yJ=16,RQ=32;class gY extends m{constructor(J,Q,q){super("MIReg",J,J.mi_reg,Q,q)}reset(){this.mem.set32(h5,33685762)}interruptsUnmasked(){return(this.mem.getU32(kJ)&this.mem.getU32(W0))!==0}intrReg(){return this.mem.getU32(W0)}intrMaskReg(){return this.mem.getU32(kJ)}setInterruptBit(J){this.mem.setBits32(W0,J),n64js.cpu0.updateCause3()}interruptSP(){this.setInterruptBit(_8)}interruptDP(){this.setInterruptBit(RQ)}write32(J,Q){const q=this.calcWriteEA(J);if(q+4>this.u8.length)throw"Write is out of range";switch(q){case uY:if(!this.quiet)M(`Wrote to MI mode register: ${j(Q)}`);this.writeModeReg(Q);break;case kJ:if(!this.quiet)M(`Wrote to MI interrupt mask register: ${j(Q)}`);this.writeIntrMaskReg(Q);break;case h5:case W0:break;default:M(`Unhandled write to MIReg: ${j(Q)} -> [${j(J)}]`),this.mem.set32(q,Q);break}}writeModeReg(J){let Q=this.mem.getU32(uY);if(J&sV)Q|=A5;if(J&rV)Q&=~A5;if(J&cV)Q|=O5;if(J&oV)Q&=~O5;if(J&dV)Q|=E5;if(J&lV)Q&=~E5;if(this.mem.set32(uY,Q),J&aV)this.mem.clearBits32(W0,RQ),n64js.cpu0.updateCause3()}writeIntrMaskReg(J){let Q=0,q=0;Q|=(J&iV)>>>0,Q|=(J&eV)>>>1,Q|=(J&QU)>>>2,Q|=(J&YU)>>>3,Q|=(J&KU)>>>4,Q|=(J&WU)>>>5,q|=(J&tV)>>>1,q|=(J&JU)>>>2,q|=(J&qU)>>>3,q|=(J&ZU)>>>4,q|=(J&XU)>>>5,q|=(J&$U)>>>6;let Y=this.mem.getU32(kJ);Y&=~Q,Y|=q,this.mem.set32(kJ,Y),n64js.cpu0.updateCause3()}}var k5=function(J,Q){return J&~(Q-1)},h0=function(J,Q){const q=document.querySelector(J);if(q)q.textContent=Q};window.n64js=window.n64js||{};class xY{constructor(){this.disasmAddress=0,this.lastPC=-1}setPC(J){if(J!==this.lastPC)this.disasmAddress=J,this.lastPC=J}scroll(J){this.disasmAddress+=J*4}}class w5 extends xY{disassembleRange(){return gK(this.disasmAddress-64,this.disasmAddress+64,!0)}updateStatusTable(){h0("#cpu0-status-opsexecuted",V.opsExecuted),h0("#cpu0-status-pc",j(V.pc)),h0("#cpu0-status-delaypc",j(V.delayPC)),h0("#cpu0-status-epc",j(V.getControlU32(N6))),h0("#cpu0-status-cause",j(Number(V.moveFromControl(w0)&0xffff_ffffn))),h0("#cpu0-status-count",j(Number(V.moveFromControl(m6)&0xffff_ffffn))),h0("#cpu0-status-compare",j(V.getControlU32(Z8))),h0("#cpu0-status-multhi",D6(V.getMultHiU64())),h0("#cpu0-status-multlo",D6(V.getMultLoU64())),this.updateStatusRegisterRow(),this.updateMipsInterruptsRow();let J=$("#cpu0-status-events").find("tbody");J.empty(),J.append("<tr><td>&nbsp;</td></tr>"),J.append("<tr><td>Events</td></tr>");const Q=V.eventQueue;let q=Q.cyclesToFirstEvent;for(let Y=Q.firstEvent;Y;Y=Y.next)J.append(`<tr><td>${Y.getName()}</td><td class="fixed">${q}</td></tr>`),q+=Y.cyclesToNextEvent}updateStatusRegisterRow(){const J=V.getControlU32(U0);h0("#cpu0-status-sr",j(J));const Q={"#cpu0-status-sr-ie":BQ,"#cpu0-status-sr-exl":OJ,"#cpu0-status-sr-erl":EJ};for(let[q,Y]of Object.entries(Q)){const Z=document.querySelector(q);if(!Z)continue;const K=(J&Y)!==0;Z.classList.toggle("cpu0-status-bit-set",K)}}updateMipsInterruptsRow(){const J=n64js.hardware().miRegDevice,Q=J.intrReg(),q=J.intrMaskReg(),Y={"#cpu0-status-mi-sp":_8,"#cpu0-status-mi-si":k6,"#cpu0-status-mi-ai":wJ,"#cpu0-status-mi-vi":CJ,"#cpu0-status-mi-pi":yJ,"#cpu0-status-mi-dp":RQ};for(let[Z,K]of Object.entries(Y)){const X=document.querySelector(Z);if(!X)continue;const W=(Q&K)!==0,z=(q&K)!==0;X.classList.toggle("cpu0-status-bit-enabled",z),X.classList.toggle("cpu0-status-bit-set",W)}}makeCop0RegistersTable(J){let Q=$('<table class="register-table"><tbody></tbody></table>'),q=Q.find("tbody");const Y=2;for(let Z=0;Z<32;Z+=Y){let K=$("<tr />");for(let X=0;X<Y;++X){let W=eQ[Z+X],z=$(`<td>${W}</td><td class="fixed">${D6(V.getRegU64(Z+X))}</td>`);if(J.has(W))z.attr("bgcolor",J.get(W));K.append(z)}q.append(K)}return Q}makeCop1RegistersTable(J){let Q=$('<table class="register-table"><tbody></tbody></table>'),q=Q.find("tbody");for(let Y=0;Y<32;++Y){let Z=Jq[Y],K;if((Y&1)===0)K=$(`<td>${Z}</td>
                 <td class="fixed fp-w">${j(c.regU32[Y])}</td>
                 <td class="fixed fp-s">${c.regF32[Y]}</td>
                 <td class="fixed fp-d">${c.regF64[Y/2]}</td>`);else K=$(`<td>${Z}</td>
                 <td class="fixed fp-w">${j(c.regU32[Y])}</td>
                 <td class="fixed fp-s">${c.regF32[Y]}</td>
                 <td></td>`);let X=$("<tr />");if(X.append(K),J.has(Z))X.attr("bgcolor",J.get(Z));else if(J.has(Z+"-w"))X.find(".fp-w").attr("bgcolor",J.get(Z+"-w"));else if(J.has(Z+"-s"))X.find(".fp-s").attr("bgcolor",J.get(Z+"-s"));else if(J.has(Z+"-d"))X.find(".fp-d").attr("bgcolor",J.get(Z+"-d"));q.append(X)}return Q}}class C5 extends xY{disassembleRange(){return gJ(H.imem,this.disasmAddress-64,this.disasmAddress+64,!0)}updateStatusTable(){h0("#rsp-status-halted",H.halted),h0("#rsp-status-pc",j(H.pc)),h0("#rsp-status-delaypc",j(H.delayPC)),h0("#rsp-status-nextpc",j(H.nextPC)),h0("#rsp-status-branchtarget",j(H.branchTarget)),h0("#rsp-status-vco",x(H.VCO)),h0("#rsp-status-vcc",x(H.VCC)),h0("#rsp-status-vce",M0(H.VCE))}makeScalarRegistersTable(J){let Q=$('<table class="register-table"><tbody></tbody></table>'),q=Q.find("tbody");const Y=2;for(let Z=0;Z<32;Z+=Y){let K=$("<tr />");for(let X=0;X<Y;++X){let W=qq[Z+X],z=$(`<td>${W}</td><td class="fixed">${j(H.getRegU32(Z+X))}</td>`);if(J.has(W))z.attr("bgcolor",J.get(W));K.append(z)}q.append(K)}return Q}makeVectorRegistersTable(J){let Q=$('<table class="register-table"><tbody></tbody></table>'),q=Q.find("tbody");for(let Y=0;Y<32;Y++){let Z=$("<tr />");const K=`V${Y}`;Z.append($(`<td>${K}</td>`));for(let X=0;X<8;++X){let W=$(`<td class="fixed">${B(H.getVecU16(Y,X),16)}</td>`);if(J.has(K))W.attr("bgcolor",J.get(K));Z.append(W)}q.append(Z)}return Q}makeTaskTable(){const q=n64js.hardware().sp_mem.subRegion(4032,64);let Y=$('<table class="register-table"><tbody></tbody></table>'),Z=Y.find("tbody");const K=["type","flags","ucode_boot","ucode_boot_size","ucode","ucode_size","ucode_data","ucode_data_size","dram_stack","dram_stack_size","output_buff","output_buff_size","data_ptr","data_size","yield_data_ptr","yield_data_size"];for(let X=0;X<16;X++){const W=$(`<tr><td>${K[X]}</td><td class="fixed">${B(q.getU32(X*4),32)}</td></tr>`);Z.append(W)}return Y}}class pY{constructor(){this.$cpuContent=$("#cpu-content"),this.cpuTabs=[$("#cpu0-content"),$("#cpu1-content")],this.$cpu0Disassembly=$("#cpu-disasm"),this.$rspContent=$("#rsp-content"),this.rspTabs=[$("#rsp-scalar-content"),$("#rsp-vector-content"),$("#rsp-task-content")],this.$rspDisassembly=$("#rsp-disasm"),this.$dynarecContent=$("#dynarec-content"),this.$memoryContent=$("#memory-content"),this.cpu0State=new w5,this.rspState=new C5,this.lastOpExecuted=0,this.recentMemoryAccesses=[],this.lastMemoryAccessAddress=0,this.lastStore=null,this.labelMap=new Map,this.debugCycles=Math.pow(10,0),XK($(".output"),()=>{return j(V.pc)}),n64js.addResetCallback(this.onReset.bind(this)),$("#output").find("#clear").click(function(){WK()});const J=this;$("#cpu-speed").change(function(){J.debugCycles=Math.pow(10,$(this).val()|0),M("Speed is now "+J.debugCycles)}),$("#cpu").find("#address").change(function(){J.disasmAddress=parseInt($(this).val(),16),J.updateCPU()}),this.refreshLabelSelect(),this.$memoryContent.find("input").change(function(){J.lastMemoryAccessAddress=parseInt($(this).val(),16),J.updateMemoryView()}),this.updateMemoryView(),$("body").keydown(function(Q){let q=!1;switch(Q.key){case"ArrowDown":q=!0,J.disassemblerDown();break;case"ArrowUp":q=!0,J.disassemblerUp();break;case"PageDown":q=!0,J.disassemblerPageDown();break;case"PageUp":q=!0,J.disassemblerPageUp();break;case"F8":q=!0,n64js.toggleRun();break;case"F9":q=!0,hW();break;case"F10":q=!0,n64js.step();break}if(q)Q.preventDefault()}),document.querySelector("#cpu-tab").addEventListener("click",()=>{this.updateCPU()}),document.querySelector("#rsp-tab").addEventListener("click",()=>{this.updateRSP()}),document.querySelector("#memory-tab").addEventListener("click",()=>{this.updateMemoryView()}),document.querySelector("#dynarec-tab").addEventListener("click",()=>{this.updateDynarec()})}updateMemoryView(){const J=this.lastMemoryAccessAddress||2147483648;this.$memoryContent.find("pre").empty().append(this.makeMemoryAccessRow(J,1024))}refreshLabelSelect(){const J=$("#cpu").find("#labels"),Q=Array.from(this.labelMap.keys()),q=this;Q.sort((Y,Z)=>{const K=q.labelMap.get(Y),X=q.labelMap.get(Z);return K.localeCompare(X)}),J.html("");for(let Y of Q){const Z=this.labelMap.get(Y),K=$(`<option value="${Z}">${Z}</option>`);K.data("address",Y),J.append(K)}J.change(()=>{let Y=J.find("option:selected").data("address");q.cpu0State.disasmAddress=Y>>>0,q.updateCPU()})}onReset(){this.restoreLabelMap(),this.updateCPU(),this.updateRSP()}restoreLabelMap(){this.labelMap=n64js.getLocalStorageItem("debugLabelMap")||new Map,this.refreshLabelSelect()}storeLabelMap(){n64js.setLocalStorageItem("debugLabelMap",this.labelMap)}makeMemoryAccessRow(J,Q,q=64,Y=null){let Z=k5(J,q)-k5(Q/2,q),K=Z+Q,X="";for(let W=Z;W<K;W+=q){let z=B(W,32)+":";for(let F=0;F<q;F+=4){let N=W+F>>>0,G=n64js.hardware().memMap.readMemoryInternal32(N),P="";if(Y&&Y.has(N))P=` style="background-color: ${Y.get(N)}"`;z+=` <span id="mem-${B(N,32)}"${P}>${B(G,32)}</span>`}z+="\n",X+=z}return $(`<span>${X}</span>`)}makeRecentMemoryAccessRow(J,Q){let q=Q==="store"?"#faa":"#ffa";if(Q==="update")q="#afa";let Y=new Map,Z=(J&~3)>>>0;return Y.set(Z,q),this.makeMemoryAccessRow(J,32,32,Y)}makeLabelColor(J){let Q=J>>>2,q=Q>>>16^(Q&65535)*2803,Y=q&31,Z=q>>>5&31,K=q>>>10&31,X=q>>>15&3;switch(Y*=4,Z*=4,K*=4,X){case 0:Y*=2,Z*=2;break;case 1:Z*=2,K*=2;break;case 2:K*=2,Y*=2;break;default:Y*=2,Z*=2,K*=2;break}return"#"+B(Y,8)+B(Z,8)+B(K,8)}setLabelText(J,Q){if(this.labelMap.has(Q))J.append(` (${this.labelMap.get(Q)})`)}setLabelColor(J,Q){J.css("color",this.makeLabelColor(Q))}makeLabelText(J){let Q=this.labelMap.get(J)||"";while(Q.length<20)Q+=" ";return Q}onLabelClicked(J){let Q=$(J.delegateTarget),q=Q.data("address")>>>0,Y=this.labelMap.get(q)||"",Z=$(`<input class="input-mini" value="${Y}" />`);const K=this;Z.keypress((X)=>{if(X.which==13){const W=Z.val();if(W)K.labelMap.set(q,W.toString());else K.labelMap.delete(q);K.storeLabelMap(),K.refreshLabelSelect(),this.updateCPU()}}),Z.blur(()=>{Q.html(K.makeLabelText(q))}),Q.empty().append(Z),Z.focus()}onFragmentClicked(J){let q=$(J.delegateTarget).data("fragment");M(`<pre>${q.func.toString()}</pre>`)}onClickBreakpoint(J){let q=$(J.delegateTarget).data("address")>>>0;n64js.toggleBreakpoint(q),this.updateCPU()}updateCPU(){this.cpu0State.setPC(V.pc);let J=V.getOpsExecuted(),Q=this.lastOpExecuted===J-1;this.lastOpExecuted=J;let q=$q(),Y=this.cpu0State.disassembleRange(),Z=$("<pre/>"),K=$("<pre/>"),X;for(let z=0;z<Y.length;++z){let F=Y[z],N=F.instruction.address,G=F.isJumpTarget||this.labelMap.has(N),P=(G?'<span class="dis-address-target">':'<span class="dis-address">')+B(N,32)+":</span>",L=`<span class="dis-label">${this.makeLabelText(N)}</span>`,U=`${P}  ${B(F.instruction.opcode,32)}  ${L}${F.disassembly}`,E=q.get(N);if(E){const u=`<span class="dis-fragment-link"> frag - ops=${E.opsCompiled} hit=${E.executionCount}</span>`;U+=u}let A=$(`<span class="dis-line">${U}</span>`);if(A.find(".dis-label").data("address",N).css("color",this.makeLabelColor(N)).click(this.onLabelClicked.bind(this)),E)A.find(".dis-fragment-link").data("fragment",E).click(this.onFragmentClicked.bind(this));if(N===V.pc)X=F.instruction,A.addClass("dis-line-cur");if(G)A.addClass("dis-line-target"),this.setLabelColor(A.find(".dis-address-target"),N);K.append(A),K.append("<br>");let C="&nbsp;";if(n64js.isBreakpoint(N))C="&bull;";let D=$(`<span>${C}</span>`).data("address",N).click(this.onClickBreakpoint.bind(this));Z.append(D),Z.append("<br>")}K.find(".dis-address-jump").each(function(){let z=parseInt($(this).text(),16);this.setLabelText($(this),z),this.setLabelColor($(this),z),$(this).click(function(){this.cpu0state.disasmAddress=z,this.redraw()})}.bind(this));let W=this.makeRegisterColours(X);for(let[z,F]of W)K.find(".dis-reg-"+z).css("background-color",F);this.$cpu0Disassembly.find(".dis-recent-memory").html(this.makeRecentMemoryAccesses(Q,X,V.calcDebuggerAddress.bind(V))),this.$cpu0Disassembly.find(".dis-gutter").empty().append(Z),this.$cpu0Disassembly.find(".dis-view").empty().append(K),this.cpu0State.updateStatusTable(),this.cpuTabs[0].empty().append(this.cpu0State.makeCop0RegistersTable(W)),this.cpuTabs[1].empty().append(this.cpu0State.makeCop1RegistersTable(W))}updateRSP(){this.rspState.setPC(H.pc);const J=!0;let Q=this.rspState.disassembleRange(),q=$("<pre/>"),Y=$("<pre/>");for(let W=0;W<Q.length;++W){let z=Q[W],F=z.instruction.address,N=z.isJumpTarget||this.labelMap.has(F),G=(N?'<span class="dis-address-target">':'<span class="dis-address">')+B(F,32)+":</span>",P=`<span class="dis-label">${this.makeLabelText(F)}</span>`,L=`${G}  ${B(z.instruction.opcode,32)}  ${P}${z.disassembly}`,U=$(`<span class="dis-line">${L}</span>`);if(U.find(".dis-label").data("address",F).css("color",this.makeLabelColor(F)).click(this.onLabelClicked.bind(this)),F===H.pc)U.addClass("dis-line-cur");if(N)U.addClass("dis-line-target"),this.setLabelColor(U.find(".dis-address-target"),F);Y.append(U),Y.append("<br>");let E="&nbsp;";if(n64js.isBreakpoint(F))E="&bull;";let A=$(`<span>${E}</span>`).data("address",F).click(this.onClickBreakpoint.bind(this));q.append(A),q.append("<br>")}Y.find(".dis-address-jump").each(function(){let W=parseInt($(this).text(),16);this.setLabelText($(this),W),this.setLabelColor($(this),W),$(this).click(function(){this.rspstate.disasmAddress=W,this.redraw()})}.bind(this));const K=KJ(H.pc,H.imem.getU32(H.pc)).instruction;let X=this.makeRegisterColours(K);for(let[W,z]of X)Y.find(".dis-reg-"+W).css("background-color",z);this.$rspDisassembly.find(".dis-recent-memory").html(this.makeRecentMemoryAccesses(J,K,H.calcDebuggerAddress.bind(H))),this.$rspDisassembly.find(".dis-gutter").empty().append(q),this.$rspDisassembly.find(".dis-view").empty().append(Y),this.rspState.updateStatusTable(),this.rspTabs[0].empty().append(this.rspState.makeScalarRegistersTable(X)),this.rspTabs[1].empty().append(this.rspState.makeVectorRegistersTable(X)),this.rspTabs[2].empty().append(this.rspState.makeTaskTable())}makeRegisterColours(J){const Q=["#fd7e14","#198754","#0d6efd"];let q=new Map;if(J){let Y=0;for(let Z in J.srcRegs)if(!Object.prototype.hasOwnProperty.call(q,Z))q.set(Z,Q[Y++]);for(let Z in J.dstRegs)if(!Object.prototype.hasOwnProperty.call(q,Z))q.set(Z,Q[Y++])}return q}makeRecentMemoryAccesses(J,Q,q){const Y=V.opsExecuted;if(J){if(this.lastStore){if(this.lastStore.cycle+1===Y){let X=this.makeRecentMemoryAccessRow(this.lastStore.address,"update");this.lastStore.element.append(X)}this.lastStore=null}const K=Q.memory;if(K){const X=q(Q.opcode);let W=this.makeRecentMemoryAccessRow(X,K.mode);if(K.mode==="store")this.lastStore={address:X,cycle:Y,element:W};if(this.recentMemoryAccesses.push({element:W}),this.recentMemoryAccesses.length>4)this.recentMemoryAccesses.splice(0,1);this.lastMemoryAccessAddress=X}}else this.recentMemoryAccesses=[],this.lastStore=null;let Z=$("<pre />");if(this.recentMemoryAccesses.length>0){const K=["#bbb","#999","#666","#333"];for(let X=0;X<this.recentMemoryAccesses.length;++X){let W=this.recentMemoryAccesses[X].element;W.css("color",K[X]),Z.append(W)}}return Z}updateDynarec(){let J=WX(),Q=new Map,q=0,Y=[];for(let[W,z]of $q()){let F=z.executionCount>0?Math.floor(Math.log10(z.executionCount)):0;Q.set(F,(Q.get(F)||0)+1),Y.push(z),q=Math.max(q,F)}Y.sort((W,z)=>{return z.opsCompiled*z.executionCount-W.opsCompiled*W.executionCount});let Z=$('<div class="container-fluid" />'),K="";K+='<div class="row">',K+='<table class="table table-condensed table-nonfluid"><tr><th>Execution Count</th><th>Frequency</th></tr>';for(let W=0;W<=q;W++){let z=Q.get(W)||0,F=`< ${Math.pow(10,W+1)}`;K+=`<tr><td>${F}</td><td>${z}</td></tr>`}K+="</table>",K+="</div>",Z.append(K),K="",K+='<div class="row">',K+='  <div class="col-lg-6" id="fragments" />',K+='  <div class="col-lg-6" id="fragment-code" />',K+="</div>";let X=$(K);if(this.createHotFragmentsTable(X,Y),Z.append(X),J.length>0){K="",K+='<div class="row">',K+='<div class="col-lg-6">',K+='<table class="table table-condensed">',K+="<tr><th>Address</th><th>Length</th><th>System</th><th>Fragments Removed</th></tr>";for(let W=0;W<J.length;++W){let z=[j(J[W].address),J[W].length,J[W].system,J[W].fragmentsRemoved];K+=`<tr><td>${z.join("</td><td>")}</td></tr>`}K+="</table>",K+="</div>",K+="</div>",Z.append(K)}this.$dynarecContent.empty().append(Z)}createHotFragmentsTable(J,Q){let q=J.find("#fragment-code"),Y=$('<table class="table table-condensed" />'),Z=["Address","Execution Count","Length","ExecCount * Length"];Y.append(`<tr><th>${Z.join("</th><th>")}</th></tr>`);for(let K=0;K<Q.length&&K<20;++K){let X=Q[K],W=[j(X.entryPC),X.executionCount,X.opsCompiled,X.executionCount*X.opsCompiled],z=$(`<tr><td>${W.join("</td><td>")}</td></tr>`);this.initFragmentRow(z,X,q),Y.append(z)}if(J.find("#fragments").append(Y),Q.length>0)q.append(`<pre>${Q[0].func.toString()}</pre>`)}initFragmentRow(J,Q,q){J.click(()=>{q.html(`<pre>${Q.func.toString()}</pre>`)})}disassemblerDown(){this.scrollActiveDisassemblyWindow(1),this.redraw()}disassemblerUp(){this.scrollActiveDisassemblyWindow(-1),this.redraw()}disassemblerPageDown(){this.scrollActiveDisassemblyWindow(16),this.redraw()}disassemblerPageUp(){this.scrollActiveDisassemblyWindow(-16),this.redraw()}scrollActiveDisassemblyWindow(J){const Q=this.activeDisassemblyWindow();if(Q)Q.scroll(J)}activeDisassemblyWindow(){if(this.$cpuContent.hasClass("active"))return this.cpu0State;if(this.$rspContent.hasClass("active"))return this.rspState;return null}redraw(){if(!n64js.debuggerVisible())return;if(this.$cpuContent.hasClass("active"))this.updateCPU();if(this.$rspContent.hasClass("active"))this.updateRSP();if(this.$memoryContent.hasClass("active"))this.updateMemoryView();if(this.$dynarecContent.hasClass("active"))this.updateDynarec()}}n64js.toggleDebugger=()=>{$(".debug").toggle()};n64js.debuggerVisible=()=>{return $(".debug").is(":visible")};n64js.hideDebugger=()=>{$(".debug").hide()};function y5(J){var Q=new DataView(J);switch(Q.getUint32(0)){case 2151092800:break;case 1074935680:mY(J,3,2,1,0);break;case 306217015:mY(J,2,3,0,1);break;case 931151890:mY(J,1,0,3,2);break;default:throw"Unhandled byteswapping: "+Q.getUint32(0).toString(16)}}var mY=function(J,Q,q,Y,Z){var K=new Uint8Array(J),X;for(X=0;X<K.length;X+=4){var W=K[X+Q],z=K[X+q],F=K[X+Y],N=K[X+Z];K[X]=W,K[X+1]=z,K[X+2]=F,K[X+3]=N}};function D5(J){var Q="";for(let F=0;F<J.length;F+=3){var q=J[F+0],Y=J[F+1],Z=J[F+2],K=q>>>2,X=(q&3)<<4|Y>>>4,W=(Y&15)<<2|Z>>>6,z=Z&63;if(F+1>=J.length)W=64;if(F+2>=J.length)z=64;Q+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(K)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(X)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(W)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(z)}return Q}function nY(J,Q){var q=0;for(let N=0;N<J.length;N+=4){var Y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(J.charAt(N+0)),Z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(J.charAt(N+1)),K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(J.charAt(N+2)),X="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(J.charAt(N+3)),W=Y<<2|Z>>>4,z=(Z&15)<<4|K>>>2,F=(K&3)<<6|X;if(Q[q++]=W,K!==64)Q[q++]=z;if(X!==64)Q[q++]=F}}var AU=function(J){if(J<b5)return b5;if(J>T5)return T5;return J},HU=0,FU=4,jU=8,I5=12,NU=16,GU=20,LU=1,PU=17825792,VU=33554432,UU=1073741824,MU=2147483648,hU=16777208,OU=262136,B5="AI DMA",R5=0.005,b5=3000,T5=96000,EU=0.1,_5=5;class oY extends m{constructor(J,Q,q){super("AIReg",J,J.ai_reg,Q,q);this.audioContext=new window.AudioContext,this.pendingAddress=0,this.dmaAddresses=new Uint32Array(2),this.dmaLengths=new Uint32Array(2),this.dmaDurations=new Uint32Array(2),this.dmaCount=0,this.dmaEnable=!1,this.dacRate=0,this.bitRate=15,this.precision=16,this.frequency=32000,this.time=0,this.dynamicRate=1,this.lastLogTime=0}readU32(J){return this.readS32(J)>>>0}readS32(J){const Q=this.calcWriteEA(J);if(Q+4>this.u8.length)throw"Write is out of range";if(!this.quiet)M(`Read from ${j(Q)}`);if(Q==I5){let q=PU;return q|=this.dmaEnable?VU:0,q|=this.dmaCount>0?UU:0,q|=this.dmaCount>1?MU:0,q|=this.dmaCount>1?LU:0,q}return this.dmaLengthRemaining()}write32(J,Q){const q=this.calcWriteEA(J);if(q+4>this.u8.length)throw"Write is out of range";switch(q){case HU:if(!this.quiet)M(`Wrote to AI_DRAM_ADDR_REG: ${j(Q)}`);this.pendingAddress=Q&hU;break;case FU:if(!this.quiet)M(`Wrote to AI_LEN_REG: ${j(Q)}`);this.pushDMA(Q&OU);break;case jU:if(!this.quiet)M(`Wrote to AI_CONTROL_REG: ${j(Q)}`);this.dmaEnable=(Q&1)!=0;break;case I5:this.clearAI();break;case NU:if(this.dacRate=Q&16383,this.frequency=Math.max(1,this.viClock/(this.dacRate+1))>>0,!this.quiet)M(`AI dacrate changed to ${this.dacRate}, vi clock is ${this.viClock}, freq ${this.frequency}`);break;case GU:if(!this.quiet)M(`Wrote to AI_BITRATE_REG: ${j(Q)}`);this.bitRate=Q&15,this.precision=this.bitRate+1;break;default:M(`Unhandled write to AIReg: ${j(Q)} -> [${j(J)}]`);break}}get viClock(){return this.hardware.viRegDevice.videoClock}pushDMA(J){if(!J){n64js.warn("AI received zero length write");return}if(this.dmaCount>=2){n64js.warn("AI DMA FIFO is full");return}if(this.dmaAddresses[this.dmaCount]=this.pendingAddress,this.dmaLengths[this.dmaCount]=J,this.dmaDurations[this.dmaCount]=this.estimateDMACyclesFromLength(J),this.dmaCount++,this.dmaCount==1)this.startPlayback()}popDMA(){if(this.dmaCount<=0){n64js.warn("AI DMA underflow");return}if(this.dmaCount==2)this.dmaAddresses[0]=this.dmaAddresses[1],this.dmaLengths[0]=this.dmaLengths[1],this.dmaDurations[0]=this.dmaDurations[1];if(this.dmaCount--,this.dmaCount==1)this.startPlayback()}estimateDMACyclesFromLength(J){const q=(this.bitRate+1<<1)/8*this.frequency;return J*this.viClock/q>>>0}startPlayback(){const J=this.dmaAddresses[0],Q=this.dmaLengths[0],q=this.dmaDurations[0],Y=Q/4,Z=new Float32Array(Y),K=new Float32Array(Y),X=this.hardware.cachedMemDevice.u8,W=new DataView(X.buffer,J,Q);for(let L=0;L<Y;L++)Z[L]=W.getInt16(L*4+0)/32768,K[L]=W.getInt16(L*4+2)/32768;const z=this.audioContext.currentTime,F=this.time-z;this.dynamicRate=F>0?+R5:-R5;const N=AU(this.frequency*(1+this.dynamicRate));if(_5>0&&z-this.lastLogTime>_5){const L=F>0?"leading":"lagging";console.log(`AI sync: timeDelta ${F}, ${L}, dynamic ${this.dynamicRate}, ${this.frequency} -> ${N}`),this.lastLogTime=z}const G=new AudioBuffer({length:Y,sampleRate:N,numberOfChannels:2});G.copyToChannel(Z,0),G.copyToChannel(K,1);const P=new AudioBufferSourceNode(this.audioContext,{buffer:G});if(P.connect(this.audioContext.destination),P.start(this.time),F<0)this.time=z;this.time+=G.duration,this.raiseAI(),this.addAIDMAEvent(q)}shouldSkipFrame(){return this.time-this.audioContext.currentTime>EU}dmaLengthRemaining(){if(this.dmaCount==0||this.dmaDurations[0]==0)return 0;const J=n64js.cpu0.getCyclesUntilEvent(B5);if(J<=0)return 0;return J*this.dmaLengths[0]/this.dmaDurations[0]&~7}addAIDMAEvent(J){const Q=this;n64js.cpu0.addEvent(B5,J,()=>{Q.dmaComplete()})}dmaComplete(){this.popDMA()}raiseAI(){this.hardware.mi_reg.setBits32(W0,wJ),n64js.cpu0.updateCause3()}clearAI(){this.hardware.mi_reg.clearBits32(W0,wJ),n64js.cpu0.updateCause3()}}var kU=0,wU=4,S5=8,cY=12,CU=16,yU=20,DU=24,IU=28,BU=1,RU=2,bU=4;var TU=16,_U=32;var v5=1,SU=2,f5=4;class lY extends m{constructor(J,Q,q){super("DPC",J,J.dpc_mem,Q,q)}write32(J,Q){this.writeReg32(this.calcWriteEA(J),Q)}writeReg32(J,Q){if(J+4>this.u8.length)throw"Write is out of range";switch(J){case kU:if(!this.quiet)M(`DPC start set to: ${j(Q)}`);this.mem.set32(J,Q),this.mem.set32(S5,Q);break;case wU:if(!this.quiet)M(`DPC end set to: ${j(Q)}`);this.mem.set32(J,Q);break;case cY:this.updateStatus(Q);break;case S5:case CU:case yU:case DU:case IU:M("Wrote to read only DPC reg");break;default:this.mem.set32(J,Q);break}}readU32(J){return this.logRead(J),this.readRegU32(this.calcReadEA(J))}readS32(J){return this.logRead(J),this.readRegU32(this.calcReadEA(J))>>0}readRegU32(J){if(J+4>this.u8.length)throw"Read is out of range";return this.mem.getU32(J)}updateStatus(J){let Q=this.mem.getU32(cY);if(J&BU)Q&=~v5;if(J&RU)Q|=v5;if(J&bU)Q&=~SU;if(J&TU)Q&=~f5;if(J&_U)Q|=f5;this.mem.set32(cY,Q)}}class dY extends m{constructor(J,Q,q){super("DPS",J,J.dps_mem,Q,q)}write32(J,Q){if(this.calcWriteEA(J)+4>this.u8.length)throw"Write is out of range";throw"DPS writes are unhandled"}readS32(J){if(this.logRead(J),this.calcReadEA(J)+4>this.u8.length)throw"Read is out of range";throw"DPS reads are unhandled"}readU32(J){return this.readS32(J)>>>0}}function iU(J){return J>=dU&&J<sY}function tU(J){return J>=sY&&J<DJ}function g5(J){return J>=DJ&&J<iY}function eU(J){return J>=iY&&J<=rU}function J3(J){return J>=m5&&J<=sU}var x5=function(J){return J>=DJ&&J<=aU},S8=0,v8=4,aY=8,rY=12,j6=16,vU=20,fU=24,uU=28,gU=32,xU=36,pU=40,mU=44,nU=48,bQ=1;var oU=4,u5=8,cU=1,lU=2,dU=83886080,sY=100663296,DJ=134217728,aU=134348799,iY=268435456,rU=532676607,m5=533725184,sU=2147483647,p5="PI Interrupt";class tY extends m{constructor(J,Q,q){super("PIReg",J,J.pi_reg,Q,q);this.haveSetMemorySize=!1}reset(){this.haveSetMemorySize=!1}setMemorySize(){if(!this.haveSetMemorySize){const J=this.hardware.rominfo.cic==="6105"?2147484656:2147484440;this.hardware.ram.set32(J-2147483648,8388608),M("Setting memory size"),this.haveSetMemorySize=!0}}readS32(J){const Q=this.calcReadEA(J);if(Q+4>this.u8.length)throw"Read is out of range";let q=this.mem.getS32(Q);switch(Q){case S8:q&=16777214;break;case v8:q&=4294967294;break;case aY:case rY:q=127;break}if(!this.quiet)M(`Reading from PIReg: [${j(J)}] -> ${j(q)}`);return q}readU32(J){return this.readS32(J)>>>0}write32(J,Q){const q=this.calcWriteEA(J);if(q+4>this.u8.length)throw"Write is out of range";if(!this.quiet)M(`Writing to PIReg: ${j(Q)} -> [${j(J)}]`);if(this.busy()&&q!=j6){n64js.warn("Write to PI registers while DMA or IO busy"),this.mem.setBits32(j6,oU);return}switch(q){case S8:case v8:this.mem.set32(q,Q);break;case aY:this.mem.set32(q,Q),this.copyFromRDRAM();break;case rY:this.mem.set32(q,Q),this.copyToRDRAM();break;case j6:if(Q&cU){if(!this.quiet)M("PI_STATUS_REG reset");this.mem.set32(j6,0),this.removePIInterrupt()}if(Q&lU){if(!this.quiet)M("PI interrupt cleared");this.mem.clearBits32(j6,u5),this.hardware.mi_reg.clearBits32(W0,yJ),n64js.cpu0.updateCause3()}break;case vU:case fU:case uU:case gU:case xU:case pU:case mU:case nU:this.mem.set32(q,Q);break;default:M(`Unhandled write to PIReg: ${j(Q)} -> [${j(J)}]`),this.mem.set32(q,Q);break}}busy(){return this.mem.getBits32(j6,bQ)!=0}copyFromRDRAM(){const J=this.mem.getU32(S8)&16777214,Q=this.mem.getU32(v8)&4294967294;let q=(this.mem.getU32(aY)&16777215)+1,Y,Z=0,K=4096;if(q>=127&&q&1)q++;if(g5(Q))if(x5(Q))switch(this.hardware.saveType){case"SRAM":Y=this.hardware.saveMem,Z=Q-DJ,this.hardware.saveDirty=!0;break;case"FlashRam":if(Y=this.hardware.romD2A2Device.flashBuffer,Z=0,q>Y.length)n64js.warn(`PI DMA to FlashRam exceeds buffer length (${q} > ${Y.length})`),q=Y.length;break}else n64js.halt(`PI: unknown dom2addr2 address for ram->cart DMA: ${j(Q)}`);else n64js.halt(`PI: unknown cart address for ram->cart DMA: ${j(Q)}`);if(Y)Y.copy(Z,this.hardware.ram,J,q);this.mem.setBits32(j6,bQ),this.addPIInterrupt(K)}copyToRDRAM(){const J=this.mem.getU32(S8)&16777214,Q=this.mem.getU32(v8)&4294967294;let q=(this.mem.getU32(rY)&16777215)+1;if(!this.quiet)M(`PI: copying ${q} bytes of data from ${j(Q)} to ${j(J)}`);if(q>=127&&q&1)q++;if(q<=128)q-=J&7;let Y,Z=0,K=this.estimateDMACyclesFromLength(q);if(tU(Q))Y=this.hardware.rom,Z=Q-sY;else if(eU(Q))Y=this.hardware.rom,Z=Q-iY;else if(J3(Q))Y=this.hardware.rom,Z=Q-m5;else if(iU(Q))n64js.halt("PI: dom2addr1 transfer is unhandled (save)");else if(g5(Q))if(x5(Q)){switch(Z=Q-DJ,this.hardware.saveType){case"SRAM":Y=this.hardware.saveMem;break;case"FlashRam":Y=this.hardware.romD2A2Device.flashDMASource();break}K=4096}else n64js.halt(`PI: unknown dom2addr2 address for cart->ram DMA: ${j(Q)}`);else n64js.halt(`PI: unknown cart address for cart->ram DMA: ${j(Q)}`);if(Y)this.hardware.ram.copy(J,Y,Z,q);this.setMemorySize(),this.mem.setBits32(j6,bQ),this.mem.set32(S8,this.mem.getU32(S8)+q+7&~7),this.mem.set32(v8,this.mem.getU32(v8)+q+1&~1),this.addPIInterrupt(K)}estimateDMACyclesFromLength(J){const Q=J>>>3;if(Q)return Q;return 16}removePIInterrupt(){n64js.cpu0.removeEvent(p5)}addPIInterrupt(J){const Q=this;n64js.cpu0.addEvent(p5,J,()=>{Q.dmaComplete()})}dmaComplete(){this.mem.clearBits32(j6,bQ),this.mem.setBits32(j6,u5),this.hardware.mi_reg.setBits32(W0,yJ),n64js.cpu0.updateCause3()}}var eY=0,Q3=4,q3=16,p6=24;var f8=4096;class JZ extends m{constructor(J,Q,q){super("SIReg",J,J.si_reg,Q,q)}readS32(J){this.logRead(J);const Q=this.calcReadEA(J);if(Q+4>this.u8.length)throw"Read is out of range";if(Q===p6)this.checkStatusConsistent();return this.mem.getS32(Q)}readU32(J){return this.readS32(J)>>>0}write32(J,Q){const q=this.calcWriteEA(J);if(q+4>this.u8.length)throw"Write is out of range";switch(q){case eY:if(!this.quiet)M(`Writing to SI dram address reigster: ${j(Q)}`);this.mem.set32(q,Q);break;case Q3:this.mem.set32(q,Q),this.copyToRDRAM();break;case q3:this.mem.set32(q,Q),this.copyFromRDRAM();break;case p6:if(!this.quiet)M("SI interrupt cleared");this.mem.clearBits32(p6,f8),this.hardware.mi_reg.clearBits32(W0,k6),n64js.cpu0.updateCause3();break;default:M(`Unhandled write to SIReg: ${j(Q)} -> [${j(J)}]`),this.mem.set32(q,Q);break}}checkStatusConsistent(){const J=this.hardware.mi_reg.getBits32(W0,k6)!==0,Q=this.mem.getBits32(p6,f8)!==0;if(J!==Q)n64js.halt("SI_STATUS register is in an inconsistent state")}copyFromRDRAM(){const J=this.mem.getU32(eY)&536870911;if(!this.quiet)M(`SI: copying from ${j(J)} to PIF RAM`);n64js.joybus().dmaWrite(this.hardware.ram,J),this.mem.setBits32(p6,f8),this.hardware.mi_reg.setBits32(W0,k6),n64js.cpu0.updateCause3()}copyToRDRAM(){const J=this.mem.getU32(eY)&536870911;if(!this.quiet)M(`SI: copying from PIF RAM to ${j(J)}`);n64js.joybus().dmaRead(this.hardware.ram,J),this.mem.setBits32(p6,f8),this.hardware.mi_reg.setBits32(W0,k6),n64js.cpu0.updateCause3()}}class QZ extends m{constructor(J,Q,q){super("PIFMEM",J,J.pif_mem,Q,q)}readS32(J){const Q=this.calcReadEA(J);if(Q+4>this.u8.length)throw"Read is out of range";const q=this.mem.getS32(Q);if(Q<1984)M(`Reading from PIF rom (${j(J)}). Got ${j(q)}`);else{const Y=Q-1984;switch(Y){case 36:M(`Reading PIF CIC values: ${j(q)}`);break;case 60:M(`Reading PIF Control byte: ${j(q)}`);break;default:M(`Reading from PIF ram [${j(J)}]. Got ${j(q)}`);break}n64js.joybus().cpuRead(Y)}return q}readU32(J){return this.readS32(J)>>>0}readS8(J){const Q=this.calcReadEA(J),q=this.mem.getU8(Q);if(Q<1984)M(`Reading from PIF rom (${j(J)}). Got ${M0(q)}`);else{const Y=Q-1984;switch(Y){case 36:M(`Reading PIF CIC values: ${M0(q)}`);break;case 60:M(`Reading PIF Control byte: ${M0(q)}`);break;default:M(`Reading from PIF ram [${j(J)}]. Got ${M0(q)}`);break}n64js.joybus().cpuRead(Y)}return q}readU8(J){return this.readS8(J)>>>0}write32(J,Q){const q=this.calcWriteEA(J);if(q<1984){M("Attempting to write to PIF ROM");return}this.mem.set32(q,Q);const Y=q-1984;switch(Y){case 36:M(`Writing PIF CIC values: ${j(Q)}`);break;case 60:M(`Writing PIF Control byte: ${j(Q)}`),this.updateControl();break;default:M(`Writing directly to PIF ram [${j(J)}] <-- ${j(Q)}`);break}n64js.joybus().cpuWrite(Y)}write16(J,Q){const q=this.calcWriteEA(J);if(q<1984){M("Attempting to write to PIF ROM");return}const Y=q&~3,Z=8*(2-(q&2));this.mem.set32(Y,Q<<Z)}write8(J,Q){const q=this.calcWriteEA(J);if(q<1984){M("Attempting to write to PIF ROM");return}const Y=q&~3,Z=8*(3-(q&3));this.mem.set32(Y,Q<<Z)}updateControl(){const J=this.mem.subRegion(0,1984),Q=this.mem.subRegion(1984,64),q=Q.getU8(63);switch(q){case 1:M("PIF: execute block");break;case 8:M("PIF: interrupt control"),Q.set8(63,0),this.hardware.si_reg.setBits32(p6,f8),this.hardware.mi_reg.setBits32(W0,k6),n64js.cpu0.updateCause3();break;case 16:M("PIF: clear rom"),J.clear();break;case 48:M("PIF: set 0x80 control "),Q.set8(63,128);break;case 192:M("PIF: clear ram"),Q.clear();break;default:n64js.halt(`Unknown PIF control value: ${M0(q)}`);break}}}class IJ extends m{constructor(J,Q,q){super("VMEM",J,J.ram,Q,q)}calcInternalEA(J){return n64js.cpu0.translateReadInternal(J)&8388607}calcReadEA(J){return n64js.cpu0.translateRead(J)&8388607}calcWriteEA(J){return n64js.cpu0.translateWrite(J)&8388607}}class qZ extends m{constructor(J,Q,q){super("RAM",J,J.ram,Q,q);this.dataView=this.mem.dataView,this.s32=this.mem.s32Array()}readU32(J){const Q=J-2147483648;return this.dataView.getUint32(Q,!1)}readS32(J){const Q=J-2147483648;return this.dataView.getInt32(Q,!1)}write32(J,Q){const q=J-2147483648;this.dataView.setUint32(q,Q,!1)}}class YZ extends m{constructor(J,Q,q){super("RAM",J,J.ram,Q,q)}}class TQ extends m{constructor(J,Q,q){super("Invalid",J,null,Q,q)}read(J){return M(`Reading from invalid address ${j(J)}`),0}write(J){M(`Writing to invalid address ${j(J)}`)}readU32(J){return this.read(J)>>>0}readU16(J){return this.read(J)&65535}readU8(J){return this.read(J)&255}readS32(J){return this.read(J)>>0}readS16(J){return this.read(J)&65535}readS8(J){return this.read(J)&255}write32(J,Q){this.write(J,Q)}write16(J,Q){this.write(J,Q)}write8(J,Q){this.write(J,Q)}}class ZZ extends m{constructor(J,Q,q){super("RDRAMReg",J,J.rdram_reg,Q,q)}calcEA(J){return J&255}}var Z3=12;class KZ extends m{constructor(J,Q,q){super("RIReg",J,J.ri_reg,Q,q)}reset(){this.mem.set32(Z3,1)}}class w6{constructor(J,Q,q){if(Q===void 0)Q=0;if(q===void 0)q=J.byteLength-Q;this.arrayBuffer=J,this.offset=Q,this.length=q,this.u8=new Uint8Array(J,Q,q),this.dataView=new DataView(J,Q,q)}clear(){for(let J=0;J<this.u8.length;++J)this.u8[J]=0}set(J,Q,q){for(let Y=0;Y<Q;++Y)this.u8[J+Y]=q}subRegion(J,Q){if(J+Q>this.length)throw"end is out of bounds";return new w6(this.arrayBuffer,this.offset+J,Q)}s32Array(){return new Int32Array(this.arrayBuffer,this.offset,this.length/4)}copy(J,Q,q,Y){if(J+Y>this.u8.length)throw"overflow dst";if(q+Y>Q.u8.length)throw"overflow src";for(let Z=0;Z<Y;++Z)this.u8[J+Z]=Q.u8[q+Z]}getU64(J){return this.dataView.getBigUint64(J,!1)}getU32(J){return this.dataView.getUint32(J,!1)}getU16(J){return this.dataView.getUint16(J,!1)}getU8(J){return this.dataView.getUint8(J,!1)}getS64(J){return this.dataView.getBigInt64(J,!1)}getS32(J){return this.dataView.getInt32(J,!1)}getS16(J){return this.dataView.getInt16(J,!1)}getS8(J){return this.dataView.getInt8(J,!1)}set64masked(J,Q,q){const Z=this.getU64(J,!1)&~q|Q&q;this.set64(J,Z,!1)}set32masked(J,Q,q){const Z=this.getU32(J,!1)&~q|Q&q;this.set32(J,Z)}set64(J,Q){this.dataView.setBigUint64(J,Q,!1)}set32(J,Q){this.dataView.setUint32(J,Q,!1)}set16(J,Q){this.dataView.setUint16(J,Q,!1)}set8(J,Q){this.dataView.setUint8(J,Q,!1)}clearBits32(J,Q){const q=this.getU32(J)&~Q;return this.set32(J,q),q}setBits32(J,Q){const q=this.getU32(J)|Q;return this.set32(J,q),q}getBits32(J,Q){return this.getU32(J)&Q}}var G3=function(J){return(J<<16|J&65535)>>>0},K3=3019833364,XZ=3019833376,_Q=512,X3=XZ+_Q,W3=75,$3=120,z3=165,H3=180,F3=210,j3=225,N3=240,n5=0,o5=1,c5=2,l5=3,d5=4;class WZ extends m{constructor(J,Q,q){super("ROMd1a1",J,J.rom,Q,q)}write32(J,Q){throw`Writing to rom d1a1 ${j(Q)} -> [${j(J)}]`}write16(J,Q){throw`Writing to rom d1a1 ${x(Q)} -> [${j(J)}]`}write8(J,Q){throw`Writing to rom d1a1 ${M0(Q)} -> [${j(J)}]`}}class $Z extends m{constructor(J,Q,q){super("ROMd1a2",J,J.rom,Q,q);this.lastWrite=0,this.hasLastWrite=!1,this.debugBuffer=new ArrayBuffer(_Q),this.debugBufferU32=new Uint32Array(this.debugBuffer),this.debugBufferU8=new Uint8Array(this.debugBuffer),this.output=""}calcEA(J){return J-this.rangeStart+2&~2}write64(J,Q){this.cacheLastWrite(Number(Q>>32n))}write32(J,Q){if(J==K3)return this.writeDebugBufferLen(Q);if(J>=XZ&&J<X3)return this.writeDebugBuffer32(J-XZ,Q);this.cacheLastWrite(Q>>>0)}write16(J,Q){const q=8*(2-(J&2));this.cacheLastWrite(Q<<q&4294967295)}write8(J,Q){const q=8*(3-(J&3));this.cacheLastWrite(Q<<q&4294967295)}readU32(J){if(this.hasLastWrite)return this.consumeLastWrite()>>>0;return super.readU32(J)}readS32(J){if(this.hasLastWrite)return this.consumeLastWrite()>>0;return super.readS32(J)}readU16(J){if(this.hasLastWrite)return this.consumeLastWrite()>>>16;return super.readU16(J)}readS16(J){if(this.hasLastWrite)return this.consumeLastWrite()>>16;return super.readS16(J)}readU8(J){if(this.hasLastWrite)return this.consumeLastWrite()>>>24;return super.readU8(J)}readS8(J){if(this.hasLastWrite)return this.consumeLastWrite()>>24;return super.readS8(J)}cacheLastWrite(J){if(!this.hasLastWrite)this.lastWrite=J,this.hasLastWrite=!0}consumeLastWrite(){return this.hasLastWrite=!1,this.lastWrite}writeDebugBufferLen(J){if(J>_Q)console.log(`debug buffer value too long (${J}), truncating`),J=_Q;for(let Q=0;Q<J;Q++)this.output+=String.fromCharCode(this.debugBufferU8[Q^3]);this.flushDebugOutput()}writeDebugBuffer32(J,Q){const q=J>>>2;this.debugBufferU32[q]=Q}flushDebugOutput(){const J=this.output.lastIndexOf("\n");if(J>=0)console.log(this.output.substring(0,J+1)),this.output=this.output.substring(J+1)}}class zZ extends m{constructor(J,Q,q){super("ROMd1a3",J,J.rom,Q,q)}write32(J,Q){throw`Writing to rom d1a3 ${j(Q)} -> [${j(J)}]`}write16(J,Q){throw`Writing to rom d1a3 ${x(Q)} -> [${j(J)}]`}write8(J,Q){throw`Writing to rom d1a3 ${M0(Q)} -> [${j(J)}]`}}class HZ extends m{constructor(J,Q,q){super("ROMd2a1",J,null,Q,q)}read(J){if(J==2768241928)return M("Reading from ROMd2a1 0xa5000508 - spoofing ~0 value"),~0;return M(`Reading from invalid ROMd2a1 address ${j(J)}`),0}readU32(J){return this.read(J)>>>0}readU16(J){return this.read(J)&65535}readU8(J){return this.read(J)&255}readS32(J){return this.read(J)>>0}readS16(J){return this.read(J)&65535}readS8(J){return this.read(J)&255}write32(J,Q){throw`Writing to rom ${j(Q)} -> [${j(J)}]`}write16(J,Q){throw`Writing to rom ${x(Q)} -> [${j(J)}]`}write8(J,Q){throw`Writing to rom ${M0(Q)} -> [${j(J)}]`}}class FZ extends m{constructor(J,Q,q){super("ROMd2a2",J,null,Q,q);this.flashMode=n5,this.flashStatus=new w6(new ArrayBuffer(8)),this.flashBuffer=new w6(new ArrayBuffer(128)),this.flashOffset=0}hasFlashRam(){return this.hardware.saveType=="FlashRam"}readU32(J){return this.readS32(J)>>>0}readU16(J){return this.readS16(J)>>>0}readU8(J){return this.readS8(J)>>>0}readS32(J){const Q=this.calcWriteEA(J);if(Q>=557056)return G3(J);if(this.hasFlashRam()){const q=Q&4;return this.flashStatus.getS32(q)}throw`Reading s32 from rom d2a2 [${j(J)}]`}readS16(J){throw`Reading s16 from rom d2a2 [${j(J)}]`}readS8(J){throw`Reading s8 from rom d2a2 [${j(J)}]`}write32(J,Q){const q=this.calcWriteEA(J);if(this.hasFlashRam()){if(q!=0)this.flashCommand(Q);return}throw`Writing s32 to rom ${j(Q)} -> [${j(J)}]`}write16(J,Q){throw`Writing s16 to rom ${x(Q)} -> [${j(J)}]`}write8(J,Q){throw`Writing s8 to rom ${M0(Q)} -> [${j(J)}]`}flashDMASource(){switch(this.flashMode){case l5:return this.hardware.saveMem;case d5:return this.flashStatus}return n64js.warn(`Unexpected mode for flash DMA: ${this.flashMode}`),null}flashCommand(J){const Q=J>>>24&255;switch(Q){case W3:if(this.flashOffset=(J&65535)*128,!this.quiet)M(`set erase offset: ${j(this.flashOffset)}`);break;case $3:if(!this.quiet)M("set mode ERASE");this.flashMode=o5,this.flashStatus.set64(0,0x1111_8008_00c2_001dn);break;case z3:if(this.flashOffset=(J&65535)*128,!this.quiet)M(`set write offset: ${j(this.flashOffset)}`);this.flashStatus.set64(0,0x1111_8004_00c2_001dn);break;case H3:if(!this.quiet)M("setting mode WRITE");this.flashMode=c5;break;case F3:switch(this.flashMode){case n5:if(!this.quiet)M("execute IDLE (ignored)");break;case o5:if(!this.quiet)M(`execute ERASE flash @ ${j(this.flashOffset)} (set saveMem to 0xff)`);this.hardware.saveMem.set(this.flashOffset,128,255),this.hardware.saveDirty=!0;break;case c5:if(!this.quiet)M(`execute WRITE flash @ ${j(this.flashOffset)} (copy flashBuffer to saveMem)`);this.hardware.saveMem.copy(this.flashOffset,this.flashBuffer,0,128),this.hardware.saveDirty=!0;break;default:M(`execute (${j(J)}) with unhandled mode: ${this.flashMode}`);break}break;case j3:if(!this.quiet)M("setting mode STATUS");this.flashMode=d5,this.flashStatus.set64(0,0x1111_8001_00c2_001dn);break;case N3:if(!this.quiet)M("setting mode READ");this.flashMode=l5,this.flashStatus.set64(0,0x1111_8004_f000_001dn);break;default:if(!this.quiet)M(`execute with unknown command ${j(Q)}`)}}}function s5(){const J=n64js.hardware().cachedMemDevice.u8,Q=n64js.hardware().sp_mem.subRegion(P3,V3);var q=new r5(J,Q);let Y=!1;switch(q.type){case k3:EW(q),n64js.hardware().miRegDevice.interruptDP(),Y=!0;break;case w3:Y=!a5.enableAudioLLE;break;case C3:break;case y3:break}return Y}var a5={enableAudioLLE:!0},L3=P6.addFolder("Audio");L3.add(a5,"enableAudioLLE").name("Audio LLE");var P3=4032,V3=64,U3=0;var M3=16,h3=20,O3=24,E3=28;var A3=48;var k3=1,w3=2,C3=3,y3=4;class r5{constructor(J,Q){this.ram_u8=J,this.type=Q.getU32(U3),this.codeAddr=Q.getU32(M3)&536870911,this.codeSize=this.clampCodeSize(Q.getU32(h3)),this.codeDataAddr=Q.getU32(O3)&536870911,this.codeDataSize=Q.getU32(E3),this.dataPtr=Q.getU32(A3)}dumpCode(){const J=n64js.hardware().cachedMemDevice.mem,q=Yq(J,4224,this.codeAddr,this.codeSize);let Y=`${this.detectVersionString()}\n`;for(let Z of q)Y+=`${B(Z.address,16)} ${Z.disassembly}\n`;Y+="\nDMEM\n",Y+=rK(J,0,this.codeDataAddr,this.codeDataSize),console.log(Y)}loadUcode(J,Q,q,Y){this.codeAddr=J&536870911,this.codeSize=this.clampCodeSize(Q),this.codeDataAddr=q&536870911,this.codeDataSize=Y}clampCodeSize(J){if(J==0||J>4096)return 4096;return J}dataByte(J){return this.ram_u8[this.codeDataAddr+J]}codeByte(J){return this.ram_u8[this.codeAddr+J]}detectVersionString(){const J="R".charCodeAt(0),Q="S".charCodeAt(0),q="P".charCodeAt(0);for(let Y=0;Y+2<this.codeDataSize;++Y)if(this.dataByte(Y+0)===J&&this.dataByte(Y+1)===Q&&this.dataByte(Y+2)===q){let Z="";for(let K=Y;K<this.codeDataSize;++K){const X=this.dataByte(K);if(X===0)return Z;Z+=String.fromCharCode(X)}}return""}computeMicrocodeHash(){let J=0;for(let Q=0;Q<this.codeSize;++Q)J=J*17+this.codeByte(Q)>>>0;return J}}var D3=!0,jZ=0,NZ=4,GZ=8,LZ=12,BJ=16,i5=20,t5=24,e5=28,I3=4294967288,B3=4294967288,J7=4287627256,Q7=4287627256,q7=4096,Y7=4293918720,Z7=20,u8=1044480,K7=12,g8=4095,x8=0,PZ=1,VZ=2,X7=4,UZ=8,MZ=16,W7=32,$7=64,z7=128,H7=256,F7=512,j7=1024,N7=2048,G7=4096,L7=8192,P7=16384,V7=32768,U7=65536,M7=131072,h7=262144,O7=524288,E7=1048576,A7=2097152,k7=4194304,w7=8388608,C7=16777216,hZ=1,y7=2,D7=4,I7=8;var R3=32,B7=64,b3=128,T3=256,b7=512,_3=1024,S3=2048,v3=4096,f3=8192,u3=16384;var g3=b7,x3=0,p3=4092,m3="SP DMA",R7=1,n3=2;class T7{constructor(J,Q,q,Y){this.isRead=J,this.spMemAddr=Q,this.rdRamAddr=q,this.len=Y}}class OZ extends m{constructor(J,Q,q){super("SPMem",J,J.sp_mem,Q,q);this.pendingSPMemAddr=0,this.pendingDRAMAddr=0}calcEA(J){return(J-this.rangeStart)%8192}write64(J,Q){const q=this.calcWriteEA(J);this.mem.set32(q,Number(Q>>32n))}write16(J,Q){const q=this.calcWriteEA(J),Y=q&~3,Z=8*(2-(q&2));this.mem.set32(Y,Q<<Z)}write8(J,Q){const q=this.calcWriteEA(J),Y=q&~3,Z=8*(3-(q&3));this.mem.set32(Y,Q<<Z)}}class EZ extends m{constructor(J,Q,q){super("SPIBIST",J,J.sp_ibist_mem,Q,q)}write32(J,Q){const q=this.calcWriteEA(J);switch(q){case x3:this.mem.set32(q,Q&p3);break;default:M(`Unhandled write to SPIBISTReg: ${j(Q)} -> [${j(J)}]`)}}}class AZ extends m{constructor(J,Q,q){super("SPReg",J,J.sp_reg,Q,q);this.dmaQueue=[]}write32(J,Q){this.writeReg32(this.calcWriteEA(J),Q)}writeReg32(J,Q){if(J+4>this.u8.length)throw"Write is out of range";switch(J){case jZ:this.pendingSPMemAddr=Q&I3;break;case NZ:this.pendingDRAMAddr=Q&B3;break;case GZ:this.mem.set32(J,Q&J7),this.pushDMA(R7,Q&J7);break;case LZ:this.mem.set32(J,Q&Q7),this.pushDMA(n3,Q&Q7);break;case BJ:this.spUpdateStatus(Q);break;case i5:case t5:break;case e5:this.mem.set32(J,0);break;default:M(`Unhandled write to SPReg: ${j(Q)} -> [${j(J)}]`),this.mem.set32(J,Q)}}readU32(J){return this.logRead(J),this.readRegU32(this.calcReadEA(J))}readS32(J){return this.logRead(J),this.readRegU32(this.calcReadEA(J))>>0}readRegU32(J){if(J+4>this.u8.length)throw"Read is out of range";const Q=this.mem.getU32(J);if(J==e5)this.mem.set32(J,1);return Q}setStatusBits(J){if(this.mem.setBits32(BJ,J)&B7)this.hardware.miRegDevice.interruptSP()}spUpdateStatus(J){if(!this.quiet){if(J&PZ)M("SP: Clearing Halt");if(J&VZ)M("SP: Setting Halt");if(J&X7)M("SP: Clearing Broke");if(J&UZ)M("SP: Clearing Interrupt");if(J&MZ)M("SP: Setting Interrupt");if(J&W7)M("SP: Clearing Single Step");if(J&$7)M("SP: Setting Single Step");if(J&z7)M("SP: Clearing Interrupt on break");if(J&H7)M("SP: Setting Interrupt on break");if(J&F7)M("SP: Clearing Sig0 (Yield)");if(J&j7)M("SP: Setting Sig0 (Yield)");if(J&N7)M("SP: Clearing Sig1 (Yielded)");if(J&G7)M("SP: Setting Sig1 (Yielded)");if(J&L7)M("SP: Clearing Sig2 (TaskDone)");if(J&P7)M("SP: Setting Sig2 (TaskDone)");if(J&V7)M("SP: Clearing Sig3");if(J&U7)M("SP: Setting Sig3");if(J&M7)M("SP: Clearing Sig4");if(J&h7)M("SP: Setting Sig4");if(J&O7)M("SP: Clearing Sig5");if(J&E7)M("SP: Setting Sig5");if(J&A7)M("SP: Clearing Sig6");if(J&k7)M("SP: Setting Sig6");if(J&w7)M("SP: Clearing Sig7");if(J&C7)M("SP: Setting Sig7")}function Q(K,X,W,z,F){const N=X&z,G=X&W;if(N&&!G)return K|F;else if(G&&!N)return K&~F;return K}let q=this.mem.getU32(BJ),Y=!1,Z=!1;if(J&VZ&&J&PZ);else if(J&VZ)q|=hZ,Z=!0;else if(J&PZ)q&=~hZ,Y=!0;if(J&MZ&&J&UZ);else if(J&MZ)this.hardware.mi_reg.setBits32(W0,_8),n64js.cpu0.updateCause3();else if(J&UZ)this.hardware.mi_reg.clearBits32(W0,_8),n64js.cpu0.updateCause3();if(q=Q(q,J,X7,0,y7),q=Q(q,J,W7,$7,R3),q=Q(q,J,z7,H7,B7),q=Q(q,J,F7,j7,b3),q=Q(q,J,N7,G7,T3),q=Q(q,J,L7,P7,b7),q=Q(q,J,V7,U7,_3),q=Q(q,J,M7,h7,S3),q=Q(q,J,O7,E7,v3),q=Q(q,J,A7,k7,f3),q=Q(q,J,w7,C7,u3),this.mem.set32(BJ,q),Y)if(s5()||!D3)this.hardware.spRegDevice.setStatusBits(g3|y7|hZ);else H.unhalt();else if(Z)H.halt(0)}pushDMA(J,Q){if(this.dmaQueue.length>=2){n64js.warn("RSP DMA FIFO is full");return}const q=J==R7,Y=new T7(q,this.pendingSPMemAddr,this.pendingDRAMAddr,Q);if(this.dmaQueue.push(Y),this.setDMAStatus(),this.dmaQueue.length==1)this.startDMA(Y)}startDMA(J){if(J.isRead)this.spCopyFromRDRAM(J.spMemAddr,J.rdRamAddr,J.len);else this.spCopyToRDRAM(J.spMemAddr,J.rdRamAddr,J.len)}dmaComplete(){if(this.dmaQueue.shift(),this.dmaQueue.length>0)this.startDMA(this.dmaQueue[0]);this.setDMAStatus()}setDMAStatus(){const J=this.dmaQueue.length>=2?I7:0,Q=this.dmaQueue.length>=1?D7:0;this.mem.set32(i5,J?1:0),this.mem.set32(t5,Q?1:0),this.mem.set32masked(BJ,J|Q,I7|D7)}spCopyFromRDRAM(J,Q,q){const Y=J&8191,Z=Q&16777215,K=((q&g8)>>>x8|7)+1,X=((q&u8)>>>K7)+1,W=(q&Y7)>>>Z7,z=Y&q7;if(!this.quiet)M(`SP: copying ${K} bytes from ram ${j(Z)} to sp ${x(Y)}, count ${X}, skip ${W}`);let F=Y,N=Z;for(let P=0;P<X;P++){for(let L=0;L<K;++L)this.hardware.sp_mem.u8[z|F&4095]=this.hardware.ram.u8[N],F++,N++;N+=W}this.mem.set32(jZ,z|F&4095),this.mem.set32(NZ,N),this.mem.set32masked(GZ,4088<<x8,u8|g8),this.mem.set32masked(LZ,4088<<x8,u8|g8);const G=this.estimateDMACyclesFromLength(X,K);this.addSPDMAEvent(G)}spCopyToRDRAM(J,Q,q){const Y=J&8191,Z=Q&16777215,K=((q&g8)>>>x8|7)+1,X=((q&u8)>>>K7)+1,W=(q&Y7)>>>Z7,z=Y&q7;if(!this.quiet)M(`SP: copying ${K} bytes from sp ${x(Y)} to ram ${j(Z)}, count ${X}, skip ${W}`);let F=Z,N=Y;for(let P=0;P<X;P++){for(let L=0;L<K;++L)this.hardware.ram.u8[F]=this.hardware.sp_mem.u8[z|N&4095],F++,N++;F+=W}this.mem.set32(jZ,z|N&4095),this.mem.set32(NZ,F),this.mem.set32masked(GZ,4088<<x8,u8|g8),this.mem.set32masked(LZ,4088<<x8,u8|g8);const G=this.estimateDMACyclesFromLength(X,K);this.addSPDMAEvent(G)}estimateDMACyclesFromLength(J,Q){const Y=J*Q>>>3;if(Y)return Y;return 16}addSPDMAEvent(J){const Q=this;n64js.cpu0.addEvent(m3,J,()=>{Q.dmaComplete()})}}var qM=function(J){switch(J){case K8:return JM;case JJ:return g7;case QK:return QM}return g7},YM=function(J){return J==K8?50:60},_7=0,S7=4,v7=8,kZ=12,wZ=16,o3=20,SQ=24,c3=28,l3=32,d3=36,a3=40,r3=44,s3=48,i3=52,f7=2,u7=3;var t3=64;var e3=3,JM=49656530,g7=48681812,QM=48628316,CZ="VI Interrupt";class yZ extends m{constructor(J,Q,q){super("VIReg",J,J.vi_reg,Q,q);this.field=0,this.videoClock=0,this.refreshRate=0,this.countPerScanline=0,this.countPerVbl=0,this.reset()}reset(){const J=this.hardware.rominfo.tvType==JJ;this.videoClock=qM(J),this.refreshRate=YM(J),this.countPerScanline=0,this.countPerVbl=0,this.screenWidth=640,this.screenHeight=J?480:576,this.hScanMin=J?108:128,this.hScanMax=this.hScanMin+this.screenWidth,this.vScanMin=J?34:44,this.vScanMax=this.vScanMin+this.screenHeight,this.dims=new x7(this.screenWidth,this.screenHeight)}get controlReg(){return this.mem.getU32(_7)}get dramAddrReg(){return this.mem.getU32(S7)}get hWidthReg(){return this.mem.getU32(v7)}get vIntrReg(){return this.mem.getU32(kZ)}get vCurrentLineReg(){return this.mem.getU32(wZ)}get timingReg(){return this.mem.getU32(o3)}get vSyncReg(){return this.mem.getU32(SQ)}get hSyncReg(){return this.mem.getU32(c3)}get hSyncLeapReg(){return this.mem.getU32(l3)}get hVideoReg(){return this.mem.getU32(d3)}get vVideoReg(){return this.mem.getU32(a3)}get vBurstReg(){return this.mem.getU32(r3)}get xScaleReg(){return this.mem.getU32(s3)}get yScaleReg(){return this.mem.getU32(i3)}get interlaced(){return(this.controlReg&t3)!=0}get modeType(){return this.controlReg&e3}get is32BitMode(){return this.modeType==u7}get is16BitMode(){return this.modeType==f7}get xScale(){return(this.xScaleReg&4095)/1024}get yScale(){return(this.yScaleReg&4095)/1024}get bitDepth(){switch(this.modeType){case u7:return 32;case f7:return 16}return 0}dump(){console.log(`VI_CONTROL = ${j(this.controlReg)}`),console.log(`VI_DRAM_ADDR = ${j(this.dramAddrReg)}`),console.log(`VI_H_WIDTH = ${j(this.hWidthReg)}`),console.log(`VI_V_INTR = ${j(this.vIntrReg)}`),console.log(`VI_V_CURRENT_LINE = ${j(this.vCurrentLineReg)}`),console.log(`VI_TIMING = ${j(this.timingReg)}`),console.log(`VI_V_SYNC = ${j(this.vSyncReg)}`),console.log(`VI_H_SYNC = ${j(this.hSyncReg)}`),console.log(`VI_H_SYNC_LEAP = ${j(this.hSyncLeapReg)}`),console.log(`VI_H_VIDEO = ${j(this.hVideoReg)}`),console.log(`VI_V_VIDEO = ${j(this.vVideoReg)}`),console.log(`VI_V_BURST = ${j(this.vBurstReg)}`),console.log(`VI_X_SCALE = ${j(this.xScaleReg)} = ${this.xScale}`),console.log(`VI_Y_SCALE = ${j(this.yScaleReg)} = ${this.yScale}`)}verticalBlank(){this.field^=this.interlaced?1:0,this.addInterruptEvent(),this.hardware.mi_reg.setBits32(W0,CJ),n64js.cpu0.updateCause3(),x9(),n64js.returnControlToSystem()}initInterrupt(){if(n64js.cpu0.hasEvent(CZ))return;const J=this.mem.getU32(kZ),Q=this.mem.getU32(SQ);if(J>=Q){M(`not setting VI interrupt - intr ${J} >= sync ${Q}`);return}this.addInterruptEvent()}addInterruptEvent(){n64js.cpu0.addEvent(CZ,this.countPerVbl,()=>{n64js.verticalBlank()})}getVblCount(){const J=n64js.cpu0.getCyclesUntilEvent(CZ);return J>=0?J:0}write32(J,Q){const q=this.calcWriteEA(J);if(q+4>this.u8.length)throw"Write is out of range";switch(q){case S7:this.mem.set32(q,Q);break;case _7:if(!this.quiet)M(`VI control set to: ${j(Q)}`);this.mem.set32(q,Q);break;case v7:if(!this.quiet)M(`VI width set to: ${Q}`);this.mem.set32(q,Q);break;case kZ:if(!this.quiet)M(`VI intr set to: ${Q}`);this.mem.set32(q,Q),this.initInterrupt();break;case wZ:if(!this.quiet)M(`VI current set to: ${j(Q)}`);if(!this.quiet)M("VI interrupt cleared");this.hardware.mi_reg.clearBits32(W0,CJ),n64js.cpu0.updateCause3();break;case SQ:if(this.mem.getU32(q)!=Q){const Z=Q+1;this.countPerScanline=this.hardware.systemFrequency/this.refreshRate/Z>>0,this.countPerVbl=Z*this.countPerScanline,M(`VI_V_SYNC_REG set to ${Q}, cycles per scanline = ${this.countPerScanline}, cycles per vbl = ${this.countPerVbl}`),this.mem.set32(q,Q),this.initInterrupt()}break;default:this.mem.set32(q,Q);break}}readS32(J){this.logRead(J);const Q=this.calcReadEA(J);if(Q+4>this.u8.length)throw"Read is out of range";if(Q===wZ){const q=this.getVblCount(),Z=(this.countPerVbl-q)/this.countPerScanline>>0,K=this.mem.getU32(SQ);let X=Z;if(X>=K)X-=K;X=X&~1|this.field,this.mem.set32(Q,X)}return this.mem.getS32(Q)}readU32(J){return this.readS32(J)>>>0}computeDimensions(){if(this.modeType==0)return M("mode type is 0 - not rendering"),null;const J=this.hVideoReg,Q=J>>16&1023,q=J&1023;let Y=Math.max(Q,this.hScanMin),Z=Math.min(q,this.hScanMax);const K=this.vVideoReg,X=K>>16&1023,W=K&1023;let z=Math.max(X,this.vScanMin),F=W<X?this.vScanMax:Math.min(W,this.vScanMax);if(Y>=this.hScanMin)Y+=8;if(Z<this.hScanMax)Z-=7;const N=this.dims;N.interlaced=this.interlaced,N.field=this.field,N.xSubpixel=this.xScaleReg>>16&4095,N.ySubpixel=this.yScaleReg>>16&4095,N.xScale=this.xScaleReg&4095,N.yScale=this.yScaleReg&4095,N.sx0=Y-Q,N.sy0=z-X,N.dx0=Y-this.hScanMin,N.dy0=z-this.vScanMin,N.dstWidth=Z-Y,N.dstHeight=F-z,N.srcPitch=this.hWidthReg;const G=(N.sx0+N.dstWidth)*N.xScale>>10,P=(N.sy0+N.dstHeight)*N.yScale>>11,L=N.srcPitch>768||N.srcPitch>=G*2?2:1;return N.srcWidth=G,N.srcHeight=P*L,N}renderBackBuffer(){const J=this.computeDimensions();if(!J)return null;const Q=this.dramAddrReg&16777214;if(!Q)return null;const q=this.hardware.cachedMemDevice.mem.dataView;if(this.is32BitMode)return J.renderBackBuffer32(q,Q);if(this.is16BitMode)return J.renderBackBuffer16(q,Q);return null}}class x7{constructor(J,Q){this.screenWidth=640,this.screenHeight=480,this.pixels32bpp=new Uint8Array(J*Q*4),this.pixels16bpp=new Uint16Array(J*Q),this.interlaced=!1,this.field=0,this.dstWidth=640,this.dstHeight=480,this.srcPitch=320,this.srcWidth=320,this.srcHeight=240,this.xSubpixel=0,this.ySubpixel=0,this.xScale=512,this.yScale=1024,this.sx0=0,this.sy0=0,this.dx0=0,this.dy0=0}renderBackBuffer32(J,Q){const q=this.pixels32bpp,Y=-this.screenWidth;let Z=(this.screenHeight-1-this.dy0)*this.screenWidth;const K=255;let X=this.sy0*this.yScale+this.ySubpixel;for(let W=0;W<this.dstHeight;W++){if(!this.interlaced||(this.dy0+W&1)!=this.field){const z=Q+(X>>>11)*this.srcPitch*4;let F=Z+this.dx0,N=this.sx0*this.xScale+this.xSubpixel;for(let G=0;G<this.dstWidth;G++){const P=J.getInt32(z+(N>>>10)*4,!1);q[F*4+0]=P>>>24,q[F*4+1]=P>>>16,q[F*4+2]=P>>>8,q[F*4+3]=K,F++,N+=this.xScale}}X+=this.yScale,Z+=Y}return q}renderBackBuffer16(J,Q){const q=this.pixels16bpp,Y=-this.screenWidth;let Z=(this.screenHeight-1-this.dy0)*this.screenWidth;const K=1;let X=this.sy0*this.yScale+this.ySubpixel;for(let W=0;W<this.dstHeight;W++){if(!this.interlaced||(this.dy0+W&1)!=this.field){const z=Q+(X>>>11)*this.srcPitch*2;let F=Z+this.dx0,N=this.sx0*this.xScale+this.xSubpixel;for(let G=0;G<this.dstWidth;G++)q[F++]=J.getInt16(z+(N>>>10)*2,!1)|K,N+=this.xScale}X+=this.yScale,Z+=Y}return q}}class DZ{constructor(J){this.map=this.createMemMap(J)}createMemMap(J){const Q=[];for(let q=0;q<16384;++q)Q.push(void 0);if(J.map((q)=>{const Y=q.rangeStart>>>18,Z=q.rangeEnd-1>>>18;for(let K=Y;K<=Z;++K)Q[K]=q}),Q.length!==16384)throw"initialisation error";return Q}getMemoryHandler(J){var Q=this.map[J>>>18];if(Q)return Q;throw M(`accessing unhandled location ${j(J)}`),`unhandled access ${j(J)}`}readMemoryInternal32(J){const Q=this.map[J>>>18];if(Q)return Q.readInternal32(J);return 3722304989}writeMemoryInternal32(J,Q){const q=this.map[J>>>18];if(q)q.writeInternal32(J,Q)}}var S0=function(J){return new w6(new ArrayBuffer(J))},IZ=64,ZM=4096,KM=93750000;class RJ{constructor(){this.data=new Uint8Array(32768),this.dirty=!1}init(J){this.dirty=!1;for(let Q=0;Q<this.data.length;Q++)this.data[Q]=0;if(J&&J.data)nY(J.data,this.data)}}class BZ{constructor(J){this.rominfo=J,this.systemFrequency=KM,this.rom=null,this.pif_mem=S0(2048),this.ram=S0(8388608),this.sp_mem=S0(8192),this.sp_reg=S0(32),this.sp_ibist_mem=S0(8),this.dpc_mem=S0(32),this.dps_mem=S0(16),this.rdram_reg=S0(48),this.mi_reg=S0(16),this.vi_reg=S0(56),this.ai_reg=S0(24),this.pi_reg=S0(52),this.ri_reg=S0(32),this.si_reg=S0(28),this.saveMem=null,this.saveDirty=!1,this.mempacks=[new RJ,new RJ,new RJ,new RJ],this.mappedMemDevice=new IJ(this,0,2147483648),this.invalidCachedMemDevice=new TQ(this,2147483648,2684354560),this.cachedMemDevice=new qZ(this,2147483648,2155872256),this.invalidUnachedMemDevice=new TQ(this,2684354560,3221225472),this.uncachedMemDevice=new YZ(this,2684354560,2692743168),this.rdRamRegDevice=new ZZ(this,2750414848,2751463424),this.spMemDevice=new OZ(this,2751463424,2751725568),this.spRegDevice=new AZ(this,2751725568,2751725600),this.spIbistDevice=new EZ(this,2751987712,2751987720),this.dpcDevice=new lY(this,2752512000,2752512032),this.dpsDevice=new dY(this,2753560576,2753560592),this.miRegDevice=new gY(this,2754609152,2754609168),this.viRegDevice=new yZ(this,2755657728,2755657784),this.aiRegDevice=new oY(this,2756706304,2756706328),this.piRegDevice=new tY(this,2757754880,2757754932),this.riRegDevice=new KZ(this,2758803456,2758803488),this.siRegDevice=new JZ(this,2759852032,2759852060),this.romD2A1Device=new HZ(this,2768240640,2785017856),this.romD1A1Device=new WZ(this,2785017856,2818572288),this.romD2A2Device=new FZ(this,2818572288,2952790016),this.romD1A2Device=new $Z(this,2952790016,3217031168),this.pifMemDevice=new QZ(this,3217031168,3217033216),this.romD1A3Device=new zZ(this,3218079744,3221225472),this.mappedMem2Device=new IJ(this,3221225472,3758096384),this.mappedMem3Device=new IJ(this,3758096384,4294967296),this.devices=[this.mappedMemDevice,this.invalidCachedMemDevice,this.cachedMemDevice,this.invalidUnachedMemDevice,this.uncachedMemDevice,this.rdRamRegDevice,this.spMemDevice,this.spRegDevice,this.spIbistDevice,this.dpcDevice,this.dpsDevice,this.miRegDevice,this.viRegDevice,this.aiRegDevice,this.piRegDevice,this.riRegDevice,this.siRegDevice,this.romD2A1Device,this.romD1A1Device,this.romD2A2Device,this.romD1A2Device,this.pifMemDevice,this.romD1A3Device,this.mappedMem2Device,this.mappedMem3Device],this.memMap=new DZ(this.devices)}reset(){this.pif_mem.clear(),this.ram.clear(),this.sp_mem.clear(),this.sp_reg.clear(),this.sp_ibist_mem.clear(),this.rdram_reg.clear(),this.dpc_mem.clear(),this.dps_mem.clear(),this.mi_reg.clear(),this.vi_reg.clear(),this.ai_reg.clear(),this.pi_reg.clear(),this.ri_reg.clear(),this.si_reg.clear(),this.initSaveGame();for(let J of this.devices)J.reset()}createROM(J){if(Math.max(J.byteLength<8388608))J=J.transfer(8388608);const q=new w6(J);return this.rom=q,this.romD1A1Device.setMem(q),this.romD1A2Device.setMem(q),this.romD1A3Device.setMem(q),q}loadROM(){if(this.rom)this.sp_mem.copy(IZ,this.rom,IZ,ZM-IZ)}verticalBlank(){this.flushSaveData(),this.viRegDevice.verticalBlank()}initSaveGame(){for(let[Q,q]of this.mempacks.entries()){const Y=n64js.getLocalStorageItem(`mempack${Q}`);q.init(Y)}const J=this.saveSizeBytes();if(J){const Q=new w6(new ArrayBuffer(J)),q=n64js.getLocalStorageItem("save");if(q&&q.data)nY(q.data,Q.u8);this.saveMem=Q}else this.saveMem=null;this.saveDirty=!1}saveSizeBytes(){switch(this.saveType){case"Eeprom4k":return 512;case"Eeprom16k":return 2048;case"SRAM":return 32768;case"FlashRam":return 131072}if(this.saveType)n64js.ui().displayWarning(`Unhandled savegame type: ${this.saveType}.`);return 0}get saveType(){return this.rominfo.save}flushSaveData(){if(this.saveMem&&this.saveDirty)this.saveU8Array("save",this.saveMem.u8),this.saveDirty=!1;for(let[J,Q]of this.mempacks.entries())if(Q.dirty)this.saveU8Array(`mempack${J}`,Q.data),Q.dirty=!1}saveU8Array(J,Q){var q={name:this.rominfo.name,id:this.rominfo.id,data:D5(Q)};n64js.setLocalStorageItem(J,q)}checkSIStatusConsistent(){this.siRegDevice.checkStatusConsistent()}}var XM=function(J,Q){if(typeof Q==="object"&&Q!==null){if(Q instanceof Map)return{_meta:{type:"map"},value:Array.from(Q.entries())};else if(Q instanceof Set)return{_meta:{type:"set"},value:Array.from(Q.values())};else if("_meta"in Q)return{...Q,_meta:{type:"escaped-meta",value:Q._meta}}}return Q},WM=function(J,Q){if(typeof Q==="object"&&Q!==null){if("_meta"in Q)if(Q._meta.type==="map")return new Map(Q.value);else if(Q._meta.type==="set")return new Set(Q.value);else if(Q._meta.type==="escaped-meta")return{...Q,_meta:Q._meta.value};else console.warn("Unexpected meta",Q._meta)}return Q},RZ=(J)=>JSON.stringify(J,XM),p7=(J)=>JSON.parse(J,WM);var m7=function(J){return J>>24&255|J>>8&65280|J<<8&16711680|J<<24&4278190080};function n7(J,Q){return B(m7(J),32)+B(m7(Q),32)}function o7(J){let Q=0;for(let q=0;q<4032;q++)Q=Q+J[64+q];switch(Q){case 211495:return"6101";case 213534:return"6101";case 213060:return"6102";case 219088:return"6103";case 293505:return"6105";case 225740:return"6106";case 213961:return"6106";default:return M("Unknown CIC Code "+j(Q)),"6102"}}function c7(J,Q,q){let Y="";for(let Z=0;Z<q;++Z){const K=J[Q+Z];if(K===0)break;Y+=String.fromCharCode(K)}return Y}var l7={"134c3f03a7e79e31":{name:"007 - The World is Not Enough",save:"Eeprom4k"},"9516943beb5e0af9":{name:"007 - The World is Not Enough",save:"Eeprom4k"},"61f1ba1ff1541c2c":{name:"1080 Snowboarding",save:"SRAM"},"253ffd588daa2ed9":{name:"1080 Snowboarding",save:"SRAM"},"091da5abd9ba68c6":{name:"40 Winks",save:"Eeprom4k"},d927f2df69814d0d:{name:"A Bug's Life"},fd04dc82f4822dcf:{name:"A Bug's Life"},c0ae382b10b85063:{name:"A Bug's Life"},"96c0128fe117dc45":{name:"A Bug's Life"},f18b591b459ba2ec:{name:"Aero Fighters Assault",save:"Eeprom4k"},"95bef662d6d602f1":{name:"Aero Fighters Assault",save:"Eeprom4k"},"3e46beae4b4671cc":{name:"AeroGauge",save:"Eeprom4k"},"3111f480f6454638":{name:"AeroGauge",save:"Eeprom4k"},c84530d8363a9df2:{name:"AeroGauge",save:"Eeprom4k"},a682c18cb0cad0c2:{name:"AI Shogi 3"},ccffc42d215affc8:{name:"Aidyn Chronicles - The First Mage",save:"SRAM"},"4f5aa9e623ead2ba":{name:"Aidyn Chronicles - The First Mage",save:"SRAM"},"0cb6456c300ee5dc":{name:"Airboarder 64",save:"Eeprom4k"},d025c427c1992d8c:{name:"Airboarder 64",save:"Eeprom4k"},"941a95b6af49c863":{name:"Akumajou Dracula Mokushiroku"},"063153a55b5ef2b9":{name:"Akumajou Dracula Mokushiroku Gaiden"},fc81607a787a8fff:{name:"Alice no Wakuwaku Trump World",save:"Eeprom4k"},ad84d7df036642ae:{name:"All Star Tennis '99",save:"Eeprom4k"},"91e285e16d76504e":{name:"All Star Tennis '99",save:"Eeprom4k"},"2907d2674c7796f6":{name:"All Star! Dairantou Smash Brothers"},"4d7a545e9507e690":{name:"All-Star Baseball 2000"},efc64654bb478ee1:{name:"All-Star Baseball 2001"},a7233ec41a68b140:{name:"All-Star Baseball 99"},"4dd5edd974e2b86b":{name:"All-Star Baseball 99"},"0290aeb967a3b6c1":{name:"Animal Forest",save:"Eeprom4k"},"17dbf6c032d5e080":{name:"Armorines - Project S.W.A.R.M."},"32d9b51f1b48a93b":{name:"Armorines - Project S.W.A.R.M."},"5071c73c87b9cd21":{name:"Armorines - Project S.W.A.R.M."},b2bb524c6b0fabce:{name:"Army Men - Air Combat"},"57062c866d89fd8d":{name:"Army Men - Sarge's Heroes"},"19df10b21a8db598":{name:"Army Men - Sarge's Heroes"},b6730fb234fc7529:{name:"Army Men - Sarge's Heroes 2"},abd8f7d146043b29:{name:"Asteroids Hyper 64"},c45db2418667721b:{name:"Automobili Lamborghini",save:"Eeprom4k"},bf9777fc3ce8954a:{name:"Automobili Lamborghini",save:"Eeprom4k"},"9ca440e3418d3174":{name:"Baku Bomberman",save:"Eeprom4k"},"4f7c3ce738b893af":{name:"Baku Bomberman 2",save:"Eeprom4k"},"5db998df78098458":{name:"Bakuretsu Muteki Bangaioh",save:"Eeprom4k"},"0a98cf88b52ed58e":{name:"Bakushou Jinsei 64 - Mezase! Resort Ou"},"20d568510dcd5fca":{name:"Banjo to Kazooie no Dai Bouken",save:"Eeprom4k"},"00694b518198b1b4":{name:"Banjo to Kazooie no Dai Bouken 2",save:"Eeprom16k"},ac5975cdaef56cb2:{name:"Banjo-Kazooie",save:"Eeprom4k"},"0693bfa4d1df0cbf":{name:"Banjo-Kazooie",save:"Eeprom4k"},b1cc3f73f9924844:{name:"Banjo-Kazooie",save:"Eeprom4k"},"9aaae9c2aa705d47":{name:"Banjo-Tooie",save:"Eeprom16k"},"396d17c9d17947ea":{name:"Banjo-Tooie",save:"Eeprom16k"},df7c5b152573daf0:{name:"Banjo-Tooie",save:"Eeprom16k"},b4fb88b01d4b1e44:{name:"Bass Hunter 64",save:"Eeprom4k"},caa237d15350b662:{name:"Bass Tsuri No. 1 (Shigesato Itoi's Bass Fishing)"},aaccfabcefd814b8:{name:"Bassmasters 2000"},c18944202bcf8612:{name:"Batman Beyond - Return of the Joker"},"847f9f2526ed9e7c":{name:"Batman Beyond - Return of the Joker"},e7dda46ae7f4e2e3:{name:"BattleTanx"},"47e2a4753d960860":{name:"BattleTanx - Global Assault"},e617ad0c97b7a571:{name:"BattleTanx - Global Assault"},cec4d4558ac75377:{name:"Battlezone - Rise of the Black Dogs"},"3d1c69914d5bacf4":{name:"Beast Wars Metals"},"16d3794d331b50e8":{name:"Beast Wars Transmetal"},a819f4edcc0419bf:{name:"Beetle Adventure Racing!"},d218739cc10dae24:{name:"Beetle Adventure Racing!"},"614ab6a10b9414d0":{name:"Beetle Adventure Racing!"},b7a4ff08b653f401:{name:"Big Mountain 2000",save:"Eeprom4k"},"95351208def11005":{name:"Bio F.R.E.A.K.S."},"1d107cabb0c858ec":{name:"Bio F.R.E.A.K.S."},"8824ae7e5aa3409d":{name:"Bio Hazard 2",save:"SRAM"},dbe6647cdb24b955:{name:"Blast Corps",save:"Eeprom4k"},"257c647ce601d9d9":{name:"Blast Corps (v1.0)",save:"Eeprom4k"},"657e647c05d34819":{name:"Blast Corps (v1.1)",save:"Eeprom4k"},"514423656f34d3eb":{name:"Blast Dozer",save:"Eeprom16k"},"128bd07c89ff5311":{name:"Blues Brothers 2000",save:"SRAM"},"83c871d5cf3f2d82":{name:"Blues Brothers 2000",save:"SRAM"},"6f692653c3999afe":{name:"Body Harvest",save:"Eeprom4k"},cdb8580bd291b2b7:{name:"Body Harvest",save:"Eeprom4k"},c651d4b3e258cbe1:{name:"Bokujo Monogatari 2"},f4f06fdf3842d129:{name:"Bomberman 64",save:"Eeprom4k"},"1ed568f51eba497e":{name:"Bomberman 64",save:"Eeprom4k"},"3603165ab0377bbc":{name:"Bomberman 64",save:"Eeprom4k"},b4737e23376b3bd6:{name:"Bomberman 64 - The Second Attack!",save:"Eeprom4k"},d6fd4644088278e3:{name:"Bomberman Hero",save:"Eeprom4k"},cc12ff671202bf76:{name:"Bomberman Hero",save:"Eeprom4k"},"294e5cd8af76e288":{name:"Bomberman Hero",save:"Eeprom4k"},"4dd12fd7c432ed1f":{name:"Bottom of the 9th"},"2ecf221e13c8aa42":{name:"Brunswick Circuit Pro Bowling"},"1a78ae855df056c7":{name:"Buck Bumble"},b662c7d742963df8:{name:"Buck Bumble"},"9c33b2d5edcabcca":{name:"Buck Bumble"},"73f0868a4be545cd":{name:"Bust-A-Move 2 - Arcade Edition"},"1ededcce02053a51":{name:"Bust-A-Move 2 - Arcade Edition"},fab428e3e1284a00:{name:"Bust-A-Move 3 DX"},"9fd8224237b6e0af":{name:"Bust-A-Move '99"},"0e4016ac1a075dcf":{name:"California Speed"},"4e2d0ff0f4aa0f34":{name:"Carmageddon 64"},ec620158f18b10e3:{name:"Carmageddon 64 (censored)"},f5018ee49b1fe5e6:{name:"Carmageddon 64 (uncensored)"},"47ffcd4b8fafa3aa":{name:"Castlevania v1.2"},"955f5df3693dfe8a":{name:"Castlevania"},cab7f1645537a271:{name:"Castlevania"},"3863c01c26893887":{name:"Castlevania - Legacy of Darkness"},e74bc5a2b2cb1967:{name:"Castlevania - Legacy of Darkness"},"3421cfdc7835d69d":{name:"Centre Court Tennis"},"5a53206462800250":{name:"Chameleon Twist",save:"Eeprom4k"},"21f5f2a48e16ebf0":{name:"Chameleon Twist",save:"Eeprom4k"},c68cafb99ff1c9de:{name:"Chameleon Twist",save:"Eeprom4k"},e48c53cdf9fc8a61:{name:"Chameleon Twist 2"},"5a76490542d0b993":{name:"Chameleon Twist 2"},"019da607a1417d9a":{name:"Chameleon Twist 2"},e8960e1e6b82284e:{name:"Charlie Blast's Territory"},d0483cfb9ff6288d:{name:"Charlie Blast's Territory"},"94ad4c21243b1abe":{name:"Chopper Attack",save:"Eeprom4k"},"3993352ea6eda53f":{name:"Chopper Attack",save:"Eeprom4k"},c4f9cc2b6f9f3d40:{name:"Choro Q 64",save:"Eeprom4k"},"540fcd26e0efeb53":{name:"Choro Q 64 II",save:"Eeprom4k"},"281594a79d19f161":{name:"Chou Snobow Kids"},f40f183af78a8e5c:{name:"Chou Kuukan Night Pro Yakyuu King 2",save:"Eeprom4k"},b09d00f82318296b:{name:"City-Tour GP - All Japan Grand Touring Car Champion"},ff3d5afab9cdc9b4:{name:"Clay Fighter - Sculptor's Cut"},ca243cf0cc7b23c5:{name:"Clay Fighter 63 1/3"},b392968e2abb6442:{name:"Clay Fighter 63 1/3"},c0a76f2b2512a709:{name:"Clay Fighter 63 1/3 (beta)"},ad5b02b5fd7526d3:{name:"Command & Conquer",save:"FlashRam"},b46e28958fd56ab7:{name:"Command & Conquer",save:"FlashRam"},"65945bae76654dc5":{name:"Command & Conquer",save:"FlashRam"},"50acc7302d070477":{name:"Conker's Bad Fur Day",save:"Eeprom16k"},"89583f370aa86c9a":{name:"Conker's Bad Fur Day",save:"Eeprom16k"},aff7a346d091750f:{name:"Cruis'n Exotica",save:"Eeprom4k"},"542540b304c04073":{name:"Cruis'n USA",save:"Eeprom4k"},"60a73e50960e30e1":{name:"Cruis'n USA",save:"Eeprom4k"},b42f2fff9a1461d1:{name:"Cruis'n USA (v1.0)",save:"Eeprom4k"},"45cf06535092c4cb":{name:"Cruis'n USA (v1.1)",save:"Eeprom4k"},"5311e6dfe61861d7":{name:"Cruis'n World",save:"Eeprom16k"},"1e93f3833d2272cb":{name:"Cruis'n World",save:"Eeprom16k"},"870bcb835754327e":{name:"Custom Robo",save:"Eeprom4k"},b9019507ab3202ab:{name:"Custom Robo V2",save:"Eeprom16k"},a18efce89183739f:{name:"CyberTiger"},"078aa7d13edda352":{name:"CyberTiger"},"45f48871680a4184":{name:"Dance Dance Revolution - Disney Dancing Museum"},"582ba5a441987523":{name:"Dark Rift"},d47cd67e6d5e41b4:{name:"Dark Rift"},"493336f51bd2f9db":{name:"Deadly Arts"},d9a9663f005bcb9b:{name:"Defi au Tetris Magique"},e167f6a51fbd1fda:{name:"Derby Stallion 64",save:"FlashRam"},"614ac517e7f2834a":{name:"Densha de GO! 64",save:"SRAM"},a284e5de8711160f:{name:"Destruction Derby 64"},"7da30a63dbd76b89":{name:"Destruction Derby 64"},"9c167989a0f689f1":{name:"Dezaemon 3D",save:"SRAM"},"725629d51570b59c":{name:"Diddy Kong CRACKED",save:"Eeprom4k"},"5aa389f362557817":{name:"Diddy Kong Racing",save:"Eeprom4k"},e740d45311b01975:{name:"Diddy Kong Racing (v1.0)",save:"Eeprom4k"},"75f773fd5a752497":{name:"Diddy Kong Racing (v1.0)",save:"Eeprom4k"},"0d4302e49dfcfcd2":{name:"Diddy Kong Racing (v1.1)",save:"Eeprom4k"},"5b146e599f87d9f7":{name:"Diddy Kong Racing (v1.1)",save:"Eeprom4k"},"1b426cc1f78015a2":{name:"Disney's Donald Duck - Goin' Quackers",save:"Eeprom4k"},"2313264c1a5e294f":{name:"Disney's Tarzan"},c769fecb2aabc0f2:{name:"Disney's Tarzan",save:"Eeprom4k"},d03b1a001adeb3af:{name:"Disney's Tarzan"},bfe514d6c1bc6da7:{name:"Disney's Tarzan",save:"Eeprom4k"},"6d208ebd1c5ec398":{name:"Doubutsu No Mori",save:"Eeprom4k"},"8074f13d5aed3d19":{name:"Donald Duck - Quack Attack"},bfea58ec69717cad:{name:"Donkey Kong 64",save:"Eeprom16k"},a7893c05024306a5:{name:"Donkey Kong 64",save:"Eeprom16k"},"8c6d9311434b2c6f":{name:"Donkey Kong 64",save:"Eeprom16k"},ababd40d1ea9a2b5:{name:"Donkey Kong 64 - Kiosk",save:"Eeprom16k"},"1a103ea89db637e9":{name:"Doom 64"},f4963e425bf088ce:{name:"Doom 64"},"365ba67aade5cefd":{name:"Doom 64"},ac9e732c2677f79e:{name:"Doom 64"},c2b1f7bf8e14bfae:{name:"Doraemon - Mittsu no Seireiseki",save:"Eeprom4k"},"996e30b6b2d23eb6":{name:"Doraemon 2 - Hikari no Shinden",save:"Eeprom16k"},"405127a8e856b0b9":{name:"Doraemon 3 - Nobi Dai No Machi SOS!",save:"Eeprom16k"},"134d9d76fe3f23da":{name:"Dr. Mario 64",save:"Eeprom4k"},a0ecde3fb29b9f39:{name:"Dragon Sword 64"},c33022a6884483f0:{name:"Dual Heroes"},"63ab6e05d5fc15c2":{name:"Dual Heroes"},"614452b6b1046ded":{name:"Dual Heroes"},faf1b9fb8986f86b:{name:"Duck Dodgers Starring Daffy Duck",save:"Eeprom4k"},"7ff0da0488e6180d":{name:"Duke Nukem - ZER0 H0UR"},"4b97ca32509cc2b2":{name:"Duke Nukem - ZER0 H0UR"},"6a6236dccb70373f":{name:"Duke Nukem - ZER0 H0UR"},"56ab73a29adb33da":{name:"Duke Nukem 64"},"3d88121e1827b9d3":{name:"Duke Nukem 64"},"4df7bf57437774de":{name:"Duke Nukem 64"},cfb6db349d7806ea:{name:"Earthworm Jim 3D Ru",save:"Eeprom4k"},"914157df3d12b59e":{name:"Earthworm Jim 3D",save:"Eeprom4k"},e89d2b491cc8ccc6:{name:"Earthworm Jim 3D",save:"Eeprom4k"},"6d76f9bd708d06bd":{name:"ECW Hardcore Revolution"},dbe5388cd7277cb3:{name:"ECW Hardcore Revolution"},cb53a6f23b3b6360:{name:"Elmo's Letter Adventure"},"8f53b102d0884bc9":{name:"Elmo's Number Journey"},dce23ae1e85cb64f:{name:"Eltale Monsters"},"421886079fbc2ea1":{name:"Excitebike 64",save:"Eeprom16k"},"19351c86e51c09f6":{name:"Excitebike 64",save:"Eeprom16k"},e48e2a20898bf883:{name:"Excitebike 64",save:"Eeprom16k"},"7b4f75af8173d11d":{name:"Excitebike 64 - Kiosk",save:"Eeprom16k"},d245a2fd473d4aa7:{name:"Extreme-G"},c42d80ee7dd50b69:{name:"Extreme-G"},"4e839d8ea9298b1e":{name:"Extreme-G"},"0b15d45cf1c20c47":{name:"Extreme-G XG2"},"819b9b3911ad33d5":{name:"Extreme-G XG2"},"85ec851131775a4b":{name:"Extreme-G XG2"},"7a6882ae8d383f9a":{name:"F-1 Pole Position 64"},b248d2fd0e029a56:{name:"F-1 Pole Position 64"},b8bcec3c07bf2661:{name:"F1 Racing Championship"},"3426443860f0b366":{name:"F-1 World Grand Prix",save:"Eeprom4k"},b3c83ccca405c40e:{name:"F-1 World Grand Prix",save:"Eeprom4k"},e5ae0bb7a805503a:{name:"F-1 World Grand Prix",save:"Eeprom4k"},c447bf64ba22bdf4:{name:"F-1 World Grand Prix",save:"Eeprom4k"},"6e86c107decc7557":{name:"F-1 World Grand Prix II",save:"Eeprom16k"},"374cff6dfd63b7b1":{name:"Famista 64"},"4f47294f7a70cb30":{name:"F-Cup Maniax"},decd1acbf21d29cf:{name:"FIFA - Road to World Cup 98"},"673c73f53a97a317":{name:"FIFA - Road to World Cup 98"},f0ed310ed54972c3:{name:"FIFA - Road to World Cup 98"},"30a61376f396d63e":{name:"FIFA 99"},"51a69801849d21fc":{name:"FIFA 99"},"5991f1c35abcd265":{name:"FIFA Soccer 64"},"70e594fe9c3a87e4":{name:"Fighter's Destiny",save:"Eeprom4k"},"0588f752b7ca8f8b":{name:"Fighter's Destiny",save:"Eeprom4k"},c2f9410c0d7a7101:{name:"Fighter's Destiny",save:"Eeprom4k"},"4bc7f136399902f2":{name:"Fighter's Destiny",save:"Eeprom4k"},"452fefaef1307ef9":{name:"Fighter's Destiny 2",save:"Eeprom4k"},"2d6ce4490c111a7b":{name:"Fighting Cup"},cbc7ef32203feac3:{name:"Fighting Force 64"},fe0fcf669c7f69ad:{name:"Fighting Force 64"},"2d56d52850aed5e4":{name:"Fire Electric Pen",save:"Eeprom4k"},e5522da955b6261d:{name:"Flying Dragon"},"3f62e922ad520eb6":{name:"Flying Dragon"},"1a8fff35bee3796e":{name:"Flying Dragon Fighters (Hiro no Ken Twin)"},"79b1e5e8e830aa44":{name:"Frogger 2 (Alpha)"},ff76cdc3decb9d9b:{name:"Forsaken"},"010c339eba14038c":{name:"Forsaken"},aa172a14968d0213:{name:"Forsaken"},"79d4613225bc0ded":{name:"Fox Sports College Hoops '99"},eeea74f73eb1d8f0:{name:"Fushigi no Dungeon - Furai no Shiren 2",save:"FlashRam"},a9d183398c150420:{name:"F-Zero DXP",save:"SRAM"},"78d90eb3f9c90330":{name:"F-Zero X",save:"SRAM"},"2e623e4d4e8b829b":{name:"F-Zero X",save:"SRAM"},f64666772bacb906:{name:"F-Zero X",save:"SRAM"},b67986afbf11105e:{name:"G.A.S.P! Fighter's NEXTream",save:"Eeprom16k"},"26f7fc68bc8c6549":{name:"G.A.S.P! Fighter's NEXTream",save:"Eeprom16k"},"8b162c83aecda256":{name:"Ganbare Goemon"},d99c7b455253c509:{name:"Ganbare Goemon 2 - Deoru Dero Douchuu Obake Tenko"},"0afdff21981d0dfa":{name:"Ganbare Nippon Olympics 2000"},"325e9b7280d928b7":{name:"Gauntlet Legends"},"0e26b0704cd01667":{name:"Gauntlet Legends"},d6bc43d556e2a52b:{name:"Gauntlet Legends"},e6849c48f9496e4c:{name:"Getter Love!! Cho Renai Party Game"},"127edc3ec91c6ce2":{name:"Gex 3 - Deep Cover Gecko"},"59931799c3ebe72f":{name:"Gex 3 - Deep Cover Gecko"},a43347875a7423a8:{name:"Gex 3 - Deep Cover Gecko"},"74d7fe891be2afca":{name:"Gex 64 - Enter the Gecko"},"0e008ae6dd669163":{name:"Gex 64 - Enter the Gecko"},ff016e8e48f9b4cc:{name:"Glover",save:"Eeprom4k"},"017323f593eee399":{name:"Glover",save:"Eeprom4k"},"7fd2c6b2fd8ca42d":{name:"Goemon Mononoke Sugoroku"},ada552424ebf6fae:{name:"Goemon's Great Adventure"},"1cfb9046446dd54c":{name:"Golden Nugget 64"},d150bcdca31afd09:{name:"GoldenEye 007",save:"Eeprom4k"},f14c4fa2ba2723a8:{name:"GoldenEye 007",save:"Eeprom4k"},"61ca1404aab8572e":{name:"GoldenEye 007",save:"Eeprom4k"},a2dc9ac4621b50f1:{name:"GT 64 Championship Edition",save:"Eeprom4k"},"330e4aeec988d58f":{name:"GT 64 Championship Edition",save:"Eeprom4k"},"1401a8957f2ab7e0":{name:"Hamster Monogatari 64",save:"Eeprom4k"},bf2ff236f2128931:{name:"Hanafuda 64 - Tenshi no Yakusoku"},b157ae0937562a18:{name:"Harukanaru Augusta Masters 98",save:"Eeprom4k"},fc9ddf9889c10666:{name:"Harvest Moon 64",save:"SRAM"},"66e8703ee8ba3844":{name:"Heiwa Pachinko World",save:"Eeprom4k"},"77eb3c7f0a038189":{name:"Hercules - The Legendary Journeys"},ebdb90ae2391b879:{name:"Hercules - The Legendary Journeys"},"0ab5b39a056166bc":{name:"Hexen"},bd5f1b5c3416967e:{name:"Hexen"},ea6aab9c001cc687:{name:"Hexen"},"571a75666e9da254":{name:"Hexen"},"0bb3b295c115642b":{name:"Hexen"},"5d0ef1d379a52e05":{name:"Hey You, Pikachu!",save:"Eeprom4k"},"140efa7505d1b3c9":{name:"Holy Magic Century"},b0eb5fb304b22774:{name:"Holy Magic Century"},"9d127b27ff7938dd":{name:"Holy Magic Century"},bd02d7c14765416d:{name:"Hoshi no Kirby 64",save:"Eeprom4k"},"8e8fc9c7de5d1442":{name:"Hot Wheels Turbo Racing"},"9301d2e7938e15c1":{name:"Hot Wheels Turbo Racing"},"7d1d6172d2bd1999":{name:"HSV Adventure Racing"},"2e97355595328ebd":{name:"Human Grand Prix"},"6ac9dbe8eee2c9da":{name:"Hybrid Heaven"},bf882810ca884843:{name:"Hybrid Heaven"},"36cee20de6291dd4":{name:"Hybrid Heaven"},"7f3a1d6466048286":{name:"Hybrid Heaven"},eb65dcc804898c3d:{name:"Hydro Thunder"},e98889b5e84bfcb1:{name:"Hydro Thunder"},"9e8b456936f995fc":{name:"Iggy-kun no Bura Bura Poyon"},bcb516e6888b65c9:{name:"Iggy's Reckin' Balls"},"5ecc92d672d058ec":{name:"Iggy's Reckin' Balls"},"15cc9daf883d721a":{name:"Indiana Jones and the Infernal Machine",save:"Eeprom4k"},"7a4636e49b8fde82":{name:"Indy Racing 2000",save:"Eeprom4k"},e08b138c460e7095:{name:"In-Fisherman Bass Hunter 64",save:"Eeprom4k"},"3754838eb44857cd":{name:"International Superstar Soccer 2000"},a0646333bfd5c806:{name:"International Superstar Soccer 2000"},"71e8e8ba4e94ff35":{name:"International Superstar Soccer 2000"},c463275fe52a4162:{name:"International Superstar Soccer 64"},f07cd3e2ae4e7ef5:{name:"International Superstar Soccer 64"},"43631bf4e66106c1":{name:"International Superstar Soccer 98"},"09da0f7f0bce6160":{name:"International Superstar Soccer '98"},c73b072011013b5e:{name:"International Track and Field 2000"},"79c712671d78723b":{name:"International Track and Field Summer Games"},"476776876571c291":{name:"J. League Dynamite Soccer"},aa0acec619f017d1:{name:"J. League Tactics Soccer (1.1)"},"29a4bf4f15bb2069":{name:"J. League Eleven Beat 1997"},"424a5554fb5f98e4":{name:"J. League Live 64"},a09dd2e8941de615:{name:"J. League Tactics Soccer"},"16d03ac77d53c548":{name:"Jangou Simulation Mahjong Do 64"},"6064256986f5a3b9":{name:"Jeopardy!"},a5b130bbce12f7fc:{name:"Jeremy McGrath Supercross 2000"},fbabf721e8a78a6a:{name:"Jeremy McGrath Supercross 2000"},b609608a50e1ac94:{name:"Jet Force Gemini",save:"FlashRam"},dea1d7684a837900:{name:"Jet Force Gemini",save:"FlashRam"},"47abd8df89ebdb3c":{name:"Jet Force Gemini - Kiosk",save:"FlashRam"},f5d919afcc2302b7:{name:"Jikkyou G1 Stable"},"532a11638fa89fa2":{name:"Jikkyou J. League 1999 - Perfect Striker 2"},"66436c14b3dea672":{name:"Jikkyou J. League Perfect Striker"},"1c1f89d78837e4c3":{name:"Jikkyou Pawafuru Puroyakyu 4 (1.1)"},d144c20a05c60e1f:{name:"Jikkyou Pawapuro Puroyakyu 2000"},"23df6442f7bd28be":{name:"Jikkyou Pawapuro Puroyakyu 2000"},"2056ea3f40db5674":{name:"Jikkyou World Cup France '98"},"8cb354c9b3be626f":{name:"Jikkyou World Cup France '98"},d6abc7e1287f704e:{name:"Jikkyou World Cup France '98"},"8c9fa7e0fa97cc32":{name:"Jikkyou World Soccer 3"},edf6aa4aad286437:{name:"Jinsei Game 64"},b01a15d04ba15cfe:{name:"John Romero's Daikatana"},"4b3c7e9d6c4a0fe6":{name:"John Romero's Daikatana"},"9531740f95dba6d8":{name:"John Romero's Daikatana"},"231f2836cf569700":{name:"Ken Griffey Jr.'s Slugfest",save:"FlashRam"},"3e269b97040047f8":{name:"Killer Instinct Gold",save:"Eeprom4k"},bae28f9e7007278b:{name:"Killer Instinct Gold (v1.0)",save:"Eeprom4k"},facd8f9e2b65f549:{name:"Killer Instinct Gold (v1.0)",save:"Eeprom4k"},"4cca08f927434636":{name:"Killer Instinct Gold (v1.2)",save:"Eeprom4k"},e1a49e51e88475eb:{name:"King Hill 64 - Extreme Snowboarding"},d66abc75c92b5578:{name:"Kiratto Kaiketsu! 64 Tanteidan"},b49f03462c823703:{name:"Kirby 64 - The Crystal Shards",save:"Eeprom4k"},"11ba930da6683868":{name:"Kirby 64 - The Crystal Shards",save:"Eeprom4k"},"6fb81bcac5a5cc41":{name:"Kirby 64 - The Crystal Shards (1.1)",save:"Eeprom4k"},"7a1c580ce4206e3d":{name:"Kirby 64 - The Crystal Shards (1.2)",save:"Eeprom4k"},"9ff8b1bca2520706":{name:"Kirby 64 - The Crystal Shards (1.3)",save:"Eeprom4k"},"99d7e0fc546c3165":{name:"Knife Edge - Nose Gunner"},"3fef1a93906b19ef":{name:"Knife Edge - Nose Gunner"},"747c994a997f08e2":{name:"Knife Edge - Nose Gunner"},"9c9094082dd8d4da":{name:"Knockout Kings 2000"},"95a7d6e33c5d1c2a":{name:"Knockout Kings 2000"},"94846b611092508a":{name:"Kobe Bryant's NBA Courtside",save:"Eeprom16k"},baef3917683ab4d0:{name:"Kobe Bryant's NBA Courtside",save:"Eeprom16k"},e8603e5e95d4b54a:{name:"Kuiki Uhabi Suigo"},"9940307f7652cf52":{name:"Last Legion UX",save:"Eeprom4k"},ea406a09100abe8a:{name:"LEGO Racers"},b3d878f46ddd1697:{name:"LEGO Racers"},"2bc6673d5031d031":{name:"Let's Smash Tennis"},df1850253aaed657:{name:"Lode Runner 3-D",save:"Eeprom4k"},"0bdd4a96db1392b2":{name:"Lode Runner 3-D",save:"Eeprom4k"},"80064660720e5f30":{name:"Lode Runner 3-D",save:"Eeprom4k"},"5b05a00a65df3776":{name:"Looney Tunes - Duck Dodgers",save:"Eeprom4k"},"2ce9cbf412ed92b3":{name:"Lylat Wars",save:"Eeprom4k"},"2bf283245e026e13":{name:"Lylat Wars",save:"Eeprom4k"},"5007706bfe21d629":{name:"Mace - The Dark Age"},"3d444511db0e6111":{name:"Mace - The Dark Age"},"8616b80c815ad85f":{name:"Madden 2000"},"89638313763c5b26":{name:"Madden Football 64"},"52cb97a10ede2075":{name:"Madden Football 64"},"8d4f13d7b5001ac1":{name:"Madden NFL 2002",save:"Eeprom16k"},"92f738eb46a20e19":{name:"Madden NFL 2001"},ba8bb7de9dbdf652:{name:"Madden NFL 99"},"25d625395ec7838c":{name:"Madden NFL 99"},f793efe10b8b9014:{name:"Magical Tetris Challenge"},"4716b67578bfda7a":{name:"Magical Tetris Challenge"},"4a56c880ab659c92":{name:"Magical Tetris Challenge"},"796690e4053f249f":{name:"Magical Tetris Challenge"},"41dc3ec55993e1ec":{name:"Mahjong 64"},"1e82cccc838ae896":{name:"Mahjong Hourouki Classic"},"702cc40fcdf15487":{name:"Mahjong Master"},"5cc0c180f45e06ea":{name:"Major League Baseball Featuring Ken Griffey Jr.",save:"SRAM"},be98b9cdc8a52410:{name:"Major League Baseball Featuring Ken Griffey Jr.",save:"SRAM"},d4a34b66b7808a67:{name:"Mario Golf 64",save:"SRAM"},d14489d40e3ad9b0:{name:"Mario Golf 64",save:"SRAM"},d057e9625d5ac17f:{name:"Mario Golf 64",save:"SRAM"},b655503e52da922e:{name:"Mario Kart 64",save:"Eeprom4k"},"5847ff6b5e5dffe5":{name:"Mario Kart 64 (v1.0)",save:"Eeprom4k"},"9ddeb6c376ded265":{name:"Mario Kart 64 (v1.0)",save:"Eeprom4k"},"87a9c3c94c341058":{name:"Mario Kart 64 (v1.1)",save:"Eeprom4k"},d4c77725aeaa8fd1:{name:"Mario Kart 64 (v1.1)",save:"Eeprom4k"},ac90989adf13c3f0:{name:"Mario No Photopie"},"7e652928771862a0":{name:"Mario Party",save:"Eeprom4k"},be15a8ad2f622860:{name:"Mario Party",save:"Eeprom4k"},"6930669c804af280":{name:"Mario Party",save:"Eeprom4k"},"5858a99e18b672af":{name:"Mario Party 2",save:"Eeprom4k"},"0f7d56ed1589b038":{name:"Mario Party 2",save:"Eeprom4k"},"87033882d944c7df":{name:"Mario Party 2",save:"Eeprom4k"},d929387cce47826e:{name:"Mario Party 3",save:"Eeprom16k"},cdb40a0b3789157b:{name:"Mario Party 3",save:"Eeprom16k"},"604167c53c455f0f":{name:"Mario Party 3",save:"Eeprom16k"},dccda73ba0524e46:{name:"Mario Story",save:"FlashRam"},"4fcf0150bdb30cf3":{name:"Mario Tennis",save:"Eeprom16k"},b5426c3a1bdaca1a:{name:"Mario Tennis",save:"Eeprom16k"},d53a9f83fa156d40:{name:"Mario Tennis",save:"Eeprom16k"},f558c10e96683efb:{name:"Mega Man 64",save:"FlashRam"},"0cf10110c1d8513d":{name:"Mia Hamm Soccer 64"},c26661e3e5a21386:{name:"Michael Owens WLS 2000"},"71458cfac0f9e7bb":{name:"Mickey's Speedway USA",save:"Eeprom4k"},"9addd0dea72582e7":{name:"Mickey's Speedway USA",save:"Eeprom4k"},afe66a73c7e91741:{name:"Mickey no Racing Challenge USA",save:"Eeprom4k"},"350c85f11279e0ac":{name:"Micro Machines 64 Turbo"},"8d01492a024a03d0":{name:"Micro Machines 64 Turbo"},"4c5eb3e4c95cc41a":{name:"Midway's Greatest Arcade Hits Volume 1"},"163ed509b968b23a":{name:"Mike Piazza's Strike Zone"},cd5e952e840800f3:{name:"Milo's Astro Lanes"},"9d0d499adc3a018f":{name:"Milo's Astro Lanes"},"1b05930bf9813d60":{name:"Mischief Makers",save:"Eeprom4k"},"98da8b41580f8a24":{name:"Mischief Makers",save:"Eeprom4k"},"7e3feb93445e6781":{name:"Mission Impossible",save:"Eeprom4k"},f85c032635912b80:{name:"Mission Impossible",save:"Eeprom4k"},"345b0920879e3d34":{name:"Mission Impossible",save:"Eeprom4k"},dc49a9ebbdecba39:{name:"Mission Impossible",save:"Eeprom4k"},daec56229c1bab71:{name:"Mission Impossible",save:"Eeprom4k"},e2046a5f0d07fad4:{name:"Mission Impossible",save:"Eeprom4k"},"6d8d76286c9779b3":{name:"Monaco Grand Prix",save:"Eeprom4k"},e183c35a87e312d7:{name:"Monopoly",save:"Eeprom4k"},"99d99ab11851587e":{name:"Monster Truck Madness 64"},fc06d8d3a8a23ab4:{name:"Monster Truck Madness 64"},"70dde8e898d15d41":{name:"Morita Shogi 64",save:"Eeprom4k"},f4d47d41e22f481b:{name:"Mortal Kombat 4",save:"Eeprom4k"},"3b6f0373e9690dce":{name:"Mortal Kombat 4",save:"Eeprom4k"},ac0443c321c0792d:{name:"Mortal Kombat Mythologies - Sub-Zero"},c4ed44ff1392ae1a:{name:"Mortal Kombat Mythologies - Sub-Zero"},"125cf7d9599b85a8":{name:"Mortal Kombat Trilogy"},"92113d8ce172f1be":{name:"Mortal Kombat Trilogy"},a93af3830dd401a9:{name:"Mortal Kombat Trilogy (v1.2)"},"5cb6f92ad7a2e285":{name:"MRC - Multi Racing Championship",save:"Eeprom4k"},"13b4b6a6cc13d115":{name:"MRC - Multi Racing Championship",save:"Eeprom4k"},"03bdf0b89e187944":{name:"MRC - Multi Racing Championship",save:"Eeprom4k"},"5c52381956966e58":{name:"Ms. Pac-Man Maze Madness"},"21cbbcfc6b3c9072":{name:"Mystical Ninja - Starring Goemon"},be0f36f51d69f12b:{name:"Mystical Ninja - Starring Goemon"},d345937fdeca1e84:{name:"Mystical Ninja 2 - Starring Goemon"},"8725c27e23e31aef":{name:"Nagano Olympic Hockey '98"},"3730f490f570535c":{name:"Nagano Olympic Hockey '98"},"353a2dae1ad4f024":{name:"Nagano Olympic Hockey '98"},"98ae2b8dbf2537d7":{name:"Nagano Winter Olympics '98"},"4cc3c52f9dcc057a":{name:"Nagano Winter Olympics '98"},"1620456dee093c71":{name:"Nagano Winter Olympics '98"},dab629518c3cef9d:{name:"Namco Museum 64"},"181a33df44e0d45f":{name:"NASCAR 2000"},"78957423fd58dc80":{name:"NASCAR 99"},"49140000c99249ae":{name:"NASCAR 99"},c99249ae53b25392:{name:"NASCAR 99"},"57ebf724f4f9b374":{name:"NBA Courtside 2 - Featuring Kobe Bryant",save:"FlashRam"},d8526891efeadb73:{name:"NBA Courtside 2 - Featuring Kobe Bryant",save:"FlashRam"},"87b4694e90e218fe":{name:"NBA Hangtime"},aedc88c70a0003bd:{name:"NBA Hangtime"},"011fe1aa45a02526":{name:"NBA In the Zone 2000"},"185bf98d7b49daec":{name:"NBA In the Zone 2000"},"9f4f05b3b59eb696":{name:"NBA In the Zone 2000"},"3019126a74c25c66":{name:"NBA In the Zone '98"},"9bbaac36944d8df2":{name:"NBA In the Zone '98"},"4f5292a2492a6c3d":{name:"NBA In the Zone '99"},dba8eeeb3cb2ecf2:{name:"NBA Jam 2000"},a0cad0b6c893f4e3:{name:"NBA Jam 2000"},f6290781c1cf3fe0:{name:"NBA Jam 99"},"1e8300e6a822f459":{name:"NBA Jam 99"},eeb0255fdbc12762:{name:"NBA Live 2000"},"8f9c49ebb66745cd":{name:"NBA Live 2000"},"9b1cf85735fa3311":{name:"NBA Live 99"},"5ff484cfebf6e400":{name:"NBA Live 99"},"2f96deac7ff8cbb2":{name:"NBA Pro 98"},b680178d76b9b357:{name:"NBA Pro 99"},f480fe3f7e5fc1a7:{name:"NBA Showtime - NBA on NBC"},db0e7e142cb1c536:{name:"Neon Genesis Evangelion",save:"Eeprom16k"},"4fd5ea30f60b6231":{name:"NFL Blitz - Special Edition"},"70b194d0ccb5c4d7":{name:"NFL Blitz"},"6909a01585a2e534":{name:"NFL Blitz 2000"},eb35fa36362e5ee8:{name:"NFL Blitz 2001"},d04eabe3d20d0483:{name:"NFL Quarterback Club 2000"},"9e5abd88bfdf1fe8":{name:"NFL Quarterback Club 2000"},"224678288529b2ff":{name:"NFL Quarterback Club 2001"},f8e29bd8df7ac999:{name:"NFL Quarterback Club 98"},f49e624b9b1db299:{name:"NFL Quarterback Club 98"},ffed76be092d4520:{name:"NFL Quarterback Club 99"},"47cfa352fc3bc14e":{name:"NFL Quarterback Club 99"},"6e801a591d92e6a5":{name:"NHL 99"},"1e607d28aef8f4ab":{name:"NHL 99"},"30dcef8261246a80":{name:"NHL Blades of Steel '99"},c3cdfd6dc801e74d:{name:"NHL Breakaway 98"},"9276ce297985c571":{name:"NHL Breakaway 98"},d06817444ff2737d:{name:"NHL Breakaway 99"},cb21468727c13100:{name:"NHL Breakaway 99"},d95c89a96c012070:{name:"NHL Pro 99"},"4d675728da3743cc":{name:"Nightmare Creatures"},df3c3ccdfa937731:{name:"Nintama Rantarou 64"},"45b8508f2fd229d7":{name:"Nuclear Strike 64"},bbdd9849bcaeb7f7:{name:"Nuclear Strike 64"},"97a1978ac1f62d27":{name:"Nuclear Strike 64"},"20b93bd8166440cc":{name:"Nushi Zuri 64"},"18169b5b49c6431b":{name:"Nushi Tsuri 64 - Shiokaze ni Notte"},ec939031ef09c20f:{name:"Off Road Challenge"},d08922819632e5c2:{name:"Off Road Challenge"},c59b41e6e31d0169:{name:"Ogre Battle 64 - Person of Lordly Caliber",save:"SRAM"},"67cf7503aa3fa956":{name:"Ogre Battle 64 - Person of Lordly Caliber (v1.1)",save:"SRAM"},"6910969c8d48eaf5":{name:"Ohzumou 64",save:"Eeprom4k"},"168bc185af2296df":{name:"Ohzumou 64 2",save:"Eeprom4k"},"669464dcd9f02f57":{name:"Onegai Monsters"},"3b4b5574b5bcaef4":{name:"Pachinko 365 Nichi"},"3ae5ee653c737ded":{name:"Paper Mario",save:"FlashRam"},af29ab1928cd1bc7:{name:"Paper Mario",save:"FlashRam"},"129b52893bed5308":{name:"Paperboy"},"9e8d193e7e26e1f2":{name:"Paperboy"},"386b97ac7ac9a9c3":{name:"Paperboy"},"31cbe2cf1d1e6b4d":{name:"Parlor! Pro 64 Pachinko Jikki Simulation Game"},"6647dd6ea89b3ea9":{name:"Pawapuro Puroyakyu 2001"},ad5b4934269d2e50:{name:"Pawapuro Puroyakyu 4"},da4329d2c0772bac:{name:"Pawapuro Puroyakyu 5"},b7205eb7fdfdfeb3:{name:"Pawapuro Puroyakyu 6"},"8c1168f44ee42ee3":{name:"PD Ultraman Battle Collection 64",save:"Eeprom16k"},fbb1ab739360ca9c:{name:"Penny Racers",save:"Eeprom4k"},"83eb3cc81962c5fd":{name:"Penny Racers",save:"Eeprom4k"},b47e749643b24b10:{name:"Perfect Dark",save:"Eeprom16k"},"0780b0e433ff02a6":{name:"Perfect Dark",save:"Eeprom16k"},cc60f4ddc034a63c:{name:"Perfect Dark (v1.0)",save:"Eeprom16k"},"8fb9f24166b458b4":{name:"Perfect Dark (v1.1)",save:"Eeprom16k"},"81e84cb52661cbbc":{name:"PGA European Tour",save:"Eeprom4k"},"02c608eea6d5c26b":{name:"PGA European Tour",save:"Eeprom4k"},"0553243faa740bfc":{name:"Pikachu Genki Dechu"},"1c9651c8faaafc78":{name:"Pilot Wings 64",save:"Eeprom4k"},"0148cc0991e42ee4":{name:"Pilot Wings 64",save:"Eeprom4k"},d55aa01a802df546:{name:"Pilot Wings 64",save:"Eeprom4k"},"0d690fec8c43a732":{name:"Pocket Monsters Snap",save:"FlashRam"},"59825e661dbd98d0":{name:"Pocket Monsters Stadium",save:"FlashRam"},"865877637b0eb85f":{name:"Pocket Monsters Stadium 2",save:"FlashRam"},ac47477a23ecee44:{name:"Pokemon Puzzle League",save:"FlashRam"},a753c519524b0fa7:{name:"Pokemon Puzzle League",save:"FlashRam"},f3e6b23efe9e2f06:{name:"Pokemon Puzzle League",save:"FlashRam"},"53d11c4af8ae30d8":{name:"Pokemon Puzzle League",save:"FlashRam"},"6f97f54fd859f5ac":{name:"Pokemon Snap",save:"FlashRam"},"6a287d81167441ef":{name:"Pokemon Snap",save:"FlashRam"},"0d7253574d888a2a":{name:"Pokemon Snap",save:"FlashRam"},"47b512cae44efa71":{name:"Pokemon Snap",save:"FlashRam"},"3a296cba38a3af9f":{name:"Pokemon Snap",save:"FlashRam"},"4650c8c0051b0561":{name:"Pokemon Snap",save:"FlashRam"},"408db17b59851383":{name:"Pokemon Snap",save:"FlashRam"},"729811399f2e7207":{name:"Pokemon Snap Station",save:"FlashRam"},"432d121a0faf7dc1":{name:"Pokemon Stadium - Kiosk",save:"FlashRam"},"2da83fa55dc1e2da":{name:"Pokemon Stadium",save:"FlashRam"},"5de0c991b9af3aad":{name:"Pokemon Stadium",save:"FlashRam"},"1b1e0142b52d55e3":{name:"Pokemon Stadium",save:"FlashRam"},b3d9f590f0dc0e9d:{name:"Pokemon Stadium",save:"FlashRam"},a35335a2392dbf42:{name:"Pokemon Stadium",save:"FlashRam"},"757207849c5b3157":{name:"Pokemon Stadium",save:"FlashRam"},ce49e5b6c03481dc:{name:"Pokemon Stadium",save:"FlashRam"},"821157036dd02f89":{name:"Pokemon Stadium 2",save:"FlashRam"},c7a55aacc3cdb0a9:{name:"Pokemon Stadium 2",save:"FlashRam"},"727e9b435d49a1c1":{name:"Pokemon Stadium 2",save:"FlashRam"},"0bfca1d04b07b82f":{name:"Pokemon Stadium 2",save:"FlashRam"},"00afceef48480922":{name:"Pokemon Stadium 2",save:"FlashRam"},"5bfca1d04b07b82f":{name:"Pokemon Stadium 2",save:"FlashRam"},"9c365229a8c3e4b6":{name:"Pokemon Stadium 2",save:"FlashRam"},c2d74fee38d9f19c:{name:"Pokemon Stadium GS",save:"FlashRam"},"9207384145e067a1":{name:"Polaris Sno Cross"},fadca6d7b7b6fecc:{name:"Power League Baseball 64"},ad5789cfa97ed596:{name:"Power Rangers - Lightspeed Rescue"},"110cf6397dba2eab":{name:"Power Rangers - Lightspeed Rescue"},"75d474fcab78029a":{name:"Powerpuff Girls - Chemical X-Traction",save:"Eeprom4k"},"547fd2f3f9ac11c1":{name:"Premier Manager 64"},"4e0ca19bd3ab0804":{name:"Pro Mahjong Kiwame 64"},"0fb3dc1b76d832a1":{name:"Pro Mahjong Tsuwamono 64"},"8366ce8a6e42ba3f":{name:"Pro Yak Yu King Baseball"},b972464be75dbe2d:{name:"Puyo Puyo 4 - Puyo Puyo Party",save:"Eeprom4k"},"6b7e8094e462cc60":{name:"Puyo Puyo Sun 64",save:"Eeprom4k"},"4707dec0d372dfa2":{name:"Puzzle Bobble 64"},"9cf75b9fa008fed2":{name:"Quake 64"},"741d9316346ddc65":{name:"Quake 64"},"43f1a8bd622dafb1":{name:"Quake II"},d7d93374d022432c:{name:"Quake II"},d94dbbc80b435fcc:{name:"Quest 64"},a55f70280e6909b5:{name:"Racing Simulation - Monaco Grand Prix",save:"Eeprom4k"},"2dac77289a13dcc3":{name:"Racing Simulation 2"},f0ca1e9f0e8ac4ee:{name:"Rakuga Kids"},"6818d267614042c5":{name:"Rakuga Kids"},"0cbad935865548df":{name:"Rally '99"},"3d8ea87371c5c53a":{name:"Rally Challenge 2000",save:"Eeprom4k"},e4f99fc27dfe4b26:{name:"Rampage - World Tour"},"4844d484b019ca67":{name:"Rampage - World Tour"},"9b093d67de08c8a4":{name:"Rampage 2 - Universal Tour"},"4942fc5d079c5299":{name:"Rampage 2 - Universal Tour"},"8ec40403b80140ac":{name:"Rat Attack"},f10bfd20871dcff5:{name:"Rat Attack"},"9bbfc5f3e2330f16":{name:"Rayman 2 - The Great Escape"},"0be1d56046eded8b":{name:"Rayman 2 - The Great Escape"},"4a831839290cb515":{name:"Razor Freestyle Scooter"},"29b4b7ea572cc9ba":{name:"Ready 2 Rumble Boxing"},"34a3d48b058b131e":{name:"Ready 2 Rumble Boxing"},"339521e9bdaffb13":{name:"Ready 2 Rumble Boxing Round 2"},a5b118aaeb6adb07:{name:"Resident Evil 2",save:"SRAM"},"8e0e509bb35005e9":{name:"Resident Evil 2",save:"SRAM"},"87a91f0fa6afc1bf":{name:"Re-Volt"},"9ee2e7c3cc51725d":{name:"Re-Volt"},"6c7450f00b827b24":{name:"Road Rash 64"},"6a36d8029cefab6c":{name:"Road Rash 64"},db4d6b0b82e67196:{name:"Roadsters"},"707ae874d4ae9362":{name:"Roadsters"},d3a5bc747e5f944a:{name:"Roadsters Trophy"},"0f692b27777a0aad":{name:"Robot Ponkottsu 64 - Caramel of the 7 Seas",save:"Eeprom4k"},"93b8a075b521a34c":{name:"Robotech - Crystal Dreams"},"324b8eac2673b4e7":{name:"Robotron 64"},"4f9df69f59005f19":{name:"Robotron 64"},f875d39fc82df345:{name:"Rocket - Robot on Wheels",save:"Eeprom4k"},"85e05e0c3edd67a1":{name:"Rocket - Robot on Wheels",save:"Eeprom4k"},"3b5966d6075ca2d7":{name:"Rockman Dash",save:"FlashRam"},"7e260025cec37e2a":{name:"RR64 - Ridge Racer 64",save:"Eeprom16k"},"1070e9fea0a9944e":{name:"RR64 - Ridge Racer 64",save:"Eeprom16k"},"378f8f658dd21318":{name:"RTL World League Soccer 2000"},c5b3020cb811259e:{name:"Rugrats - Scavenger Hunt"},dadf3a4daefc9875:{name:"Rugrats - Treasure Hunt"},"0fca1a458abc6378":{name:"Rugrats - Treasure Hunt"},b46c692bd8dc937b:{name:"Rugrats - Treasure Hunt"},"3215c21fd466640b":{name:"Rugrats in Paris - The Movie"},"391dc60aa603faab":{name:"Rugrats in Paris - The Movie"},"31e0d6ed13601368":{name:"Rush 2 - Extreme Racing USA"},"3621cfb715a70afa":{name:"Rush 2 - Extreme Racing USA"},f34791760ec13320:{name:"S.C.A.R.S."},"602d8e913e6865f8":{name:"S.C.A.R.S."},"20186b2a66f4bc6a":{name:"San Francisco Rush - Extreme Racing"},b016d1610cd624fa:{name:"San Francisco Rush - Extreme Racing"},a2eca9b98ee4aa17:{name:"San Francisco Rush 2049"},"1894d251e36ab4d5":{name:"San Francisco Rush 2049"},c44e810ca85cfe58:{name:"Scooby-Doo - Classic Creep Capers"},"1d22bde3d334083c":{name:"Scooby-Doo - Classic Creep Capers"},b7f6f5eb39d756c9:{name:"SD Hiryuu no Ken Densetsu"},"75fdd584df3cfdbb":{name:"Shadow Man"},b560473a10d4742d:{name:"Shadow Man"},c3f806eaeddec207:{name:"Shadow Man"},e537c460e31e25a2:{name:"Shadow Man"},ce97680354fad4e0:{name:"Shadowgate 64 - Trials of the Four Towers"},"556fb4020b8d7761":{name:"Shadowgate 64 - Trials of the Four Towers"},"84ea4ed8b4f1b245":{name:"Shadowgate 64 - Trials of the Four Towers"},f2fcc12bf40d9a7b:{name:"Shadowgate 64 - Trials of the Four Towers"},"0c28d5b12abca74b":{name:"Sim City 2000"},b00fbcb6982181e3:{name:"Sin and Punishment - Tsumi To Batsu",save:"Eeprom4k"},"19d5f42e5e0c4ac6":{name:"Snow Speeder"},"9deaf4dbc0823e33":{name:"Snowboard Kids"},ff04fc84e93c25b1:{name:"Snowboard Kids"},a0cdd75fad51bbd9:{name:"Snowboard Kids"},ea290c93bf459293:{name:"Snowboard Kids 2",save:"Eeprom4k"},"1a1d75c2ff9bc1f8":{name:"Snowboard Kids 2",save:"Eeprom4k"},"512321224b594640":{name:"Sonic Wings Assault",save:"Eeprom4k"},"39e9cb7e9517333c":{name:"South Park"},"6236b5209f89617b":{name:"South Park"},"48a90cc04bd3608e":{name:"South Park - Chef's Luv Shack"},"76b2f307393d8fec":{name:"South Park Rally"},"3afc8a4ff22d91f7":{name:"South Park Rally"},"123446378d38c5ea":{name:"Space Dynamites",save:"Eeprom4k"},"9723feeb34da74ff":{name:"Space Invaders"},"8438e2bfafea48ef":{name:"Spacestation Silicon Valley",save:"Eeprom4k"},"72e270fcaae7ff08":{name:"Spacestation Silicon Valley",save:"Eeprom4k"},"71d10ea66ed0853d":{name:"Spider-Man"},"6805ed0d5e510215":{name:"St. Andrews Old Course"},f815d0a743aa8922:{name:"Star Fox 64",save:"Eeprom4k"},c1a7caff37858568:{name:"Star Fox 64",save:"Eeprom4k"},a00b78ba34db210f:{name:"Star Fox 64",save:"Eeprom4k"},"853cd9dde881e3da":{name:"Star Soldier Vanishing Earth",save:"Eeprom4k"},"23eb03b73ae5aa28":{name:"Star Soldier Vanishing Earth",save:"Eeprom4k"},"42a263f13b9b44f2":{name:"Star Twins"},"124aa266c26aaf22":{name:"Star Wars - Rogue Squadron",save:"Eeprom4k"},a2bd5c164622a605:{name:"Star Wars - Rogue Squadron",save:"Eeprom4k"},c1919121613c1833:{name:"Star Wars - Rogue Squadron",save:"Eeprom4k"},ec4ba2664fd9ad2e:{name:"Star Wars - Rogue Squadron",save:"Eeprom4k"},bbe8e07eaa11e449:{name:"Star Wars - Rogue Squadron",save:"Eeprom4k"},"63ac24fe17aa411b":{name:"Star Wars - Shadows of the Empire",save:"Eeprom4k"},"8166484d45927dab":{name:"Star Wars - Shadows of the Empire",save:"Eeprom4k"},"5c7e4d2622468718":{name:"Star Wars - Shadows of the Empire (v1.0)",save:"Eeprom4k"},"91b0474160102563":{name:"Star Wars - Shadows of the Empire (v1.1)",save:"Eeprom4k"},"54edd74d7d28f974":{name:"Star Wars - Shadows of the Empire (v1.2)",save:"Eeprom4k"},"90487e82dc688495":{name:"Star Wars - Shuggeki Rogue Chitai",save:"Eeprom4k"},"9b98023de281a3d4":{name:"Star Wars Episode I - Battle for Naboo",save:"Eeprom4k"},e2ace6ea84430b02:{name:"Star Wars Episode I - Battle for Naboo",save:"Eeprom4k"},"9803f7728ba95665":{name:"Star Wars Episode I - Racer",save:"Eeprom16k"},"52b1f561ab226104":{name:"Star Wars Episode I - Racer",save:"Eeprom16k"},c42ded5302802506:{name:"Star Wars Episode I - Racer",save:"Eeprom16k"},fbfb8406a5a83e5d:{name:"StarCraft 64",save:"FlashRam"},a35ecf42df34139a:{name:"StarCraft 64",save:"FlashRam"},c32c9bbca54dd04e:{name:"StarCraft 64 (beta)",save:"FlashRam"},b8a5ed9403e97386:{name:"Starshot - Space Circus Fever",save:"Eeprom4k"},"550e9ed89aa97ab1":{name:"Starshot - Space Circus Fever",save:"Eeprom4k"},d7d81095d20d1035:{name:"Stunt Racer 64"},"696b64f4951075c5":{name:"Super B-Daman - Battle Phoenix 64"},"5a211daa9abecb91":{name:"Super Bowling 64"},"85f3f2f37f0c496e":{name:"Super Bowling 64"},f08cbca5f651bad8:{name:"Super Mario 64 - Star Road",save:"Eeprom4k"},"76d1fe61f9bb05ea":{name:"Super Mario 64 - The Missing Stars v2",save:"Eeprom4k"},"88aefe21241410a4":{name:"Super Mario 64 - The Missing Stars",save:"Eeprom4k"},d5ba7f26dcfa9375:{name:"Super Mario 64 Ru",save:"Eeprom4k"},c5425a63dc8ec5bd:{name:"Super Mario 64 Extended",save:"Eeprom4k"},ff2b5a632623028b:{name:"Super Mario 64",save:"Eeprom4k"},"0e3daa4e247c7574":{name:"Super Mario 64",save:"Eeprom4k"},"36f03ca0d2c5c1bc":{name:"Super Mario 64",save:"Eeprom4k"},a8a4fbd62caa2663:{name:"Super Mario 64 Shindou Edition",save:"Eeprom4k"},"80205766e148e328":{name:"Super Robot Spirits"},"10d84916d2d63af7":{name:"Super Robot Taisen 64"},"5b8b6b91a4850b78":{name:"Super Smash Brothers",save:"SRAM"},"485f9493302e0f5c":{name:"Super Smash Brothers",save:"SRAM"},a1fd26dde36b4acb:{name:"Super Smash Brothers",save:"SRAM"},"222ee09cb0f16e20":{name:"Super Speed Race 64"},"532545c1d9247b5d":{name:"Supercross 2000"},"7f12bb2cd8bfc209":{name:"Supercross 2000"},"5bf3e8a2d987dcc9":{name:"Superman - The Animated Series"},"74ab4cb4299a0207":{name:"Superman - The Animated Series"},f311e83524277999:{name:"Susume! Taisen Puzzle Dama Toukon! Marumata Chou"},"56a48bb9af762b5b":{name:"Tamagotchi World 64",save:"Eeprom4k"},"54ddbcae4a83ff15":{name:"Taz Express",save:"Eeprom4k"},bb2f04d97c99fffc:{name:"Telefoot Soccer 2000"},a6db3a969bc8d5f7:{name:"Tetris 64"},beda1f3cbae0a402:{name:"Tetrisphere",save:"Eeprom4k"},a984e60fc47ab78b:{name:"Tetrisphere",save:"Eeprom4k"},"161b7d91e19b1f83":{name:"The Legend of Zelda - OoT Nightmare Mod",save:"SRAM"},c7c7b1f831a4fc1e:{name:"The Legend of Zelda - Ocarina of Time Ru",save:"SRAM"},"4fecec6a144892f0":{name:"The Legend of Zelda - Majora's Mask ",save:"FlashRam"},E585C39FC705CC3E:{name:"The Legend of Zelda - Majora's Mask Debug",save:"FlashRam"},b71170ec2bd71676:{name:"The Legend of Zelda - Ocarina of Time (v1.0)",save:"SRAM"},"1a0034f006ed47ae":{name:"The Legend of Zelda - Ocarina of Time Master Quest (GC)",save:"SRAM"},"69b544b085193c37":{name:"The Legend of Zelda - Ocarina of Time (v1.0)",save:"SRAM"},"1fa83dd4191e1e02":{name:"The Legend of Zelda - Ocarina of Time (v1.1)",save:"SRAM"},bd5f05b20c4eab0b:{name:"The Legend of Zelda - Ocarina of Time (v1.1)",save:"SRAM"},aea23b699f4ef1b7:{name:"The Legend of Zelda - Ocarina of Time (v1.2)",save:"SRAM"},c35a46091b50cbf8:{name:"The Legend of Zelda - Ocarina of Time (GC)",save:"SRAM"},f6187d915354bc69:{name:"The Legend of Zelda - Zelda's Birthday",save:"SRAM"},"08eb43b49311b34d":{name:"The Legend of Zelda - Majora's Mask (GC)",save:"FlashRam"},"459379bf027aff39":{name:"The Legend of Zelda - Majora's Mask (Demo)",save:"FlashRam"},"1c635453f0dea203":{name:"The Legend of Zelda - Majora's Mask",save:"FlashRam"},c65579e9388d33bc:{name:"The Legend of Zelda - Majora's Mask",save:"FlashRam"},ba35ddf375e05241:{name:"The Legend of Zelda - Ocarina of Time (GC)",save:"SRAM"},f336411da9ee63af:{name:"The Legend of Zelda - OOT (Master Quest)",save:"SRAM"},"3f14532151632d99":{name:"The New Tetris",save:"SRAM"},"0aff1ce6710d1cce":{name:"The New Tetris",save:"SRAM"},"33ddbf4e849d4c66":{name:"Tigger's Honey Hunt",save:"FlashRam"},"2ff7c4e006159e76":{name:"Tigger's Honey Hunt",save:"FlashRam"},"1c39e76333eacce6":{name:"Tom and Jerry in Fists of Furry",save:"Eeprom4k"},fb4e4f2bfe11c543:{name:"Tom and Jerry in Fists of Furry",save:"Eeprom4k"},"3329418ddb648f58":{name:"Tom Clancy's Rainbow Six"},"35f36b4881cc4d03":{name:"Tom Clancy's Rainbow Six"},"420c2a397de790b7":{name:"Tom Clancy's Rainbow Six"},"3daf7548a2d3669a":{name:"Tom Clancy's Rainbow Six"},"14979eef7d2c3bc0":{name:"Tonic Trouble"},"6e913f0998b60844":{name:"Tonic Trouble"},"22c04e2085d119b1":{name:"Tony Hawk's Pro Skater (v1.0)"},"804114e0c9780b65":{name:"Tony Hawk's Pro Skater (v1.1)"},a526899f09b48705:{name:"Tony Hawk's Pro Skater"},"57b5ea840f198ac8":{name:"Tony Hawk's Pro Skater 2"},"180e1599a5e66612":{name:"Tony Hawk's Pro Skater 2"},"99150E181266E6A5":{name:"Tony Hawk's Pro Skater 2"},b5707f1afdb9b700:{name:"Tony Hawk's Pro Skater 3"},bf6e749a99ea0228:{name:"Toon Panic (Proto)"},f002cc8e81de8b7f:{name:"Top Gear Hyper-Bike",save:"Eeprom4k"},c6493f5fb014c70d:{name:"Top Gear Hyper-Bike",save:"Eeprom4k"},"80cd41d712b9a9ac":{name:"Top Gear Overdrive",save:"Eeprom4k"},"4ff2780517bf7591":{name:"Top Gear Overdrive",save:"Eeprom4k"},"38a59bd089541a1c":{name:"Top Gear Overdrive",save:"Eeprom4k"},"3d9b2662e8b111fe":{name:"Top Gear Rally",save:"Eeprom4k"},"4762590e8b4b3d75":{name:"Top Gear Rally",save:"Eeprom4k"},"01e7437fd1286353":{name:"Top Gear Rally",save:"Eeprom4k"},e07359beb8edb089:{name:"Top Gear Rally 2"},d62cefcfe673e9c9:{name:"Top Gear Rally 2"},"77b6babee4b5b051":{name:"Top Gear Rally 2"},"77d32df847b33f8c":{name:"Top Gear Rally 2"},a43c70efc99a4a4d:{name:"Toukon Road - Brave Spirits"},"437f1c551c834991":{name:"Toukon Road 2 - The Next Generation"},"75902a781d6352e5":{name:"Toy Story 2"},"3e7450a1cd2225cf":{name:"Toy Story 2"},"97db93cbd5635c7f":{name:"Toy Story 2"},"5838ebcc972d9526":{name:"Toy Story 2"},"436b4bfea7291d08":{name:"Triple Play 2000"},"0ffae466d0c788de":{name:"Turok - Legenden des Verlorenen Landes"},"8b49b9ad558ff2da":{name:"Turok - Rage Wars"},"1462a21e0f9090e7":{name:"Turok - Rage Wars"},dd09702f53ac3bfc:{name:"Turok - The Dinosaur Hunter"},"63d95f661266ccb5":{name:"Turok - The Dinosaur Hunter"},b8e66a9122ab1788:{name:"Turok - The Dinosaur Hunter"},"0df1702fff87415c":{name:"Turok - The Dinosaur Hunter (v1.0)"},dd095f6653ac3bfc:{name:"Turok - The Dinosaur Hunter (v1.0)"},cd0d702fc9c56c17:{name:"Turok - The Dinosaur Hunter (v1.1/v1.2)"},"49770e2e599db4b8":{name:"Turok 2 - Seeds of Evil"},"942bb9e025e0a7b9":{name:"Turok 2 - Seeds of Evil"},"0b8405fe0c329393":{name:"Turok 2 - Seeds of Evil"},"118a08497e959464":{name:"Turok 2 - Seeds of Evil"},"942bb9e0bd7ce880":{name:"Turok 2 - Seeds of Evil"},fc5ac9e8da21d135:{name:"Turok 2 - Seeds of Evil - Kiosk"},f179a589ef977e66:{name:"Turok 3 - Shadow of Oblivion"},f22f166a4c709320:{name:"Turok 3 - Shadow of Oblivion"},"329dc9bb80aa7d11":{name:"Twisted Edge Extreme Snowboarding"},b8a588e6183f4bb1:{name:"Twisted Edge Extreme Snowboarding"},"7851da6ec1fe96d3":{name:"Vigilante 8"},"6a0571ea474821e4":{name:"Vigilante 8"},a282bce294d61c59:{name:"Vigilante 8"},f4791f15e5c8ed8e:{name:"Vigilante 8"},"6d86c5f5d9132705":{name:"Vigilante 8 - 2nd Offense"},"7ebc10dd51b300f9":{name:"Vigilante 8 - 2nd Offense"},"986c006081a30526":{name:"Violence Killer - Turok New Generation"},"8b24b3824d243ee7":{name:"Virtual Chess 64"},"21a2da2fcea788a5":{name:"Virtual Chess 64"},"43764a4ed73974a3":{name:"Virtual Pool 64"},d0f2f9989cf0d903:{name:"Virtual Pool 64"},c4085c048b79fd4a:{name:"Virtual Pro Wrestling",save:"Eeprom4k"},"354209cd624b0788":{name:"Virtual Pro Wrestling 2",save:"SRAM"},"3890053c8221bfc8":{name:"V-Rally Edition 99",save:"Eeprom4k"},a524024d9457eb1b:{name:"V-Rally Edition 99",save:"Eeprom4k"},"196b6e635fdc7de5":{name:"V-Rally Edition 99",save:"Eeprom4k"},"8ad56680c1cadec3":{name:"Waialae Country Club - True Golf Classics",save:"Eeprom4k"},"75300593430f1e26":{name:"Waialae Country Club - True Golf Classics",save:"Eeprom4k"},ad57500c6e126e04:{name:"Waialae Country Club - True Golf Classics (1.1)",save:"Eeprom4k"},e28c31ddba9837b7:{name:"Waialae Country Club - True Golf Classics (1.1)",save:"Eeprom4k"},f628fef7c3acf2c3:{name:"War Gods"},"70cc15d7d6f51c27":{name:"War Gods"},d691915c06c30ab3:{name:"Wave Race 64",save:"Eeprom4k"},"96fa0e65a7f9dd30":{name:"Wave Race 64",save:"Eeprom4k"},"531fe17d9d2f8774":{name:"Wave Race 64 (v1.0)",save:"Eeprom4k"},"614b2f496a14e504":{name:"Wave Race 64 (v1.1)",save:"Eeprom4k"},e2f35d53f1899760:{name:"Wave Race 64 Shindou Edition",save:"Eeprom4k"},"59aa3bdc6a45bb0a":{name:"Wayne Gretzky's 3D Hockey v1.1"},"3f22456b565c0ef0":{name:"Wayne Gretzky's 3D Hockey"},"431030f11a5480fd":{name:"Wayne Gretzky's 3D Hockey"},"4b090922af59952c":{name:"Wayne Gretzky's 3D Hockey"},"59389d5a10e7aa97":{name:"Wayne Gretzky's 3D Hockey '98"},f3451b666d26d69e:{name:"Wayne Gretzky's 3D Hockey '98"},dd5a6f39a7ec9366:{name:"WCW Backstage Assault"},d68cbe33126918ec:{name:"WCW Mayhem"},"58067baa7b93969c":{name:"WCW Mayhem"},"1a5ac4d45eb225f4":{name:"WCW Nitro"},"68afdb8b364b5b34":{name:"WCW vs. NWO - World Tour"},bd193e2c5eee1351:{name:"WCW vs. NWO - World Tour (v1.0)"},b960be713cfbdb1d:{name:"WCW vs. NWO - World Tour (v1.2)"},ab96e5dee77a3baf:{name:"WCW-NWO Revenge",save:"SRAM"},"75a8e86886a4e70c":{name:"WCW-NWO Revenge",save:"SRAM"},"4fb5a8ce03d5217f":{name:"Wetrix"},faeab6dca3cfbbc6:{name:"Wetrix"},"2b0996e84e4d24dc":{name:"Wheel of Fortune"},c7c4eb0c32e99c0c:{name:"Wild Choppers",save:"Eeprom4k"},"7e9598edacdc4282":{name:"WinBack - Covert Operations"},e056a01f6a94b9a4:{name:"WinBack - Covert Operations"},af8c89d55bb60760:{name:"WinBack - Covert Operations"},"32272d1318910ec7":{name:"Wipeout 64"},"7d0e3154d830546b":{name:"Wipeout 64"},"65973ce4bec1b105":{name:"Wonder Project J2"},"38594b3a9d986fa2":{name:"Wonder Project J2 (English)"},f7881e4f963f5a4a:{name:"Wonder Project J2 (English)"},"6a6d63bdba541f5d":{name:"World Cup 98"},"9030fcf9c24e01ff":{name:"World Cup 98"},c8fe8d30f6b52ece:{name:"World Driver Championship"},"782706acb8fcaddf":{name:"World Driver Championship"},a059e913b0ca930e:{name:"Worms - Armageddon",save:"Eeprom4k"},"7bc5212d8cc5e48f":{name:"Worms - Armageddon",save:"Eeprom4k"},"0fec5bcd0810fd86":{name:"WWF - War Zone"},a475a233594450b8:{name:"WWF - War Zone"},c851318f45f53a4f:{name:"WWF Attitude"},"142fbed288374538":{name:"WWF Attitude"},"7b5bf45be8ee6b59":{name:"WWF Attitude"},"40064b4efbbc491b":{name:"WWF No Mercy",save:"FlashRam"},"8ef08d6dcfc308d0":{name:"WWF No Mercy (v1.0)",save:"FlashRam"},c294db8cf0c646cb:{name:"WWF No Mercy (v1.1)",save:"FlashRam"},"0390a59064980831":{name:"WWF WrestleMania 2000",save:"SRAM"},a57d731259919623:{name:"WWF Wrestlemania 2000",save:"SRAM"},be5313c7eea609aa:{name:"WWF WrestleMania 2000",save:"SRAM"},"9dae5305c1e0d8ea":{name:"Xena Warrior Princess - Talisman of Fate"},c767160aa6463329:{name:"Xena Warrior Princess - Talisman of Fate"},c3968b9fdc9411a0:{name:"Yakouchuu II - Satsujun Kouru"},e8d83723ec7c8e6b:{name:"Yoshi's Story",save:"Eeprom16k"},"60cacf2d47b15483":{name:"Yoshi's Story",save:"Eeprom16k"},"497df9d35b132469":{name:"Yoshi's Story",save:"Eeprom16k"},"8d3bda777c0d2b16":{name:"Yosuke no Mahjong Juku",save:"Eeprom4k"},"2d16e69f37407ee9":{name:"Yuke Yuke!! Trouble Makers"},c1d0738466061223:{name:"Zelda no Densetsu 2 - Mujura no Kamen",save:"FlashRam"},b82df5f736e69521:{name:"Zelda no Densetsu - Toki no Ocarina Collectors Ed.",save:"SRAM"},baf411f65c1384c5:{name:"Zelda no Densetsu - Toki no Ocarina (GC)",save:"SRAM"},ba453bf46f9b0e2f:{name:"Zelda no Densetsu - Toki no Ocarina (GC)",save:"SRAM"},"127341ec5fde31eb":{name:"Zelda no Densetsu 2 - Mujura no Kamen",save:"FlashRam"},"3804ae69f3f3632c":{name:"Zelda no Densetsu 2 - Mujura no Kamen (1.1)",save:"FlashRam"},cd0c011cfab7d322:{name:"Zool - Majou Tsukai Densetsu"},"54a43977662af5a2":{name:"A HORiZON64 RELEASE"},"91d8ab5ccef62962":{name:"Fishy by NaN v0.3141"},bc069a1355006b41:{name:"Mind Present-Readme"},b1cb11c87c61b78f:{name:"Mind Present / DNX"},"54f53fcb0bcd7387":{name:"Tron Demo"},"4549049c0c0b1ed3":{name:"POM99 - README"},"7a7d3b994df0542e":{name:"POM99 - MADEIRAGAMES"},"575aa9a37dc2e69f":{name:"POM99 - WET DREAMS"},"95c03bca0a864996":{name:"POM99 - CAN-BETA"},d44a7da4f981fa8b:{name:"Manic Miner 64"},"2d369c9d086be65b":{name:"Shag-a-delic/CAMELOT"},c479518fdc263580:{name:"Space Rotator"},"70bb552625997d66":{name:"O.D.T.",save:"Controller"},a61564e8535b3998:{name:"O.D.T.",save:"Controller"}};class bZ{domLoaded(){n64js.hideDebugger(),$(".tabbable a").on("shown.bs.tab",(J)=>{n64js.debugger().redraw()}),n64js.debugger().redraw()}triggerLoad(){const J=document.getElementById("fileInput");J.value="",J.click()}loadFile(){const J=document.getElementById("fileInput");if(J&&J.files.length>0){const Q=J.files[0],q=new FileReader;q.onerror=(Y)=>{this.displayError("loading file")},q.onload=(Y)=>{n64js.loadRomAndStartRunning(Y.target.result)},q.readAsArrayBuffer(Q)}}displayWarning(J){this.displayAlert("Warning",J)}displayError(J){this.displayAlert("Error",J)}displayAlert(J,Q){const Y=document.getElementById("alert").content.cloneNode(!0),Z=Y.querySelector(".alert-type"),K=Y.querySelector(".alert-message");Z.textContent=J+"!",K.textContent=Q,$("#alerts").append(Y)}setRunning(J){const Q=J?'<i class="bi-pause"></i> Pause':'<i class="bi-play"></i> Run';$("#runbutton").html(Q)}}var vZ=function(J){p8=J,SZ.setRunning(J)},jM=function(J){const Q=md5(J);M(`hash is ${Q}`)},NM=function(J){y5(J),jM(J);const Q=m0.createROM(J),q={header:Q.getU32(0),clock:Q.getU32(4),bootAddress:Q.getU32(8),release:Q.getU32(12),crclo:Q.getU32(16),crchi:Q.getU32(20),unk0:Q.getU32(24),unk1:Q.getU32(28),name:c7(Q.u8,32,20),unk2:Q.getU32(52),unk3:Q.getU16(56),unk4:Q.getU8(58),categoryCode:ZK(Q.getU8(59)),cartId:Q.getU16(60),countryId:Q.getU8(62),romVersion:Q.getU8(63)};console.log(q);const Y=$('<table class="register-table"><tbody></tbody></table>'),Z=Y.find("tbody");for(let X in q){const W=typeof q[X]==="string"?q[X]:j(q[X]);Z.append(`<tr><td>${X}</td><td>${W}</td></tr>`)}zK(Y),O0.cic=o7(Q.u8),O0.id=n7(q.crclo,q.crchi),O0.country=q.countryId,O0.tvType=YK(q.countryId);const K=l7[O0.id];if(K)M(`Loaded info for ${O0.id} from db`),O0.name=K.name,O0.save=K.save;else M(`No info for ${O0.id} in db`),O0.name=q.name,O0.save="Eeprom4k";M(`rominfo is ${RZ(O0)}`),$("#title").text(`n64js - ${O0.name}`)},GM=function(){const J=[],Q=new XMLHttpRequest;if(Q.open("GET","roms/n64-systemtest-all.z64",!0),Q.responseType="arraybuffer",Q.onload=(q)=>{const Y=Q.response;if(Y)n64js.loadRomAndStartRunning(Y)},Q.send(null),Q.status!=200)return;for(let q=0;q<Q.responseText.length;++q)J.push(Q.responseText.charCodeAt(q)&255)},_Z=function(){if(J6)J6.begin();if(p8){if(requestAnimationFrame(_Z),n64js.hardware().aiRegDevice.shouldSkipFrame())return;let J=zM;if(n64js.debuggerVisible()&&!MW())J=m8.debugCycles;if(jK())J=NK(J);if(J>0)n64js.cpu0.run(J),m8.redraw()}else if(UW())requestAnimationFrame(_Z),OW(),x9();if(J6)J6.end()},fZ=function(J){return(J>>26&63)===d7},r7=function(J){return J+"-"+O0.id},LM=function(J){const Q=O0.name?`n64js - ${O0.name} - ${J}mspf`:`n64js - ${J}mspf`;$("#title").text(Q)},i7=function(J,Q){if(vZ(!1),uZ(),M('<span style="color:red">'+J+"</span>"),Q)n64js.ui().displayError(J)},uZ=function(){n64js.cpu0.breakExecution()};window.n64js=window.n64js||{};var d7=28,zM=1e8,J6=null,p8=!1,bJ=new Map,a7=[],HM={runTest:()=>{GM()}};P6.add(HM,"runTest").name("Run n64-systemtest");var O0={id:"",name:"",cic:"6101",country:qK,tvType:JJ,save:"Eeprom4k"},m0=new BZ(O0),TZ=new rQ,FM=new iQ(m0,TZ.inputs),SZ=new bZ,m8=null;n64js.hardware=()=>m0;n64js.joybus=()=>FM;n64js.ui=()=>SZ;n64js.debugger=()=>m8;n64js.loadRomAndStartRunning=(J)=>{NM(J),n64js.reset(),m8.redraw(),vZ(!1),n64js.toggleRun()};n64js.toggleRun=()=>{if(vZ(!p8),p8)_Z()};n64js.toggleFullscreen=()=>{document.getElementById("display").requestFullscreen().catch((Q)=>{console.log(`Error attempting to enable fullscreen mode: ${Q.message} (${Q.name})`)})};n64js.breakEmulationForDisplayListDebug=()=>{if(p8)n64js.toggleRun(),uZ()};n64js.step=()=>{if(!p8)n64js.singleStep(),m8.redraw()};n64js.getInstruction=(J)=>{const Q=m0.memMap.readMemoryInternal32(J);if(fZ(Q))return bJ[J]||0;return Q};n64js.isBreakpoint=(J)=>{const Q=m0.memMap.readMemoryInternal32(J);return fZ(Q)};n64js.toggleBreakpoint=(J)=>{const Q=m0.memMap.readMemoryInternal32(J);let q;if(fZ(Q))q=bJ[J]||0,delete bJ[J];else q=d7<<26,bJ[J]=Q;m0.memMap.writeMemoryInternal32(J,q)};n64js.getLocalStorageItem=(J)=>{const Q=r7(J),q=localStorage.getItem(Q);return q?p7(q):void 0};n64js.setLocalStorageItem=(J,Q)=>{const q=r7(J),Y=RZ(Q);localStorage.setItem(q,Y)};var s7,vQ;n64js.emitRunningTime=(J)=>{const Y=((new Date()).getTime()-s7.getTime()).toString();n64js.ui().displayWarning(`Time to ${J} ${Y}`)};n64js.onPresent=()=>{const J=new Date;if(vQ){const Q=J.getTime()-vQ.getTime();LM(Q)}vQ=J};n64js.addResetCallback=(J)=>{a7.push(J)};n64js.reset=()=>{bJ.clear(),FK(),m0.reset(),W5(m0),x$(m0),VW(),m0.loadROM(),KK(n64js.cpu0,m0,O0),s7=new Date,vQ=void 0;for(let J of a7)J()};n64js.verticalBlank=()=>{m0.verticalBlank()};n64js.check=(J,Q)=>{if(!J)M(Q)};n64js.warn=(J)=>{$K(J)};n64js.stopForBreakpoint=()=>{i7("Breakpoint",!1)};n64js.halt=(J)=>{i7(J,!0)};n64js.returnControlToSystem=()=>{uZ()};n64js.init=()=>{n64js.reset(),m8=new pY,PW($("#display"));const J=document.querySelector("body");J.addEventListener("keyup",(Q)=>{TZ.handleKey(0,Q.key,!1)}),J.addEventListener("keydown",(Q)=>{TZ.handleKey(0,Q.key,!0)}),SZ.domLoaded()};n64js.togglePerformance=()=>{const J=document.getElementById("performance");if(J6)J.removeChild(J6.dom),J6=null;else J6=new Stats,J6.showPanel(1),J6.dom.style.position="relative",J.appendChild(J6.dom)};
